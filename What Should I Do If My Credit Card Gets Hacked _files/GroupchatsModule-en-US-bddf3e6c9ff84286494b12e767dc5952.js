if("undefined"==typeof mantle)var mantle={};if("undefined"==typeof mantle.components&&(mantle.components={}),"undefined"==typeof mantle.components.post&&(mantle.components.post={}),"undefined"==typeof mantle.components.post.meta&&(mantle.components.post.meta={}),"undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.replies&&(tiger.components.forms.replies={}),"undefined"==typeof tiger.components.groupchats&&(tiger.components.groupchats={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.inset&&(tiger.components.post.inset={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),define("module/base/ModuleBase",["lib/underscore","view/BaseView"],function(a,b){var c=b.extend({handledEvents:{},initialize:function(){a.each(this.handledEvents,function(a,b){this.on(b,this[a],this)},this)},start:function(){},setOptions:function(b){this.options=a.defaults(b,this.options,{services:this.services})},remove:function(){this.off(null,null,this)}});return c}),tiger.components.post.inset.referencedWideLSMock=function(a,b,c){var d=b||new soy.StringBuilder,e=a.insets.length>1,f=a.insets.length>2;d.append('<aside class="referenced-wide referenced-wide-ls referenced-editor proxima',f?" referenced-carousel":"",'" contentEditable="false"><div class="row">'),f&&tiger.components.post.inset.referenceNavigation(null,d,c);for(var g=a.insets,h=g.length,i=0;h>i;i++){var j=g[i];d.append('<div class="referenced-item referenced-editor-item columns',e?" medium-6":"",i>1?" hide":"",'" data-uid="',soy.$$escapeHtml(j.uid),'"><a href="javascript:;" class="js_skip-inset close" aria-hidden="true">&times;</a>',j.thumbnails.length>0?'<div class="'+(e?"small-6":"small-3")+' columns pln referenced-item-image"><a href="'+soy.$$escapeHtml(j.url)+'"><span class="img-border"><img src="'+soy.$$escapeHtml(j.thumbnails[0])+'" /></span></a></div>':"",j.headline?'<h6 class="headline"><a href="'+soy.$$escapeHtml(j.url)+'">'+soy.$$filterNoAutoescape(j.headline)+"</a></h6>":"",j.description?'<p class="text">'+soy.$$filterNoAutoescape(soy.$$truncate(j.description,90,!0))+' <a href="'+soy.$$escapeHtml(j.url)+'">Readâ€¦</p>':"","</div>")}return d.append("</div></aside>"),b?"":d.toString()},tiger.components.post.inset.referenceNavigation=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="referenced-nav hide-for-small"><div class="nav-arrow prev js_previous_inset hide"><a href="#" class="icon inline notranslate" onclick="javascript:return false;">3</a></div><div class="nav-arrow next js_next_inset"><a href="#" class="icon inline notranslate" onclick="javascript:return false;">4</a></div></div>'),b?"":c.toString()},define("templates/tiger/components/post/inset/referenced-permalink",function(){}),define("view/items/InsetTools",["lib/underscore","lib/jquery","view/BaseView","templates/tiger/components/post/inset/referenced-permalink"],function(a,b,c){var d=c.extend({initialize:function(){this.render()},render:function(){var a=this,c=this.$(".js_inset-groups aside");c.each(function(c,d){var e=b(d),f=e.data("ids");a.hideEmptyThumbnails(e),a.$("#inset_placeholder_"+f).replaceWith(e)}),this.initEvents()},initEvents:function(){this.$(".js_next_inset").off("click.inset").on("click.inset",b.proxy(function(a){this.changeInset(a,"next")},this)),this.$(".js_previous_inset").off("click.inset").on("click.inset",b.proxy(function(a){this.changeInset(a,"prev")},this))},changeInset:function(a,c){var d,e,f,g,h,i,j=b(a.target).closest(".referenced-wide"),k=j.find(".referenced-item:not(.hide)");return d=function(a){a.fadeIn(200,function(){b(this).removeClass("hide")})},e=function(a){a.fadeOut(200,function(){b(this).addClass("hide")})},f=function(){h=k.last().nextAll(".referenced-item:lt(2)"),i=k.slice(0,h.length),j.find(".js_previous_inset").removeClass("hide"),k.nextAll(".referenced-item").length<=2&&j.find(".js_next_inset").addClass("hide")},g=function(){h=k.first().prevAll(".referenced-item:lt(2)"),i=k.slice(-1*h.length),j.find(".js_next_inset").removeClass("hide"),k.prevAll(".referenced-item").length<=2&&j.find(".js_previous_inset").addClass("hide")},"next"===c?f():g(),h.length>0&&i.length>0&&(d(h),e(i)),!1},hideEmptyThumbnails:function(a){var c=a.find(".referenced-item");c.each(function(a,c){var d=b(c).find("img"),e=d.clone(),f=d.closest(".six");f.addClass("hide"),e.load(function(){f.removeClass("hide"),e.remove()}),e.removeClass().appendTo("body")})},removeInsetGroup:function(b){a.each(b,function(a){var b=a.$parent,c=a.$insetGroup;b&&b.data("insets",[]),c&&c.remove()})},renderFromObject:function(c){var d,e,f,g=[];return d=function(b){return a.find(g,function(a){return a.$parent.is(b)})},e=function(a){g.push({$parent:a,insets:[]})},f=function(a){var b=d(a.$parent);b&&b.insets.push(a)},a.each(c,function(a){d(a.$parent)||e(a.$parent),f(a)}),a.each(g,function(c){var d;d=this.soyToHtml(tiger.components.post.inset.referencedWideLSMock,{insets:a.pluck(c.insets,"data")}),c.$parent.next(".referenced-wide").remove(),d=b(d).insertAfter(c.$parent),c.$parent.data("$inset",d),a.each(c.insets,function(a){a.$insetGroup=d})},this),g},removeEmptySibling:function(a,b){var c=a[b](),d=c.text();(!d||""===d||1===d.length&&/[^u\200B]/.test(d))&&c.remove()}});return d}),mantle.components.post.meta.avatarDisplay=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;return d.append('	<div class="avatar-container js_avatar-container"><span class="icon icon-followed notranslate">O</span>',a.url&&"http://"!=a.url?'<a href="'+soy.$$escapeHtml(a.url)+'"'+(a.nofollow?' rel="nofollow"':"")+">":"",a.stacked&&"true"==a.stacked?'<div class="avatar-stack"><span class="img-border"><img src="'+(a.avatar?soy.$$escapeHtml(a.avatar):soy.$$escapeHtml(c.meta.assets.images)+"icons/avatar-big.png")+'" class="avatar-mini" /></span><span></span><span></span></div>':'<span class="img-border"><img src="'+(a.avatar?soy.$$escapeHtml(a.avatar):soy.$$escapeHtml(c.meta.assets.images)+"icons/avatar-big.png")+'" class="avatar" /></span>',a.url&&"http://"!=a.url?"</a>":"","</div>"),b?"":d.toString()},mantle.components.post.meta.avatarContainer=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder("avt-large");return e=e.toString(),a.post.showByline&&""==a.post.byline?(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id)?mantle.components.post.meta.avatarDisplay({url:"http://"+soy.$$escapeHtml(a.canonicalHost),avatar:window.kinja.imageUrl(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id,e),nofollow:a.post.isPromoted,stacked:a.stacked},d,c):mantle.components.post.meta.avatarDisplay(null,d,c):(null==a.post.salesAvatarMap?null:a.post.salesAvatarMap.id)?mantle.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(window.kinja.imageUrl(a.post.salesAvatarMap.id,e)),stacked:a.stacked},d,c):mantle.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(c.meta.assets.images),stacked:a.stacked},d,c),b?"":d.toString()},mantle.components.post.meta.byline=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),!a.post.showByline||a.post.postAction&&a.post.postAction.author||(""==a.post.byline?(d.append('<span class="meta-info display-name strong">',a.canonicalHost?'<a class="text-upper name" href="http://'+soy.$$escapeHtml(a.canonicalHost)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(a.post.author.displayName)+"</a>":'<span class="text-upper maincolor name">'+soy.$$escapeHtml(a.post.author.displayName)+"</span>","</span>"),(!a.post.postAction||a.post.postAction&&"REPOST"!=a.post.postAction.relation)&&""==a.post.byline&&"permalink"!=c.meta.pageType&&(d.append('<span class="follow-links">'),mantle.components.post.button.follow({pageType:c.meta.pageType},d,c),d.append("</span>"))):d.append('<span class="meta-info display-name text-upper strong">',soy.$$filterNoAutoescape(a.post.byline),"</span>")),d.append(a.post.postAction&&a.post.postAction.author?'<span class="meta-info reposted-by pln"><span class="text-upper">'+soy.$$escapeHtml(a.post.postAction.author.displayName)+'</span><span class="trigger-italic phs">Shared a Post by</span><span class="meta-info display-name strong">'+(""==a.post.byline?'<a class="text-upper" href="http://'+soy.$$escapeHtml(a.canonicalHost)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(a.post.author.displayName)+"</a>":soy.$$escapeHtml(a.post.byline))+"</span></span>":""),b?"":d.toString()},mantle.components.post.meta.topByline=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<span class="meta-bg">'),a.post.showByline)if(""==a.post.byline){if(d.append('<span class="meta-info display-name strong"><a class="text-upper" href="http://',soy.$$escapeHtml(a.canonicalHost),'"',a.post.isPromoted?' rel="nofollow"':"",">",soy.$$escapeHtml(a.post.author.displayName),"</a>","reply"==a.mode&&a.post.starterId!=a.post.parentId?'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+soy.$$escapeHtml(a.post.replyMeta.parentAuthor.displayName)+"</span>":"","</span>"),(!a.post.postAction||a.post.postAction&&"REPOST"!=a.post.postAction.relation)&&""==a.post.byline&&"permalink"!=c.meta.pageType&&(d.append('<span class="follow-links">'),mantle.components.post.button.follow({pageType:c.meta.pageType},d,c),d.append("</span>")),c.meta.blog&&a.post.isStarter&&a.post.defaultBlogId!=a.post.author.defaultBlogId&&a.post.defaultBlogId!=c.meta.blog.id||a.forSharedPost){d.append('<span class="meta-info display-name strong published-on">');for(var e=a.post.blogs,f=e.length,g=0;f>g;g++){var h=e[g];d.append(h.id==a.post.defaultBlogId?' <span class="trigger-italic">on</span> <a class="text-upper" href="http://'+soy.$$escapeHtml(h.canonicalHost)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(h.displayName)+"</a>":"")}d.append("</span>")}}else d.append('<span class="meta-info display-name text-upper strong">',soy.$$filterNoAutoescape(a.post.byline),"</span>");return d.append(a.post.postAction&&a.post.postAction.author&&a.post.postAction.author.displayName?'<span class="meta-info reposted-by"><span class="trigger-italic">shared by</span> <span class="text-upper">'+soy.$$escapeHtml(a.post.postAction.author.displayName)+"</span></span>":"","</span>"),b?"":d.toString()},mantle.components.post.meta.publishTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="publish-time js_publish_time" data-publishtime="',soy.$$escapeHtml(a.post.publishTimeMillis),'">'),a.post.postAction&&a.post.postAction.createTime?(d.append('<a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.postAction.createTime},d,c),d.append("</a>")):a.post.publishTime&&("SCHEDULED"==a.post.status?(d.append('Scheduled:<br /><a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append('</a><span class="icon inline text-light notranslate mls">f</span>')):"DRAFT"==a.post.status?(d.append('Draft<br /><a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>")):(d.append('<a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>"))),d.append("</span>"),b?"":d.toString()},mantle.components.post.meta.postScore=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<span class="meta-score meta-separator js_meta-score hide"><span title="',a.post.score.explanation?soy.$$escapeHtml(a.post.score.explanation):"",'">Total score: ',soy.$$escapeHtml(a.post.score.total),"</span><br/>",a.post.score.baseScore>0?'<span title="'+(a.post.score.baseScoreExplanation?soy.$$escapeHtml(a.post.score.baseScoreExplanation):"")+'">Base score: '+soy.$$escapeHtml(a.post.score.baseScore)+"</span><br/>":"",a.post.score.likeScore>0?'<span title="'+(a.post.score.likeScoreExplanation?soy.$$escapeHtml(a.post.score.likeScoreExplanation):"")+'">Recommend score: '+soy.$$escapeHtml(a.post.score.likeScore)+"</span><br/>":"",a.post.score.sumScore>0?'<span title="'+(a.post.score.sumScoreExplanation?soy.$$escapeHtml(a.post.score.sumScoreExplanation):"")+'">Sum score: '+soy.$$escapeHtml(a.post.score.sumScore)+"</span><br/>":"","</span>"),b?"":c.toString()},mantle.components.post.meta.formattedTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="show-on-hover published updated">',soy.$$escapeHtml(a.time.Mddyyhmma),'</span><span class="hide-on-hover">'),mantle.messages.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma},d,c),d.append("</span>"),b?"":d.toString()},mantle.components.post.meta.stats=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<span class="meta-stats">',a.post.viewstats&&a.post.viewstats.nonUniqueFormatted&&"0"!=a.post.viewstats.nonUniqueFormatted?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'" class="viewstats stat-views text-light" '+(a.post.viewstats.uniqueFormatted?' title="'+soy.$$escapeHtml(a.post.viewstats.uniqueFormatted)+' New Visitors"':"")+(""!=a.post.isPromoted?' rel="nofollow"':"")+'><span class="icon notranslate text-light">g</span>&nbsp;<span class="text">'+soy.$$escapeHtml(a.post.viewstats.nonUniqueFormatted)+"</span></a>":"",(a.post.replyCount||0==a.post.replyCount)&&a.post.isStarter?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'#replies" class="viewstats stat-replies text-light"'+(""!=a.post.isPromoted?' rel="nofollow"':"")+'><span class="icon notranslate text-light">L</span>&nbsp;<span class="text">'+soy.$$escapeHtml(a.post.replyCount)+"</span></a>":"","</span>"),b?"":c.toString()},mantle.components.post.meta.sharedReplyMeta=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div class="top-meta proxima"><div class="meta text-micro"><span class="meta-bg"><span class="meta-info reposted-by pln"><span class="text-upper">',soy.$$escapeHtml(null==a.post?null:null==a.post.postAction?null:null==a.post.postAction.author?null:a.post.postAction.author.displayName),'</span><span class="trigger-italic phs">Shared a Reply by</span><span class="meta-info display-name strong"><a class="text-upper" href="http://',soy.$$escapeHtml(a.canonicalHost),'">',soy.$$escapeHtml(a.post.author.displayName),"</a></span></span></span></div>"),mantle.components.post.postToolsNg(a,d,c),d.append("</div>"),b?"":d.toString()},define("templates/mantle/components/post/meta/meta-components",function(){}),tiger.components.post.meta.metaAvatarUrl=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="meta-container"><div class="meta-avatar"><div class="floated-container img-30"><div class="avatar">'),mantle.components.post.meta.avatarDisplay({avatar:a.avatarUrl},d,c),d.append('</div><div class="txt"><span class="display-name">',a.displayName?soy.$$escapeHtml(a.displayName):"",a.parentAuthorDisplayName?'<span class="replyto-author"><span class="icon text-light notranslate">U</span>'+soy.$$escapeHtml(a.parentAuthorDisplayName)+"</span>":"",'</span></div><div class="second-line">Now</div></div></div></div>'),b?"":d.toString()},define("templates/tiger/components/post/meta/meta-avatar-url",function(){}),tiger.components.forms.replies.replyCallout=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="reply-callout-container collapsed"><span class="js_reply-callout-meta">'),tiger.components.post.meta.metaAvatarUrl(a,d,c),d.append('</span><div class="callout-input js_reply-callout-input" data-replyid="',soy.$$escapeHtml(a.parent.id),'">Reply to ',soy.$$escapeHtml(a.parentAuthorDisplayName),"</div></div>"),b?"":d.toString()},define("templates/tiger/components/forms/replies/reply-callout",function(){}),define("module/groupchats/view/OpenReplyForms",["lib/jquery","lib/underscore","templates/mantle/components/post/meta/meta-components","templates/tiger/components/post/meta/meta-avatar-url","templates/tiger/components/forms/replies/reply-callout"],function(a,b){var c={replyform:null,triggeredReply:!1,initReplyForms:function(){this.events=b.extend({"click .js_reply-to-selected-post":"replyToSelected","click .js_reply-prompt-link":"replyToStarter","click .js_edit-reply":"editReply"},this.events),this.delegateEvents()},handleStarterInsert:function(){var a=this.services.resolve("eventDispatcher");a.on("reply:openstarterform",this.insertNewStarter,this)},unhandleStarterInserts:function(){var a=this.services.resolve("eventDispatcher");a.off("reply:openstarterform",this.insertNewStarter,this)},replyToSelected:function(b){var c=a(b.currentTarget).closest(".js_reply"),d=this.services.resolve("currentUser"),e=parseInt(c.data("id"),10);return b.stopPropagation(),this.closeReplyForm(),this.redirectForTouch(b),d.onAuth.done(a.proxy(function(){var b,f,g=this.services.resolve("PostModel",{args:{id:e}}),h=this.services.resolve("utils");d.get("avatar")&&(b=h.imageUrl(d.get("avatar").id,"avt-small",d.get("avatar").format)),c.next(".reply-callout-container").remove(),this.openReplyForm(g).done(a.proxy(function(b){b.on("success",function(a){this.trigger("reply:insert",{$el:f,model:a.model})},this),c.parents(".js_new-reply-container").length?c.after(b.$el).show():c.next(".js_new-reply-container").append(b.$el).show(),b.render(),f=a("<div />").insertAfter(b.$el)},this))},this)),!1},insertNewStarter:function(){var b=window.event;return this.redirectForTouch(b),this.closeReplyForm(),this.openReplyForm(this.model).done(a.proxy(function(b){this.$elements.replyFormContainer.after(b.$el),b.render(),window.setTimeout(function(){var c=a(window).height()/2-b.$el.height()/2;a.scrollTo(b.$el,200,{offset:-1*c})},100),b.on("success",function(b){this.trigger("reply:insert",{$el:a("<div />").prependTo(this.$elements.branchList),model:b.model})},this)},this)),!1},insertReplyCallout:function(b){var c=a(b.currentTarget).closest(".js_reply"),d=c.data("id"),e=this.$("#js_toggled-replies-"+d),f=this.services.resolve("currentUser"),g=this;return f.onAuth.done(a.proxy(function(){var b,h,i=this.services.resolve("PostModel",{args:{id:d}}),j=this.services.resolve("utils");f.get("avatar")&&(b=j.imageUrl(f.get("avatar").id,"avt-small",f.get("avatar").format)),h=c.after(this.soyToHtml(tiger.components.forms.replies.replyCallout,{parent:i,avatarUrl:b,displayName:f.get("displayName"),parentAuthorDisplayName:i.returnElement().author.displayName})).next(".reply-callout-container").find(".js_reply-callout-input").first(),h.on("click",function(b){g.closeReplyForm(b),g.redirectForTouch(b),a(this).parent().toggleClass("collapsed").toggleClass("expanded"),g.openReplyForm(i).done(a.proxy(function(b){var c;b.on("success",function(a){this.trigger("reply:insert",{$el:c,model:a.model}),e.show()},this),b.on("remove",function(){h.parent().toggleClass("collapsed").toggleClass("expanded")}),h.after(b.$el),b.render({},!1),c=a("<div />").appendTo(e)},g))})},this)),!1},replyToPost:function(a){return this.closeReplyForm(a),this.insertReplyCallout(a),!1},editReply:function(b){this.redirectForTouch(b),this.closeReplyForm();var c=a(b.currentTarget).closest(".js_reply"),d=this.services.resolve("PostModel",{args:{id:c.data("id")}});return a.when(this.openReplyForm(d,!0)).done(a.proxy(function(a){var b=this.getFormAncestor();b.after(a.$el),a.render({},!0),a.on("success",function(a){var b=this.getFormAncestor();b.find("#reply_"+a.model.get("id")+" .reply-content").html(a.model.get("display"))},this)},this)),!1},openReplyForm:function(b,c,d){var e=this,f=a.Deferred(),g=this.services.resolve("utils");return void 0===d&&(d="view/editor/Quickreply"),this.triggeredReply||(this.triggeredReply=!0,g.requireModule("module/NewEditor",function(){require([d],function(a){var d=new a({parent:b,isEditMode:c});d.on("success",function(){e.replyform=void 0,e.triggeredReply=!1,this.remove()}),d.on("remove",function(){e.replyform=void 0,e.triggeredReply=!1}),e.replyform=d,f.resolve(d)})})),f.promise()},closeReplyForm:function(b){var c=this.replyform;if(b&&b.target&&(null===c||void 0===c)&&a(b.target).closest(".js_reply").next(".reply-callout-container").remove(),c&&this.triggeredReply){if(!c.confirmRemove())return!1;a(".js_reply-prompt").remove(),c.remove()}},redirectForTouch:function(b){var c,d,e=this.services.resolve("feature");return e.isOn("redactor")?!1:((e.isOn("touchdebug")||e.device.is("handheld")&&e.device.has("touch"))&&b&&(d=a(b.target).closest("a").attr("href"),a(b.target).hasClass("js_reply-callout-input")&&(c=a(b.target).data("replyid"),d="/posts/"+c+"/reply"),d&&(b.stopPropagation(),window.location.href=d)),void 0)},replyToStarter:function(){return this.insertNewStarter(),this.$elements.replyPromptLink.addClass("hide"),!1},getFormAncestor:function(){return this.$elements.branchList}};return c}),define("module/groupchats/view/ReplyListView",["lib/jquery","lib/underscore","view/BaseView","view/items/InsetTools","module/groupchats/view/OpenReplyForms"],function(a,b,c,d,e){var f=c.extend(b.extend({},e,{collection:null,renderQueue:[],events:{"click .js_expand-branch, .js_reply":"postClickHandler","click .js_load-groupchats":"loadUsersGroupchats"},noScrollOnExit:!1,initialize:function(){this.renderQueue=[],this.collection=this.getCollection(),this.initReplyForms(),null!==this.collection&&(this.collection.on("add",this.addToRenderQueue,this),this.collection.on("reset",this.removeItems,this),this.collection.on("sync",this.render,this),this.collection.once("sync",this.runOnce,this)),this.on("reply:insert",this.renderComment,this)},remove:function(){this.removeControls(),this.noScrollOnExit||(this.preventJumping(),this.scrollToContainerTop(this)),this.unhandleStarterInserts(),b.isFunction(this.closeReplyForm)&&this.closeReplyForm(),null!==this.collection&&(this.collection.reset(),this.collection.off(null,null,this)),this.trigger("remove"),this.$el.empty(),this.undelegateEvents(),this.stopListening()},runOnce:function(){this.renderControls()},addToRenderQueue:function(a){this.renderQueue.push(a.returnElement())},clearRenderQueue:function(){this.renderQueue=[]},prefillRenderQueue:function(){this.collection.each(function(a){this.renderQueue.push(a.returnElement())},this)},getCollection:function(){return null},getFetchParams:function(){},getTemplateData:function(){return{}},loadPosts:function(){var c=this.getFetchParams();if(!b.isEqual(c.data,this.fetchParamData))return this.fetchParamData=b.clone(c.data),this.$elements.progressIndicator.removeClass("hide"),c.data.webchatsbeta="on",c.error=a.proxy(function(a,b){this.handleError.call(this,b)},this),this.collection.fetch(c)},render:function(){},removeItems:function(){},startReplyControlsFor:function(a){this.services.resolve("eventDispatcher").trigger("update.postlist.reply",{el:a}),this._fixReplyLinkPosition(a),this.services.resolve("feature").isOn("linksupport")&&(this.insetTools=new d({el:a})),window.twttr&&window.twttr.widgets.load(a.get(0))},_fixReplyLinkPosition:function(c){b.each(c.find(".js_endoftext"),function(b){var c=a(b),d=c.parents(".reply-content").children(":not(.js_endoftext)").last();d.append(c.detach().removeClass("hide"))})},setWaypoints:function(){var b=this.$elements.repliesEnd;this.destroyWaypoints(),b.waypoint(a.proxy(function(){this.destroyWaypoints(),this.loadPosts()},this),{offset:"150%"})},destroyWaypoints:function(){this.$elements.repliesEnd.waypoint("destroy")},expandBranch:function(){},handleError:function(){},postClickHandler:function(a){var b=this.services.resolve("utils");return b.clickedOnLink(a)?!0:!1},loadFullThread:function(b){var c=a.Deferred(),d=this.services.resolve("PostCollection",{args:{model:"post",url:"/api/post/"+b+"/branch/"+this.model.id}});return a.when(d.fetch()).done(a.proxy(function(){c.resolve(d)})),c.promise()},preventJumping:function(){var b=a(window).height(),c=this.$elements.innerContainer.height();this.$elements.outerContainer.css({"min-height":c>b?c:b-90})},scrollToContainerTop:function(b){a(document.body).animate({scrollTop:this.$elements.outerContainer.offset().top-40},"300","swing",function(){b.preventJumping()})},renderComment:function(){},renderControls:function(){},removeControls:function(){},loadUsersGroupchats:function(b){var c=a(b.currentTarget),d=c.data("authorblogname"),e=c.data("replyid");return this.trigger("reply:personalized:reload",{query:d,id:e}),!1}}));return f}),tiger.components.groupchats.replyList=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=a.replies,f=e.length,g=0;f>g;g++){var h=e[g];tiger.components.groupchats.reply({reply:h,straplineMode:a.straplineMode},d,c)}return b?"":d.toString()},tiger.components.groupchats.reply=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=c.features.superuser,f=a.reply.displayReplyCount,g=a.reply.authorStats&&a.reply.authorStats.contributors.length?a.reply.authorStats.contributors.length:1,h=(((null==c.replyData?null:c.replyData.query)==a.reply.author.screenName||!(null==c.replyData?null:c.replyData.query))&&(a.reply.approved||a.reply.dynamicApproved),new soy.StringBuilder);if(a.reply.blogs)for(var i=a.reply.blogs,j=i.length,k=0;j>k;k++){var l=i[k];h.append(l.id==a.reply.author.defaultBlogId?soy.$$escapeHtml(l.canonicalHost):"")}h=h.toString();var m=(null==c.replyData?null:c.replyData.atUser)==a.reply.authorBlogName;if(d.append('<article class="js_reply reply js_goto_post',a.extraClass?" "+soy.$$escapeHtml(a.extraClass):"",m?" moderator":"",' clearfix" id="',soy.$$escapeHtml(a.annotationInPopup?"annotation_":""),"reply_",soy.$$escapeHtml(a.reply.id),'" data-id="',soy.$$escapeHtml(a.reply.id),'" data-authorname="',soy.$$escapeHtml(a.reply.authorBlogName),'" ',a.reply.jsModelJson?'data-model="'+soy.$$escapeUri(a.reply.jsModelJson)+'"':"",' data-contributors="',soy.$$escapeHtml(g),'"><header class="no-expand">'),tiger.components.post.meta.postMetaContainer({post:a.reply,contributors:a.contributors,mode:"reply",showDate:!0},d,c),d.append('</header><div class="reply-content whitelisted-links">',"IMAGE"==(null==a.reply.annotation?null:a.reply.annotation.annotationType)?'<div class="reply-image-annotation" style="background-image: url(\''+soy.$$escapeHtml(a.reply.annotation.imageUrl)+"'); background-position: -"+soy.$$escapeHtml(a.reply.annotation.xPx)+"px -"+soy.$$escapeHtml(a.reply.annotation.yPx)+'px;"></div>':"","TEXT"==(null==a.reply.annotation?null:a.reply.annotation.annotationType)?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+(a.reply.annotation.annotationShortText?'<div class="js_annotation-long hide">'+soy.$$filterNoAutoescape(a.reply.annotation.annotationText)+'</div><div class="js_annotation-short">'+soy.$$filterNoAutoescape(a.reply.annotation.annotationShortText)+' <a href="'+soy.$$escapeHtml(a.reply.permalink)+'" class="js_annotation-expand proxima text-small">Show all</a></div>':soy.$$filterNoAutoescape(a.reply.annotation.annotationText))+"</blockquote>":"",soy.$$filterNoAutoescape(a.reply.display)),e){if(d.append(a.reply.score?'<span class="mscr">'+(a.reply.isStarter&&a.reply.score.baseScoreExplanation?"BASE: "+soy.$$escapeHtml(a.reply.score.baseScoreExplanation):!a.reply.isStarter&&a.reply.score.explanation?soy.$$escapeHtml(a.reply.score.explanation):"")+"</span>":""),a.reply.qiApprovalReason.length){d.append('<span class="mscr">');for(var n=a.reply.qiApprovalReason,o=n.length,p=0;o>p;p++){var q=n[p];if(e)switch(q.type){case"UserComment":d.append("written by the @user");break;case"AuthorComment":d.append("written by the starter post's author");break;case"FolloweeComment":d.append("written by someone the @user follows");break;case"AlwaysApproved":d.append("is an ancestor");break;case"UserReplied":d.append("the @user replied to this comment");break;case"AuthorReplied":d.append("the starter post's author replied to this comment");break;case"FolloweeReplied":d.append("one of the people followed by the @user replied to this comment");break;case"UserStarred":d.append("Recommended");break;default:d.append(soy.$$escapeHtml(q.type))}d.append(p!=o-1?",":"")}d.append("</span>")}d.append((null==a.reply.replyMeta?null:a.reply.replyMeta.approvedExplanation)?'<span class="mscr">'+soy.$$escapeHtml(a.reply.replyMeta.approvedExplanation)+"</span>":"")}return d.append('</div><div class="reply-tools">',"section2"==a.section?'<a href="#" class="no-events">View discussion<span class="icon icon-img downsized icon-bubble-solid"></span></a>':"<a href=\"#\" class=\"js_like recommend-reply\" title=\"Recommend\" onclick=\"window._gaq.push(['_trackEvent', 'Recommendation', 'Comment Recommended', '"+soy.$$escapeHtml(a.reply.permalink)+"']);\">"+(a.reply.likes&&a.reply.likes>0?soy.$$escapeHtml(a.reply.likes):"")+'<span class="icon notranslate icon-append js_like_icon">1</span></a>'+(f&&f>0?'<a href="#" class="js_toggle-descendants reply-count" data-id="'+soy.$$escapeHtml(a.reply.id)+'" title="Show replies">'+soy.$$escapeHtml(f)+'<span class="icon icon-img downsized js_bubble-icon icon-bubble-solid"></span></a>':"")+'<a href="/posts/'+soy.$$escapeHtml(a.reply.id)+'/reply" class="'+(a.openChildReplies?"js_toggle-descendants":"js_reply-to-selected-post")+'" data-id="'+soy.$$escapeHtml(a.reply.id)+'" title="Reply">Reply<span class="icon icon-img downsized icon-bubble-plus-solid"></span></a>','</div><div class="reply-border"></div></article><section id="js_toggled-replies-',soy.$$escapeHtml(a.reply.id),'" class="js_toggled-replies js_new-reply-container toggled-replies" style="display: none;"></section>'),b?"":d.toString()},tiger.components.groupchats.permalinkBranchWrapper=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="proxima mtl mbl text-right"><a href="#" class="js_reload-groupchats">Back to main thread <span class="icon transparent notranslate mrs">K</span></a></div><div class="js_permalink-branch branch"></div>'),b?"":c.toString()},tiger.components.groupchats.branch=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=a.ancestors,f=e.length,g=0;f>g;g++){var h=e[g];tiger.components.groupchats.reply({reply:h,extraClass:"ancestor"},d,c)}a.reply&&tiger.components.groupchats.reply({reply:a.reply,extraClass:"anchor"},d,c);for(var i=a.descendants,j=i.length,k=0;j>k;k++){var l=i[k];tiger.components.groupchats.reply({reply:l,extraClass:"descendant"},d,c)}return b?"":d.toString()},tiger.components.groupchats.personalizedRepliesHeaderChanges=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<h6 class="section-header thread-header js_header"><div class="txt"><strong>',soy.$$escapeHtml(a.atUser),"</strong>'s Group Chat</div></h6>"),b?"":c.toString()},tiger.components.groupchats.personalizedReplies=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=a.branches,f=e.length,g=0;f>g;g++){var h=e[g];if(h.length>0){d.append('<div class="branch js_branch">');for(var i=h,j=i.length,k=0;j>k;k++){var l=i[k];tiger.components.groupchats.reply({reply:l,openChildReplies:!0},d,c)}d.append("</div>")}}return b?"":d.toString()},tiger.components.groupchats.otherThreads=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=a.replies,f=e.length,g=0;f>g;g++){var h=e[g],i=h.contribMeta.contributors.length-1;d.append('<div class="item medium-4 columns">'),tiger.components.post.meta.postMetaContainer({post:h,contributors:i,mode:"reply",showDate:!0},d,c),d.append("</div>")}return b?"":d.toString()},tiger.components.groupchats.toggledReplyList=function(a,b,c){var d=b||new soy.StringBuilder;
d.append("	");for(var e=a.replies,f=e.length,g=0;f>g;g++){var h=e[g];tiger.components.groupchats.reply({reply:h},d,c)}return d.append(a.hasMore?'<footer class="reply-footer-bar"><a href="#" class="js_load-descendants proxima text-small">Show more replies</a></footer>':""),b?"":d.toString()},tiger.components.groupchats.hilitedReplies=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),tiger.components.groupchats.otherThreads(a,d,c),b?"":d.toString()},tiger.components.groupchats.userNotFound=function(a,b){var c=b||new soy.StringBuilder;return c.append('<div class="row mtl text-center proxima"><div class="column">The user ',soy.$$escapeHtml(a.username)," could not be found</div></div>"),b?"":c.toString()},tiger.components.groupchats.unapprovedPostMessage=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="unapproved-msg">Your reply has been submitted. <a href="',soy.$$escapeHtml(a.permalink),'" class="js_load-groupchats" data-authorblogname="',soy.$$escapeHtml(a.authorBlogName),'" data-replyid="',soy.$$escapeHtml(a.selectedId),'">View your group chat &raquo;</a></div>'),b?"":c.toString()},tiger.components.groupchats.flatRepliesHeader=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<h6 class="section-header js_header">All replies on this post, by time</h6>'),b?"":c.toString()},tiger.components.groupchats.threadList=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=a.branches,f=e.length,g=0;f>g;g++){var h=e[g];tiger.components.groupchats.thread({branch:h},d,c)}return b?"":d.toString()},tiger.components.groupchats.thread=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<div class=\'branch js_branch\'><h6 class="section-header thread-header"><div class="txt"><strong>',soy.$$escapeHtml(a.branch.reply.author.displayName),'</strong> started this thread</div><span class="timestamp hover-switch">'),tiger.components.post.meta.formattedTime({time:a.branch.reply.publishTime},d,c),d.append("</span></h6><!-- [[ branch --><!-- [[ starter -->"),tiger.components.groupchats.reply({reply:a.branch.reply},d,c),d.append("<!-- starter ]] -->"),a.branch.children){d.append('<section id="js_timeline-replies-',soy.$$escapeHtml(a.branch.reply.id),'" class="js_new-reply-container timeline-replies',a.branch.reply.replyCount>2?" with-more":"",'">');for(var e=a.branch.children,f=e.length,g=0;f>g;g++){var h=e[g];d.append("<!-- [[ child -->"),tiger.components.groupchats.reply({reply:h},d,c),d.append("<!-- child ]] -->")}d.append(a.branch.reply.replyCount>2?'<footer class="reply-footer-bar"><a href="'+soy.$$escapeHtml(a.branch.reply.permalink)+'" class="js_load-all-replies proxima text-small" data-reply-id="'+soy.$$escapeHtml(a.branch.reply.id)+'">Show more replies</a></footer>':"","</section>")}return d.append("<!-- branch ]] --></div>"),b?"":d.toString()},tiger.components.groupchats.threadRepliesFooter=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<footer class="reply-footer-bar"><a href="#" class="js_close-replies proxima text-small" >Collapse replies</a></footer>'),b?"":c.toString()},tiger.components.groupchats.noAuthorParticipationMessage=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="author-message twelve columns text-center"><h5 class="text-light proxima">Reply to or recommend interesting discussions to highlight them here.<br /><a href="',soy.$$escapeHtml(a.permalink),'" class="js_allview">Explore all threads on this post &raquo;</a></h5></div>'),b?"":c.toString()},tiger.components.groupchats.noAuthorParticipationMessageUser=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="author-message twelve columns text-center"><h5 class="text-light proxima">The author hasn\'t participated in any discussions yet.<br /><a href="',soy.$$escapeHtml(a.permalink),'" class="js_allview">Explore all threads on this post &raquo;</a></h5></div>'),b?"":c.toString()},tiger.components.groupchats.childRepliesHeader=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<h6 class="child-header js_header">Replies to ',soy.$$escapeHtml(a.parentAuthor.displayName),"</h6>"),b?"":c.toString()},define("templates/tiger/components/groupchats",function(){}),tiger.components.post.tag=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<a class="',soy.$$escapeHtml(a.tagClasses?a.tagClasses:"tag text-upper")," ",soy.$$escapeHtml(a.isPrimary?" js_tag_primary":""),'" href="',soy.$$escapeHtml(a.host?"http://"+a.host:""),"/tag/",soy.$$escapeHtml(a.tag.urlName),'" data-urlname="',soy.$$escapeHtml(a.tag.urlName),'"',a.hasDropdown?' data-dropdownhover="taglist"':"",">",soy.$$escapeHtml(a.tag.desc),"</a>"),b?"":c.toString()},tiger.components.post.tagList=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),tiger.components.post.metaDropdown({list:a.tags,startAt:1,host:a.host?a.host:""},d,c),b?"":d.toString()},tiger.components.post.metaDropdown=function(a,b,c){var d=b||new soy.StringBuilder;d.append('		<ul id="taglist" class="f-dropdown text-upper" data-dropdownhover-content>');for(var e=a.list,f=e.length,g=0;f>g;g++){var h=e[g];g>=a.startAt&&tiger.components.post.dropdowniterable({item:h,host:a.host?a.host:""},d,c)}return d.append("</ul>"),b?"":d.toString()},tiger.components.post.dropdowniterable=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<li class=""><a href="',soy.$$escapeHtml(a.host?"http://"+a.host:""),"/tag/",soy.$$escapeHtml(a.item.urlName),'" data-urlname="',soy.$$escapeHtml(a.item.urlName),'">',soy.$$escapeHtml(a.item.desc),"</a></li>"),b?"":c.toString()},define("templates/tiger/components/post/tags",function(){}),tiger.components.post.meta.meta=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="meta">'),tiger.components.post.meta.postInfo(a,d,c),d.append('<div class="meta-byline">'),tiger.components.post.meta.byline(a,d,c),(a.post.sponsored||a.post.isBillboardPost||a.post.isPromoted)&&tiger.components.post.meta.promotedByline(a,d,c),d.append("</div></div>"),b?"":d.toString()},define("templates/tiger/components/post/meta",function(){}),tiger.components.post.meta.avatarDisplay=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;return d.append('	<div class="avatar avatar-container js_avatar-container"',a.dropdownName?' data-dropdownhover="'+soy.$$escapeHtml(a.dropdownName)+'"':"",'><span class="icon icon-followed notranslate">O</span>',a.url&&"http://"!=a.url?'<a href="'+soy.$$escapeHtml(a.url)+'"'+(a.nofollow?' rel="nofollow"':"")+">":"",'<span class="img-border"><img src="',a.avatar?soy.$$escapeHtml(a.avatar):soy.$$escapeHtml(c.meta.assets.images)+"icons/avatar-big.png",'" /></span>',a.url&&"http://"!=a.url?"</a>":"","</div>"),b?"":d.toString()},define("templates/tiger/components/post/meta/avatar-display",function(){}),tiger.components.post.meta.formattedTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="show-on-hover published updated">',soy.$$escapeHtml(a.time.Mddyyhmma),'</span><span class="hide-on-hover">'),mantle.messages.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma},d,c),d.append("</span>"),b?"":d.toString()},define("templates/tiger/components/post/meta/formatted-time",function(){}),tiger.components.post.meta.byline=function(a,b,c){for(var d=b||new soy.StringBuilder,e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}e=e.toString();var j=new soy.StringBuilder;if("reply"==a.mode)for(var k=a.post.blogs,l=k.length,m=0;l>m;m++){var n=k[m];j.append(n.id==a.post.replyMeta.parentAuthor.defaultBlogId?soy.$$escapeHtml(n.canonicalHost):"")}if(j=j.toString(),a.post.showByline&&(!a.post.postAction||!a.post.postAction.author)){if(d.append('<span class="display-name author vcard">',""==a.post.byline?e?'<a href="http://'+soy.$$escapeHtml(e)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+' class="fn url">'+soy.$$escapeHtml(a.post.author.displayName)+"</a>":soy.$$escapeHtml(a.post.author.displayName):soy.$$filterNoAutoescape(a.post.byline),"</span>"),a.post.allowReplies&&"reply"!=a.mode){var o=a.post.sharedPost?a.post.sharedPost.replyCount:a.post.replyCount?a.post.replyCount:0;d.append(o&&o>0?' <a href="'+(c.meta&&"permalink"!=c.meta.pageType?soy.$$escapeHtml(a.post.permalink):"")+'#replies" class="text-light'+("reply"==a.mode?" js_expand-branch":" js_reply-to-post-disabled")+'" rel="nofollow">'+(1==o?"and "+soy.$$escapeHtml(o)+" other":"and "+soy.$$escapeHtml(o)+" others")+"</a>":"")}d.append("reply"==a.mode?'&nbsp;Replied to a Post by&nbsp;<span class="strong">'+(""==a.post.replyMeta.parentByline?'<a href="http://'+soy.$$escapeHtml(j)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(null==a.post.replyMeta?null:null==a.post.replyMeta.parentAuthor?null:a.post.replyMeta.parentAuthor.displayName)+"</a>":soy.$$escapeHtml(a.post.replyMeta.parentByline))+"</span>":"")}return d.append(a.post.postAction&&a.post.postAction.author?soy.$$escapeHtml(a.post.postAction.author.displayName)+' <span class="text-italic">'+("shared-reply"==a.mode?"Shared a Reply by":"Shared a Post by")+"</span> "+(""==a.post.byline?'<a href="http://'+soy.$$escapeHtml(e)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(a.post.author.displayName)+"</a>":soy.$$escapeHtml(a.post.byline)):""),b?"":d.toString()},tiger.components.post.meta.topByline=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}if(e=e.toString(),a.post.showByline)if(""==a.post.byline){d.append('<span class="display-name author vcard"><a href="http://',soy.$$escapeHtml(e),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':""," ",a.dropdownName?' data-dropdownhover-anchor="'+soy.$$escapeHtml(a.dropdownName)+'"':"",' class="fn url">',soy.$$escapeHtml(a.post.author.displayName),"</a>");var j=(null==c.replyData?null:c.replyData.atUser)==a.post.authorBlogName;if(d.append(j?'<span class="moderator-name">, Host</span>':"","reply"==a.mode&&(null==a.post.replyMeta?null:null==a.post.replyMeta.parentAuthor?null:a.post.replyMeta.parentAuthor.displayName)?'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+((null==a.post.replyMeta?null:a.post.replyMeta.showParentByline)&&""!=(null==a.post.replyMeta?null:a.post.replyMeta.parentByline)?soy.$$filterNoAutoescape(a.post.replyMeta.parentByline):soy.$$escapeHtml(a.post.replyMeta.parentAuthor.displayName))+"</span>":"",a.contributors?' <span class="text-normal text-tiny">'+(1==a.contributors?"and 1 other":a.contributors>1?"and "+soy.$$escapeHtml(a.contributors)+" others":"")+"</span>":"","</span>"),c.meta.blog&&a.post.isStarter&&a.post.defaultBlogId!=a.post.author.defaultBlogId&&a.post.defaultBlogId!=c.meta.blog.id||a.forSharedPost){d.append('<span class="published-on">');for(var k=a.post.blogs,l=k.length,m=0;l>m;m++){var n=k[m];d.append(n.id==a.post.defaultBlogId?' on <a class="blog-name" href="http://'+soy.$$escapeHtml(n.canonicalHost)+'" target="_self" '+(a.post.isPromoted?'rel="nofollow"':"")+">"+soy.$$escapeHtml(n.displayName)+"</a>":"")}d.append("</span>")}}else d.append('<span class="display-name">',soy.$$filterNoAutoescape(a.post.byline),"</span>");return d.append(a.post.postAction&&a.post.postAction.author&&a.post.postAction.author.displayName?'<span class="reposted-by">shared by <span class="text-upper">'+soy.$$escapeHtml(a.post.postAction.author.displayName)+"</span></span>":""),b?"":d.toString()},tiger.components.post.meta.promotedByline=function(a,b){var c=b||new soy.StringBuilder;if(c.append('	<span class="meta-promoted"><span class="promoted-dot">&middot;</span> ',a.post.sponsored||a.post.isBillboardPost?'<span class="sponsored-label text-upper">Sponsored</span><span class="icon notranslate mhs">B</span>':""),a.post.isPromoted){var d=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");d=d.toString(),c.append('Promoted by <span class="js_promoted_displayName">',soy.$$filterNoAutoescape(d),"</span>")}return c.append("</span>"),b?"":c.toString()},tiger.components.post.meta.publishTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="publish-time js_publish_time" data-publishtime="',soy.$$escapeHtml(a.post.publishTimeMillis),'">'),a.post.postAction&&a.post.postAction.createTime?(d.append('<a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.postAction.createTime},d,c),d.append("</a>")):a.post.publishTime&&("SCHEDULED"==a.post.status?(d.append('Scheduled:<br /><a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append('</a><span class="icon inline notranslate">f</span>')):"DRAFT"==a.post.status?(d.append('Draft<span class="icon inline notranslate">e</span><a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>")):(d.append('<a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>"))),d.append("</span>"),b?"":d.toString()},tiger.components.post.meta.avatarContainer=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder("avt-large");if(e=e.toString(),a.post.showByline&&""==a.post.byline)if(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id){tiger.components.post.meta.avatarPopover({author:a.post.author,canonicalHost:a.canonicalHost,idName:soy.$$escapeHtml(a.post.id)+"-hovercard"},d,c);var f="gif"==(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.format)?"jpg":null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.format;tiger.components.post.meta.avatarDisplay({url:"http://"+soy.$$escapeHtml(a.canonicalHost),avatar:window.kinja.imageUrl(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id,e,f),nofollow:a.post.isPromoted,dropdownName:soy.$$escapeHtml(a.post.id)+"-hovercard"},d,c)}else tiger.components.post.meta.avatarDisplay(null,d,c);else(null==a.post.salesAvatarMap?null:a.post.salesAvatarMap.id)?tiger.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(window.kinja.imageUrl(a.post.salesAvatarMap.id,e))},d,c):tiger.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(c.meta.assets.images)},d,c);return b?"":d.toString()},tiger.components.post.meta.avatarPopover=function(a,b){var c=b||new soy.StringBuilder;if(c.append('<div id="',soy.$$escapeHtml(a.idName),'" class="f-dropdown content small whitelisted-links" data-dropdownhover-content>'),null==a.author.avatar?null:a.author.avatar.id){c.append('<span class="floated-container img-60 avatar-container js_avatar-container">');var d=new soy.StringBuilder("avt-large");d=d.toString(),c.append('<span class="avatar"><span class="icon icon-followed notranslate">O</span><img data-src="',soy.$$escapeHtml(window.kinja.imageUrl(a.author.avatar.id,d,a.author.avatar.format)),'" alt="',soy.$$escapeHtml(a.author.screenName),'" /></span>')}return c.append("<div><h4>",soy.$$escapeHtml(a.author.displayName),'</h4><a href="http://',soy.$$escapeHtml(a.canonicalHost),'" class="button tiny secondary mrs" target="_blank">Profile</a><a href="#" class="button tiny secondary js_followforuser mrs" data-targetblogid="',soy.$$escapeHtml(a.author.defaultBlogId),'">Follow</a><a href="#" class="button tiny secondary js_unfollowforuser mrs hide" data-targetblogid="',soy.$$escapeHtml(a.author.defaultBlogId),'">Unfollow</a></div></div>'),b?"":c.toString()},tiger.components.post.meta.postInfo=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="meta-tools">',a.post.isBlip&&!a.post.isBillboardPost||a.forSharedPost?"":a.post.viewstats&&a.post.viewstats.nonUniqueFormatted&&"0"!=a.post.viewstats.nonUniqueFormatted&&("permalink"==c.meta.pageType||"private"==c.meta.pageType)?'<span class="view-count" '+(a.post.viewstats.uniqueFormatted?' title="'+soy.$$escapeHtml(a.post.viewstats.uniqueFormatted)+' New Visitors"':"")+">"+soy.$$escapeHtml(a.post.viewstats.nonUniqueFormatted)+'<span class="icon notranslate icon-append">g</span></span>':"","<a href=\"#\" class=\"js_like button-recommend-post hover-icon\" title=\"Recommend\" onclick=\"window._gaq.push(['_trackEvent', 'Recommendation', 'Post Recommended', '",soy.$$escapeHtml(a.post.permalink),"']);\">",a.post.likes&&a.post.likes>0?soy.$$escapeHtml(a.post.likes):"",'<span class="icon notranslate icon-append js_like_icon">1</span></a></span>'),b?"":d.toString()},define("templates/tiger/components/post/meta/meta-components",function(){}),tiger.components.post.meta.postMetaContainer=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="meta-container">'),"permalink"==c.meta.pageType?tiger.components.post.meta.metaAvatar(a,d,c):tiger.components.post.meta.meta(a,d,c),"grid"!=a.mode&&(d.append('<div class="post-dropdown-ct js_post-dropdown-ct',"permalink"!=c.meta.pageType||a.mode?"":" js_post-dropdown-ct-sticky",'">'),tiger.components.post.meta.postDropdown(a,d,c),d.append("</div>")),d.append("</div>"),b?"":d.toString()},define("templates/tiger/components/post/meta/post-meta-container",function(){}),tiger.components.post.meta.postDropdown=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder(a.post.headline?soy.$$escapeHtml(a.post.headline):a.post.first100Characters?soy.$$escapeHtml(a.post.first100Characters):soy.$$escapeHtml(a.post.compact));e=e.toString();var f=a.post.plaintext?a.post.plaintext:a.post.headline,g=new soy.StringBuilder,h=new soy.StringBuilder("k-medium");return h=h.toString(),g.append((null==a.post.sharingMainImage?null:a.post.sharingMainImage.id)?'<img src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.post.sharingMainImage.id,h,a.post.sharingMainImage.format))+'" /><br />':""),g=g.toString(),d.append('<a href="#" target="_self" class="button dropdown secondary transparent toggle-30 js_post-menu-toggler post-dropdown-trigger" data-dropdown="dropdown-',soy.$$escapeHtml(a.post.id),'"></a><ul id="dropdown-',soy.$$escapeHtml(a.post.id),'" class="f-dropdown proxima js_post-dropdown whitelisted-links" data-postid="',soy.$$escapeHtml(a.post.id),'" data-starterid="',soy.$$escapeHtml(a.post.starterId),'" data-title="',soy.$$filterNoAutoescape(e),'" data-description="',soy.$$escapeUri(f),'" data-imagetag="',soy.$$escapeUri(g),'" data-blogid="',soy.$$escapeHtml(a.post.authorBlogId),'" data-dropdown-content><li class="js_edit-post hover-icon hide"><a href="#"><i class="icon icon-prepend notranslate">e</i>Edit</a></li><li class="js_delete-post hover-icon hide"><a href="#"><i class="icon icon-prepend notranslate">a</i>Delete</a></li><li class="js_invite-to-post hover-icon"><a href="#"><i class="icon icon-prepend notranslate">i</i>Invite</a></li>',"reply"==a.mode?'<li class="js_followforuser hover-icon" data-targetblogid="'+soy.$$escapeHtml(a.post.authorBlogId)+'"><a href="#"><i class="icon icon-prepend notranslate">P</i>Follow '+soy.$$escapeHtml(a.post.authorBlogName)+'</a></li><li class="js_unfollowforuser hover-icon hide" data-targetblogid="'+soy.$$escapeHtml(a.post.authorBlogId)+'"><a href="#"><i class="icon icon-prepend notranslate">O</i>Unfollow '+soy.$$escapeHtml(a.post.authorBlogName)+'</a></li><li class="js_followforblog hover-icon hide" data-targetblogid="'+soy.$$escapeHtml(a.post.authorBlogId)+'"><a href="#"><i class="icon icon-prepend notranslate">P</i>Follow '+soy.$$escapeHtml(a.post.authorBlogName)+" for "+soy.$$escapeHtml(a.post.defaultBlogName)+'</a></li><li class="js_unfollowforblog hover-icon hide" data-targetblogid="'+soy.$$escapeHtml(a.post.authorBlogId)+'"><a href="#"><i class="icon icon-prepend notranslate">O</i>Unfollow '+soy.$$escapeHtml(a.post.authorBlogName)+" for "+soy.$$escapeHtml(a.post.defaultBlogName)+"</a></li>":'<li class="js_promote hover-icon hide"><a href="#"><i class="icon icon-prepend notranslate">B</i>Promote</a></li>','<li class="js_dismiss js_external_dismiss hover-icon hide"><a href="#"><i class="icon icon-prepend notranslate">X</i>Dismiss</a></li><li class="js_undismiss js_external_undismiss hover-icon hide"><a href="#"><i class="icon icon-prepend notranslate">X</i>Undismiss</a></li><li class="js_block hover-icon hide" data-blogid="',soy.$$escapeHtml(a.post.defaultBlogId),'" data-targetblogid="',soy.$$escapeHtml(a.post.authorBlogId),'"><a href="#"><i class="icon icon-prepend notranslate">b</i><span>Block for ',soy.$$escapeHtml(a.post.defaultBlogName),'</span></a></li><li class="js_hide-post hover-icon hide"><a href="#"><i class="icon icon-prepend notranslate">b</i>Hide</a></li>',"permalink"==(null==c.meta?null:c.meta.pageType)?("reply"!=a.mode?'<li class="js_kinja-share-block"><a class="js_kinja-share hover-icon" href="#"><i class="icon icon-prepend notranslate">E</i>Share to Kinja</a></li>':"")+'<li><a class="js_share-post-item facebook hover-icon" href="http://facebook.com/sharer.php?u='+soy.$$escapeUri(a.post.permalink)+"%2F%2B"+soy.$$escapeUri(a.post.author.screenName)+'"><i class="icon icon-prepend notranslate">j</i>Share to Facebook</a></li><li><a class="js_share-post-item twitter hover-icon" href="http://twitter.com/share?url='+soy.$$escapeUri(a.post.permalink)+"%2F%2B"+soy.$$escapeUri(a.post.author.screenName)+'&amp;text=POST_TITLE"><i class="icon icon-prepend notranslate">i</i>Share to Twitter</a></li><li><a class="hover-icon" href="'+soy.$$escapeHtml(a.post.permalink)+'"><i class="icon icon-prepend notranslate">r</i>Go to permalink</a></li>':"","</ul>"),b?"":d.toString()},define("templates/tiger/components/post/meta/post-dropdown",function(){}),tiger.components.post.meta.metaAvatar=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}e=e.toString();var j=new soy.StringBuilder(soy.$$escapeHtml(a.post.id),"-hovercard");return j=j.toString(),d.append('<div class="meta-avatar js_author" data-blogid="',soy.$$escapeHtml(a.post.author.defaultBlogId),'">'),"reply"!=a.mode&&tiger.components.post.meta.postInfo(a,d,c),d.append('<div class="floated-container img-30" data-dropdownhover-container>'),tiger.components.post.meta.avatarContainer({post:a.post,canonicalHost:e},d,c),d.append('<div class="txt">',a.forSharedPost?"Original post by":""),tiger.components.post.meta.topByline({post:a.post,mode:soy.$$escapeHtml(a.mode?a.mode:"post"),forSharedPost:a.forSharedPost,contributors:a.contributors,dropdownName:j},d,c),d.append('<div class="second-line">'),(a.post.sponsored||a.post.isBillboardPost||a.post.isPromoted)&&tiger.components.post.meta.promotedByline(a,d,c),a.post.tags&&a.post.tags[0]&&!a.forSharedPost&&(d.append("Filed to: "),tiger.components.post.tag({tag:a.post.tags[0],hasDropdown:a.post.tags.length>1,tagClasses:"first-tag"},d,c),a.post.tags.length>1&&tiger.components.post.tagList({tags:a.post.tags},d,c)),0==a.showDate||a.forSharedPost||tiger.components.post.meta.publishTime(a,d,c),d.append("</div></div></div></div>"),b?"":d.toString()},define("templates/tiger/components/post/meta/meta-avatar",function(){}),define("module/groupchats/view/ChildReplies",["lib/jquery","lib/underscore","module/groupchats/view/ReplyListView","templates/tiger/components/groupchats","templates/tiger/components/post/tags","templates/tiger/components/post/meta","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/post/meta/meta-components","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/meta-avatar","templates/mantle/messages"],function(a,b,c){var d=c.extend({excludedCommentIds:[],selectedId:null,getCollection:function(){return this.services.resolve("PostCollection",{args:{model:"branch"}})},setQuery:function(a){this.selectedId=a,this.collection.url="/api/post/"+a+"/replies"},getFetchParams:function(){return{data:{startIndex:this.collection.pagination.next?this.collection.pagination.next.startIndex:0,startTime:this.collection.pagination.next?this.collection.pagination.next.startTime:0,maxReturned:4,withLikeCounts:!1},remove:!1}},getTemplateData:function(){var a=this.excludedCommentIds,c=b.reject(this.renderQueue,function(c){return b.indexOf(a,c.reply.id)>-1});return{replies:b.map(c,function(a){return a.reply})}},excludeCommentIds:function(a){this.excludedCommentIds=a},render:function(){var a,b=this.getTemplateData();if(0===b.replies.length)return this;this.collection.pagination.next?(b.hasMore=!0,this.$el.addClass("with-more")):(b.hasMore=!1,this.$el.removeClass("with-more"),this.clearRenderQueue());var c=tiger.components.groupchats.toggledReplyList;a=this.soyToHtml(c,b,{replyData:this.injectedData}),this.$el.html(a),this.startReplyControlsFor(this.$el),this.$elements.progressIndicator.addClass("hide"),this.trigger("rendered")},postClickHandler:function(a){return this.services.resolve("utils").clickedOnLink(a)?!0:!1},remove:function(){null!==this.collection&&(this.collection.reset(),this.collection.off(null,null,this)),b.isFunction(this.closeReplyForm)&&this.closeReplyForm(),this.$el.empty(),this.undelegateEvents(),this.stopListening()},renderControls:function(){var a=this.services.resolve("PostModel",{args:{id:this.selectedId}});this.collection.length>0&&this.$el.prepend(this.soyToHtml(tiger.components.groupchats.childRepliesHeader,{parentAuthor:a.get("author")}))},removeControls:function(){this.$el.find(".js_header").remove()}});return d}),define("module/groupchats/mixin/WithChildReplies",["lib/jquery","lib/underscore","module/groupchats/view/ChildReplies"],function(a,b,c){var d={toggleDescendants:function(c){var d=a(c.currentTarget).closest(".js_reply"),e=d.data("id"),f=a("#js_toggled-replies-"+e),g=d.find(".js_bubble-icon");return d.addClass("anchor"),d.find(".js_toggle-descendants").toggleClass("active"),d.find(".js_reply-number-closed").addClass("hide"),d.find(".js_reply-number-open").removeClass("hide"),this.childReplies[e]?(d.find(".js_reply-number-open").addClass("hide"),d.find(".js_reply-number-closed").removeClass("hide"),d.removeClass("anchor"),this.hideReplies(e,f),b.isFunction(this.closeReplyForm)&&(g.addClass("icon-bubble-solid"),g.removeClass("icon-bubble-x-solid"),this.closeReplyForm(c)),g.hasClass("icon-bubble-empty")&&g.removeClass("icon-bubble-solid")):(this.showReplies(e,f),b.isFunction(this.replyToPost)&&this.replyToPost(c),g.removeClass("icon-bubble-solid"),g.addClass("icon-bubble-x-solid")),!1},loadDescendants:function(b){b.preventDefault();var c=a(b.currentTarget).closest(".toggled-replies").prevAll(".js_reply").first(),d=c.data("id"),e=a("#js_toggled-replies-"+d);this.showChildReplies(d,e)},showChildReplies:function(a){var b=this.childReplies[a];b.$elements=this.$elements,b.injectedData=this.injectedData,b.setQuery(a),b.excludeCommentIds(this.getDisplayedReplyIds()),b.loadPosts()},hideReplies:function(b,c){c.slideUp(200,a.proxy(function(){this.childReplies[b]&&(this.childReplies[b].remove(),delete this.childReplies[b])},this))},showReplies:function(a,b){var d=new c({model:this.model,el:b,services:this.services});d.$elements=this.$elements,d.injectedData=this.injectedData,d.setQuery(a),d.excludeCommentIds(this.getDisplayedReplyIds()),d.loadPosts(),this.$elements.progressIndicator.addClass("hide"),this.childReplies[a]=d,d.on("reply:personalized:reload",function(a){this.trigger("reply:personalized:reload",a)},this),d.on("rendered",function(){b.slideDown(200)})},getDisplayedReplyIds:function(){return b.map(a(".js_branch>.js_reply"),function(a){return parseInt(a.dataset.id,10)})}};return d}),define("gawkerlib/lightboxer",["lib/jquery","lib/underscore","view/BaseView","singleton/Utils","templates/mantle/messages"],function(a,b,c,d){function e(e){var f=e.find(".lightBoxWrapper .img-border img");e.find(".lightBox .text").html(c.prototype.t(mantle.messages.lightboxExpand)),b.each(f,function(b){var c=a(b);c.attr("data-original-src",d.imageUrl(c.data("chomp-id"),"original",c.data("format")))}),e.find(".lightBox").removeClass("hide").lightBox()}return e}),define("module/groupchats/view/PersonalizedReplies",["lib/jquery","lib/underscore","module/groupchats/view/ReplyListView","module/groupchats/mixin/WithChildReplies","singleton/LogProvider","gawkerlib/lightboxer","templates/tiger/components/groupchats","templates/tiger/components/post/tags","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/post/meta/meta-components","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/meta-avatar","templates/tiger/components/post/meta","templates/tiger/components/post/meta/post-dropdown","templates/mantle/messages"],function(a,b,c,d,e,f){var g=c.extend(b.extend({},d,{childReplies:{},firstRun:!0,initialize:function(){c.prototype.initialize.apply(this,arguments),this.handleStarterInsert(),this.events=b.extend({"click .js_toggle-descendants":"toggleDescendants","click .js_load-descendants":"loadDescendants"},this.events),this.delegateEvents()},setQuery:function(a,b){this.collection.url="/api/post/"+this.model.id+"/replies/qi/combined/"+a,this.injectedData.query=a,b&&(this.injectedData.refId=b)},remove:function(){delete this.injectedData.query,delete this.injectedData.refId,c.prototype.remove.call(this)},getCollection:function(){return this.services.resolve("FlatBranchCollection")},getFetchParams:function(){var a=this.services.resolve("feature");return{data:{refId:this.injectedData.refId?this.injectedData.refId:this.collection.pagination.next?this.collection.pagination.next.refId:0,maxReturned:20,"with-direct-contributors":"off","with-liked-leafs":"on",chunking:!a.isOn("disablechunking"),sort:a.isOn("activitysort")?"activity":"chrono",bsMaxReturned:this.firstRun&&a.isOn("userlinks")?6:1,leaves:!0},remove:!1}},filterDisplayedReplies:function(a){var c=function(a,c){var d=b.countBy(a,function(a){return a.parentId===c});return d[!0]?d[!0]:0};return b.map(a,function(a){return b.map(a,function(b){var d=b.directReplies?b.directReplies.length:b.replyCount;return b.displayReplyCount=d-(d>0?c(a,b.id):0),b})})},getTemplateData:function(){return{branches:this.filterDisplayedReplies(this.renderQueue),firstRun:this.firstRun}},render:function(){("authorparticipating"===this.collection.listMeta.queryType||"manual"===this.collection.listMeta.queryType)&&(this.injectedData.atUser=this.collection.listMeta.query.split("+")[0]),this.firstRun&&window.markUserTime("Groupchats - Start personalized replies render firstrun");var a=!!this.collection.pagination.next,b=tiger.components.groupchats.personalizedReplies,c=this.soyToHtml(b,this.getTemplateData(),{replyData:this.injectedData});this.clearRenderQueue(),this.$el.append(c),this.startReplyControlsFor(this.$el),a?this.setWaypoints():(this.destroyWaypoints(),this.trigger("reply:personalized:hasNoMore")),this.$elements.progressIndicator.addClass("hide"),this.firstRun&&window.markUserTime("Groupchats - End personalized replies render firstrun"),this.firstRun=!1,f(this.$el)
},removeItems:function(){this.$el.find(".js_branch").remove()},handleError:function(a){if(this.$elements.progressIndicator.addClass("hide"),404===a.status){var b=this.injectedData.query.split("+")[0];this.$el.html(this.soyToHtml(tiger.components.groupchats.userNotFound,{username:b}))}},postClickHandler:function(a){var b=this.services.resolve("utils");return b.clickedOnLink(a)?!0:this.toggleDescendants(a)},renderComment:function(a){var b,c=this.services.resolve("currentUser");this.model.id===a.model.get("parentId")?(b={branches:[[a.model.replaceImagesWithOriginal().returnElement()]]},a.$el.replaceWith(this.soyToHtml(tiger.components.groupchats.personalizedReplies,b))):(b={reply:a.model.replaceImagesWithOriginal().returnElement()},a.$el.replaceWith(this.soyToHtml(tiger.components.groupchats.reply,b))),this.startReplyControlsFor(this.$("#reply_"+a.model.id).closest(".js_branch")),this.isGroupApproved(c.get("defaultBlogId"))||this.renderUnapprovedPostWarning(a.model.id)},renderUnapprovedPostWarning:function(a){var b=this.services.resolve("currentUser"),c=b.get("defaultBlog").name,d=this.soyToHtml(tiger.components.groupchats.unapprovedPostMessage,{permalink:this.model.get("permalink")+"/+"+c,selectedId:a,authorBlogName:c});this.$("#reply_"+a).prepend(d)},isGroupApproved:function(a){var c=b.find(this.collection.listMeta.contributors,function(b){return parseInt(b.blogId,10)===a&&b.groupMember===!0});return!!c},scrollToElement:function(b){a(document.body).scrollTo(b,700,{easing:"swing",queue:!0,axis:"xy"})},loadPosts:function(){var a=this.services.resolve("feature");return a.isOn("threadsortingprototype")?this.loadThreadSortedPosts():c.prototype.loadPosts.call(this)},loadThreadSortedPosts:function(){this.$elements.progressIndicator.removeClass("hide");var c,d,f=this.getFetchParams(),g=this.services.resolve("FlatBranchCollection"),h=this.model.get("authorBlogName"),i=a.Deferred();return g.url="/api/post/"+this.model.id+"/replies/qi/combined/"+h+"+repliedto",c=g.fetch(f),d=a.proxy(function(b){var c=this.services.resolve("FlatBranchCollection"),d=a.Deferred();return c.url="/api/post/"+this.model.id+"/replies/qi/combined/"+b,e.warn("fetching webchats for "+b),c.fetch({data:{maxReturned:20,"with-direct-contributors":"off","with-liked-leafs":"on",chunking:!0,bsMaxReturned:0},success:a.proxy(function(){e.warn("got webchats for "+b),d.resolve(c.models)},this)}),d},this),c.done(a.proxy(function(){var c=b.without(b.pluck(g.listMeta.contributors,"name"),h),e=[];d(h).done(a.proxy(function(f){e=b.map(c,d,this),a.when.apply(this,e).done(a.proxy(function(){var a=b.sortBy(b.flatten(arguments),function(a){return a.get("replies").at(0).get("publishTimeMillis")});this.collection.add(f),this.collection.add(a),this.collection.trigger("sync"),i.resolve()},this))},this))},this)),i},renderControls:function(){if(this.$el.addClass("no-reply-counts"),this.collection.length>0){var a=this.collection.listMeta.atUser.author.displayName,b=this.soyToHtml(tiger.components.groupchats.personalizedRepliesHeaderChanges,{atUser:a});this.$el.prepend(b)}},removeControls:function(){this.$el.removeClass("no-reply-counts"),this.$el.find(".js_header").remove()}}));return g}),define("module/groupchats/view/HilitedReplies",["lib/jquery","module/groupchats/view/ReplyListView","templates/mantle/messages","templates/tiger/components/groupchats","templates/tiger/components/post/tags","templates/tiger/components/post/meta","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/post/meta/meta-avatar","templates/tiger/components/post/meta/meta-components","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/post-meta-container"],function(a,b){var c=b.extend({getCollection:function(){return this.collection},getTemplateData:function(){return{replies:this.getAuthorDetails()}},getAuthorDetails:function(){var a=this;return _.map(this.collection.models,function(b){var c=_.find(a.collection.listMeta.contributors,function(a){return a.blogId===b.get("authorBlogId")});return b.set("contribMeta",c),b.toJSON()})},render:function(){var a,b=this.getTemplateData();return b.replies&&b.replies.length>0&&(a=this.soyToHtml(tiger.components.groupchats.hilitedReplies,b,{replyData:this.injectedData}),this.$el.find(".js_grid").append(a)),this.startReplyControlsFor(this.$el),this.$elements.progressIndicator.addClass("hide"),this},removeItems:function(){this.$el.find(".js_grid").empty()},remove:function(){this.removeControls(),null!==this.collection&&(this.collection.reset(),this.collection.off(null,null,this)),this.trigger("remove"),this.$el.find(".js_grid").empty(),this.undelegateEvents(),this.stopListening()},postClickHandler:function(b){var c,d,e,f,g=this.services.resolve("utils");return g.clickedOnLink(b)?!0:(c=a(b.currentTarget),d=c.hasClass("js_reply")?c:c.parents(".js_reply"),e=d.data("authorname"),f=d.data("id"),this.trigger("reply:personalized:reload",{query:e,id:f}),!1)},renderControls:function(){this.$el.find(".js_header").removeClass("hide")},removeControls:function(){this.$el.find(".js_header").addClass("hide")}});return c}),tiger.components.groupchats.replyApplet=function(a,b,c){var d=b||new soy.StringBuilder;d.append('	<div class="replies-wrapper fade"><div class="js_replycol js_ad300-companion">'),tiger.components.groupchats.replyFilters({post:a.post,extraClass:"below-post"},d,c),d.append('<div class="js_permalink-place permalink-place row" style="display: none;"><div class="row"><div class="twelve columns center"><a class="button secondary js_collapse-branch">Show all threads</a></div></div></div><div class="js_reply-form-container row"></div><div class="js_branch-list branch-list"></div><div class="js_branch-grid other-threads"><h6 class="section-header js_header hide">Hosts of other popular chats</h6><div class="row js_grid"></div></div><div class="js_replymessage hide createnewreply"></div><div class="js_reply-loading-progress reply-spinner hide">'),tiger.components.spinner.bounce(null,d,c),d.append('</div><div class="js_discussionlinks discussionlinks row hide"></div><a class="js_reply-prompt-link reply-prompt-link hover-icon hide">');var e=new soy.StringBuilder(a.post.showByline&&""!=a.post.byline?soy.$$escapeHtml(a.post.byline):soy.$$escapeHtml(a.post.author.displayName));return e=e.toString(),d.append('<span class="maincolor">Respond to <strong>',soy.$$escapeHtml(e),'</strong></span> and keep the discussion going...<span class="icon icon-img downsized icon-bubble-empty"></span></a>'),a.post.allowReplies||(d.append('<div class="js_disabled-replies reply-prompt-link proxima pam mtm text-light"><div class="floated-container"><div class="avatar"><span class="icon notranslate">L</span></div><div class="txt"><span class="msg text-small text-light proxima">'),mantle.messages.groupchatsRepliesDisabled(null,d,c),d.append("</span></div></div></div>")),d.append('<div class="load-pending js_load-pending hide text-center"><a href="javascript:;" class="js_load-pending-btn proxima text-small">Show Pending Discussions</a></div><div class="js_load-more"></div>'),tiger.components.groupchats.replyFilters(a,d,c),d.append("</div></div>"),tiger.components.groupchats.loadingLayer(null,d,c),b?"":d.toString()},tiger.components.groupchats.replyFilters=function(a,b){var c=b||new soy.StringBuilder;return c.append("	",a.post.replyCount&&a.post.replyCount>0?'<dl class="reply-filters '+(a.extraClass?soy.$$escapeHtml(a.extraClass):"")+'"><dd class="js_reload-groupchats"><a href="'+soy.$$escapeHtml(a.post.permalink)+'">Highlights</a></dd><dd  class="js_allview"><a href="'+soy.$$escapeHtml(a.post.permalink)+'/all" title="View all '+soy.$$escapeHtml(a.post.replyCount)+' replies">All replies</a></dd></dl>':""),b?"":c.toString()},define("templates/tiger/components/groupchats/reply-applet",function(){}),define("module/groupchats/view/ThreadReplies",["lib/jquery","lib/underscore","module/groupchats/view/ReplyListView","templates/mantle/messages","templates/tiger/components/groupchats","templates/tiger/components/groupchats/reply-applet","templates/tiger/components/post/meta","templates/tiger/components/post/tags","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/post/meta/meta-components","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/meta-avatar"],function(a,b,c){var d=c.extend({events:{"click .js_expand-branch, .js_reply":"postClickHandler","click .js_close-replies":"remove"},getCollection:function(){return this.services.resolve("PostCollection",{args:{model:"branch"}})},setQuery:function(a){this.collection.url="/api/post/"+a+"/replies/flat"},getFetchParams:function(){return{data:{startIndex:2,maxReturned:100,order:"ASC"}}},getSortedTemplateData:function(){return{replies:this.sortByApprovedStatus(this.renderQueue[0]).children}},sortByApprovedStatus:function(a){var c=[],d=b.groupBy(a.children,function(a){return!!a.approved});return"true"in d&&c.push(d["true"]),"false"in d&&c.push(d["false"]),a.children=b.flatten(c),a},render:function(){var a=!!this.collection.pagination.next,b=this.getSortedTemplateData(),c=tiger.components.groupchats.replyList,d=this.soyToHtml(c,b,{replyData:this.injectedData});this.clearRenderQueue(),this.$el.append(d),this.startReplyControlsFor(this.$el),a&&this.setWaypoints(),this.$elements.progressIndicator.addClass("hide")},renderComment:function(a){var b={reply:a.model.replaceImagesWithOriginal().returnElement()};a.$el.replaceWith(this.soyToHtml(tiger.components.groupchats.reply,b))},renderControls:function(){this.$el.append(this.soyToHtml(tiger.components.groupchats.threadRepliesFooter,{}))},remove:function(){return c.prototype.remove.call(this),this.$el.slideUp(),!1},scrollToContainerTop:function(){a(document.body).animate({scrollTop:this.$el.parents(".js_branch").offset().top-20},"200","swing")}});return d}),define("module/groupchats/view/StarterReplies",["lib/jquery","lib/underscore","module/groupchats/view/ReplyListView","module/groupchats/view/ThreadReplies","module/groupchats/mixin/WithChildReplies","templates/mantle/messages","templates/tiger/components/groupchats","templates/tiger/components/post/meta","templates/tiger/components/post/tags","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/post/meta/meta-components","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/meta-avatar"],function(a,b,c,d,e){var f=c.extend(b.extend({},e,{childReplies:{},withoutUnapproved:!0,startIndex:0,total:0,unapproved:0,events:{"click .js_toggle-descendants":"toggleDescendants","click .js_load-descendants":"loadDescendants","click .js_expand-branch, .js_reply":"postClickHandler","click .js_load-all-replies":"displayFullThread"},initialize:function(){c.prototype.initialize.apply(this,arguments),this.options.disableStarterInsert||this.handleStarterInsert(),this.bind("pending:show",this.showPending,this),this.bind("pending:hide",this.hidePending,this),this.bind("indicator:show",this.showIndicator,this),this.bind("indicator:hide",this.hideIndicator,this),this.bind("remove",this.hidePending,this)},getCollection:function(){return this.services.resolve("PostCollection",{args:{model:"branch",url:"/api/post/"+this.model.id+"/replies"}})},getFetchParams:function(){return this.startIndex=this.collection.pagination.next?this.collection.pagination.next.startIndex:0,this.startIndexOverride&&this.startIndexOverride>this.startIndex&&(this.startIndex=this.startIndexOverride),{data:{startIndex:this.startIndex,maxReturned:10,withLikeCounts:!0,maxChildren:2,approvedChildrenOnly:!1,approvedStartersOnly:this.withoutUnapproved},remove:!1}},loadPermalinkPost:function(c){this.loadFullThread(c).done(a.proxy(function(d){this.renderControls(),a(".js_replycol").css("min-height",this.repliesHeight);var e,f=d.pop(),g={reply:f.returnElement(),ancestors:d.chain().invoke("returnElement").rest().value(),descendants:[]},h={};this.$el.html(this.soyToHtml(tiger.components.groupchats.permalinkBranchWrapper)),e=this.$(".js_permalink-branch"),e.html(this.soyToHtml(tiger.components.groupchats.branch,g,{replyData:this.injectedData})),this.$elements.loadAllButton.removeClass("hide"),this.startReplyControlsFor(e),b.isFunction(this.replyToPost)&&(h.currentTarget=a("#reply_"+c).get(0),h.target=a("#reply_"+c).get(0),this.replyToPost(h)),this.showReplies(c,a("#js_toggled-replies-"+c)),this.scrollToReply(c),this.trigger("indicator:hide")},this))},collapsePermalink:function(){this.$el.empty(),b.isFunction(this.closeReplyForm)&&this.closeReplyForm(),0===this.collection.length?this.loadPosts():(this.prefillRenderQueue(),this.render())},expandBranch:function(b){var c=a(b.currentTarget).parents(".js_reply"),d=c.data("id"),e=this.services.resolve("utils");return e.clickedOnLink(b)?!0:(this.offsetTop=a("#reply_"+d).offset().top,this.scrollTop=a(window).scrollTop(),this.repliesHeight=a(window).height()-c.position().top+c.height(),this.loadPermalinkPost(d),!1)},getTemplateData:function(){return{branches:this.renderQueue}},render:function(){var a=!!this.collection.pagination.next,b=this.getTemplateData(),c=tiger.components.groupchats.threadList,d=this.soyToHtml(c,b,{replyData:this.injectedData});this.startIndex=parseInt(this.startIndex,10),this.total=parseInt(this.collection.listMeta.directReplyCount.total,10),this.unapproved=parseInt(this.collection.listMeta.directReplyCount.unapproved,10),this.clearRenderQueue(),this.$el.append(d),this.startReplyControlsFor(this.$el),a?(this.trigger("pending:hide"),this.setWaypoints()):(this.collection.length<this.total?this.trigger("pending:show"):this.trigger("pending:hide"),this.displayReplyMeta()),this.trigger("indicator:hide")},displayReplyMeta:function(){var a;0===this.collection.listMeta.directReplyCount.total&&this.model.get("allowReplies")&&this.$elements.replyPromptLink.removeClass("hide"),this.collection.listMeta.directReplyCount.unapproved>0&&this.trigger("indicator:show"),0===this.collection.listMeta.directReplyCount.total&&(a=this.model.get("allowReplies")===!1?mantle.messages.repliesDisabled:mantle.messages.replyCreate,this.$elements.replyMessage.empty().append(this.t(a)).removeClass("hide"))},showIndicator:function(){this.$elements.progressIndicator.removeClass("hide")},hideIndicator:function(){this.$elements.progressIndicator.addClass("hide")},showPending:function(){this.$elements.loadPending.removeClass("hide")},hidePending:function(){this.$elements.loadPending.addClass("hide")},scrollToReply:function(b){var c=a("#reply_"+b);window.setTimeout(function(){a.scrollTo(c,200,{offset:-20})},1e3)},postClickHandler:function(a){var b=this.services.resolve("utils");return b.clickedOnLink(a)?!0:!1},renderComment:function(a){var b;this.model.id===a.model.get("parentId")?(b={branch:{reply:a.model.replaceImagesWithOriginal().returnElement()}},a.$el.replaceWith(this.soyToHtml(tiger.components.groupchats.thread,b))):(b={reply:a.model.replaceImagesWithOriginal().returnElement()},a.$el.replaceWith(this.soyToHtml(tiger.components.groupchats.reply,b))),this.startReplyControlsFor(this.$("#reply_"+a.model.id).closest(".js_branch"))},renderControls:function(){this.$el.addClass("all-threads no-reply-counts")},removeControls:function(){this.$el.removeClass("all-threads no-reply-counts"),this.$el.find(".js_header").remove()},displayFullThread:function(b){var c=this.$(b.currentTarget).closest(".js_load-all-replies"),e=c.data("reply-id"),f=this.$("#js_timeline-replies-"+e),g=a("<div />").addClass("timeline-replies-container"),h=new d({model:this.model,el:g,services:this.services});return c.fadeOut(200),h.on("remove",function(){c.show()}),f.append(g),h.setQuery(e),h.$elements=this.$elements,h.injectedData=this.injectedData,h.loadPosts(),!1}}));return f}),define("model/Blog",["lib/jquery","lib/underscore","model/Model","singleton/CurrentUser"],function(a,b,c,d){var e=c.extend({validate:function(c){var d=["properties","adminProperties"],e=[];return b.each(d,a.proxy(function(a){try{JSON.parse(c[a])}catch(b){e.push({key:a,message:"Invalid JSON."})}},this)),e.length>0?e:void 0},sync:function(c,e,f){var g,h,i,j;if("create"!==c&&(void 0===e.id||null===e.id))throw new Error("Blog.sync(): Model undefined");switch(c){case"read":g="GET",h="/apiproxy/blog/"+e.id;break;case"update":g="POST",h="/apiproxy/blog/"+e.id+"/update",i=JSON.stringify(e.toFormData())}return d.has("token")&&""!==d.get("token")&&(h=h+"?token="+d.get("token")),j={type:g,dataType:"json",url:h,contentType:"application/json; charset=utf-8",data:i||null},a.ajax(b.extend(j,f))},parse:function(a){var c;return c=a.meta&&a.meta.success===!0?a.data:a,c.hosts=c.hosts?b.map(c.hosts,function(a){return void 0!==a.name?a.name:a}):[],c.cdnHosts=c.cdnHosts?b.map(c.cdnHosts,function(a){return a.name}):[],c},toFormData:function(){var a=["id","properties","adminProperties","descriptionHtml","canonicalHost","hosts","cdnHosts","excludedTags","adsEnabled"];return b.pick(this.toJSON(),a)}});return e}),function(a,b){var c=a.History=a.History||{};if("undefined"!=typeof c.Adapter)throw new Error("History.js Adapter has already been loaded...");c.Adapter={handlers:{},_uid:1,uid:function(a){return a._uid||(a._uid=c.Adapter._uid++)},bind:function(a,b,d){var e=c.Adapter.uid(a);c.Adapter.handlers[e]=c.Adapter.handlers[e]||{},c.Adapter.handlers[e][b]=c.Adapter.handlers[e][b]||[],c.Adapter.handlers[e][b].push(d),a["on"+b]=function(a,b){return function(d){c.Adapter.trigger(a,b,d)}}(a,b)},trigger:function(a,b,d){d=d||{};var e,f,g=c.Adapter.uid(a);for(c.Adapter.handlers[g]=c.Adapter.handlers[g]||{},c.Adapter.handlers[g][b]=c.Adapter.handlers[g][b]||[],e=0,f=c.Adapter.handlers[g][b].length;f>e;++e)c.Adapter.handlers[g][b][e].apply(this,[d])},extractEventData:function(a,c){var d=c&&c[a]||b;return d},onDomLoad:function(b){var c=a.setTimeout(function(){b()},2e3);a.onload=function(){clearTimeout(c),b()}}},"undefined"!=typeof c.init&&c.init()}(window),function(a,b){var c=a.console||b,d=a.document,e=a.navigator,f=!1,g=a.setTimeout,h=a.clearTimeout,i=a.setInterval,j=a.clearInterval,k=a.JSON,l=a.alert,m=a.History=a.History||{},n=a.history;try{f=a.sessionStorage,f.setItem("TEST","1"),f.removeItem("TEST")}catch(o){f=!1}if(k.stringify=k.stringify||k.encode,k.parse=k.parse||k.decode,"undefined"!=typeof m.init)throw new Error("History.js Core has already been loaded...");m.init=function(){return"undefined"==typeof m.Adapter?!1:("undefined"!=typeof m.initCore&&m.initCore(),"undefined"!=typeof m.initHtml4&&m.initHtml4(),!0)},m.initCore=function(){if("undefined"!=typeof m.initCore.initialized)return!1;if(m.initCore.initialized=!0,m.options=m.options||{},m.options.hashChangeInterval=m.options.hashChangeInterval||100,m.options.safariPollInterval=m.options.safariPollInterval||500,m.options.doubleCheckInterval=m.options.doubleCheckInterval||500,m.options.disableSuid=m.options.disableSuid||!1,m.options.storeInterval=m.options.storeInterval||1e3,m.options.busyDelay=m.options.busyDelay||250,m.options.debug=m.options.debug||!1,m.options.initialTitle=m.options.initialTitle||d.title,m.options.html4Mode=m.options.html4Mode||!1,m.options.delayInit=m.options.delayInit||!1,m.intervalList=[],m.clearAllIntervals=function(){var a,b=m.intervalList;if("undefined"!=typeof b&&null!==b){for(a=0;a<b.length;a++)j(b[a]);m.intervalList=null}},m.debug=function(){m.options.debug&&m.log.apply(m,arguments)},m.log=function(){var a,b,e,f,g,h=!("undefined"==typeof c||"undefined"==typeof c.log||"undefined"==typeof c.log.apply),i=d.getElementById("log");for(h?(f=Array.prototype.slice.call(arguments),a=f.shift(),"undefined"!=typeof c.debug?c.debug.apply(c,[a,f]):c.log.apply(c,[a,f])):a="\n"+arguments[0]+"\n",b=1,e=arguments.length;e>b;++b){if(g=arguments[b],"object"==typeof g&&"undefined"!=typeof k)try{g=k.stringify(g)}catch(j){}a+="\n"+g+"\n"}return i?(i.value+=a+"\n-----\n",i.scrollTop=i.scrollHeight-i.clientHeight):h||l(a),!0},m.getInternetExplorerMajorVersion=function(){var a=m.getInternetExplorerMajorVersion.cached="undefined"!=typeof m.getInternetExplorerMajorVersion.cached?m.getInternetExplorerMajorVersion.cached:function(){for(var a=3,b=d.createElement("div"),c=b.getElementsByTagName("i");(b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c[0];);return a>4?a:!1}();return a},m.isInternetExplorer=function(){var a=m.isInternetExplorer.cached="undefined"!=typeof m.isInternetExplorer.cached?m.isInternetExplorer.cached:Boolean(m.getInternetExplorerMajorVersion());return a},m.emulated=m.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(a.history&&a.history.pushState&&a.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(e.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(e.userAgent))),hashChange:Boolean(!("onhashchange"in a||"onhashchange"in d)||m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<8)},m.enabled=!m.emulated.pushState,m.bugs={setHash:Boolean(!m.emulated.pushState&&"Apple Computer, Inc."===e.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),safariPoll:Boolean(!m.emulated.pushState&&"Apple Computer, Inc."===e.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),ieDoubleCheck:Boolean(m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<7)},m.isEmptyObject=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},m.cloneObject=function(a){var b,c;return a?(b=k.stringify(a),c=k.parse(b)):c={},c},m.getRootUrl=function(){var a=d.location.protocol+"//"+(d.location.hostname||d.location.host);return d.location.port&&(a+=":"+d.location.port),a+="/"},m.getBaseHref=function(){var a=d.getElementsByTagName("base"),b=null,c="";return 1===a.length&&(b=a[0],c=b.href.replace(/[^\/]+$/,"")),c=c.replace(/\/+$/,""),c&&(c+="/"),c},m.getBaseUrl=function(){var a=m.getBaseHref()||m.getBasePageUrl()||m.getRootUrl();return a},m.getPageUrl=function(){var a,b=m.getState(!1,!1),c=(b||{}).url||m.getLocationHref();return a=c.replace(/\/+$/,"").replace(/[^\/]+$/,function(a){return/\./.test(a)?a:a+"/"})},m.getBasePageUrl=function(){var a=m.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a){return/[^\/]$/.test(a)?"":a}).replace(/\/+$/,"")+"/";return a},m.getFullUrl=function(a,b){var c=a,d=a.substring(0,1);return b="undefined"==typeof b?!0:b,/[a-z]+\:\/\//.test(a)||(c="/"===d?m.getRootUrl()+a.replace(/^\/+/,""):"#"===d?m.getPageUrl().replace(/#.*/,"")+a:"?"===d?m.getPageUrl().replace(/[\?#].*/,"")+a:b?m.getBaseUrl()+a.replace(/^(\.\/)+/,""):m.getBasePageUrl()+a.replace(/^(\.\/)+/,"")),c.replace(/\#$/,"")},m.getShortUrl=function(a){var b=a,c=m.getBaseUrl(),d=m.getRootUrl();return m.emulated.pushState&&(b=b.replace(c,"")),b=b.replace(d,"/"),m.isTraditionalAnchor(b)&&(b="./"+b),b=b.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},m.getLocationHref=function(a){return a=a||d,a.URL===a.location.href?a.location.href:a.location.href===decodeURIComponent(a.URL)?a.URL:a.location.hash&&decodeURIComponent(a.location.href.replace(/^[^#]+/,""))===a.location.hash?a.location.href:-1==a.URL.indexOf("#")&&-1!=a.location.href.indexOf("#")?a.location.href:a.URL||a.location.href},m.store={},m.idToState=m.idToState||{},m.stateToId=m.stateToId||{},m.urlToId=m.urlToId||{},m.storedStates=m.storedStates||[],m.savedStates=m.savedStates||[],m.normalizeStore=function(){m.store.idToState=m.store.idToState||{},m.store.urlToId=m.store.urlToId||{},m.store.stateToId=m.store.stateToId||{}},m.getState=function(a,b){"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!0);var c=m.getLastSavedState();return!c&&b&&(c=m.createStateObject()),a&&(c=m.cloneObject(c),c.url=c.cleanUrl||c.url),c},m.getIdByState=function(a){var b,c=m.extractId(a.url);if(!c)if(b=m.getStateString(a),"undefined"!=typeof m.stateToId[b])c=m.stateToId[b];else if("undefined"!=typeof m.store.stateToId[b])c=m.store.stateToId[b];else{for(;;)if(c=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"==typeof m.idToState[c]&&"undefined"==typeof m.store.idToState[c])break;m.stateToId[b]=c,m.idToState[c]=a}return c},m.normalizeState=function(a){var b,c;return a&&"object"==typeof a||(a={}),"undefined"!=typeof a.normalized?a:(a.data&&"object"==typeof a.data||(a.data={}),b={},b.normalized=!0,b.title=a.title||"",b.url=m.getFullUrl(a.url?a.url:m.getLocationHref()),b.hash=m.getShortUrl(b.url),b.data=m.cloneObject(a.data),b.id=m.getIdByState(b),b.cleanUrl=b.url.replace(/\??\&_suid.*/,""),b.url=b.cleanUrl,c=!m.isEmptyObject(b.data),(b.title||c)&&m.options.disableSuid!==!0&&(b.hash=m.getShortUrl(b.url).replace(/\??\&_suid.*/,""),/\?/.test(b.hash)||(b.hash+="?"),b.hash+="&_suid="+b.id),b.hashedUrl=m.getFullUrl(b.hash),(m.emulated.pushState||m.bugs.safariPoll)&&m.hasUrlDuplicate(b)&&(b.url=b.hashedUrl),b)},m.createStateObject=function(a,b,c){var d={data:a,title:b,url:c};return d=m.normalizeState(d)},m.getStateById=function(a){a=String(a);var c=m.idToState[a]||m.store.idToState[a]||b;return c},m.getStateString=function(a){var b,c,d;return b=m.normalizeState(a),c={data:b.data,title:a.title,url:a.url},d=k.stringify(c)},m.getStateId=function(a){var b,c;return b=m.normalizeState(a),c=b.id},m.getHashByState=function(a){var b,c;return b=m.normalizeState(a),c=b.hash},m.extractId=function(a){var b,c,d,e;return e=-1!=a.indexOf("#")?a.split("#")[0]:a,c=/(.*)\&_suid=([0-9]+)$/.exec(e),d=c?c[1]||a:a,b=c?String(c[2]||""):"",b||!1},m.isTraditionalAnchor=function(a){var b=!/[\/\?\.]/.test(a);return b},m.extractState=function(a,b){var c,d,e=null;return b=b||!1,c=m.extractId(a),c&&(e=m.getStateById(c)),e||(d=m.getFullUrl(a),c=m.getIdByUrl(d)||!1,c&&(e=m.getStateById(c)),e||!b||m.isTraditionalAnchor(a)||(e=m.createStateObject(null,null,d))),e},m.getIdByUrl=function(a){var c=m.urlToId[a]||m.store.urlToId[a]||b;return c},m.getLastSavedState=function(){return m.savedStates[m.savedStates.length-1]||b},m.getLastStoredState=function(){return m.storedStates[m.storedStates.length-1]||b},m.hasUrlDuplicate=function(a){var b,c=!1;return b=m.extractState(a.url),c=b&&b.id!==a.id},m.storeState=function(a){return m.urlToId[a.url]=a.id,m.storedStates.push(m.cloneObject(a)),a},m.isLastSavedState=function(a){var b,c,d,e=!1;return m.savedStates.length&&(b=a.id,c=m.getLastSavedState(),d=c.id,e=b===d),e},m.saveState=function(a){return m.isLastSavedState(a)?!1:(m.savedStates.push(m.cloneObject(a)),!0)},m.getStateByIndex=function(a){var b=null;return b="undefined"==typeof a?m.savedStates[m.savedStates.length-1]:0>a?m.savedStates[m.savedStates.length+a]:m.savedStates[a]},m.getCurrentIndex=function(){var a=null;return a=m.savedStates.length<1?0:m.savedStates.length-1},m.getHash=function(a){var b,c=m.getLocationHref(a);return b=m.getHashByUrl(c)},m.unescapeHash=function(a){var b=m.normalizeHash(a);return b=decodeURIComponent(b)},m.normalizeHash=function(a){var b=a.replace(/[^#]*#/,"").replace(/#.*/,"");return b},m.setHash=function(a,b){var c,e;return b!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.setHash,args:arguments,queue:b}),!1):(m.busy(!0),c=m.extractState(a,!0),c&&!m.emulated.pushState?m.pushState(c.data,c.title,c.url,!1):m.getHash()!==a&&(m.bugs.setHash?(e=m.getPageUrl(),m.pushState(null,null,e+"#"+a,!1)):d.location.hash=a),m)},m.escapeHash=function(b){var c=m.normalizeHash(b);return c=a.encodeURIComponent(c),m.bugs.hashEscape||(c=c.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),c},m.getHashByUrl=function(a){var b=String(a).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return b=m.unescapeHash(b)},m.setTitle=function(a){var b,c=a.title;c||(b=m.getStateByIndex(0),b&&b.url===a.url&&(c=b.title||m.options.initialTitle));try{d.getElementsByTagName("title")[0].innerHTML=c.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}return d.title=c,m},m.queues=[],m.busy=function(a){if("undefined"!=typeof a?m.busy.flag=a:"undefined"==typeof m.busy.flag&&(m.busy.flag=!1),!m.busy.flag){h(m.busy.timeout);var b=function(){var a,c,d;if(!m.busy.flag)for(a=m.queues.length-1;a>=0;--a)c=m.queues[a],0!==c.length&&(d=c.shift(),m.fireQueueItem(d),m.busy.timeout=g(b,m.options.busyDelay))};m.busy.timeout=g(b,m.options.busyDelay)}return m.busy.flag},m.busy.flag=!1,m.fireQueueItem=function(a){return a.callback.apply(a.scope||m,a.args||[])},m.pushQueue=function(a){return m.queues[a.queue||0]=m.queues[a.queue||0]||[],m.queues[a.queue||0].push(a),m},m.queue=function(a,b){return"function"==typeof a&&(a={callback:a}),"undefined"!=typeof b&&(a.queue=b),m.busy()?m.pushQueue(a):m.fireQueueItem(a),m},m.clearQueue=function(){return m.busy.flag=!1,m.queues=[],m},m.stateChanged=!1,m.doubleChecker=!1,m.doubleCheckComplete=function(){return m.stateChanged=!0,m.doubleCheckClear(),m},m.doubleCheckClear=function(){return m.doubleChecker&&(h(m.doubleChecker),m.doubleChecker=!1),m},m.doubleCheck=function(a){return m.stateChanged=!1,m.doubleCheckClear(),m.bugs.ieDoubleCheck&&(m.doubleChecker=g(function(){return m.doubleCheckClear(),m.stateChanged||a(),!0},m.options.doubleCheckInterval)),m},m.safariStatePoll=function(){var b,c=m.extractState(m.getLocationHref());if(!m.isLastSavedState(c))return b=c,b||(b=m.createStateObject()),m.Adapter.trigger(a,"popstate"),m},m.back=function(a){return a!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.back,args:arguments,queue:a}),!1):(m.busy(!0),m.doubleCheck(function(){m.back(!1)}),n.go(-1),!0)},m.forward=function(a){return a!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.forward,args:arguments,queue:a}),!1):(m.busy(!0),m.doubleCheck(function(){m.forward(!1)}),n.go(1),!0)},m.go=function(a,b){var c;if(a>0)for(c=1;a>=c;++c)m.forward(b);else{if(!(0>a))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(c=-1;c>=a;--c)m.back(b)}return m},m.emulated.pushState){var o=function(){};m.pushState=m.pushState||o,m.replaceState=m.replaceState||o}else m.onPopState=function(b,c){var d,e,f=!1,g=!1;return m.doubleCheckComplete(),(d=m.getHash())?(e=m.extractState(d||m.getLocationHref(),!0),e?m.replaceState(e.data,e.title,e.url,!1):(m.Adapter.trigger(a,"anchorchange"),m.busy(!1)),m.expectedStateId=!1,!1):(f=m.Adapter.extractEventData("state",b,c)||!1,g=f?m.getStateById(f):m.expectedStateId?m.getStateById(m.expectedStateId):m.extractState(m.getLocationHref()),g||(g=m.createStateObject(null,null,m.getLocationHref())),m.expectedStateId=!1,m.isLastSavedState(g)?(m.busy(!1),!1):(m.storeState(g),m.saveState(g),m.setTitle(g),m.Adapter.trigger(a,"statechange"),m.busy(!1),!0))},m.Adapter.bind(a,"popstate",m.onPopState),m.pushState=function(b,c,d,e){if(m.getHashByUrl(d)&&m.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&m.busy())return m.pushQueue({scope:m,callback:m.pushState,args:arguments,queue:e}),!1;m.busy(!0);var f=m.createStateObject(b,c,d);return m.isLastSavedState(f)?m.busy(!1):(m.storeState(f),m.expectedStateId=f.id,n.pushState(f.id,f.title,f.url),m.Adapter.trigger(a,"popstate")),!0},m.replaceState=function(b,c,d,e){if(m.getHashByUrl(d)&&m.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&m.busy())return m.pushQueue({scope:m,callback:m.replaceState,args:arguments,queue:e}),!1;m.busy(!0);var f=m.createStateObject(b,c,d);return m.isLastSavedState(f)?m.busy(!1):(m.storeState(f),m.expectedStateId=f.id,n.replaceState(f.id,f.title,f.url),m.Adapter.trigger(a,"popstate")),!0};if(f){try{m.store=k.parse(f.getItem("History.store"))||{}}catch(p){m.store={}}m.normalizeStore()}else m.store={},m.normalizeStore();m.Adapter.bind(a,"unload",m.clearAllIntervals),m.saveState(m.storeState(m.extractState(m.getLocationHref(),!0))),f&&(m.onUnload=function(){var a,b,c;try{a=k.parse(f.getItem("History.store"))||{}
}catch(d){a={}}a.idToState=a.idToState||{},a.urlToId=a.urlToId||{},a.stateToId=a.stateToId||{};for(b in m.idToState)m.idToState.hasOwnProperty(b)&&(a.idToState[b]=m.idToState[b]);for(b in m.urlToId)m.urlToId.hasOwnProperty(b)&&(a.urlToId[b]=m.urlToId[b]);for(b in m.stateToId)m.stateToId.hasOwnProperty(b)&&(a.stateToId[b]=m.stateToId[b]);m.store=a,m.normalizeStore(),c=k.stringify(a);try{f.setItem("History.store",c)}catch(e){if(e.code!==DOMException.QUOTA_EXCEEDED_ERR)throw e;f.length&&(f.removeItem("History.store"),f.setItem("History.store",c))}},m.intervalList.push(i(m.onUnload,m.options.storeInterval)),m.Adapter.bind(a,"beforeunload",m.onUnload),m.Adapter.bind(a,"unload",m.onUnload)),m.emulated.pushState||(m.bugs.safariPoll&&m.intervalList.push(i(m.safariStatePoll,m.options.safariPollInterval)),("Apple Computer, Inc."===e.vendor||"Mozilla"===(e.appCodeName||""))&&(m.Adapter.bind(a,"hashchange",function(){m.Adapter.trigger(a,"popstate")}),m.getHash()&&m.Adapter.onDomLoad(function(){m.Adapter.trigger(a,"hashchange")})))},m.options&&m.options.delayInit||m.init()}(window),define("lib/native.history",function(){}),define("module/groupchats/Applet",["lib/jquery","lib/underscore","view/BaseView","module/groupchats/view/PersonalizedReplies","module/groupchats/view/HilitedReplies","module/groupchats/view/StarterReplies","model/Blog","lib/native.history"],function(a,b,c,d,e,f,g){var h,i,j,k,l;return h=c.extend(b.extend({},{pingTimeout:null,injectedData:{},_personalizedRepliesView:null,_hilitedRepliesView:null,_threadedRepliesView:null,pushStateDefault:null,forcedView:!1,events:{"click .js_allview":"allView","click .js_reload-groupchats":"reloadGroupchats","click .js_load-pending-btn":"loadPending"},initialize:function(){this.rootModel=this.model,k=this.services.resolve("currentBlog"),j=this.services.resolve("currentUser"),i=this.services.resolve("feature"),l=this.services.resolve("eventDispatcher"),i.isOn("timespentincomments")&&(l.once("update.postlist.reply",this.setTrackingWaypoint,this),window.onbeforeunload=a.proxy(function(){window.clearTimeout(this.pingTimeout)},this)),l.on("reply:goto",function(a){this.loadPermalink(a.model.id)},this),l.once("update.postlist.reply",this.scrollToReplies,this),this.injectedData.basePermalink=this.model.get("permalink"),j.on("authenticated",this.markFollowees,this),l.on("update.postlist.reply",this.markFollowees,this),History.Adapter.bind(window,"statechange",a.proxy(this.handleStatechange,this))},handleStatechange:function(){var a=History.getState(),b=History.getCurrentIndex(),c=a.data._index===b-1;if(c||void 0!==a.data.type||(a.data=this.pushStateDefault),!c&&a.data)switch(a.data.type){case"permalink":break;case"starters":this.loadStarters();break;case"personalized":this.reloadPersonalizedReplies(a.data.args)}},markFollowees:function(){var c=function(c,d){var e,f;return d=d||"",c&&c.length&&(f=b.map(c,function(a){return d+'[data-blogid="'+a+'"]'}).join(","),e=a(f)),e};if(j.isLoggedIn()){var d=c(j.get("defaultBlog").followedBlogIds);if(d&&d.length&&d.addClass("followed").find(".js_followforuser").addClass("hide").end().find(".js_followforuser").removeClass("hide"),j.hasPermission("AUTHOR")||j.hasPermission("SUPERUSER")){a(".js_followforblog").removeClass("hide");var e=new g({id:k.id});e.fetch().done(function(){d=c(e.get("followedBlogIds"),".f-dropdown"),d&&d.length&&d.addClass("followed").find(".js_followforblog").addClass("hide").end().find(".js_unfollowforblog").removeClass("hide")})}}else a(".js_avatar-container.followed").removeClass("followed")},render:function(){return this.setupDomElements(),this.enableDiscussion(),this.reappendLoadingLayer(),this},initSubview:function(a,c){var d=new a(b.defaults(c,{services:this.services}));return d.$elements=this.$elements,d.injectedData=this.injectedData,d.on("reply:personalized:reload",this.gotoPersonalizedView,this),d},getStarterRepliesView:function(){return null===this._threadedRepliesView&&(this._threadedRepliesView=this.initSubview(f,{el:this.$elements.branchList,model:this.model})),this._threadedRepliesView},getPersonalizedRepliesView:function(){return null===this._personalizedRepliesView&&(this._personalizedRepliesView=this.initSubview(d,{el:this.$elements.branchList,model:this.model})),this._personalizedRepliesView},getHilitedRepliesView:function(a){return null===this._hilitedRepliesView&&(this._hilitedRepliesView=this.initSubview(e,{collection:a,el:this.$el.find(".js_branch-grid"),model:this.model})),this._hilitedRepliesView},loadStarters:function(){return this.pushStateDefault||(this.pushStateDefault={type:"starters",args:{}}),this.unloadPersonalizedReplies(),this.getStarterRepliesView().loadPosts(),this.$elements.loadAllButton.addClass("active"),this.$elements.loadHighlightButton.removeClass("active"),!1},unloadStarters:function(){null!==this._threadedRepliesView&&(this.getStarterRepliesView().remove(),this._threadedRepliesView=null)},allView:function(){var a=this.model.get("permalinkPath")+"/all";return this.updatePushstate(a,{type:"starters"}),this.removeNoAuthorParticipationMessage(),this.unloadStarters(),this.loadStarters(),!1},reloadGroupchats:function(){var a=this.model.get("permalinkPath");return this.updatePushstate(a,{type:"personalized",args:this.pushStateDefault}),this.removeNoAuthorParticipationMessage(),this.unloadStarters(),this.unloadPersonalizedReplies(),this.loadPersonalizedReplies({query:this.rootModel.get("authorBlogName"),force:!0}),!1},setupDomElements:function(){this.$elements={outerContainer:this.$el,innerContainer:this.$el.find(".replies-wrapper"),branchList:this.$el.find(".js_branch-list"),progressIndicator:this.$el.find(".js_reply-loading-progress"),replyControls:this.$el.find(".js_reply-controls"),replyFormContainer:this.$el.find(".js_reply-form-container"),replyPromptLink:this.$el.find(".js_reply-prompt-link"),loadAllButton:this.$el.find(".js_allview"),loadHighlightButton:this.$el.find(".js_reload-groupchats"),repliesEnd:this.$el.find(".js_load-more"),replyMessage:this.$el.find(".js_reply-message"),loadingLayer:this.$el.find(".js_loading-layer"),loadPending:this.$el.find(".js_load-pending")}},enableDiscussion:function(){var b,c=a(".js_reply-to-post"),d=this.getPageType(),e=this.model;return c.length?(b=function(){var a,b,f;b=j.hasRole("AUTHOR",k.id),a="permalink"===d&&e.get("liveBlog")===!0&&e.get("isStarter")===!0,f=!a||a&&b,f&&c.attr("disabled",!1).attr("href",c.data("href")).css("display","inline-block")},j.onAuth.always(b),void 0):!1},scrollToReplies:function(b){if(b.length)a.scrollTo(b,250,{offset:-20});else{var c,d=window.location.hash.match(/\d+/);-1!==window.location.hash.indexOf("replies")?window.setTimeout(function(){a.scrollTo(".replies-wrapper",250,{offset:-20})},300):d&&(c=d[0],a.scrollTo("#reply_"+c,250,{offset:-20}))}},loadPermalink:function(a){this.pushStateDefault||(this.pushStateDefault={type:"permalink",args:{id:a}}),this.$elements.loadAllButton.removeClass("active"),this.$elements.loadHighlightButton.removeClass("active"),this.getStarterRepliesView().loadPermalinkPost(a)},loadPersonalizedReplies:function(a){var b,c,d,e,f="";"string"==typeof a?(b=a,d={query:b,force:!1}):(b=a.query,c=a.id,d={query:b,refId:c,force:!!a.force}),a.force&&(this.forcedView=!0),this.pushStateDefault||(this.pushStateDefault={type:"personalized",args:d}),this.$elements.loadAllButton.removeClass("active"),this.$elements.loadHighlightButton.addClass("active"),this.unloadStarters(),e=this.getPersonalizedRepliesView(),e.on("reply:personalized:hasNoMore",this.handleReplyFallback,this),e.setQuery(null!==b?b+f:"",void 0!==c?c:null),e.loadPosts()},handleReplyFallback:function(){var a=this.getPersonalizedRepliesView(),b=this.services.resolve("feature"),c=a.collection.listMeta.byScoreItems,d=this.forcedView,e=this.model.get("publishTimeMillis")<13885344e5;e?d?this.prepareFallback():(a.noScrollOnExit=!0,this.allView()):this.prepareFallback(),b.isOn("userlinks")&&c.length>0&&this.showSecondaryRepliesView(c)},prepareFallback:function(){var a=this.getPersonalizedRepliesView(),b=a.collection.listMeta.byScoreItems,c=this.model.get("replyCount"),d=a.collection.length;if(c>0&&0===d)if(b.length>0){var e=b.at(0).get("authorBlogName");this.showFallbackAuthorReplies(e)}else this.showNoAuthorParticipationMessage()},showFallbackAuthorReplies:function(a){var b=this.getPersonalizedRepliesView();b.noScrollOnExit=!0,this.unloadPersonalizedReplies(),this.loadPersonalizedReplies({query:a})},showNoAuthorParticipationMessage:function(){var a,b=this.$el.find(".js_replycol"),c=b.find(".author-message"),d=this.model.get("permalink");c.length>0?c.removeClass("hide"):(a=this.soyToHtml(tiger.components.groupchats.noAuthorParticipationMessageUser,{permalink:d}),b.append(a))},removeNoAuthorParticipationMessage:function(){var a=this.$el.find(".author-message");a.addClass("hide")},showSecondaryRepliesView:function(a){var b=this.getHilitedRepliesView(a);b.prefillRenderQueue(),b.collection.trigger("sync")},unloadPersonalizedReplies:function(){null!==this._personalizedRepliesView&&(this.getPersonalizedRepliesView().remove(),this._personalizedRepliesView=null),null!==this._hilitedRepliesView&&(this.getHilitedRepliesView().remove(),this._hilitedRepliesView=null)},gotoPersonalizedView:function(a){var b=this.model.get("permalinkPath")+"/+"+a.query;this.updatePushstate(b,{type:"personalized",args:a}),this.reloadPersonalizedReplies(a)},reloadPersonalizedReplies:function(b){this.showLoadingLayer(!0),l.once("update.postlist.reply",function(){this.showLoadingLayer(!1);var a=this.$("#reply_"+b.id);a.length&&this.scrollToReplies(a)},this),window.setTimeout(a.proxy(function(){this.unloadPersonalizedReplies(),this.loadPersonalizedReplies(b)},this),500)},setTrackingWaypoint:function(){var b=this.$el.find(".js_replycol");b.waypoint(a.proxy(function(){b.waypoint("destroy"),window._gaq.push(["_trackEvent","Discussion engagement","Groupchats discussion layout - discussions - 0 seconds",this.model.get("permalink")]),this.pingTracker(0)},this),{offset:"50%"})},pingTracker:function(b){b++,this.pingTimeout=window.setTimeout(a.proxy(function(){window._gaq.push(["_trackEvent","Discussion engagement","Groupchats discussion layout - discussions -  "+5*b+" seconds",this.model.get("permalink")]),48===b?window.clearTimeout(this.pingTimeout):this.pingTracker(b)},this),5e3)},reappendLoadingLayer:function(){this.$elements.loadingLayer.detach().appendTo(document.body)},showLoadingLayer:function(a){switch(a=arguments.length?a:!0){case!0:this.$elements.innerContainer.addClass("transparent"),this.$elements.loadingLayer.removeClass("hide");break;case!1:this.$elements.innerContainer.removeClass("transparent"),this.$elements.loadingLayer.addClass("hide")}},updatePushstate:function(a,b){b._index=History.getCurrentIndex(),History.pushState(b,document.title,a)},loadPending:function(){var a=this.getStarterRepliesView();a.withoutUnapproved=!1,a.startIndexOverride=a.collection.pagination.curr.total,a.loadPosts()}}))}),define("module/GroupchatsModule",["module/base/ModuleBase","module/groupchats/Applet"],function(a,b){var c,d,e,f;return e=null,f=function(a){return e=new b(a),e.render()},c=a.extend({constructor:function(){return d?d:(a.prototype.constructor.apply(this,arguments),d=this,void 0)},handledEvents:{loadStarters:"loadStarters",loadPersonalizedReplies:"loadPersonalizedReplies",loadPermalink:"loadPermalink"},getApplet:function(){return e?e:f(this.options)},loadPersonalizedReplies:function(a){this.getApplet().loadPersonalizedReplies(a)},loadStarters:function(){this.getApplet().loadStarters()},loadPermalink:function(a){this.getApplet().loadPermalink(a.id)}})});