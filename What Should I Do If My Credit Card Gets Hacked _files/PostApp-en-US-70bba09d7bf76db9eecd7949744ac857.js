if("undefined"==typeof mantle)var mantle={};if("undefined"==typeof mantle.components&&(mantle.components={}),"undefined"==typeof mantle.components.ad&&(mantle.components.ad={}),"undefined"==typeof mantle.components.header&&(mantle.components.header={}),"undefined"==typeof mantle.components.header.user&&(mantle.components.header.user={}),"undefined"==typeof mantle.components.post&&(mantle.components.post={}),"undefined"==typeof mantle.components.post.button&&(mantle.components.post.button={}),"undefined"==typeof mantle.components.post.header&&(mantle.components.post.header={}),"undefined"==typeof mantle.components.post.inset&&(mantle.components.post.inset={}),"undefined"==typeof mantle.components.post.meta&&(mantle.components.post.meta={}),"undefined"==typeof mantle.components.post.type&&(mantle.components.post.type={}),"undefined"==typeof mantle.components.replies&&(mantle.components.replies={}),"undefined"==typeof mantle.components.userbar&&(mantle.components.userbar={}),"undefined"==typeof mantle.components.userbar.button&&(mantle.components.userbar.button={}),"undefined"==typeof mantle.utils&&(mantle.utils={}),"undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.agegate&&(tiger.components.agegate={}),"undefined"==typeof tiger.components.annotation&&(tiger.components.annotation={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.modals&&(tiger.components.forms.modals={}),"undefined"==typeof tiger.components.forms.modals.invite&&(tiger.components.forms.modals.invite={}),"undefined"==typeof tiger.components.forms.replies&&(tiger.components.forms.replies={}),"undefined"==typeof tiger.components.header&&(tiger.components.header={}),"undefined"==typeof tiger.components.header.notifications&&(tiger.components.header.notifications={}),"undefined"==typeof tiger.components.liveblog&&(tiger.components.liveblog={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.button&&(tiger.components.post.button={}),"undefined"==typeof tiger.components.post.header&&(tiger.components.post.header={}),"undefined"==typeof tiger.components.post.inset&&(tiger.components.post.inset={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),"undefined"==typeof tiger.components.post.type&&(tiger.components.post.type={}),"undefined"==typeof tiger.components.spinner&&(tiger.components.spinner={}),"undefined"==typeof tiger.components.user&&(tiger.components.user={}),"undefined"==typeof tiger.section&&(tiger.section={}),"undefined"==typeof tiger.section.header&&(tiger.section.header={}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("lib/needly",b):a.Needly=b()}(this,function(){function a(a,b,c){this.resolve=function(){return a.resolve(b,{args:c})}}function b(){var b=this,i={};return this.registerClass=function(a,b,d){return i[a]={type:c,item:b,args:d},b},this.registerSingleton=function(a,b){return i[a]={type:e,item:b},b},this.registerFactory=function(a,b,c,e){return i[a]={type:d,item:b,args:c,context:e},b},this.registerMany=function(a){for(var b in a)if(a.hasOwnProperty(b)){var f=a[b],g=f.type,h="BadConfiguration:";if(!f||!f.dependency)throw new Error(h+b+".dependency");if(g!==e&&g!==c&&g!==d)throw new Error(h+b+".type");i[b]={item:f.dependency,type:f.type,args:f.type!==e?f.args:null,context:f.type===d?f.context:null}}},this.unregister=function(a){delete i[a]},this.unregisterAll=function(){i={}},this.property=function(b,c){return new a(this,b,c)},this.args=function(){var a=arguments.length-1,c=f.call(arguments,0,a),d=arguments[a];return function(){for(var e=[],g=f.call(arguments),h=Math.max(a,g.length),i=0;h>i;i++){var j,k=c[i];if(k)if("string"==typeof k)k=g[i]||b.resolve(k);else{if(k!==new Object(k))throw new Error("BadArgument: Expected string or object. Received: "+k);j=k,k=g[i]||{};for(var l in j)!k.hasOwnProperty(l)&&j.hasOwnProperty(l)&&(k[l]=b.resolve(j[l]))}else k=g[i];e.push(k)}return d.apply(d,e)}},this.resolveAll=function(b){for(var c in b){var d=b[c];d&&d instanceof a&&(b[c]=d.resolve())}return b},this.autoResolve=function(a,c){c=c||"initialize";var d=a.prototype[c];a.prototype[c]=function(){b.resolveAll(this),d&&d.apply(this,arguments)}},this.resolve=function(a,b){var f,j=b||{},k=i[a];if(k)switch(f=h(k.args,j.args),k.type){case e:return k.item;case d:return this.resolveAll(k.item.apply(j.context||k.context||this,f));case c:return this.resolveAll(g(k.item,f))}else{var l="DependencyNotFound:"+a;console&&console.warn&&console.warn(l),j.error&&j.error(l)}},this}var c="class",d="factory",e="singleton",f=Array.prototype.slice,g=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c},h=function(a,b){return(a||[]).concat(b||[])};return{Container:b}}),define("module/base/ModuleBase",["lib/underscore","view/BaseView"],function(a,b){var c=b.extend({handledEvents:{},initialize:function(){a.each(this.handledEvents,function(a,b){this.on(b,this[a],this)},this)},start:function(){},setOptions:function(b){this.options=a.defaults(b,this.options,{services:this.services})},remove:function(){this.off(null,null,this)}});return c}),define("singleton/ModuleFactory",["lib/jquery","lib/underscore","module/base/ModuleBase"],function(a,b,c){var d;return d=function(a,c,d){var e=b.isArray(a)?a:[a],f=function(a){return"module/"+a},g=b.map(e,f);require(g,function(){var a=[];b.each(arguments,function(b){var d=new b({services:c});d.start(),a.push(d)}),d.resolve.apply(this,a)},d.reject)},function(b,c){var e=a.Deferred();return d(b,c,e),e.promise()}}),define("singleton/KillSwitch",["lib/backbone","singleton/Utils"],function(a,b){var c=a.Model.extend({killSwitches:b.getKinjaMeta().killswitches||{},get:function(a){var b=this.killSwitches[a]||{value:null,defaultValue:null};return b},hasValue:function(a,b){var c=this.get(a);return c.value===b}});return new c}),define("collection/Notifications",["lib/jquery","lib/underscore","lib/backbone","singleton/CurrentUser","singleton/Utils"],function(a,b,c,d,e){var f=c.Collection.extend({model:c.Model,initialize:function(a,d){c.Collection.prototype.initialize.call(this,a,d),this.options=b.extend(this.options,d||{})},sync:function(c,e,f){var g={type:"GET",dataType:"json",url:"/api/user/notifications",data:{token:d.get("token"),markAsRead:"true",maxReturned:5}};return a.ajax(b.extend(g,f))},parse:function(a){if(void 0===a||void 0===a.data||a.meta.success!==!0)return{};var c=function(a){if(void 0!==a&&a){a.display=e.cutHtml(a.display.replace(/(<([^>]+)>)/gi," "),90);var b=void 0!==a.permalinkPath&&null!==a.permalinkPath?a.permalinkPath:"/"+a.id,c=null!==a.permalinkHost&&void 0!==a.permalinkHost?a.permalinkHost:"";a.permalink=c+b}return a},f=d.get("notificationsSeenUntil"),g=[];return b.each(a.data,function(a){void 0!==a.reply&&null!==a.reply&&(a.reply.post=c(a.reply.post)),void 0!==a.likeGroup&&null!==a.likeGroup&&(a.likeGroup.post=c(a.likeGroup.post),b.each(a.likeGroup.authors,function(a){return a})),a.repost&&a.repost.postAction&&(a.repost.postAction.post=c(a.repost.postAction.post)),a.seen=a.createTimeMillis<=f,g.push(a)}),g}});return f}),tiger.components.spinner.bounce=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<span class="spinner bounce"><span class="one"></span><span class="two"></span><span class="three"></span></span>'),b?"":c.toString()},define("templates/tiger/components/spinner",function(){}),tiger.components.user.notifications=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="sidebar-dropdown proxima mln f-dropdown no-triangle scrollable" id="notifications-menu" data-dropdown-content><ul class="menu-list man js_notification-list"><li class="title"><a class="js_event-link text-light pan right" onClick="window._gaq.push([\'_trackEvent\', \'Notifications\', \'Menu - See All\']);" href="http://',soy.$$escapeHtml(a.defaultBlog.canonicalHost),'/private/notifications">See all</a><span class="text-light text-upper">Notifications</span></li></ul></div>'),b?"":c.toString()},define("templates/tiger/components/user/notifications",function(){}),tiger.components.header.notifications.dropdown=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;d.append("	");var e=a.notifications,f=e.length;if(f>0)for(var g=0;f>g;g++){var h=e[g];(h.follow||h.reply||h.likeGroup&&h.likeGroup.post||h.repost&&h.repost.postAction||h.message||h.invite||h.inviteError)&&(d.append('<li class="',soy.$$escapeHtml(h.seen?"seen":"unseen"),' js_notification-item cursor-default">'),h.follow?tiger.components.header.notifications.followEvent({follow:h.follow,relativeTime:h.relativeTime},d,c):h.reply?tiger.components.header.notifications.replyEvent({reply:h.reply,relativeTime:h.relativeTime},d,c):h.likeGroup&&h.likeGroup.post?tiger.components.header.notifications.likeGroupPostEvent({likeGroup:h.likeGroup,relativeTime:h.relativeTime},d,c):h.repost&&h.repost.postAction?tiger.components.header.notifications.repostEvent({repost:h.repost,relativeTime:h.relativeTime},d,c):h.message?tiger.components.header.notifications.messageEvent({message:h.message,relativeTime:h.relativeTime},d,c):h.invite?tiger.components.header.notifications.inviteEvent({invite:h.invite,relativeTime:h.relativeTime},d,c):h.inviteError&&tiger.components.header.notifications.inviteErrorEvent({eventId:h.id,inviteError:h.inviteError,relativeTime:h.relativeTime},d,c),d.append('<span class="unread-marker"></span></li>'))}else d.append('<li class="text-center pvm js_notification-item">You have no unread notifications.</li>');return d.append('<li class="text-center text-upper js_notification-item"><a class="js_event-link" onClick="window._gaq.push([\'_trackEvent\', \'Notifications\', \' Menu - See All Bottom\']);" href="http://',soy.$$escapeHtml(a.defaultBlog.canonicalHost),'/private/notifications">See all notifications</a></li>'),b?"":d.toString()},tiger.components.header.notifications.followEvent=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<a href="http://',soy.$$escapeHtml(a.follow.blog.canonicalHost),'" onClick="window._gaq.push([\'_trackEvent\', \'Notifications\', \'Menu - Follow Notification\']);" class="js_event-link floated-container img-20 notification-box"><span class="txt"><span class="msg txt-20">',"FOLLOW"==a.follow.type?soy.$$escapeHtml(a.follow.blog.displayName)+" started following you.":soy.$$escapeHtml(a.follow.blog.displayName)+" stopped following you.",'</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span></span></a>"),b?"":c.toString()},tiger.components.header.notifications.replyEvent=function(a,b,c){var d=b||new soy.StringBuilder,e=a.reply.post.showByline&&""!=a.reply.post.byline?a.reply.post.byline:a.reply.author.displayName;d.append('<a href="',soy.$$escapeHtml(a.reply.post.permalink),'" onClick="window._gaq.push([\'_trackEvent\', \'Notifications\', \'Menu - Reply Notification\']);"class="js_event-link floated-container img-20 notification-box"><span class="avatar">');var f=new soy.StringBuilder("avt-large");return f=f.toString(),d.append(a.reply.post.showByline&&""!=a.reply.post.byline?(null==a.reply.post.salesAvatarMap?null:a.reply.post.salesAvatarMap.id)?'<span class="img-border"><img src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.reply.post.salesAvatarMap.id,f))+'" /></span>':'<span class="img-border"><img src="'+soy.$$escapeHtml(c.meta.assets.images)+'icons/avatar-big.png" /></span>':'<span class="img-border"><img src="'+soy.$$escapeHtml(a.reply.author.avatar.id?window.kinja.imageUrl(a.reply.author.avatar.id,f,a.reply.author.avatar.format):c.meta.assets.images+"icons/avatar-big.png")+'" /></span>','</span><span class="txt"><span class="msg txt-20"><strong>',soy.$$filterNoAutoescape(e),'</strong> replied to you:</span><span class="msg-excerpt">',soy.$$filterNoAutoescape(a.reply.post.display),'</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span></span></a>"),b?"":d.toString()},tiger.components.header.notifications.likeGroupPostEvent=function(a,b){var c=b||new soy.StringBuilder;c.append('	<a href="',soy.$$escapeHtml(a.likeGroup.post.permalink),'" onClick="window._gaq.push([\'_trackEvent\', \'Notifications\', \'Menu - Recommend Notification\']);" class="js_event-link floated-container img-20 notification-box"><span class="avatar">');var d=new soy.StringBuilder("avt-large");return d=d.toString(),c.append('<span class="img-border"><img src="',soy.$$escapeHtml(window.kinja.imageUrl(a.likeGroup.authors[0].avatar.id,d,a.likeGroup.authors[0].avatar.format)),'" /></span></span><span class="txt"><span class="msg">',a.likeGroup.post.headline?a.likeGroup.totalAuthorCount>1?soy.$$escapeHtml(a.likeGroup.totalAuthorCount)+" people recommended <strong>"+soy.$$filterNoAutoescape(a.likeGroup.post.headline)+"</strong>.":soy.$$escapeHtml(a.likeGroup.authors[0].displayName)+" recommended <strong>"+soy.$$filterNoAutoescape(a.likeGroup.post.headline)+"</strong>.":a.likeGroup.totalAuthorCount>1?soy.$$escapeHtml(a.likeGroup.totalAuthorCount)+" people recommended your post.":soy.$$escapeHtml(a.likeGroup.authors[0].displayName)+" recommended your post.",'</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span></span></a>"),b?"":c.toString()},tiger.components.header.notifications.repostEvent=function(a,b){var c=b||new soy.StringBuilder;c.append("	");var d=""!=a.repost.postAction.post.headline?a.repost.postAction.post.headline:a.repost.postAction.post.display;c.append('<a href="',soy.$$escapeHtml(a.repost.postAction.post.permalink),'" onClick="window._gaq.push([\'_trackEvent\', \'Notification\', \'Menu - Share Notification\']);" class="js_event-link floated-container img-20 notification-box"><span class="avatar">');var e=new soy.StringBuilder("avt-large");return e=e.toString(),c.append('<span class="img-border"><img src="',soy.$$escapeHtml(window.kinja.imageUrl(a.repost.author.avatar.id,e,a.repost.author.avatar.format)),'" /></span></span><span class="txt"><span class="msg">',a.repost.author.defaultBlogId==a.repost.postAction.blogId?"<strong>"+soy.$$filterNoAutoescape(d)+"</strong> has been shared by <strong>"+soy.$$escapeHtml(a.repost.author.displayName)+"</strong>.":"<strong>"+soy.$$filterNoAutoescape(d)+"</strong> has been shared by <strong>"+soy.$$escapeHtml(a.repost.author.displayName)+"</strong> to <strong>"+soy.$$escapeHtml(a.repost.postAction.blog.displayName)+"</strong>.",'</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span></span></a>"),b?"":c.toString()},tiger.components.header.notifications.messageEvent=function(a,b){var c=b||new soy.StringBuilder;return c.append('<span class="txt"><span class="msg"><strong>',soy.$$escapeHtml(a.message.author.displayName),"</strong>: ",soy.$$escapeHtml(a.message.text),'</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span></span>"),b?"":c.toString()},tiger.components.header.notifications.inviteEvent=function(a,b){var c=b||new soy.StringBuilder;c.append('	<a href="',soy.$$escapeHtml(a.invite.post.permalink),'" onClick="window._gaq.push([\'_trackEvent\', \'Notifications\', \'Menu - Invite Notification\']);" class="js_event-link floated-container img-20 notification-box"><span class="avatar">');var d=new soy.StringBuilder("avt-large");return d=d.toString(),c.append('<span class="img-border"><img src="',soy.$$escapeHtml(window.kinja.imageUrl(a.invite.inviter.avatar.id,d,a.invite.inviter.avatar.format)),'" /></span></span><span class="txt"><span class="msg"><strong>',soy.$$escapeHtml(a.invite.inviter.displayName),'</strong> has invited you to a discussion.</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span></span></a>"),b?"":c.toString()},tiger.components.header.notifications.inviteErrorEvent=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append("	"),a.inviteError.status&&"NEW"==a.inviteError.status){d.append('<span class="floated-container img-20 notification-box"><span class="avatar">');var e=new soy.StringBuilder("avt-large");e=e.toString(),d.append('<span class="img-border"><img src="',soy.$$escapeHtml(c.meta.assets.images),'icons/icon-kinja@2x.png" /></span></span><span class="txt"><span class="msg">An error occurred during inviting <strong>',soy.$$escapeHtml(a.inviteError.inviteText),'</strong>.</span><span class="timestamp text-light text-tiny">',soy.$$escapeHtml(a.relativeTime),"</span><button onClick=\"window._gaq.push(['_trackEvent', 'Notifications', 'Menu - Invite Error Notification']);\" class=\"tiny secondary resend mts js_resend-invite\" data-code=\"",soy.$$escapeHtml(a.inviteError.code),'" data-eventId="',soy.$$escapeHtml(a.eventId),'" data-blogId="',soy.$$escapeHtml(a.inviteError.blogId),'" data-postId="',soy.$$escapeHtml(a.inviteError.postId),'" data-inviteText="',soy.$$escapeHtml(a.inviteError.inviteText),'">Resend</button><button class="tiny secondary mts mls js_remove-notification" data-eventId="',soy.$$escapeHtml(a.eventId),'">Nevermind</button></span></span>')}return b?"":d.toString()},define("templates/tiger/components/header/notifications",function(){}),tiger.components.post.meta.avatarDisplay=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;return d.append('	<div class="avatar avatar-container js_avatar-container"',a.dropdownName?' data-dropdownhover="'+soy.$$escapeHtml(a.dropdownName)+'"':"",'><span class="icon icon-followed notranslate">O</span>',a.url&&"http://"!=a.url?'<a href="'+soy.$$escapeHtml(a.url)+'"'+(a.nofollow?' rel="nofollow"':"")+">":"",'<span class="img-border"><img src="',a.avatar?soy.$$escapeHtml(a.avatar):soy.$$escapeHtml(c.meta.assets.images)+"icons/avatar-big.png",'" /></span>',a.url&&"http://"!=a.url?"</a>":"","</div>"),b?"":d.toString()},define("templates/tiger/components/post/meta/avatar-display",function(){}),tiger.components.post.meta.byline=function(a,b,c){for(var d=b||new soy.StringBuilder,e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}e=e.toString();var j=new soy.StringBuilder;if("reply"==a.mode)for(var k=a.post.blogs,l=k.length,m=0;l>m;m++){var n=k[m];j.append(n.id==a.post.replyMeta.parentAuthor.defaultBlogId?soy.$$escapeHtml(n.canonicalHost):"")}if(j=j.toString(),a.post.showByline&&(!a.post.postAction||!a.post.postAction.author)){if(d.append('<span class="display-name author vcard">',""==a.post.byline?e?'<a href="http://'+soy.$$escapeHtml(e)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+' class="fn url">'+soy.$$escapeHtml(a.post.author.displayName)+"</a>":soy.$$escapeHtml(a.post.author.displayName):soy.$$filterNoAutoescape(a.post.byline),"</span>"),a.post.allowReplies&&"reply"!=a.mode){var o=a.post.sharedPost?a.post.sharedPost.replyCount:a.post.replyCount?a.post.replyCount:0;d.append(o&&o>0?' <a href="'+(c.meta&&"permalink"!=c.meta.pageType?soy.$$escapeHtml(a.post.permalink):"")+'#replies" class="text-light'+("reply"==a.mode?" js_expand-branch":" js_reply-to-post-disabled")+'" rel="nofollow">'+(1==o?"and "+soy.$$escapeHtml(o)+" other":"and "+soy.$$escapeHtml(o)+" others")+"</a>":"")}d.append("reply"==a.mode?'&nbsp;Replied to a Post by&nbsp;<span class="strong">'+(""==a.post.replyMeta.parentByline?'<a href="http://'+soy.$$escapeHtml(j)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(null==a.post.replyMeta?null:null==a.post.replyMeta.parentAuthor?null:a.post.replyMeta.parentAuthor.displayName)+"</a>":soy.$$escapeHtml(a.post.replyMeta.parentByline))+"</span>":"")}return d.append(a.post.postAction&&a.post.postAction.author?soy.$$escapeHtml(a.post.postAction.author.displayName)+' <span class="text-italic">'+("shared-reply"==a.mode?"Shared a Reply by":"Shared a Post by")+"</span> "+(""==a.post.byline?'<a href="http://'+soy.$$escapeHtml(e)+'" class="text-light"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(a.post.author.displayName)+"</a>":soy.$$escapeHtml(a.post.byline)):""),b?"":d.toString()},tiger.components.post.meta.topByline=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}if(e=e.toString(),a.post.showByline)if(""==a.post.byline){d.append('<span class="display-name author vcard"><a href="http://',soy.$$escapeHtml(e),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':""," ",a.dropdownName?' data-dropdownhover-anchor="'+soy.$$escapeHtml(a.dropdownName)+'"':"",' class="fn url">',soy.$$escapeHtml(a.post.author.displayName),"</a>");var j=(null==c.replyData?null:c.replyData.atUser)==a.post.authorBlogName;if(d.append(j?'<span class="moderator-name">, Host</span>':"","reply"==a.mode&&(null==a.post.replyMeta?null:null==a.post.replyMeta.parentAuthor?null:a.post.replyMeta.parentAuthor.displayName)?'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+((null==a.post.replyMeta?null:a.post.replyMeta.showParentByline)&&""!=(null==a.post.replyMeta?null:a.post.replyMeta.parentByline)?soy.$$filterNoAutoescape(a.post.replyMeta.parentByline):soy.$$escapeHtml(a.post.replyMeta.parentAuthor.displayName))+"</span>":"",a.contributors?' <span class="text-normal text-tiny">'+(1==a.contributors?"and 1 other":a.contributors>1?"and "+soy.$$escapeHtml(a.contributors)+" others":"")+"</span>":"","</span>"),c.meta.blog&&a.post.isStarter&&a.post.defaultBlogId!=a.post.author.defaultBlogId&&a.post.defaultBlogId!=c.meta.blog.id||a.forSharedPost){d.append('<span class="published-on">');for(var k=a.post.blogs,l=k.length,m=0;l>m;m++){var n=k[m];d.append(n.id==a.post.defaultBlogId?' on <a class="blog-name" href="http://'+soy.$$escapeHtml(n.canonicalHost)+'" target="_self" '+(a.post.isPromoted?'rel="nofollow"':"")+">"+soy.$$escapeHtml(n.displayName)+"</a>":"")}d.append("</span>")}}else d.append('<span class="display-name">',soy.$$filterNoAutoescape(a.post.byline),"</span>");return d.append(a.post.postAction&&a.post.postAction.author&&a.post.postAction.author.displayName?'<span class="reposted-by">shared by <span class="text-upper">'+soy.$$escapeHtml(a.post.postAction.author.displayName)+"</span></span>":""),b?"":d.toString()},tiger.components.post.meta.promotedByline=function(a,b){var c=b||new soy.StringBuilder;if(c.append('	<span class="meta-promoted"><span class="promoted-dot">&middot;</span> ',a.post.sponsored||a.post.isBillboardPost?'<span class="sponsored-label text-upper">Sponsored</span><span class="icon notranslate mhs">B</span>':""),a.post.isPromoted){var d=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");d=d.toString(),c.append('Promoted by <span class="js_promoted_displayName">',soy.$$filterNoAutoescape(d),"</span>")}return c.append("</span>"),b?"":c.toString()},tiger.components.post.meta.publishTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="publish-time js_publish_time" data-publishtime="',soy.$$escapeHtml(a.post.publishTimeMillis),'">'),a.post.postAction&&a.post.postAction.createTime?(d.append('<a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.postAction.createTime},d,c),d.append("</a>")):a.post.publishTime&&("SCHEDULED"==a.post.status?(d.append('Scheduled:<br /><a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append('</a><span class="icon inline notranslate">f</span>')):"DRAFT"==a.post.status?(d.append('Draft<span class="icon inline notranslate">e</span><a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>")):(d.append('<a class="hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self" ',a.post.isPromoted?'rel="nofollow"':"",">"),tiger.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>"))),d.append("</span>"),b?"":d.toString()},tiger.components.post.meta.avatarContainer=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder("avt-large");if(e=e.toString(),a.post.showByline&&""==a.post.byline)if(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id){tiger.components.post.meta.avatarPopover({author:a.post.author,canonicalHost:a.canonicalHost,idName:soy.$$escapeHtml(a.post.id)+"-hovercard"},d,c);var f="gif"==(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.format)?"jpg":null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.format;tiger.components.post.meta.avatarDisplay({url:"http://"+soy.$$escapeHtml(a.canonicalHost),avatar:window.kinja.imageUrl(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id,e,f),nofollow:a.post.isPromoted,dropdownName:soy.$$escapeHtml(a.post.id)+"-hovercard"},d,c)}else tiger.components.post.meta.avatarDisplay(null,d,c);else(null==a.post.salesAvatarMap?null:a.post.salesAvatarMap.id)?tiger.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(window.kinja.imageUrl(a.post.salesAvatarMap.id,e))},d,c):tiger.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(c.meta.assets.images)},d,c);return b?"":d.toString()},tiger.components.post.meta.avatarPopover=function(a,b){var c=b||new soy.StringBuilder;if(c.append('<div id="',soy.$$escapeHtml(a.idName),'" class="f-dropdown content small whitelisted-links" data-dropdownhover-content>'),null==a.author.avatar?null:a.author.avatar.id){c.append('<span class="floated-container img-60 avatar-container js_avatar-container">');var d=new soy.StringBuilder("avt-large");d=d.toString(),c.append('<span class="avatar"><span class="icon icon-followed notranslate">O</span><img data-src="',soy.$$escapeHtml(window.kinja.imageUrl(a.author.avatar.id,d,a.author.avatar.format)),'" alt="',soy.$$escapeHtml(a.author.screenName),'" /></span>')}return c.append("<div><h4>",soy.$$escapeHtml(a.author.displayName),'</h4><a href="http://',soy.$$escapeHtml(a.canonicalHost),'" class="button tiny secondary mrs" target="_blank">Profile</a><a href="#" class="button tiny secondary js_followforuser mrs" data-targetblogid="',soy.$$escapeHtml(a.author.defaultBlogId),'">Follow</a><a href="#" class="button tiny secondary js_unfollowforuser mrs hide" data-targetblogid="',soy.$$escapeHtml(a.author.defaultBlogId),'">Unfollow</a></div></div>'),b?"":c.toString()},tiger.components.post.meta.postInfo=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="meta-tools">',a.post.isBlip&&!a.post.isBillboardPost||a.forSharedPost?"":a.post.viewstats&&a.post.viewstats.nonUniqueFormatted&&"0"!=a.post.viewstats.nonUniqueFormatted&&("permalink"==c.meta.pageType||"private"==c.meta.pageType)?'<span class="view-count" '+(a.post.viewstats.uniqueFormatted?' title="'+soy.$$escapeHtml(a.post.viewstats.uniqueFormatted)+' New Visitors"':"")+">"+soy.$$escapeHtml(a.post.viewstats.nonUniqueFormatted)+'<span class="icon notranslate icon-append">g</span></span>':"","<a href=\"#\" class=\"js_like button-recommend-post hover-icon\" title=\"Recommend\" onclick=\"window._gaq.push(['_trackEvent', 'Recommendation', 'Post Recommended', '",soy.$$escapeHtml(a.post.permalink),"']);\">",a.post.likes&&a.post.likes>0?soy.$$escapeHtml(a.post.likes):"",'<span class="icon notranslate icon-append js_like_icon">1</span></a></span>'),b?"":d.toString()},define("templates/tiger/components/post/meta/meta-components",function(){}),define("view/items/NotificationButton",["lib/jquery","view/BaseView","singleton/CurrentUser","collection/Notifications","singleton/EventDispatcher","singleton/ModalManager","singleton/Feature","templates/tiger/components/spinner","templates/tiger/components/user/notifications","templates/tiger/components/header/notifications","templates/tiger/components/post/meta/avatar-display","templates/tiger/components/post/meta/meta-components"],function(a,b,c,d,e,f,g){var h=b.extend({notifications:new d,deferred:a.Deferred(),activeClass:"active",$notificationsPlaceholder:a(".js_notifications-menu"),$notificationBadge:a(".js_notification-count"),initialize:function(){c.on("authenticated",function(){return this.resetState(),c.isLoggedIn()?(this.kickOffWithUser(),void 0):(this.kickOffWithoutUser(),!1)},this),c.on("change:notificationCount",this.updateNotificationCount,this),e.on("notifications:toggle",this.toggleNotifications,this)},resetState:function(){this.$el.off(".notifications"),this.$dropdown&&this.$dropdown.off(".notifications").remove(),"pending"!==this.deferred.state()&&(this.deferred=a.Deferred())},kickOffWithoutUser:function(){this.$el.removeClass("has-notification"),this.$notificationBadge.addClass("hide"),this.$el.on("click.notifications",a.proxy(this.requireLogin,this)),this.deferred.reject()},kickOffWithUser:function(){this.$dropdown=this.createDropdown(),this.$notificationList=this.$dropdown.find(".js_notification-list"),this.$dropdown.on("opened.notifications",a.proxy(this.onDropdownOpen,this)),this.$dropdown.on("closed.notifications",a.proxy(this.onDropdownClose,this)),this.deferred.resolve()},toggleNotifications:function(){this.$el.click()},onDropdownOpen:function(){switch(this.$el.addClass(this.activeClass),this.deferred.state()){case"resolved":this.insertNotifications();break;case"pending":this.deferred.done(a.proxy(this.insertNotifications,this))}e.trigger("notifications:toggled","opened")},onDropdownClose:function(){this.$el.removeClass(this.activeClass),e.trigger("notifications:toggled","closed"),this.notifications.reset()},updateNotificationCount:function(){var a=c.get("notificationCount");a>0?(this.$el.addClass("has-notification"),1===a&&this.$notificationBadge.addClass("only-one"),this.$notificationBadge.text(a).removeClass("hide")):(this.$notificationBadge.text("").addClass("hide").removeClass("only-one"),this.$el.addClass("is-loaded"))},insertNotifications:function(){this.notifications.isEmpty()?(this.createSpinner(),this.loadNotifications()):this.injectNotifications()},loadNotifications:function(){var b=this;this.notifications.fetch({reset:!0,success:function(){b.$dropdown.find(".js_resend-invite").on("click",a.proxy(b.resendInvite,b)),b.$dropdown.find(".js_remove-notification").on("click",a.proxy(b.removeNotification,b))}}),this.notifications.on("reset",this.injectNotifications,this),this.notifications.on("remove",this.removeNotificationFromDOM,this)},injectNotifications:function(){var a,b={notifications:this.getNotificationItems(),defaultBlog:c.get("defaultBlog")};a=g.isOn("notif")?tiger.components.notificationprototype.dropdown:tiger.components.header.notifications.dropdown,this.destroySpinner(),this.$notificationList.find(".js_notification-item").remove(),this.$notificationList.append(this.soyToHtml(a,b)),this.$el.removeClass("has-notification"),this.$notificationBadge.addClass("hide").removeClass("only-one")},getNotificationItems:function(){var a=function(a){return a.set({relativeTime:this.getRelativeTime(a.get("createTimeMillis"))}),a.toJSON()};return this.notifications.map(a,this)},createDropdown:function(){var a={defaultBlog:c.get("defaultBlog")};return this.$notificationsPlaceholder.html(this.soyToHtml(tiger.components.user.notifications,a)).find("[data-dropdown-content]")},createSpinner:function(){if(this.$dropdown.find(".spinner").length)return!1;var b=a(document.createElement("li")).addClass("js_spinner notifications-spinner").append(this.soyToHtml(tiger.components.spinner.bounce,{}));
this.$dropdown.find(".title").after(b)},destroySpinner:function(){this.$dropdown.find(".js_spinner").remove()},requireLogin:function(){e.trigger("loginRequired",{})},resendInvite:function(b){b.preventDefault();var d=a(b.target).data(),g=this;switch(d.source="resendInvite",d.code){case 429:case 502:case 503:case 504:a.ajax("api/invite",{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({blogId:d.blogid,postId:d.postid,inviteText:d.invitetext,authType:2,accountToken:c.get("token")}),success:function(){g.removeNotificationAction(d.eventid)}});break;case 89:case 401:case 403:require(["view/forms/invite/ResendInviteModalView"],function(a){g.resendInviteModalView=new a,g.resendInviteModalView.setTemplateVars(d),f.create(g.resendInviteModalView.render().$el).on("afterinsert",function(){g.resendInviteModalView.initForms("#twitter-connector-form")},g).on("close",g.removeResendInviteModal,g).open()});break;default:e.trigger("loginRequired")}return!1},removeNotificationAction:function(b){a.ajax("/apiproxy/account/notifications/"+b+"/inviteerror",{type:"POST",data:JSON.stringify({status:"DISMISSED"}),contentType:"application/json; charset=utf-8",context:this,complete:function(){this.notifications.remove(this.notifications.get(b))}})},removeNotification:function(b){var c=a(b.target).data("eventid");return this.removeNotificationAction(c),b.preventDefault(),!1},removeNotificationFromDOM:function(a){this.$dropdown.find('[data-eventid="'+a.id+'"]').closest(".js_notification-item").remove()},removeResendInviteModal:function(){null!==this.resendInviteModalView&&(this.resendInviteModalView.off("remove",null,this),this.resendInviteModalView=null)}});return h}),define("view/items/NotificationButtonPrototype",["view/BaseView","singleton/CurrentUser"],function(a,b){var c=a.extend({initialize:function(){b.on("authenticated",function(){b.isLoggedIn()}),b.on("change:notificationCount",this.updateNotificationCount,this)},updateNotificationCount:function(){console.log(b.get("notificationCount"))}});return c}),define("model/Action",["model/Model"],function(a){var b=a.extend({parse:function(a){if(void 0===a)throw new Error("ActionModel.parse(): no attributes to parse");return a}});return b}),define("model/post/Post",["config","lib/jquery","lib/backbone","lib/underscore","model/Model","model/Action","singleton/CurrentUser","singleton/Utils"],function(a,b,c,d,e,f,g,h){var i=b("<div />"),j=function(a){var b,c=a.getHours(),d=a.getMinutes(),e=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear();return 10>c&&(c="0"+c),10>d&&(d="0"+d),b=c+":"+d,{MdyHm:[e,b].join(" ")}},k={dateTimeFormat:/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}$/,chompImgType:/img\.gawkerassets\.com\/img\/(\w+)\/[\w\-]+\./g},l=f.extend({constructor:function(a){window.__postModelStorage=window.__postModelStorage||{};var b,c=window.__postModelStorage,d=void 0!==a&&void 0!==a.id&&void 0!==c;return d&&void 0!==c[a.id]?(b=c[a.id],b.set(a),b):(e.prototype.constructor.apply(this,arguments),d&&(c[a.id]=this),void 0)},initialize:function(){k=b.extend(k,{mediaInPost:new RegExp("<("+this.mediaTags.join("|")+")","gim")})},storeInMemory:function(){var a=window.__postModelStorage||{},b=void 0!==this.id&&void 0!==a;return b&&void 0!==a[this.id]?a[this.id].set(this.attributes):a[this.id]=this,this},mediaTags:["img","embed","object","iframe","video","audio","canvas"],defaults:{promoteState:{},publishTime:j(new Date),blogs:new c.Collection,liked:!1},validationRules:{PUBLISHTIME_IS_REQUIRED:function(a){var b=!0;return"SCHEDULED"!==a.status||a.publishTimeString||a.publishTimeMillis||(b=!1),b},POST_CONTENT_IS_REQUIRED:function(a){var c=!0,d=a.headline&&b.trim(i.html(a.headline)),e=a.entry&&b.trim(i.html(a.entry).text()),f=a.entry&&(k.mediaInPost.test(a.entry)||i.html(a.entry).find("img").length),g=a.hasFile||a.files&&a.files.length;return d||e||f||g||(c=!1),c},POST_CONTENT_CANNOT_CONTAIN_BAD_CONTENT:function(a){var b=!0,c=["form"].join("");return i.html(a.entry).find(c).length&&(b=!1),b}},savePipeline:b.Deferred().resolve(),publishTime:function(a){return j(a)},set:function(){return f.prototype.set.apply(this,arguments),""===this.get("id")&&this.unset("id"),this},sync:function(a,c,e){var f,h,i,j,k;if("create"!==a&&(void 0===c.id||null===c.id))throw new Error("Post.sync(): Model undefined");switch(a){case"create":f="POST",h=c.has("parentId")&&""!==c.get("parentId")?"/api/post/"+c.get("parentId")+"/reply":"/api/post/add",i=c.toFormData();break;case"read":f="GET",h=void 0!==e.preview&&e.preview===!0?"/api/post/preview/"+c.id:void 0!==e.showcase&&e.showcase===!0?"/api/post/showcase/"+c.id:"/api/post/"+c.id;break;case"update":f="POST",h="/api/post/"+c.id+"/update",i=c.toFormData();break;case"delete":f="POST",h="/api/post/"+c.id+"/delete"}return j={type:f,dataType:"json",url:h,data:i||null},k=g.has("token")&&""!==g.get("token")?g.token(function(){return j.url=j.url+"?token="+g.get("token"),b.ajax(d.extend(j,e))}):b.ajax(d.extend(j,e))},parse:function(a){if(void 0===a)throw new Error("Post.parse(): no response to parse");var b={};return void 0!==a.data?void 0!==a.data.id&&a.meta.success===!0&&(b=a.data):b=a,void 0!==b.id&&null!==b.id&&(b.id=parseInt(b.id,10)),b},toFormData:function(){var a=["id","headline","entry","tags","publishTimeMillis","publishTimeString","publishTimeZone","status","blogId","defaultBlogId","annotation.annotationType","annotation.imageUrl","annotation.imageChompId","annotation.imageWidth","annotation.imageHeight","annotation.x","annotation.y","annotation.annotationText","annotation.annotationTextHash","allowReplies","sponsored","source","showByline","byline","salesAvatar","salesAvatarMap","share","properties","shareBlogId","sharedPostId","images","parentId","adZone","inviteText"],b=["status","allowReplies","showByline","byline","properties"],c=function(a){var c=a[0],e=a[1];return-1!==d.indexOf(b,c)&&(c="meta."+c),[c,e]},e=d.pick(this.toJSON(),d.union(a,d.map(b,function(a){return"meta."+a}))),f=d.object(d.pairs(e).map(c));return f},getUrl:function(){return void 0!==this.get("permalink")?this.get("permalink"):"/"+this.id},getActionState:function(){var a=b.Deferred();return this.has("actionState")?a.resolve():this.getPostInfo().done(function(){a.resolve()}),a.promise()},getPostInfo:function(c){var d,e=this,f=parseInt(this.id,10);if(!g.isLoggedIn())throw new Error("Post.getPostInfo(): user not logged in");return c=c||{},c.success=c.success||function(){},d=[a.api.url,"/post/",f,"/actionstatus?token=",g.get("token")].join(""),b.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:d,success:function(a){200===a.meta.status&&(e.setActionState(a.data),c.success.call(e))}})},setAction:function(a,b,c){if(!a||"repost"!==a&&"dismiss"!==a&&"actionreset"!==a)throw new Error("Post:setAction(): Invalid post action: "+a);if(!b)throw new Error("Post:setAction(): Invalid blogId: "+b);var d="/api/post/"+this.id+"/"+a+"/"+b;return this.setLikeOrAction(c,a,d)},setLikeOrAction:function(a,c,d){a=a||{},a.success=a.success||function(){},a.error=a.error||function(){},g.isLoggedIn()||a.error.call(this,{reason:"user"});var e=this;return b.ajax({url:d+"?token="+g.get("token"),type:"POST",success:function(b){void 0!==b.meta&&b.meta.success===!0?"repost"===c||"dismiss"===c||"actionreset"===c?(e.setActionState(b.data.items),a.success.call(e,{response:b.data.items})):(e.setLikeState(b.data),a.success.call(e,{response:b.data})):a.error.call(e,{reason:"action error"})},error:function(){a.error.call(this,{reason:"ajax error"})}})},setActionState:function(a){var b={};d.each(a,function(a){b[a.blogId]=a.relation.toLowerCase()},this),this.set({actionState:b})},setLike:function(a,b){if(!a||"like"!==a&&"unlike"!==a)throw new Error("Post:setLike(): Invalid post action: "+a);var c="/api/post/"+this.id+"/"+a;return this.setLikeOrAction(b,a,c)},getLikeState:function(c){var e=this;c=c||{},c.success=c.success||function(){},g.onAuth.done(b.proxy(function(){g.isLoggedIn()?b.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:a.api.url+"/like/status",data:{id:this.id,token:g.get("token")},traditional:!0,success:function(a){200===a.meta.status&&(a.data&&d.isArray(a.data)&&d.each(a.data,function(a){this.setLikeState(a)}),c.success.call(e))}}):c.success.call(e)},this))},setLikeState:function(a){void 0!==a.objectId&&a.objectId===this.get("id")?this.set({liked:!0}):this.set({liked:!1})},prepareAnnotations:function(){if(this.has("annotation")){var a=this.get("annotation"),c=b().text(a.annotationText),d=170;void 0===a.annotationShortText&&c.length>d&&(a.annotationShortText=h.cut(c,d))}return this},parseFromDom:function(a){var b=JSON.parse(decodeURIComponent(a.data("model")));return new l(b)},replaceImagesWithOriginal:function(){var a=this.get("display");return this.set("display",a.replace(k.chompImgType,"img.gawkerassets.com/img/$1/original.")),this},validate:function(){var a=[],b=this.toJSON();return b.mode&&d.each(this.validationRules,function(c,d){c(b)||a.push({error:"CLIENT_VALIDATION_ERROR",reason:d})},this),a.length?a:!1},getShareOptionsForUser:function(a){var c=b.Deferred(),e=[],f=[],g=[],h=a.get("defaultBlogId"),i=!1;return this.getActionState().done(b.proxy(function(){d.each(this.get("actionState"),function(a,b){"repost"===a&&e.push(parseInt(b,10))}),i=-1!==d.indexOf(e,h)?!0:!1,a.get("membership").each(function(a){a.get("blogId")===h||"ENABLED"!==a.get("blog").status&&"SPAM"!==a.get("blog").status||(-1!==d.indexOf(e,a.get("blog").id)?g.push({name:a.get("blog").displayName,id:a.get("blog").id}):f.push({name:a.get("blog").displayName,id:a.get("blog").id}))},this),c.resolve({repostedTo:e,repostedToPersonal:i,personalBlogId:h,blogsUndo:g,blogsRepost:f})},this)),c.promise()}});return l}),mantle.components.post.meta.avatarDisplay=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;return d.append('	<div class="avatar-container js_avatar-container"><span class="icon icon-followed notranslate">O</span>',a.url&&"http://"!=a.url?'<a href="'+soy.$$escapeHtml(a.url)+'"'+(a.nofollow?' rel="nofollow"':"")+">":"",a.stacked&&"true"==a.stacked?'<div class="avatar-stack"><span class="img-border"><img src="'+(a.avatar?soy.$$escapeHtml(a.avatar):soy.$$escapeHtml(c.meta.assets.images)+"icons/avatar-big.png")+'" class="avatar-mini" /></span><span></span><span></span></div>':'<span class="img-border"><img src="'+(a.avatar?soy.$$escapeHtml(a.avatar):soy.$$escapeHtml(c.meta.assets.images)+"icons/avatar-big.png")+'" class="avatar" /></span>',a.url&&"http://"!=a.url?"</a>":"","</div>"),b?"":d.toString()},mantle.components.post.meta.avatarContainer=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder("avt-large");return e=e.toString(),a.post.showByline&&""==a.post.byline?(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id)?mantle.components.post.meta.avatarDisplay({url:"http://"+soy.$$escapeHtml(a.canonicalHost),avatar:window.kinja.imageUrl(null==a.post.author?null:null==a.post.author.avatar?null:a.post.author.avatar.id,e),nofollow:a.post.isPromoted,stacked:a.stacked},d,c):mantle.components.post.meta.avatarDisplay(null,d,c):(null==a.post.salesAvatarMap?null:a.post.salesAvatarMap.id)?mantle.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(window.kinja.imageUrl(a.post.salesAvatarMap.id,e)),stacked:a.stacked},d,c):mantle.components.post.meta.avatarDisplay({avatar:soy.$$escapeHtml(c.meta.assets.images),stacked:a.stacked},d,c),b?"":d.toString()},mantle.components.post.meta.byline=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),!a.post.showByline||a.post.postAction&&a.post.postAction.author||(""==a.post.byline?(d.append('<span class="meta-info display-name strong">',a.canonicalHost?'<a class="text-upper name" href="http://'+soy.$$escapeHtml(a.canonicalHost)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(a.post.author.displayName)+"</a>":'<span class="text-upper maincolor name">'+soy.$$escapeHtml(a.post.author.displayName)+"</span>","</span>"),(!a.post.postAction||a.post.postAction&&"REPOST"!=a.post.postAction.relation)&&""==a.post.byline&&"permalink"!=c.meta.pageType&&(d.append('<span class="follow-links">'),mantle.components.post.button.follow({pageType:c.meta.pageType},d,c),d.append("</span>"))):d.append('<span class="meta-info display-name text-upper strong">',soy.$$filterNoAutoescape(a.post.byline),"</span>")),d.append(a.post.postAction&&a.post.postAction.author?'<span class="meta-info reposted-by pln"><span class="text-upper">'+soy.$$escapeHtml(a.post.postAction.author.displayName)+'</span><span class="trigger-italic phs">Shared a Post by</span><span class="meta-info display-name strong">'+(""==a.post.byline?'<a class="text-upper" href="http://'+soy.$$escapeHtml(a.canonicalHost)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(a.post.author.displayName)+"</a>":soy.$$escapeHtml(a.post.byline))+"</span></span>":""),b?"":d.toString()},mantle.components.post.meta.topByline=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<span class="meta-bg">'),a.post.showByline)if(""==a.post.byline){if(d.append('<span class="meta-info display-name strong"><a class="text-upper" href="http://',soy.$$escapeHtml(a.canonicalHost),'"',a.post.isPromoted?' rel="nofollow"':"",">",soy.$$escapeHtml(a.post.author.displayName),"</a>","reply"==a.mode&&a.post.starterId!=a.post.parentId?'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+soy.$$escapeHtml(a.post.replyMeta.parentAuthor.displayName)+"</span>":"","</span>"),(!a.post.postAction||a.post.postAction&&"REPOST"!=a.post.postAction.relation)&&""==a.post.byline&&"permalink"!=c.meta.pageType&&(d.append('<span class="follow-links">'),mantle.components.post.button.follow({pageType:c.meta.pageType},d,c),d.append("</span>")),c.meta.blog&&a.post.isStarter&&a.post.defaultBlogId!=a.post.author.defaultBlogId&&a.post.defaultBlogId!=c.meta.blog.id||a.forSharedPost){d.append('<span class="meta-info display-name strong published-on">');for(var e=a.post.blogs,f=e.length,g=0;f>g;g++){var h=e[g];d.append(h.id==a.post.defaultBlogId?' <span class="trigger-italic">on</span> <a class="text-upper" href="http://'+soy.$$escapeHtml(h.canonicalHost)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$escapeHtml(h.displayName)+"</a>":"")}d.append("</span>")}}else d.append('<span class="meta-info display-name text-upper strong">',soy.$$filterNoAutoescape(a.post.byline),"</span>");return d.append(a.post.postAction&&a.post.postAction.author&&a.post.postAction.author.displayName?'<span class="meta-info reposted-by"><span class="trigger-italic">shared by</span> <span class="text-upper">'+soy.$$escapeHtml(a.post.postAction.author.displayName)+"</span></span>":"","</span>"),b?"":d.toString()},mantle.components.post.meta.publishTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="publish-time js_publish_time" data-publishtime="',soy.$$escapeHtml(a.post.publishTimeMillis),'">'),a.post.postAction&&a.post.postAction.createTime?(d.append('<a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.postAction.createTime},d,c),d.append("</a>")):a.post.publishTime&&("SCHEDULED"==a.post.status?(d.append('Scheduled:<br /><a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append('</a><span class="icon inline text-light notranslate mls">f</span>')):"DRAFT"==a.post.status?(d.append('Draft<br /><a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>")):(d.append('<a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a>"))),d.append("</span>"),b?"":d.toString()},mantle.components.post.meta.postScore=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<span class="meta-score meta-separator js_meta-score hide"><span title="',a.post.score.explanation?soy.$$escapeHtml(a.post.score.explanation):"",'">Total score: ',soy.$$escapeHtml(a.post.score.total),"</span><br/>",a.post.score.baseScore>0?'<span title="'+(a.post.score.baseScoreExplanation?soy.$$escapeHtml(a.post.score.baseScoreExplanation):"")+'">Base score: '+soy.$$escapeHtml(a.post.score.baseScore)+"</span><br/>":"",a.post.score.likeScore>0?'<span title="'+(a.post.score.likeScoreExplanation?soy.$$escapeHtml(a.post.score.likeScoreExplanation):"")+'">Recommend score: '+soy.$$escapeHtml(a.post.score.likeScore)+"</span><br/>":"",a.post.score.sumScore>0?'<span title="'+(a.post.score.sumScoreExplanation?soy.$$escapeHtml(a.post.score.sumScoreExplanation):"")+'">Sum score: '+soy.$$escapeHtml(a.post.score.sumScore)+"</span><br/>":"","</span>"),b?"":c.toString()},mantle.components.post.meta.formattedTime=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<span class="show-on-hover published updated">',soy.$$escapeHtml(a.time.Mddyyhmma),'</span><span class="hide-on-hover">'),mantle.messages.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma},d,c),d.append("</span>"),b?"":d.toString()},mantle.components.post.meta.stats=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<span class="meta-stats">',a.post.viewstats&&a.post.viewstats.nonUniqueFormatted&&"0"!=a.post.viewstats.nonUniqueFormatted?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'" class="viewstats stat-views text-light" '+(a.post.viewstats.uniqueFormatted?' title="'+soy.$$escapeHtml(a.post.viewstats.uniqueFormatted)+' New Visitors"':"")+(""!=a.post.isPromoted?' rel="nofollow"':"")+'><span class="icon notranslate text-light">g</span>&nbsp;<span class="text">'+soy.$$escapeHtml(a.post.viewstats.nonUniqueFormatted)+"</span></a>":"",(a.post.replyCount||0==a.post.replyCount)&&a.post.isStarter?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'#replies" class="viewstats stat-replies text-light"'+(""!=a.post.isPromoted?' rel="nofollow"':"")+'><span class="icon notranslate text-light">L</span>&nbsp;<span class="text">'+soy.$$escapeHtml(a.post.replyCount)+"</span></a>":"","</span>"),b?"":c.toString()},mantle.components.post.meta.sharedReplyMeta=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div class="top-meta proxima"><div class="meta text-micro"><span class="meta-bg"><span class="meta-info reposted-by pln"><span class="text-upper">',soy.$$escapeHtml(null==a.post?null:null==a.post.postAction?null:null==a.post.postAction.author?null:a.post.postAction.author.displayName),'</span><span class="trigger-italic phs">Shared a Reply by</span><span class="meta-info display-name strong"><a class="text-upper" href="http://',soy.$$escapeHtml(a.canonicalHost),'">',soy.$$escapeHtml(a.post.author.displayName),"</a></span></span></span></div>"),mantle.components.post.postToolsNg(a,d,c),d.append("</div>"),b?"":d.toString()},define("templates/mantle/components/post/meta/meta-components",function(){}),tiger.components.post.meta.metaAvatarUrl=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="meta-container"><div class="meta-avatar"><div class="floated-container img-30"><div class="avatar">'),mantle.components.post.meta.avatarDisplay({avatar:a.avatarUrl},d,c),d.append('</div><div class="txt"><span class="display-name">',a.displayName?soy.$$escapeHtml(a.displayName):"",a.parentAuthorDisplayName?'<span class="replyto-author"><span class="icon text-light notranslate">U</span>'+soy.$$escapeHtml(a.parentAuthorDisplayName)+"</span>":"",'</span></div><div class="second-line">Now</div></div></div></div>'),b?"":d.toString()},define("templates/tiger/components/post/meta/meta-avatar-url",function(){}),tiger.components.forms.replies.replyCallout=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="reply-callout-container collapsed"><span class="js_reply-callout-meta">'),tiger.components.post.meta.metaAvatarUrl(a,d,c),d.append('</span><div class="callout-input js_reply-callout-input" data-replyid="',soy.$$escapeHtml(a.parent.id),'">Reply to ',soy.$$escapeHtml(a.parentAuthorDisplayName),"</div></div>"),b?"":d.toString()},define("templates/tiger/components/forms/replies/reply-callout",function(){}),define("module/groupchats/view/OpenReplyForms",["lib/jquery","lib/underscore","templates/mantle/components/post/meta/meta-components","templates/tiger/components/post/meta/meta-avatar-url","templates/tiger/components/forms/replies/reply-callout"],function(a,b){var c={replyform:null,triggeredReply:!1,initReplyForms:function(){this.events=b.extend({"click .js_reply-to-selected-post":"replyToSelected","click .js_reply-prompt-link":"replyToStarter","click .js_edit-reply":"editReply"},this.events),this.delegateEvents()},handleStarterInsert:function(){var a=this.services.resolve("eventDispatcher");a.on("reply:openstarterform",this.insertNewStarter,this)},unhandleStarterInserts:function(){var a=this.services.resolve("eventDispatcher");a.off("reply:openstarterform",this.insertNewStarter,this)},replyToSelected:function(b){var c=a(b.currentTarget).closest(".js_reply"),d=this.services.resolve("currentUser"),e=parseInt(c.data("id"),10);return b.stopPropagation(),this.closeReplyForm(),this.redirectForTouch(b),d.onAuth.done(a.proxy(function(){var b,f,g=this.services.resolve("PostModel",{args:{id:e}}),h=this.services.resolve("utils");d.get("avatar")&&(b=h.imageUrl(d.get("avatar").id,"avt-small",d.get("avatar").format)),c.next(".reply-callout-container").remove(),this.openReplyForm(g).done(a.proxy(function(b){b.on("success",function(a){this.trigger("reply:insert",{$el:f,model:a.model})},this),c.parents(".js_new-reply-container").length?c.after(b.$el).show():c.next(".js_new-reply-container").append(b.$el).show(),b.render(),f=a("<div />").insertAfter(b.$el)},this))},this)),!1},insertNewStarter:function(){var b=window.event;return this.redirectForTouch(b),this.closeReplyForm(),this.openReplyForm(this.model).done(a.proxy(function(b){this.$elements.replyFormContainer.after(b.$el),b.render(),window.setTimeout(function(){var c=a(window).height()/2-b.$el.height()/2;a.scrollTo(b.$el,200,{offset:-1*c})},100),b.on("success",function(b){this.trigger("reply:insert",{$el:a("<div />").prependTo(this.$elements.branchList),model:b.model})},this)},this)),!1},insertReplyCallout:function(b){var c=a(b.currentTarget).closest(".js_reply"),d=c.data("id"),e=this.$("#js_toggled-replies-"+d),f=this.services.resolve("currentUser"),g=this;return f.onAuth.done(a.proxy(function(){var b,h,i=this.services.resolve("PostModel",{args:{id:d}}),j=this.services.resolve("utils");f.get("avatar")&&(b=j.imageUrl(f.get("avatar").id,"avt-small",f.get("avatar").format)),h=c.after(this.soyToHtml(tiger.components.forms.replies.replyCallout,{parent:i,avatarUrl:b,displayName:f.get("displayName"),parentAuthorDisplayName:i.returnElement().author.displayName})).next(".reply-callout-container").find(".js_reply-callout-input").first(),h.on("click",function(b){g.closeReplyForm(b),g.redirectForTouch(b),a(this).parent().toggleClass("collapsed").toggleClass("expanded"),g.openReplyForm(i).done(a.proxy(function(b){var c;b.on("success",function(a){this.trigger("reply:insert",{$el:c,model:a.model}),e.show()},this),b.on("remove",function(){h.parent().toggleClass("collapsed").toggleClass("expanded")}),h.after(b.$el),b.render({},!1),c=a("<div />").appendTo(e)},g))})},this)),!1},replyToPost:function(a){return this.closeReplyForm(a),this.insertReplyCallout(a),!1},editReply:function(b){this.redirectForTouch(b),this.closeReplyForm();var c=a(b.currentTarget).closest(".js_reply"),d=this.services.resolve("PostModel",{args:{id:c.data("id")}});return a.when(this.openReplyForm(d,!0)).done(a.proxy(function(a){var b=this.getFormAncestor();b.after(a.$el),a.render({},!0),a.on("success",function(a){var b=this.getFormAncestor();b.find("#reply_"+a.model.get("id")+" .reply-content").html(a.model.get("display"))},this)},this)),!1},openReplyForm:function(b,c,d){var e=this,f=a.Deferred(),g=this.services.resolve("utils");return void 0===d&&(d="view/editor/Quickreply"),this.triggeredReply||(this.triggeredReply=!0,g.requireModule("module/NewEditor",function(){require([d],function(a){var d=new a({parent:b,isEditMode:c});d.on("success",function(){e.replyform=void 0,e.triggeredReply=!1,this.remove()}),d.on("remove",function(){e.replyform=void 0,e.triggeredReply=!1}),e.replyform=d,f.resolve(d)})})),f.promise()},closeReplyForm:function(b){var c=this.replyform;if(b&&b.target&&(null===c||void 0===c)&&a(b.target).closest(".js_reply").next(".reply-callout-container").remove(),c&&this.triggeredReply){if(!c.confirmRemove())return!1;a(".js_reply-prompt").remove(),c.remove()}},redirectForTouch:function(b){var c,d,e=this.services.resolve("feature");return e.isOn("redactor")?!1:((e.isOn("touchdebug")||e.device.is("handheld")&&e.device.has("touch"))&&b&&(d=a(b.target).closest("a").attr("href"),a(b.target).hasClass("js_reply-callout-input")&&(c=a(b.target).data("replyid"),d="/posts/"+c+"/reply"),d&&(b.stopPropagation(),window.location.href=d)),void 0)},replyToStarter:function(){return this.insertNewStarter(),this.$elements.replyPromptLink.addClass("hide"),!1},getFormAncestor:function(){return this.$elements.branchList}};return c}),tiger.components.user.profileMenu=function(a,b,c){var d=b||new soy.StringBuilder;d.append('	<div class="sidebar-dropdown proxima mln js_profile-dropdown f-dropdown no-triangle scrollable" id="main-menu" data-dropdown-content><ul class="menu-list"><li class="display-name"><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'/private" class="pbm">');var e=new soy.StringBuilder("avt-small");return e=e.toString(),d.append(a.user.avatar?'<img src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.user.avatar.id,e,a.user.avatar.format))+'" class="avatar-20 icon-prepend" />':'<img src="'+soy.$$escapeHtml(c.meta.assets.images)+'icons/icon-avatar@2x.png" class="avatar-20 icon-prepend" />',soy.$$escapeHtml(a.user.displayName),'</a></li><li><a href="/posts/new" class="js_compose-post-button hover-icon"><span class="icon oversized icon-prepend notranslate">e</span>Compose post</a></li><li class="title"><span class="text-light text-upper">My account</span></li><li class="show-for-medium-down"><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'/private/notifications" class="hover-icon"><span class="icon oversized icon-prepend notranslate">L</span>Notifications<span class="notification-count-badge js_notification-count hide"></span></a></li><li><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'/private" class="hover-icon"><span class="icon oversized icon-prepend notranslate">^</span>Private view</a></li><li><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'" class="js_settings-link hover-icon"><span class="icon oversized icon-prepend notranslate">G</span>Account Settings</a></li>',1==a.isSuperuser&&1==a.hasSuperuserTools?'<li><a href="#" class="js_createblog-link hover-icon"><span class="icon oversized icon-prepend notranslate">F</span>Create blog</a></li>':"",'<li><a href="#" class="js_logout-link hover-icon"><span class="icon oversized icon-prepend notranslate">8</span>Logout</a></li><li class="title js_title-ownblogs"><span class="text-light text-upper">My blogs</span></li></ul></div>'),b?"":d.toString()},define("templates/tiger/components/user/profile-menu",function(){}),tiger.components.user.yourBlogs=function(a,b){var c=b||new soy.StringBuilder;if(c.append('	<li class="js_ownblog"><a href="http://',soy.$$escapeHtml(a.defaultBlog.canonicalHost),'" class="hover-icon"><span class="icon icon-prepend notranslate">C</span>',soy.$$escapeHtml(a.defaultBlog.displayName),"</a></li>"),0!=a.groupBlogs.length)for(var d=a.groupBlogs,e=d.length,f=0;e>f;f++){var g=d[f];c.append('<li class="js_ownblog"><a href="http://',soy.$$escapeHtml(g.canonicalHost),'" class="hover-icon"><span class="icon  icon-prepend notranslate">C</span>',soy.$$escapeHtml(g.displayName),"</a></li>")}return b?"":c.toString()},define("templates/tiger/components/user/your-blogs",function(){}),define("view/items/ProfileButton",["lib/jquery","lib/underscore","lib/needly","view/BaseView","model/post/Post","module/groupchats/view/OpenReplyForms","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/ModalManager","templates/tiger/components/user/profile-menu","templates/tiger/components/user/your-blogs"],function(a,b,c,d,e,f,g,h,i,j,k){var l=d.extend(b.extend({},f,{events:{"click .js_login_link":"toggleLogin","click .js_logout-link":"initLogout","click .js_createblog-link":"toggleCreateBlog","click .js_manageblog-link":"toggleManageBlog","click .js_settings-link":"showSettings","click .js_compose-post-button":"composePost"},loginModalView:null,incompleteRegistrationModalView:null,createBlogModalView:null,manageBlogModalView:null,$mainMenu:a(".js_main-menu"),initialize:function(){g.on("authenticated",this.render,this),g.on("incompleteRegistration",this.createIncompleteRegistrationModal,this),h.on("loginRequired",this.initLogin,this),h.on("twitterConnectRecommended",this.createTwitterConnectPromptModal,this),h.on("blogMerged",this.updateBloglist,this),this.$el.on("opened closed",function(a){h.trigger("profilemenu:toggle",a.type)}),g.on("change:notificationCount",this.updateNotificationCount,this),this.on("dropdownRendered",this.updateNotificationCount,this),-1!==window.location.search.indexOf("openeditor=true")&&this.composePost()},createIncompleteRegistrationModal:function(a){var c=this;j.requireModule("module/Profile",function(){require(["view/forms/auth/IncompleteRegistrationModal"],function(d){if(k._destroy(c.loginModal),c.incompleteRegistrationModalView=new d,k.create(c.incompleteRegistrationModalView.render().$el).bind("close",b.bind(c.removeIncompleteRegistrationModal,c)).open(),void 0!==a.error)switch(a.error.code){case"ILLEGAL_SCREEN_NAME":c.incompleteRegistrationModalView.$el.find("#screenName").val(a.error.proposedScreenName);break;case"INCOMPLETE_REGISTRATION":break;default:throw new Error("Invalid error code: "+a.error.code)}})})},createLoginModal:function(c){var d=this,e=c?c.source:"default",f=["inviteField","resendInvite","inviteLink"];j.requireModule("module/Profile",function(){require(["view/forms/auth/LoginModal"],function(c){d.loginModalView=new c,d.loginModal=k.create(d.loginModalView.render().$el).bind("afterinsert",b.bind(function(){var b=a("#editor-invite-text").val()||a.inArray(e,f)>-1?"#twitter-selector-form":void 0;this.loginModalView.initForms(b)},d)).bind("close",b.bind(d.removeLoginModal,d)).open()})})},createTwitterConnectPromptModal:function(){var c=this,d="#twitter-connect-prompt-form",e=!!a(d).length;j.requireModule("module/Profile",function(){require(["view/forms/auth/LoginModal"],function(a){c.loginModalView=new a,e||(c.loginModal=k.create(c.loginModalView.render().$el).on("afterinsert",b.bind(function(){this.loginModalView.initForms(d)},c)).on("close",b.bind(c.removeLoginModal,c)).open())})})},createCreateBlogModal:function(){var a=this;j.requireModule("module/Profile",function(){require(["view/forms/createblog/CreateBlogModal"],function(c){a.createBlogModalView=new c,k.create(a.createBlogModalView.render().$el).bind("close",b.bind(a.removeCreateBlogModal,a)).open()})})},createManageBlogModal:function(){var a=this;j.requireModule("module/Profile",function(){require(["view/forms/manageblog/ManageBlogModal"],function(c){a.manageBlogModalView=new c,k.create(a.manageBlogModalView.render().$el).bind("close",b.bind(a.removeManageBlogModal,a)).open()})})},toggleCreateBlog:function(){return this.$el.removeClass("open"),null!==this.createBlogModalView?this.createBlogModalView.close():this.initCreateBlog(),!1
},toggleLogin:function(){return null!==this.loginModalView?this.loginModalView.close():this.initLogin(),!1},toggleManageBlog:function(){return this.$el.removeClass("open"),null!==this.manageBlogModalView?this.manageBlogModalView.close():this.initManageBlog(),!1},initCreateBlog:function(){return this.createBlogModalView||this.createCreateBlogModal(),!1},initLogin:function(a){return this.loginModalView||this.createLoginModal(a),!1},initManageBlog:function(){return this.manageBlogModalView||this.createManageBlogModal(),!1},removeIncompleteRegistrationModal:function(){null!==this.incompleteRegistrationModalView&&(this.incompleteRegistrationModalView.off("remove",null,this),this.incompleteRegistrationModalView=null)},removeLoginModal:function(){null!==this.loginModalView&&(this.loginModalView.off("remove",null,this),this.loginModalView=null)},removeCreateBlogModal:function(){null!==this.createBlogModalView&&(this.createBlogModalView.off("remove",null,this),this.createBlogModalView=null)},removeManageBlogModal:function(){null!==this.manageBlogModalView&&(this.manageBlogModalView.off("remove",null,this),this.manageBlogModalView=null)},initLogout:function(){return this.$el.removeClass("open"),g.logout(),!1},showSettings:function(){return this.$el.removeClass("open"),j.requireModule("module/Profile",function(){require(["view/forms/profile/ProfileModal"],function(b){var c=new b,d=c.render();a.when(d).done(function(){k.create(c.$el).open()})})}),!1},render:function(){var b=a(".js_profile-link"),c=a(".js_login_link");return g.isLoggedIn()?(c.addClass("hide"),b.removeClass("hide").attr("href","http://"+g.get("defaultBlog").canonicalHost+"/"),this.renderProfileDropdown()):(b.addClass("hide").attr("href","#"),c.removeClass("hide"),this.removeProfileDropdown()),this.$el.removeClass("disabled"),j.dropdownSentinel(),this},renderProfileDropdown:function(){var a={isSuperuser:g.hasPermission("SUPERUSER"),hasSuperuserTools:g.hasSuperuserTools(),user:g.returnElement()};this.$mainMenu.html(this.soyToHtml(tiger.components.user.profileMenu,a)),this.updateBloglist(this.$mainMenu),this.trigger("dropdownRendered")},updateBloglist:function(c){c=c||this.$mainMenu,g.isLoggedIn()?c.find(".js_title-ownblogs").after(this.soyToHtml(tiger.components.user.yourBlogs,{defaultBlog:g.get("defaultBlog"),groupBlogs:b.sortBy(g.getBlogs({filterForGroupBlogs:!0}),"name")})):a(".js_ownblog").remove()},removeProfileDropdown:function(){this.$(".js_profile-dropdown").remove()},updateNotificationCount:function(){var b=this.$mainMenu.find(a(".js_notification-count"));if(b){var c=g.get("notificationCount");c>0?(1===c&&b.addClass("only-one"),b.text(c).removeClass("hide")):b.text("").addClass("hide").removeClass("only-one")}},composePost:function(a){(i.device.can("EDIT_RICH_TEXT")||i.isOn("redactor"))&&(a&&a.preventDefault&&a.preventDefault(),this.loadEditor())},loadEditor:function(){var d=this,f=a("body").data("post-form");this.$el.find(".js_profilebutton").removeClass("open"),this.$el.find(".js_compose-post-button").addClass("disabled"),this.services=new c.Container,this.services.registerMany({PostModel:{type:"class",dependency:e},eventDispatcher:{type:"singleton",dependency:h},feature:{type:"singleton",dependency:i},utils:{type:"singleton",dependency:j}}),this.closeReplyForm(),void 0!==f&&b.isFunction(f.confirmRemove)&&f.confirmRemove()&&f.remove(!0),j.requireModule("module/NewEditor",function(){require(["model/post/Post"],function(b){var c=new b;a.when(d.openReplyForm(c,!1,"view/editor/Quickpost").done(function(b){var c=b.render();a("#editorplaceholder").append(c.$el.hide()),c.$el.fadeIn(300),a(window).scrollTop(0),b.on("remove",function(){a(".js_compose-post-button").removeClass("disabled")})}))})})}}));return l}),tiger.section.header.blogAdminToolsMenu=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;return d.append(a.isSuperuser?a.hasSuperuserTools?'<li class="js_superuser-tools"><a href="?superuser=off" class="hover-icon"><span class="icon oversized icon-prepend notranslate">1</span>Hide Mom Jeans</a></li>':'<li class="js_superuser-tools"><a href="?superuser" class="hover-icon"><span class="icon oversized icon-prepend notranslate">1</span>Show Mom Jeans</a></li>':"",a.canEdit&&c.meta.blog?'<li class="js_manage-blog"><a href="#" class="js_manageblog-link hover-icon"><span class="icon oversized icon-prepend notranslate">M</span>Manage '+soy.$$escapeJsString(c.meta.blog.displayName?c.meta.blog.displayName:"")+"</a></li>":"","permalink"==c.meta.pageType&&a.hasSalesTools?'<li class="js_salestools"><a href="#" class="js_salestools-link hover-icon"><i class="icon oversized icon-prepend notranslate">A</i>Business</a></li>':""),b?"":d.toString()},define("templates/tiger/section/header/blog-admin-tools-menu",function(){}),define("view/items/BlogAdminTools",["lib/jquery","view/BaseView","singleton/CurrentUser","singleton/CurrentBlog","singleton/Utils","singleton/ModalManager","templates/tiger/section/header/blog-admin-tools-menu"],function(a,b,c,d,e,f){var g=b.extend({_previousAuthState:null,initialize:function(){this.$menu=a("."+this.$el.data("dropdown")),c.on("authenticated",function(){var a=c.isLoggedIn();this._previousAuthState!==a&&(this.cleanup(),this.render()),this._previousAuthState=a},this)},render:function(){var a,b,c;a=this.getTemplateVariables(),b=this.soyToHtml(tiger.section.header.blogAdminToolsMenu,a),c=this.$menu.find(".js_admintools-divider").after(b),c.toggleClass("hide",this.$menu.find(".js_follow_buttons").hasClass("hide")),e.dropdownSentinel(),this.$manageBlogButton=this.$menu.find(".js_manageblog-link"),this.$salesToolsButton=this.$menu.find(".js_salestools-link"),this.initDOMEvents()},initDOMEvents:function(){this.$manageBlogButton.on("click",a.proxy(this.createManageBlogModal,this)),this.$salesToolsButton.on("click",a.proxy(this.createSalesToolsModal,this))},getTemplateVariables:function(){var a=e.getKinjaMeta().blogOwner,b=a&&a.defaultBlogId===d.id,f=c.hasRole("ADMIN",d.id),g=c.hasPermission("SUPERUSER"),h=b&&c.id===a.id;return{isSuperuser:g,hasSuperuserTools:c.hasSuperuserTools(),hasSalesTools:c.hasSalesTools(),canEdit:h||f||g}},createManageBlogModal:function(){return e.requireModule("module/Profile",function(){require(["view/forms/manageblog/ManageBlogModal"],function(a){var b=new a;f.create(b.render().$el).open()})}),!1},createSalesToolsModal:function(){var a=this;e.requireModule("module/Commerce",function(b){var c=b.formView;a.model.fetch({preview:"PUBLISHED"!==a.model.get("status")}).done(function(){var b=new c({model:a.model});f.create(b.render().$el).open()})})},cleanup:function(){this.$menu.find(".js_superuser-tools").remove(),this.$menu.find(".js_manage-blog").remove(),this.$menu.find(".js_salestools").remove()}});return g}),mantle.components.header.user.profileDropdown=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<ul class="dropdown down profile-dropdown js_profile-dropdown"><li class="display-name"><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'/private" class="pvs">'),a.user.avatar){var e=new soy.StringBuilder("avt-small");e=e.toString(),d.append('<img src="',soy.$$escapeHtml(window.kinja.imageUrl(a.user.avatar.id,e,a.user.avatar.format)),'" class="icon icon-img mrm" />')}else d.append('<img src="',soy.$$escapeHtml(c.meta.assets.images),'icons/icon-avatar@2x.png" class="icon icon-img mrm" />');return d.append(soy.$$escapeHtml(a.user.displayName),'</a></li><li class="divider"></li><li><a href="/posts/new" class="js_compose-post-button pvs"><span class="icon oversized notranslate mrm">e</span>Compose post</a></li><li class="divider"></li>',1==a.isSuperuser?1==a.hasSuperuserTools?'<li><a href="?superuser=off" class="pvs"><span class="icon notranslate mrm">1</span>Hide Mom Jeans</a></li>':'<li><a href="?superuser" class="pvs"><span class="icon notranslate mrm">1</span>Show Mom Jeans</a></li>':"",'<li><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'/private" class="pvs"><span class="icon icon-img icon-kinja mrm"></span>Private view</a></li><li><a href="http://',soy.$$escapeHtml(a.user.defaultBlog.canonicalHost),'" class="pvs js_settings-link"><span class="icon notranslate mrm">G</span>Account Settings</a></li>',1==a.isAdmin||1==a.isSuperuser&&1==a.hasSuperuserTools?'<li><a href="#" class="js_manageblog-link pvs"><span class="icon notranslate mrm">M</span>Manage '+soy.$$escapeHtml(a.currentBlog.displayName?a.currentBlog.displayName:"")+"</a></li>":"",1==a.isSuperuser&&1==a.hasSuperuserTools?'<li><a href="#" class="js_createblog-link pvs"><span class="icon notranslate mrm">F</span>Create blog</a></li>':"",'<li class="mbm"><a href="#" class="js_logout-link pvs"><span class="icon icon-img mrm"></span>Logout</a></li>'),mantle.components.header.notifications.placeholderContent({defaultBlog:a.user.defaultBlog},d,c),d.append("</ul>"),b?"":d.toString()},mantle.components.header.user.yourBlogs=function(a,b){var c=b||new soy.StringBuilder;if(c.append('	<li class="pvs js_ownblog"><span class="text text-upper dropdown-label">Your blogs</span></li><li class="js_ownblog"><a href="http://',soy.$$escapeHtml(a.defaultBlog.canonicalHost),'" class="pvs"><span class="icon transparent notranslate mrm">C</span>',soy.$$escapeHtml(a.defaultBlog.displayName),"</a></li>"),0!=a.groupBlogs.length)for(var d=a.groupBlogs,e=d.length,f=0;e>f;f++){var g=d[f];c.append('<li class="js_ownblog"><a href="http://',soy.$$escapeHtml(g.canonicalHost),'" class="pvs"><span class="icon transparent notranslate mrm">C</span>',soy.$$escapeHtml(g.displayName),"</a></li>")}return c.append('<li class="divider mtn js_ownblog"></li>'),b?"":c.toString()},define("templates/mantle/components/header/user",function(){}),mantle.components.userbar.button.followError=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<span class="icon notranslate">X</span>'),b?"":c.toString()},define("templates/mantle/components/userbar/button/follow-error",function(){}),define("view/items/UserBar",["lib/jquery","lib/underscore","view/BaseView","view/items/NotificationButton","view/items/NotificationButtonPrototype","view/items/ProfileButton","view/items/BlogAdminTools","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Feature","gawkerlib/jquery.foundation.dropdownhover","templates/mantle/components/header/user","templates/mantle/components/userbar/button/follow-error","templates/mantle/messages"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a("body"),n=c.extend({notificationButton:null,profileButton:null,followButton:null,unfollowButton:null,followButtonGroup:null,scrollPosition:0,scrollTreshold:10,scrollDirection:!1,$profileButton:null,blogIsFollowed:!1,events:{"click .js_follow, .js_unfollow":"followBlog"},initialize:function(){var c;c=a(".js_main-menu, .js_profilebutton"),this.followButton=a(".js_follow"),this.unfollowButton=a(".js_unfollow"),this.followButtonGroup=a(".js_follow_buttons"),this.$profileButton=c,h.on("authenticated",function(){var a=h.get("defaultBlog")&&h.get("defaultBlog").followedBlogIds;this.blogIsFollowed=!(!a||-1===b.indexOf(a,i.id)),this.updateFollowButtonState(),this.updateBloglist()},this),this.notificationButton=new d({el:a(".js_notification-trigger")}),this.profileButton=new f({el:c}),this.initTigerBlogDropdown()},initUserMenu:function(){this.$profileButton=m.find(".js_profilebutton");var a=this;m.on("touchstart",function(){a.handleUserMenu()}),m.on("touchend",function(){a.handleUserMenu()})},handleUserMenu:function(){if(this.$profileButton){var a=window.document.body.scrollTop,b=this.scrollPosition;a>b+this.scrollTreshold?this.$profileButton.addClass("suppress"):a<b+this.scrollTreshold&&this.$profileButton.removeClass("suppress"),this.scrollPosition=a}},initTigerBlogDropdown:function(){this.blogToolsMenu=new g({el:a(".js_dropdown-blog-trigger"),model:this.model}),j.on("orientation:toPortrait",function(){l.close(a(".dropdown-blog"))}),j.on("orientation:toLandscape",function(){l.close(a(".dropdown-blog"))})},updateFollowButtonState:function(){var a="P",b="O",c=this.$(".js_followstate:visible").text(),d=h.get("defaultBlogId")===i.id,e=i.id&&!d,f=this.blogIsFollowed&&c!==b||!this.blogIsFollowed&&c!==a;e?(f&&(this.blogIsFollowed?(this.followButton.addClass("hide"),this.unfollowButton.removeClass("hide")):(this.followButton.removeClass("hide"),this.unfollowButton.addClass("hide"))),this.followButtonGroup.removeClass("hide")):this.followButtonGroup.addClass("hide")},followBlog:function(c){if(c&&"function"==typeof c.preventDefault&&c.preventDefault(),h.isLoggedIn()){var d=this,e=h.get("defaultBlogId"),f=i.id,g=this.blogIsFollowed,k=this.blogIsFollowed?"unfollow":"follow";this.blogIsFollowed=!this.blogIsFollowed,this.updateFollowButtonState(),a(".tooltip.tip-bottom").hide(),h.setBlogAction(k,e,f,{success:function(){var a=g?mantle.messages.blogUnfollowed:mantle.messages.blogFollowed;j.trigger("successbox:display",{message:d.soyToHtml(a,{blogName:i.displayName})})},error:function(){var a=mantle.components.userbar.button.followError,c=h.get("defaultBlog").followedBlogIds;d.blogIsFollowed=-1!==b.indexOf(c,i.id),d.followButton.html(d.soyToHtml(a)),window.setTimeout(function(){d.updateFollowButtonState()},3e3)}})}else j.trigger("loginRequired",{}),h.once("authenticated",this.followBlog,this)},updateBloglist:function(){h.isLoggedIn()?this.$el.find(".js_bloglist").prepend(this.soyToHtml(mantle.components.header.user.yourBlogs,{defaultBlog:h.get("defaultBlog"),groupBlogs:b.sortBy(h.getBlogs({filterForGroupBlogs:!0}),"name")})):this.$el.find(".js_bloglist .js_ownblog").remove()}});return n});var JSON;JSON||(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("lib/json2",function(){}),define("singleton/PostHelper",["config","lib/jquery","lib/underscore","singleton/CurrentUser","singleton/Utils","model/post/Post","lib/json2"],function(a,b,c,d,e,f){var g={parsePostModelDataFromDom:function(a){return JSON.parse(decodeURIComponent(a.data("model")))},parseFromDom:function(a){var d=[],e=void 0===a?b("body"):a;return c.each(e.find(".js_post_item, .js_reply, .js_event_item"),function(a){var c=b(a),e={};void 0!==c.data("model")?(e=this.parsePostModelDataFromDom(c),d.push({model:new f(e),node:c})):void 0!==c.data("id")&&d.push({model:new f({id:c.data("id")}),node:c})},this),d},likeStatusFor:function(e,f){var g=c.map(e,function(a){return a.model.get("id")}),h=this;f=f||{},f.success=f.success||function(){},d.onAuth.done(b.proxy(function(){d.isLoggedIn()?b.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:a.api.url+"/like/status",data:{id:g,token:d.get("token")},traditional:!0,success:function(a){200===a.meta.status&&(a.data&&c.isArray(a.data)&&c.each(a.data,function(a){var b=a.objectId,d=c.find(e,function(a){return a.model.get("id")===b});d&&d.model.setLikeState(a)}),f.success.call(h,e))}}):f.success.call(h,e)},this))},createLiveblogPost:function(a){a!==!0&&(a=!1);var c=e.getKinjaMeta().postId;if(void 0===c||null===c)throw new Error("No post id found, can't set liveblog property");b.ajax({url:"/api/post/"+c+"/setliveblog?token="+d.get("token"),dataType:"json",type:"POST",data:JSON.stringify({enabled:a}),success:function(){a?window.console.log("Enabled liveblog feature"):window.console.log("Disabled liveblog feature")}})}};return g}),tiger.components.post.type.sidebarPromoted=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	"),tiger.components.post.meta.sidebarPostMetaContainer(a,d,c),d.append('<div class="row package sidebar-promoted-package post-item-',soy.$$escapeHtml(c.meta.pageType),'"><div class="column"><div class="main-media hide-for-small">');var e=a.post.images[0]?a.post.images[0].id:"",f=a.post.videos[0]&&a.post.videos[0].thumbnails[0]?a.post.videos[0].thumbnails[0].id:"",g=e||f,h=new soy.StringBuilder(g&&""!=g?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'" '+(a.post.isPromoted?'rel="nofollow"':"")+'><span class="img-border mbs"><img src="'+soy.$$escapeHtml(window.kinja.imageUrl(g,"k-medium"))+'" /></span></a><a href="'+soy.$$escapeHtml(a.post.permalink)+'" class="playIcon" '+(a.post.isPromoted?'rel="nofollow"':"")+">":"");return h=h.toString(),d.append(h&&g==f?'<div class="videoThumbPlay">'+soy.$$filterNoAutoescape(h)+'<a href="'+soy.$$escapeHtml(a.post.permalink)+'?autoplay=1" class="playIcon" '+(a.post.isPromoted?'rel="nofollow"':"")+"></div>":h?soy.$$filterNoAutoescape(h):"","</div></div></div>"),tiger.components.post.header.standard({headline:a.post.headline,headlineClasses:"",post:a.post,headerLevel:5},d,c),b?"":d.toString()},define("templates/tiger/components/post/type/sidebar-promoted-package",function(){}),tiger.components.post.meta.sidebarPostMetaContainer=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="meta-container">'),tiger.components.post.meta.metaSidebarPromoted(a,d,c),d.append("</div>"),b?"":d.toString()},define("templates/tiger/components/post/meta/sidebar-postmeta-container",function(){}),tiger.components.post.meta.metaSidebarPromoted=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="strapline proxima text-micro">'),tiger.components.post.meta.sidebarPromotedByline(a,d,c),d.append("</div>"),b?"":d.toString()},define("templates/tiger/components/post/meta/meta-sidebar-promoted",function(){}),tiger.components.post.meta.sidebarPromotedByline=function(a,b){var c=b||new soy.StringBuilder;if(c.append('	<span class="strapline-bg">',a.post.sponsored||a.post.isBillboardPost?'<span class="text-upper">Sponsored</span>':""),a.post.isPromoted){var d=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");d=d.toString(),c.append('<span class="icon notranslate mhs">B</span>Promoted by <span class="js_promoted_displayName text-upper">',soy.$$filterNoAutoescape(d),"</span>")}return c.append("</span>"),b?"":c.toString()},define("templates/tiger/components/post/meta/sidebar-promoted-byline",function(){}),tiger.components.post.header.standard=function(a,b){var c=b||new soy.StringBuilder;return c.append(a.headline?'<header class="'+soy.$$escapeHtml(a.headlineClasses?a.headlineClasses:"")+'"><h1 class="headline'+soy.$$escapeHtml(a.headerLevel&&a.headerLevel>1?" h"+a.headerLevel:"")+' hover-highlight entry-title"><a href="'+soy.$$escapeHtml(a.post.permalink)+'" data-id=""'+(a.post.isPromoted?' rel="nofollow"':"")+">"+soy.$$filterNoAutoescape(a.headline)+"</a></h1></header>":""),b?"":c.toString()},define("templates/tiger/components/post/header",function(){}),define("view/SidebarPromotedPost",["lib/jquery","lib/underscore","view/BaseView","singleton/PostHelper","templates/tiger/components/post/type/sidebar-promoted-package","templates/tiger/components/post/meta/sidebar-postmeta-container","templates/tiger/components/post/meta/meta-sidebar-promoted","templates/tiger/components/post/meta/sidebar-promoted-byline","templates/tiger/components/post/header"],function(a,b,c,d){var e=c.extend({initialize:function(){this.article=this.$el.find("article"),this.postData=d.parsePostModelDataFromDom(this.article),this.promotionData=this.$el.data("promotiondata")},render:function(){var a="Sponsored"===this.$el.find(".meta-container .meta .meta-bg:last-child span:eq(0)").text(),c={post:b.extend(this.postData,{isPromoted:!0,promotion:this.promotionData,sponsored:a})},d=this.soyToHtml(tiger.components.post.type.sidebarPromoted,c);this.article.html(d)},show:function(){this.$el.removeClass("hide")},markSeen:function(){var a;return 0===this.$el.filter(":visible").length?!1:(a=JSON.parse(localStorage.getItem("seenPromotions")||"[]")||[],b.findWhere(a,{promotionId:this.promotionData.id})||(a.push({postId:this.postData.id,promotionId:this.promotionData.id,expires:this.promotionData.endTimeMillis}),localStorage.setItem("seenPromotions",JSON.stringify(a))),void 0)},markUnseen:function(){var a=JSON.parse(localStorage.getItem("seenPromotions")||"[]")||[];a=b.reject(a,function(a){return this.promotionData.id===a.promotionId},this),localStorage.setItem("seenPromotions",JSON.stringify(a))}});return e}),define("view/SidebarPromotedPostList",["lib/jquery","lib/underscore","view/BaseView","view/SidebarPromotedPost"],function(a,b,c,d){var e=c.extend({el:".js_promoted-posts-container",activePostIndex:0,initialize:function(){this.posts=b.map(this.$el.find(".js_post-wrapper"),function(a){return new d({el:a})},this)},render:function(){b.each(this.posts,function(a){a.render()},this),this.posts[0].show(),this.show(),this.posts[0].markSeen(),a(document).foundation("interchange","reflow"),this.hideOverlay()},show:function(){this.$el.removeClass("hide")},hide:function(){this.$el.addClass("hide")},hideOverlay:function(){this.$el.find(".promoted-posts-overlay").addClass("hide")},markAllUnseen:function(){b.each(this.posts,function(a){a.markUnseen()})}});return e}),define("view/items/Sidebar",["lib/jquery","lib/underscore","view/BaseView","view/SidebarPromotedPostList","singleton/CurrentBlog","singleton/Feature","singleton/EventDispatcher","lib/modernizr"],function(a,b,c,d,e,f,g,h){var i=a("body"),j=c.extend({$popularItems:a(".js_popular-box .headline"),activePopular:0,bottomBillBoardVisible:!1,sidebarOpen:!1,ad300Displayed:!1,promotedPostsReady:!1,toggleSidebar:function(a){a.preventDefault(),this.sidebarOpen?this.closeSidebar():this.openSidebar()},openSidebar:function(){i.addClass("sidebar-active"),this.sidebarOpen=!0},closeSidebar:function(){i.removeClass("sidebar-active"),this.sidebarOpen=!1},fixSidebar:function(a){this.$sidebar.toggleClass("menu-active","opened"===a)},initialize:function(){this.$sidebar=this.$el.parents(".sidebar").first(),g.on("hyperion.ad.970x90.ispushdown",this.setupPushdown,this),this.adToggler=this.buildAdToggler(),g.on("hyperion.ad.300x250.displayed",this.setupScroll,this),g.on("hyperion.ad.970x90.displayed",this.setupScroll,this),g.on("update.postlist.post",this.setupScroll,this),g.on("hyperion.disabled",this.hideEmpty300,this),g.on("hyperion.ad.300x250_default.hide",this.hideEmpty300,this),g.on("hyperion.ad.300x600_default.hide",this.hideEmpty300,this),"frontpage"===this.getPageType()&&(g.on("hyperion.ad.970x90.resized",this.handleExpandingAd,this),f.isOn("sidebar_promoted_posts")&&(g.on("hyperion.ad.300x250.displayed",this.ad300Ready,this),g.on("promoted_posts.finished_insert",this.promotedPostsInserted,this))),g.on("hyperion.ad.970x250_default.show",function(){this.bottomBillBoardVisible=!0,"permalink"===this.getPageType()&&this.setupScroll()},this),this.adToggler(),e.adsEnabled===!1&&this.setupScroll(),g.on("notifications:toggle profilemenu:toggle",this.fixSidebar,this),window.setTimeout(a.proxy(this.loopPopular,this),1e4),a("#button-sidebar").on("mouseup touchend",a.proxy(this.toggleSidebar,this))},initHamburgerScroll:function(){var b=a(".mobile-nav-icon"),c=2*b.height(),d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,e=function(){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,e=new window.WebKitCSSMatrix(window.getComputedStyle(b[0])["-webkit-transform"]).f;d>a?b[0].style["-webkit-transform"]="translate3d(0px, "+Math.min(e+(d-a),0)+"px, 0)":a>d&&(b[0].style["-webkit-transform"]="translate3d(0px, "+Math.max(e-(a-d),-c-5)+"px, 0)"),d=a};h.csstransforms3d&&h.mq("only screen and (max-width: 50em)")&&a(window).on("touchmove",e)},hideEmpty300:function(b){var c=a("#ad-300x-container");return b&&b.element&&b.element.closest(".js_replies").length>0?!1:(0!==c.length&&(c.hide(),a(".js_sidebar .block-cover").removeClass("hide"),void 0!==this.sidebarPromotedPostList&&(this.sidebarPromotedPostList.hide(),this.sidebarPromotedPostList.markAllUnseen())),void 0)},ad300Ready:function(){this.ad300Displayed=!0,this.promotedPostsReady&&this.setupPromotedPosts()},promotedPostsInserted:function(){0!==a(".js_promoted-posts-container .js_post-wrapper").length?(this.promotedPostsReady=!0,this.ad300Displayed&&this.setupPromotedPosts()):a(".js_promoted-posts-container").addClass("hide")},setupPromotedPosts:function(){var b;b=a("#ad-300x-container"),b.removeClass("fade-top"),this.sidebarPromotedPostList=new d,this.sidebarPromotedPostList.render()},buildAdToggler:function(){g.off(null,this.setupScroll);var b,c,d,e,f=this,h=a(window),i=a("#ad-300x-container"),j=i.find(".ad-unit"),k=a("#ad-970x250-container"),l=!0,m=function(){b=h.scrollTop(),c=k.length?Math.round(k.last().offset().top):0,e=j.hasClass("ad-300x250")?250:600,d=i.length>0?i.offset().top+e:0,d>c?l||(l=!0,f.bottomBillBoardVisible&&j.css("opacity",0)):l&&(l=!1,j.css("opacity",1))};return m},setupScroll:function(){var c=a(window);c.on("scroll",b.throttle(this.adToggler,80)),c.on("resize",this.adToggler)},setupPushdown:function(){var b=-1*a(".js_post-wrapper").first().offset().top;this.$el.css({position:"relative",top:"0"}),this.$el.parent(".js_sidebar-container").css("top",b)},handleExpandingAd:function(b){var c=a("#ad-300x-container"),d=a(".reveal-modal-bg");b>106?(b>=250?d.show():d.hide(),b+30>c.offset().top&&c.css("opacity",0)):(d.hide(),c.css("opacity",1))},loopPopular:function(){var b=(this.activePopular+1)%this.$popularItems.length,c=this;this.$popularItems.eq(this.activePopular).animate({opacity:0},500,function(){a(this).hide(),c.$popularItems.eq(b).show().animate({opacity:1},500,function(){c.activePopular=b,window.setTimeout(a.proxy(c.loopPopular,c),1e4)})})}});return j}),tiger.section.header.successBox=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="proxima success-box js_success_box" style="display: none;">',a.dismissable?'<a href="#" class="js_close close icon icon-white notranslate">X</a>':"",'<span class="msg">',soy.$$filterNoAutoescape(a.message),"</span></div>"),b?"":c.toString()},define("templates/tiger/section/header/success-box",function(){}),define("view/SuccessBox",["lib/jquery","view/BaseView","templates/tiger/section/header/success-box"],function(a,b){var c=b.extend({events:{"click .js_close":"close"},initialize:function(b){this.options=a.extend({message:"",dismissable:!0,url:null,permanent:!1,timeout:1e4},b)},render:function(){var b=this.options,c=this.soyToHtml(tiger.section.header.successBox,{message:this.getHtml(b.message),dismissable:b.dismissable});a("body").prepend(c),this.setElement(a(".js_success_box")[0]),this.$el.fadeIn(300),window.setTimeout(a.proxy(function(){this.options.permanent||this.close()},this),b.timeout),null!==this.options.url&&this.$el.on("click",a.proxy(function(){return window.location=this.options.url,!1},this)).addClass("linked")},close:function(){return this.$el.fadeOut(1500,a.proxy(this.remove,this)),!1}});return c}),function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};c.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},c.window=function(){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||-1!=a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||"BackCompat"==d.compatMode?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),"max"==d&&(d=9e9),f=a.extend({},c.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=b(f.offset),f.over=b(f.over),this._scrollable().each(function(){function g(a){j.animate(l,e,f.easing,a&&function(){a.call(this,d,f)})}if(null!=d){var h,i=this,j=a(i),k=d,l={},m=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=b(k);break}if(k=a(k,this),!k.length)return;case"object":(k.is||k.style)&&(h=(k=a(k)).offset())}a.each(f.axis.split(""),function(a,b){var d="x"==b?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=i[n],p=c.max(i,b);if(h)l[n]=h[e]+(m?0:o-j.offset()[e]),f.margin&&(l[n]-=parseInt(k.css("margin"+d))||0,l[n]-=parseInt(k.css("border"+d+"Width"))||0),l[n]+=f.offset[e]||0,f.over[e]&&(l[n]+=k["x"==b?"width":"height"]()*f.over[e]);else{var q=k[e];l[n]=q.slice&&"%"==q.slice(-1)?parseFloat(q)/100*p:q}f.limit&&/^\d+$/.test(l[n])&&(l[n]=l[n]<=0?0:Math.min(l[n],p)),!a&&f.queue&&(o!=l[n]&&g(f.onAfterFirst),delete l[n])}),g(f.onAfter)}}).end()},c.max=function(b,c){var d="x"==c?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}(jQuery),define("lib/jquery.scrollTo",["lib/jquery"],function(){}),function(a){a.fn.lightBox=function(b){function c(){return d(this,s),!1}function d(c,d){var g=a(c).siblings("span").find("img");if(a("embed, object, select").css({visibility:"hidden"}),e(),b.imageArray.length=0,b.activeImage=0,1==d.length)b.imageArray.push(new Array(g.attr("data-original-src"),c.getAttribute("title")));else for(var h=0;h<d.length;h++){var i=d.eq(h).siblings("span").find("img");b.imageArray.push(new Array(i.attr("data-original-src"),d[h].getAttribute("title")))
}for(;b.imageArray[b.activeImage][0]!=g.attr("data-original-src");)b.activeImage++;f()}function e(){a("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber" class="proxima"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose"><span class="icon icon-white notranslate">8</span></a></div></div></div><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div>');var c=p();a("#jquery-overlay").css({backgroundColor:b.overlayBgColor,opacity:b.overlayOpacity,width:c[0],height:c[1]}).fadeIn();var d=q();a("#jquery-lightbox").css({top:d[1]+c[3]/10,left:d[0]}).show(),a("#jquery-overlay,#jquery-lightbox").click(function(){o()}),a("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return o(),!1}),a(window).resize(function(){var b=p();a("#jquery-overlay").css({width:b[0],height:b[1]});var c=q();a("#jquery-lightbox").css({top:c[1]+b[3]/10,left:c[0]})})}function f(){b.fixedNavigation?a("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():a("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var c=new Image;c.onload=function(){a("#lightbox-image").attr("src",b.imageArray[b.activeImage][0]),g(c.width,c.height),c.onload=function(){}},c.src=b.imageArray[b.activeImage][0],b.activeImage>-1}function g(c,d){a("#lightbox-container-image-box").hide();var e=a("#lightbox-container-image-box").width(),f=a("#lightbox-container-image-box").height(),g=c+2*b.containerBorderSize,i=d+2*b.containerBorderSize,j=e-g,k=f-i;a("#lightbox-container-image-box").css({width:g,height:i}),h(),0==j&&0==k&&(a.browser.msie?r(250):r(100)),a("#lightbox-container-image-data-box").css({width:c+20})}function h(){a("#lightbox-image").fadeIn(function(){i(),j(),a("#lightbox-container-image-box").show()}),n()}function i(){a("#lightbox-container-image-data-box").slideDown("fast"),a("#lightbox-image-details-caption").hide(),b.imageArray[b.activeImage][1]&&a("#lightbox-image-details-caption").html(b.imageArray[b.activeImage][1]).show(),b.imageArray.length>1}function j(){0!=b.activeImage?b.fixedNavigation?a("#lightbox-nav-btnPrev").unbind().html('<span class="button-box"><span class="icon icon-white notranslate">3</span></span>').bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white notranslate">3</span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").html(""),b.activeImage!=b.imageArray.length-1?b.fixedNavigation?a("#lightbox-nav-btnNext").unbind().html('<span class="button-box"><span class="icon icon-white notranslate">4</span></span>').bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):a("#lightbox-nav-btnNext").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white notranslate">4</span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):(a("#lightbox-nav-btnNext").unbind(),a("#lightbox-nav-btnNext").html("")),k()}function k(){a(document).keydown(function(a){m(a)})}function l(){a(document).unbind()}function m(a){null==a?(keycode=event.keyCode,escapeKey=27):(keycode=a.keyCode,escapeKey=a.DOM_VK_ESCAPE||27),key=String.fromCharCode(keycode).toLowerCase(),(key==b.keyToClose||"x"==key||keycode==escapeKey)&&o(),(key==b.keyToPrev||37==keycode)&&0!=b.activeImage&&(b.activeImage=b.activeImage-1,f(),l()),(key==b.keyToNext||39==keycode)&&b.activeImage!=b.imageArray.length-1&&(b.activeImage=b.activeImage+1,f(),l())}function n(){b.imageArray.length-1>b.activeImage&&(objNext=new Image,objNext.src=b.imageArray[b.activeImage+1][0]),b.activeImage>0&&(objPrev=new Image,objPrev.src=b.imageArray[b.activeImage-1][0])}function o(){a("#jquery-lightbox").remove(),a("#jquery-overlay").fadeOut(function(){a("#jquery-overlay").remove()}),a("embed, object, select").css({visibility:"visible"})}function p(){var a,b;window.innerHeight&&window.scrollMaxY?(a=window.innerWidth+window.scrollMaxX,b=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(a=document.body.scrollWidth,b=document.body.scrollHeight):(a=document.body.offsetWidth,b=document.body.offsetHeight);var c,d;return self.innerHeight?(c=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight),pageHeight=d>b?d:b,pageWidth=c>a?a:c,arrayPageSize=new Array(pageWidth,pageHeight,c,d)}function q(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),arrayPageScroll=new Array(a,b)}function r(a){var b=new Date;c=null;do var c=new Date;while(a>c-b)}b=jQuery.extend({overlayBgColor:"#000",overlayOpacity:.85,fixedNavigation:!1,containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:" / ",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0},b);var s=this;return this.unbind("click").click(c)}}(jQuery),define("lib/jquery.lightbox-0.5",["lib/jquery"],function(){}),define("lib/ios-orientationchange-fix",["jquery"],function(a){return function(b){function c(){var b,c="";a(document).find("input[placeholder]").each(function(){b=a(this),c=b.attr("placeholder"),b.removeAttr("placeholder").attr("placeholder",c)})}function d(){m.setAttribute("content",p),q=!0}function e(){m.setAttribute("content",o),q=!1}function f(a){l=a.accelerationIncludingGravity,i=Math.abs(l.x),j=Math.abs(l.y),k=Math.abs(l.z),b.orientation&&180!==b.orientation||!(i>7||(k>6&&8>j||8>k&&j>6)&&i>5)?q||d():q&&e()}b.addEventListener&&b.addEventListener("orientationchange",c,!1);var g=navigator.userAgent;if(/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(g)&&g.indexOf("AppleWebKit")>-1){var h=b.document;if(h.querySelector){var i,j,k,l,m=h.querySelector("meta[name=viewport]"),n=m&&m.getAttribute("content"),o=n+",maximum-scale=1",p=n+",maximum-scale=10",q=!0;m&&(b.addEventListener("orientationchange",d,!1),b.addEventListener("devicemotion",f,!1))}}}(window),{}}),tiger.section.header.js_iemessage=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div data-alert class="alert-box info js_ie-message-inner"><a href="#" class="close">&times;</a>Please <a href="http://help.gawker.com/customer/portal/articles/1329926-is-my-browser-supported-">update your browser</a> for a better experience on ',soy.$$escapeHtml(c.meta.blog.displayName?c.meta.blog.displayName:"kinja.com"),".</div>"),b?"":d.toString()},define("templates/tiger/section/header/js-iemessage",function(){}),define("module/BaseApp",["lib/jquery","view/BaseView","singleton/CurrentUser","singleton/Device","singleton/EventDispatcher","singleton/Feature","singleton/KillSwitch","singleton/Utils","view/items/UserBar","view/items/Sidebar","view/SuccessBox","lib/jquery.cookie","lib/jquery.scrollTo","lib/jquery.lightbox-0.5","lib/ios-orientationchange-fix","templates/tiger/section/header/js-iemessage"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b.extend({successBox:null,el:a("body"),initialize:function(){this.initApp(),this.loadSocialScripts(),this.initSubViews()},start:function(){},initApp:function(){c.load(),c.on("authenticated",this.handleAuth,this),e.on("modal:incompleteRegistration:success",function(){window._gaq.push(["_trackEvent","Sign up",c.get("authName")])},this),e.on("all",this.trigger,this),f.isOn("userstats")&&this.statsTracker(),a("body").addClass(d.has("touch")?"touch":"no-touch")},initSubViews:function(){this.initUserTools(),this.initSidebar(a(".js_user_bar")),this.cleanUpAfterWelcomeBox(),g.hasValue("maintenance","on")&&this.showMaintenanceMessage(),this.setupSuccessBox(),a("html").hasClass("lt-ie9")&&this.displayIEBox(),f.isOn("betamessage")&&this.displayBetaMessage(),this.displayShareTabMessage()},cleanUpAfterWelcomeBox:function(){a.removeCookie("welcome_seen_count")},displayIEBox:function(){var b,c=0,d=a(".js_ie-message");d.length>0&&!this.isGoogleBot()&&(c=parseInt(a.cookie("iebox_seen_count")||0,10),"1"!==a.cookie("iebox_seen")&&5e3>c&&(b=a(this.soyToHtml(tiger.section.header.js_iemessage)).removeClass("hide"),d.removeClass("hide").append(b).find("a.close").on("click",function(){return d.remove(),a.cookie("iebox_seen","1",{expires:7300,path:"/"}),!1}),a.cookie("iebox_seen_count",c+1,{expires:7300,path:"/"})))},isGoogleBot:function(){return window.navigator.userAgent.toLowerCase().indexOf("googlebot")>0},displayBetaMessage:function(){var b=a(".js_beta-message"),c=f.isOn("tiger")?"betamsg_tiger_dismissed":"betamsg_dismissed";b.length>0&&"1"!==a.cookie(c)&&b.removeClass("hide").find("a.close").on("click",function(){return b.remove(),a.cookie(c,"1",{expires:3,path:"/"}),!1})},displayShareTabMessage:function(){var b=a(".js_sharetab-message"),c="share_tab_msg_dismissed";b.length>0&&!a.cookie(c)&&"1"!==a.cookie(c)&&b.removeClass("hide").find("a.close").on("click",function(){return b.remove(),a.cookie(c,"1",{expires:365,path:"/"}),!1})},showMaintenanceMessage:function(){var b=a(".js_maintenance");b.length>0&&b.removeClass("hide")},setupSuccessBox:function(){e.on("successbox:display",function(a){null!==this.successBox&&this.successBox.close(),this.successBox=new k(a),this.successBox.render()},this),e.on("successbox:close",function(){null!==this.successBox&&this.successBox.close()},this)},initUserTools:function(){var b;b=new i({el:a(".js_topbar")})},initSidebar:function(a){var b;b=new j({el:a})},handleAuth:function(){return a("body").toggleClass("loggedin",c.isLoggedIn()),"resettoken"===this.getPageType()||"gettoken"===this.getPageType()?(c.clearTokenCookie(),c.token(function(){window.setTimeout(function(){window.location.reload()},1e3)}),!1):void 0},loadSocialScripts:function(){a.getScript("//platform.twitter.com/widgets.js",function(){window.twttr.widgets.load()}),a.getScript("//connect.facebook.net/en_US/all.js",function(){window.fbAsyncInit=function(){window.FB.init({appId:h.getKinjaMeta().blog&&h.getKinjaMeta().blog.fbAppId?h.getKinjaMeta().blog.fbAppId:"36368793975",status:!0,cookie:!0,xfbml:!0})}})},statsTracker:function(){var b="__k_iut",c=a(".js_stats"),d=c.data("trackurl"),e=!1;(!a.cookie(b)||a.cookie(b)<(new Date).getTime()-2592e6)&&(e=!0,a.cookie(b,(new Date).getTime(),{path:"/",expires:365})),d&&(e&&(d+="&unique=true"),a(".js_stats").append('<img src="'+d+'" style="display: none;">'))}});return l}),tiger.components.post.inset.amazonInset=function(a,b,c){var d=b||new soy.StringBuilder,e=new soy.StringBuilder(c.meta&&c.meta.blog&&c.meta.currentUrl?"http://"+soy.$$escapeHtml(c.meta.blog.canonicalHost)+soy.$$escapeHtml(c.meta.currentUrl)+(a.response.asin?","+soy.$$escapeHtml(a.response.asin):""):"");return e=e.toString(),d.append('<aside class="referenced amazon-module six medium-6 columns"><div class="referenced-content amazon-content whitelisted-links"><div class="referenced-item mbn row',soy.$$escapeHtml(a.response.title?"":" hide"),'">',a.response.imageUrl?'<div class="four mobile-two medium-4 small-6 columns"><a href="'+soy.$$escapeHtml(a.response.productUrl)+"[type|mod-image\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Inset Clicks', 'Amazon inset - image click', '"+soy.$$escapeHtml(e)+'\']);"><img src="'+soy.$$escapeHtml(a.response.imageUrl)+'" /></a></div>':"",'<div class="',soy.$$escapeHtml(a.response.imageUrl?"eight mobile-two medium-8 small-6 prs":"twelve mobile-four")," columns\"><h6 class=\"headline\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Inset Clicks', 'Amazon inset - product title click', '",soy.$$escapeHtml(e),'\']);"><a href="',soy.$$escapeHtml(a.response.productUrl),'[type|mod-title">',soy.$$escapeHtml(a.response.title),'</a></h6><p class="proxima price-line"><a href="',soy.$$escapeHtml(a.response.productUrl),"[type|mod-price\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Inset Clicks', 'Amazon inset - product price click', '",soy.$$escapeHtml(e),'\']);">Amazon.com: <span class="price">',soy.$$escapeHtml(a.response.price),'<span></a></p><p><a href="',soy.$$escapeHtml(a.response.productUrl),"[type|mod-button\" class=\"button small phm pvs mvm\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Inset Clicks', 'Amazon inset - Add to Cart click', '",soy.$$escapeHtml(e),"']);\">Buy now</a></p>",a.response.conversions?'<p class="conversions"><span class="icon oversized inline notranslate text-light">M</span><a href="'+soy.$$escapeHtml(a.response.productUrl)+"[type|mod-conversions\" class=\"proxima text-light\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Inset Clicks', 'Amazon inset - conversions click', '"+soy.$$escapeHtml(e)+"']);\"><em>"+soy.$$escapeHtml(a.response.conversions)+" readers bought this</em></a></p>":"","</div></div></div></aside>"),b?"":d.toString()},tiger.components.post.inset.amazonReplyInset=function(a,b,c){var d=b||new soy.StringBuilder,e=new soy.StringBuilder(c.meta&&c.meta.blog&&c.meta.currentUrl?"http://"+soy.$$escapeHtml(c.meta.blog.canonicalHost)+soy.$$escapeHtml(c.meta.currentUrl)+(a.response.amazonAsin?","+soy.$$escapeHtml(a.response.amazonAsin):""):"");return e=e.toString(),d.append('<aside class="amazon-module amazon-module-reply proxima"><div class="amazon-content whitelisted-links"><a href="',soy.$$escapeHtml(a.response.productUrl),"[type|mod-button\" class=\"button tiny\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Reply Inset Clicks', 'Amazon reply inset - product button click', '",soy.$$escapeHtml(e),'\']);">Buy now</a><a href="',soy.$$escapeHtml(a.response.productUrl),"[type|mod-price\" class=\"price\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Reply Inset Clicks', 'Amazon reply inset - product price click', '",soy.$$escapeHtml(e),"']);\">",soy.$$escapeHtml(a.response.price),'</a><div class="amazon-title"><a href="',soy.$$escapeHtml(a.response.productUrl),"[type|mod-title\" onClick=\"window._gaq.push(['_trackEvent', 'Amazon Reply Inset Clicks', 'Amazon reply inset - product title click', '",soy.$$escapeHtml(e),"']);\">",soy.$$escapeHtml(a.response.title),"</a><div></div></aside>"),b?"":d.toString()},define("templates/tiger/components/post/inset/inset-amazon",function(){}),define("module/amazoninsets/view/AmazonInset",["lib/jquery","lib/underscore","singleton/Utils","view/BaseView","templates/tiger/components/post/inset/inset-amazon"],function(a,b,c,d){var e=d.extend({showAll:!1,template:"post",render:function(){this.getAmazonInsets()},getAsins:function(){var c=function(b,c){var d=a(c),e=d.data("amazonasin").toString(),f=d.data("amazonsubtag");return e&&!b[e]&&(b[e]={link:d,asin:e,tag:"kinjamod-20",subtag:f}),b};return b.reduce(this.$el.find("a[data-amazonasin]"),c,[])},getAmazonInsets:function(){var c=this.getAsins(),d=b.keys(c);return 0===d.length?!1:(a.ajax({url:"/api/inset/amazon/"+d.join(","),type:"GET",dataType:"json",success:a.proxy(function(a){a.insets&&a.insets.length>0&&this.renderAmazonInsets(a.insets,c)},this)}),void 0)},renderAmazonInsets:function(d,e){var f,g,h,i,j,k,l=b.sortBy(d,function(a,b){return 0===b?-1e6:-1*a.conversions}),m=5,n=0,o=0,p=function(b,c){g=a(c);var d=g.offset().top,e=g.height();return b.push([d,e+d,e]),b},q=[],r="",s=75,t="reply"===this.template?tiger.components.post.inset.amazonReplyInset:tiger.components.post.inset.amazonInset;""!==document.referrer&&(r=document.referrer.match(/:\/\/([^/]+)\//),r=null!==r?r[1]:""),"reply"===this.template&&a(".amazon-module-reply").remove();do f=e[l[o].asin],l[o].link=f.link,this.showAll||"reply"===this.template||(h=a(".amazon-module"),q=b.reduce(h,p,[]),i=this.doesModuleFit(f.link.parentsUntil(".post-content, .reply-content, ul").last(),q,300)),(this.showAll||i||"reply"===this.template)&&(l[o].subtag=f.subtag+"[referrer|"+r,l[o].title=c.cut(l[o].title,s),l[o].productUrl=l[o].productUrl+"&ascsubtag="+l[o].subtag,l[o].price&&"N/A"!==l[o].price?"number"==typeof l[o].price&&(l[o].price="$"+l[o].price.toFixed(2)):l[o].price="",!l[o].conversions||l[o].conversions<5?delete l[o].conversions:l[o].conversions=l[o].conversions.toLocaleString(),j={response:l[o]},this.showAll?a("#"+l[o].asin).html(this.soyToHtml(t,j)):(k="reply"===this.template?l[o].link.parents(".reply-content").last():l[o].link.parentsUntil(".post-content, .reply-content, ul").last(),k.append(this.soyToHtml(t,j)),n+=1)),o+=1;while(m>n&&o<l.length)},doesModuleFit:function(a,c,d){var e,f,g=a.offset().top;return e=b.filter(c,function(a){return a[1]>g-d&&a[0]<g}),f=b.filter(c,function(a){return a[0]<g+d+a[2]&&a[1]>g}),!(e.length>0||f.length>0)}});return e}),define("module/AmazonInsetsModule",["module/amazoninsets/view/AmazonInset","singleton/EventDispatcher"],function(a,b){var c={forPost:function(b){var c=new a({el:b});c.showAll=!1,c.render()},forReplies:function(c){var d=new a({el:c});d.template="reply",b.on("update.postlist.reply",function(){d.render()})},forSales:function(b){var c=new a({el:b});c.showAll=!0,c.render()}};return c}),define("view/forms/BaseModalView",["view/BaseView","singleton/EventDispatcher"],function(a,b){var c=a.extend({attributes:{"data-reveal":""},events:{"click .js_close":"close",cancel:"close"},close:function(){return this.$el.foundation("reveal","close"),b.off(null,null,this),!1},hideCommonSelector:function(){this.$el.find(this.commonSelector).hide()},showTarget:function(a){this.$el.find(a).show().find("input").eq(0).focus()},switchTo:function(a){if(this.hideCommonSelector(),this.showTarget(a),void 0!==this.forms[a])this.forms[a].cancelErrors();else{var b,c=this.$el.find(a);c.length?b=new this.formClasses[a]({el:c}):(b=new this.formClasses[a],this.$(".js_form-container").append(b.render().$el)),b.$el.show(),this.forms[a]=b}}});return c}),tiger.components.forms.modals.promoteTable=function(a,b){var c=b||new soy.StringBuilder;if(c.append('	<header><span class="close-modal js_close"><i class="icon icon-img icon-close"></i></span><h3>Promote post</h3></header><form id="promote-form"><div class="modal-body"><div class="mtl mbs"><p class="text-small">Select a blog to promote this post:.</p></div><div><table class="proxima"><thead><tr>',a.promotions&&a.promotions[0]&&a.promotions[0].blog?"<th>Blog</th>":"<th>Post</th>","<th>Byline</th><th>Start</th><th>End</th><th>Views</th><th>Display Cap</th>",a.blogs?'<th colspan="2">Preview</th>':"<th>Preview</th><th>Delete on Save</th>","</tr></thead><tbody>"),a.blogs){c.append('<tr class="js_promoteNewRow"><td><select id="promotion_blog_new"><option value="">Choose a blog:</option>');for(var d=a.blogs,e=d.length,f=0;e>f;f++){var g=d[f];c.append('<option value="',soy.$$escapeHtml(g.id),'">',soy.$$escapeHtml(g.name),"</option>")}c.append('</select></td><td class="promote-byline_new"><span class="js_promoteByline"><input type="text" name="byline" value="" id="byline_new" class="mbn" /></span></td><td class="promote-begin_new"><input type="text" name="begin" value="',soy.$$escapeHtml(a.formattedBegin),'" id="beginning_new" class="mbn" /></td><td class="promote-end_new"><input type="text" name="end" value="',soy.$$escapeHtml(a.formattedEnd),'" id="ending_new" class="mbn" /></td><td>&nbsp;</td><td class="promote-displaycap_new"><span class="js_promoteDisplayCap"><input type="text" name="displaycap" value="" id="displaycap_new" class="mbn" /></span></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',soy.$$escapeHtml(a.postId),'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="" >Preview</a></span></td><td><input type="hidden" name="post_id" value="',soy.$$escapeHtml(a.postId),'" id="post_id_new" /></td></tr>')}c.append("<tr>",a.blogs&&a.promotions&&a.promotions[0]?'<td colspan="7">Existing Promotions:</td><td>Delete on Save</td>':"","</tr>");var h=a.promotions,i=h.length;if(i>0)for(var j=0;i>j;j++){var k=h[j];c.append('<tr class="js_promoteRow promotion_',soy.$$escapeHtml(k.id),'"><td><input type="hidden" name="has_promotion" value="',soy.$$escapeHtml(k.id),'" id="has_promotion" /><input type="hidden" name="post_id" value="',soy.$$escapeHtml(k.postId),'" id="post_id_',soy.$$escapeHtml(k.id),'" /><input type="hidden" name="blog_id" value="',soy.$$escapeHtml(k.blogId),'" id="blog_id_',soy.$$escapeHtml(k.id),'" />',k.blog?'<span class="bd user-name">'+soy.$$escapeHtml(k.blog.name)+"</span>":'<span class="bd user-name">'+soy.$$escapeHtml(k.headline)+"</span>",'</td><td class="promote-byline_',soy.$$escapeHtml(k.id),'"><span class="js_promoteByline"><input type="text" name="byline" value="',soy.$$escapeHtml(k.byline),'" id="byline_',soy.$$escapeHtml(k.id),'" class="mbn" /></span></td><td class="promote-begin_',soy.$$escapeHtml(k.id),'"><input type="text" name="begin" value="',soy.$$escapeHtml(k.start),'" id="beginning_',soy.$$escapeHtml(k.id),'" class="mbn" /></td><td class="promote-end_',soy.$$escapeHtml(k.id),'"><input type="text" name="end" value="',soy.$$escapeHtml(k.end),'" id="ending_',soy.$$escapeHtml(k.id),'" class="mbn" /></td><td><span class="text-small" id="count-display_',soy.$$escapeHtml(k.id),'">',soy.$$escapeHtml(k.displayCountAsString),'</span></td><td class="promote-displaycap_',soy.$$escapeHtml(k.id),'"><span class="js_promoteDisplayCap"><input type="text" name="displaycap" value="',soy.$$escapeHtml(k.displayCapAsString),'" id="displaycap_',soy.$$escapeHtml(k.id),'" class="mbn" /></span></td><td><span class="text-small text-right mlm"><a href="/?promotedpostpreview=',soy.$$escapeHtml(k.id),""!=k.byline?"&promotedby="+soy.$$escapeHtml(k.byline):"",'&token=" class="js_promotionPreviewLink" target="_preview" data-previewTarget="" >Preview</a></span></td><td><input type="checkbox" class="left" name="promotion_delete" value="',soy.$$escapeHtml(k.id),'" id="promotion_delete_',soy.$$escapeHtml(k.id),'"/></td></tr>')}else c.append('<tr><td colspan="8">No promotions found for this ',a.blogs?"post":"blog",".</td></tr>");return c.append('</tbody></table></div></div><div class="twelve columns mtl mbs hide promote-message"><p class="text-small text-center proxima success hide">Your promotion has been saved.</p><p class="text-small text-center proxima failure hide">Your promotion was not saved. Please try again.</p></div><footer class="phn"><a class="button js_close tiny left secondary">Close</a><a class="button js_promoteSubmit tiny right">Save</a></footer></form>'),b?"":c.toString()},define("templates/tiger/components/forms/modals/promote",function(){}),define("view/forms/PromoteTargetSelector",["lib/jquery","lib/underscore","view/forms/BaseModalView","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/ModalManager","templates/tiger/components/forms/modals/promote"],function(a,b,c,d,e,f,g){var h=c.extend({id:"modal-promoteselector",className:"reveal-modal kinja-modal promote-subform large",events:b.extend(c.prototype.events,{"click .js_promoteSubmit":"promotePost","click .js_promoteDisplayCap":"selectDisplayCapText","blur .js_promoteDisplayCap":"checkDisplayCapText","keyup .js_promoteByline":"updatePreviewLinkOnBlur","change .js_promoteByline":"updatePreviewLinkOnBlur"}),forms:{},initialize:function(){this.$el.on("closed",a.proxy(this.remove,this))},str_UnlimitedDisplay:"Unlimited",int_UnlimitedDisplay:-1,displayCapToString:function(a){var b=a;return(isNaN(a)||0>a)&&(b=this.str_UnlimitedDisplay),b},displayCapToInt:function(a){var c,d=a;return void 0===a||a===this.str_UnlimitedDisplay?d=this.int_UnlimitedDisplay:(c=d.replace(/\s+/g,"").match(/-?\d+/g),null!==c&&(d=b.reduce(c,function(a,b){return a+b})),d=parseInt(d,10)),isNaN(d)&&(d=this.int_UnlimitedDisplay),d},selectDisplayCapText:function(b){var c=a(b.currentTarget).find('input[name="displaycap"]');c.focus(),c.select()},checkDisplayCapText:function(b){var c=a(b.currentTarget).find('input[name="displaycap"]'),d=this.displayCapToString(this.displayCapToInt(c.val()));c.val(d)},promotePost:function(a){if(a.stopPropagation(),a.preventDefault(),!d.isLoggedIn())return f.trigger("loginRequired",{source:"promoteform"}),this.state="waitingForLogin",!1;var c=this,e=this.harvestFormData(c);return b.each(e,function(a){c.promote(a.blogId,a.postId,a.beginTimeMillis,a.endTimeMillis,a.id,a.displayCap,a.byline)}),!1},harvestFormData:function(c){var d,e,f,g=[],h=this.$el.find(".js_promoteRow"),i=0;return b.each(h,function(b){d=a(b),e=d.find("#has_promotion").val(),g[i]=[],g[i].id=e,g[i].postId=d.find("#post_id_"+e).val(),g[i].blogId=d.find("#blog_id_"+e).val(),g[i].displayCap=c.displayCapToInt(d.find("#displaycap_"+e).val()),g[i].byline=d.find("#byline_"+e).val(),d.find("#promotion_delete_"+e).is(":checked")?(g[i].beginTimeMillis=28136994e4,g[i].endTimeMillis=28136994e4):(g[i].beginTimeMillis=new Date(d.find("#beginning_"+e).val()).getTime(),g[i].endTimeMillis=new Date(d.find("#ending_"+e).val()).getTime()),i+=1}),f=a(".js_promoteNewRow"),f.length>0&&""!==f.find("#promotion_blog_new").val()&&(g[i]=[],g[i].postId=f.find("#post_id_new").val(),g[i].blogId=f.find("#promotion_blog_new").val(),g[i].displayCap=c.displayCapToInt(f.find("#displaycap_new").val()),g[i].byline=f.find("#byline_new").val(),g[i].beginTimeMillis=new Date(f.find("#beginning_new").val()).getTime(),g[i].endTimeMillis=new Date(f.find("#ending_new").val()).getTime()),g},promote:function(b,c,e,g,h,i,j){d.isLoggedIn()||f.trigger("loginRequired",{source:"promoteform"}),h=void 0!==h?h:0,h=parseInt(h,10);var k="",l={blogId:parseInt(b,10),postId:parseInt(c,10),beginTimeMillis:e,endTimeMillis:g,displayCap:i,byline:j},m=this;"number"==typeof h&&h>0?(k="/apiproxy/promotion/"+h+"?token="+d.get("token"),l.promotionId=h):k="/apiproxy/promotion/add?token="+d.get("token"),a.ajax({url:k,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(l),success:function(a){void 0!==a.meta&&200===a.meta.status?(m.$el.find(".promote-message").removeClass("hide"),m.$el.find(".promote-message .success").removeClass("hide"),window.setTimeout(function(){m.close()},2e3)):this.error()},error:function(){m.$el.find(".promote-message").removeClass("hide"),m.$el.find(".promote-message .failure").removeClass("hide")}})},render:function(c,f){var h,i,j,k,l=!!c,m=!!f,n=this,o=[],p=[],q=d.get("membership").length,r=0,s=tiger.components.forms.modals.promoteTable;return l?a.ajax({url:"/apiproxy/blog/"+e.id+"/promoted/future",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(c){n.el.id="modal-promotedList",k=a("#modal-promotedList"),k.html(),c.data&&c.data.items&&c.data.items.length>0&&b.each(c.data.items,function(a){i=a.promotions[0],i.headline=a.headline,i.start=n.getMDYYYYHHMM(new Date(i.beginTimeMillis)),i.end=n.getMDYYYYHHMM(new Date(i.endTimeMillis)),i.displayCapAsString=n.displayCapToString(i.displayCap),i.displayCountAsString=i.displayCap===n.int_UnlimitedDisplay?i.displayCount:i.displayCount+" of "+i.displayCap,i.postId=a.id,p.push(i)}),a("body").append(n.$el.html(n.soyToHtml(s,{promotions:p}))),k=k.length<1?a("#modal-promotedList"):k,g.create(k).open()}}):m?(h=this.model.id,a.ajax({url:"/apiproxy/promotion/post/"+h,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(c){n.el.id="modal-promotedList",k=a("#modal-promotedList"),k.html(),c.data&&c.data.items&&c.data.items.length>0&&b.each(c.data.items,function(a){a.start=n.getMDYYYYHHMM(new Date(a.beginTimeMillis)),a.end=n.getMDYYYYHHMM(new Date(a.endTimeMillis)),a.displayCapAsString=n.displayCapToString(a.displayCap),a.displayCountAsString=a.displayCap===n.int_UnlimitedDisplay?a.displayCount:a.displayCount+" of "+a.displayCap,p.push(a)}),a("body").append(n.$el.html(n.soyToHtml(s,{promotions:p,readOnly:!0}))),k=k.length<1?a("#modal-promotedList"):k,g.create(k).open()}})):d.get("membership").length>0&&(h=this.model.id,d.get("membership").map(function(a){var b={id:a.get("blogId"),name:a.get("blog").displayName,canonicalHost:a.get("blog").canonicalHost};o.push(b)}),b.each(o,function(c){a.ajax({url:"/apiproxy/promotion/blog/"+c.id+"/post/"+h+"/future",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){a.data&&a.data.items&&a.data.items.length>0&&b.each(a.data.items,function(a){a.blog=c,a.start=n.getMDYYYYHHMM(new Date(a.beginTimeMillis)),a.end=n.getMDYYYYHHMM(new Date(a.endTimeMillis)),a.displayCapAsString=n.displayCapToString(a.displayCap),a.displayCountAsString=a.displayCap===n.int_UnlimitedDisplay?a.displayCount:a.displayCount+" of "+a.displayCap,a.postId=h,p.push(a)}),r++,j=new Date,r===q&&n.$el.html(n.soyToHtml(s,{promotions:p,blogs:o,postId:h,formattedBegin:n.getMDYYYYHHMM(j),formattedEnd:n.getMDYYYYHHMM(new Date(j.getTime()+108e5))}))}})})),this},updatePreviewLinks:function(a,b){b.attr("href",b.attr("data-previewTargetLink")+"&promotedby="+a)},updatePreviewLinkOnBlur:function(b){var c=a(b.target),d=c.val(),e=c.attr("id").split("_");d&&2===e.length&&this.updatePreviewLinks(d,a("[data-previewTarget="+e[1]+"]"))}});return h}),tiger.components.forms.modals.header=function(a,b){var c=b||new soy.StringBuilder;return c.append("	<header><h3>",soy.$$escapeHtml(a.name),'<a class="close-reveal-modal">&times;</a></h3></header>'),b?"":c.toString()},define("templates/tiger/components/forms/modals/header",function(){}),tiger.components.forms.modals.invite.inviteToPost=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),tiger.components.forms.modals.header({name:"Invite to the discussion"},d,c),d.append('<form id="invite-to-post-form"><div class="modal-body"><div class="row"><div class="columns"><p>Enter Twitter usernames to invite: <a class="right notranslate maincolor help-link icon" href="http://help.gawker.com/customer/portal/articles/1486091-what-are-invitations" target="_blank">$</a></p></div></div><div class="row"><div class="columns"><div class="row collapse"><div class="small-1 columns"><label for="js_invite-to-post-field"><span class="prefix"><div class="oversized notranslate primary-color prepostfix-icon icon">i</div></span></label></div><div class="small-11 columns"><input type="text" id="js_invite-to-post-field" class="inline-block js_invite-field" placeholder="Write a tweet to the @user(s) you\'d like to invite." value="" autocapitalize="on" /></div></div></div></div><div class="row"><div class="columns"><footer><a href="#" class="tiny left secondary js_close button">Cancel</a><a href="#" class="tiny right js_submit button">Invite</a><div class="behind-button-spinner-container">'),tiger.components.spinner.bounce(null,d,c),d.append("</div></footer></div></div></div></form>"),b?"":d.toString()},define("templates/tiger/components/forms/modals/invite/invite-to-post",function(){}),define("view/forms/invite/InviteToPostModalView",["lib/jquery","singleton/CurrentUser","singleton/EventDispatcher","view/forms/BaseModalView","templates/mantle/messages","templates/tiger/components/spinner","templates/tiger/components/forms/modals/header","templates/tiger/components/forms/modals/invite/invite-to-post"],function(a,b,c,d){var e=d.extend({id:"modal-invite-to-post",className:"reveal-modal kinja-modal small proxima",events:{"click .js_close":"close","click .js_submit":"submit"},postId:void 0,starterId:void 0,initialize:function(a){c.on("modal:login:close",this.close,this),this.postId=a.postId,this.starterId=a.starterId
},render:function(){return this.$el.html(this.soyToHtml(tiger.components.forms.modals.invite.inviteToPost)),this},submit:function(d){var e=a(d.target);e.hide();var f={blogId:b.get("defaultBlogId"),postId:this.postId,starterId:this.starterId,accountToken:b.get("token"),authType:2,inviteText:e.closest("form").find("#js_invite-to-post-field").val()};a.ajax("api/invite",{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(f),success:a.proxy(function(){this.close(),c.trigger("successbox:display",{message:this.soyToHtml(mantle.messages.invitesSent)})},this),error:a.proxy(function(){e.show(),c.trigger("successbox:display",{message:this.soyToHtml(mantle.messages.ajaxError)})},this)})}});return e}),define("gawkerlib/lightboxer",["lib/jquery","lib/underscore","view/BaseView","singleton/Utils","templates/mantle/messages"],function(a,b,c,d){function e(e){var f=e.find(".lightBoxWrapper .img-border img");e.find(".lightBox .text").html(c.prototype.t(mantle.messages.lightboxExpand)),b.each(f,function(b){var c=a(b);c.attr("data-original-src",d.imageUrl(c.data("chomp-id"),"original",c.data("format")))}),e.find(".lightBox").removeClass("hide").lightBox()}return e}),mantle.components.post.button.postTools=function(a,b){var c=b||new soy.StringBuilder;c.append("	");a.post.headline?a.post.headline:a.post.first100Characters,a.post.plaintext?a.post.plaintext:a.post.headline;return c.append(0!=a.post.allowReplies?'<a href="/posts/'+soy.$$escapeHtml(a.post.id)+'/reply" class="button secondary reply-to-post js_reply-to-post'+(a.post.liveBlog?" hide":"")+'" rel="nofollow"><span class="icon notranslate">L</span><span class="txt font-normal">Discuss</span></a>':""),b?"":c.toString()},mantle.components.post.button.postToolsNG=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=a.post.headline?a.post.headline:a.post.first100Characters,f=a.post.plaintext?a.post.plaintext:a.post.headline,g=new soy.StringBuilder,h=new soy.StringBuilder("k-medium");h=h.toString(),g.append((null==a.post?null:null==a.post.sharingMainImage?null:a.post.sharingMainImage.id)?'<img src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.post.sharingMainImage.id,h,a.post.sharingMainImage.format))+'" /><br />':""),g=g.toString();var i=new soy.StringBuilder(a.mode&&"reply"==a.mode?"js_edit-reply":"js_edit-post");if(i=i.toString(),d.append('<a class="edit-link text-micro proxima text-upper hide ',soy.$$escapeHtml(i),' mrm minitoolbar-hide" href="/posts/',soy.$$escapeHtml(a.post.id),'/edit" rel="nofollow">Edit</a>'),(!a.post.isBlip||a.post.isBillboardPost)&&!a.forSharedPost&&(d.append(a.mode&&"reply"==a.mode?'<div class="button transparent no-text pln"><a href="#" class="js_dismiss js_external_dismiss has-tooltip tip-bottom hide" data-tooltip title="Dismiss"><span class="icon downsized notranslate no-text">X</span></a><a href="#" class="js_undismiss js_external_undismiss has-tooltip tip-bottom hide" data-tooltip title="Undismiss"><span class="icon downsized notranslate no-text force-alert-color">X</span></a></div>':a.post.viewstats&&a.post.viewstats.nonUniqueFormatted&&"0"!=a.post.viewstats.nonUniqueFormatted&&"permalink"==c.meta.pageType?'<span class="view-stats inline-block proxima" '+(a.post.viewstats.uniqueFormatted?' title="'+soy.$$escapeHtml(a.post.viewstats.uniqueFormatted)+' New Visitors"':"")+'><span class="text-micro">'+soy.$$escapeHtml(a.post.viewstats.nonUniqueFormatted)+'</span><span class="icon downsized inline notranslate mhn">g</span></span>':"",'<span class="js_liked-msg-place minitoolbar-hide"></span><span class="js_deleted-msg-place minitoolbar-hide"></span><div class="button transparent no-text button-recommend pln minitoolbar-hide"><a href="#" class="js_like has-tooltip tip-bottom no-hover" data-tooltip title="Recommend" onclick="window._gaq.push([\'_trackEvent\', \'Recommendation\', \'Post Recommended\', \'',soy.$$escapeHtml(a.post.permalink),"']);\">",a.post.likes&&a.post.likes>0?'<span class="txt text-micro text-upper">'+soy.$$escapeHtml(a.post.likes)+"</span>":"",'<span class="icon downsized notranslate mtn mhn js_like_icon">1</span></a></div>'),a.post.allowReplies&&(a.mode&&"reply"!=a.mode||"permalink"!=c.meta.pageType))){d.append('<a href="',c.meta&&"permalink"!=c.meta.pageType?soy.$$escapeHtml(a.post.permalink):"",'#replies" class="button transparent phn button-reply',"reply"==a.mode?" js_expand-branch":" js_reply-to-post-disabled",'" rel="nofollow">');var j=a.post.sharedPost?a.post.sharedPost.replyCount:a.post.replyCount?a.post.replyCount:0;d.append(j&&j>0?'<span class="txt text-micro text-upper">'+soy.$$escapeHtml(j)+"</span>":"",'<span class="icon downsized mhn notranslate">L</span></a>')}return a.mode&&"post"==a.mode&&(d.append('<div class="button dropdown transparent js_toolsmenu no-triangle prn minitoolbar-hide" data-usertools="true" data-repost="true"><span class="icon notranslate mrn">E</span><ul class="js_tools js_post-dropdown" data-title="',soy.$$filterNoAutoescape(e),'" data-description="',soy.$$escapeUri(f),'" data-imagetag="',soy.$$escapeUri(g),'"><li><a href="#" class="js_kinja-share"><span class="txt">Share to Kinja</span></a></li><li class="divider"></li><li><a href="http://www.facebook.com/sharer.php?u=',soy.$$escapeUri(a.post.permalink),'" target="_blank" onClick="window.open(this.href,\'sharefb\',\'toolbar=0,status=0,width=480,height=420\'); return false;"><span class="icon notranslate">j</span><span class="txt">Facebook</span></a></li><li><a href="http://twitter.com/share?url=',soy.$$escapeUri(a.post.permalink),'&text=POST_TITLE" class="js_share-post-item twitter"><span class="icon notranslate">i</span><span class="txt">Twitter</span></a></li><li><a href="http://www.tumblr.com/share/link?name=POST_TITLE&amp;description=POST_DESCRIPTION&amp;url=',soy.$$escapeUri(a.post.permalink),'" title="Share on Tumblr" class="js_share-post-item tumblr"><span class="icon notranslate">k</span><span class="txt">Tumblr</span></a></li></ul></div>'),a.post.reframes&&a.post.reframes.length>0&&(d.append('<div class="inline-block share-notification-container minitoolbar-hide"><div class="js_share-counter counter text-micro strong cursor-pointer">',soy.$$escapeHtml(a.post.reframes.length),"</div>"),mantle.components.post.header.shareNotificationList({items:a.post.reframes},d,c),d.append("</div>"))),b?"":d.toString()},mantle.components.post.button.hidepost=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<a href="#" class="js_hide-post"><span class="icon notranslate">b</span><span class="txt">Hide</span></a>'),b?"":c.toString()},mantle.components.post.button.dismiss=function(a,b){a=a||{};var c=b||new soy.StringBuilder;return c.append('	<a href="#" class="js_dismiss"><span class="icon notranslate">a</span><span class="txt">',a.dismissed&&1==a.dismissed?"Dismissed":"Dismiss","</span></a>"),b?"":c.toString()},mantle.components.post.button.follow=function(a,b){var c=b||new soy.StringBuilder;return c.append("	","permalink"==a.pageType?'<a href="#" class="js_followuser button secondary text-center hide follow"><span class="icon notranslate mtn">P</span>Follow</a><a href="#" class="js_followuser button secondary text-center hide unfollow"><span class="icon notranslate mtn">O</span>Unfollow</a>':'<a href="#" class="js_followuser hide follow" title="Follow"><span class="icon notranslate text-light text-tiny">P</span></a><a href="#" class="js_followuser hide unfollow" title="Unfollow"><span class="icon notranslate text-light text-tiny">O</span></a>'),b?"":c.toString()},mantle.components.post.button.promote=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<a href="#" class="js_promote"><span class="icon notranslate">B</span><span class="txt">Promote</span></a>'),b?"":c.toString()},mantle.components.post.button.followblog=function(a,b){var c=b||new soy.StringBuilder;return c.append("	",a.followed?'<a href="#" class="js_follow" data-followed="true" data-blogid="'+soy.$$escapeHtml(a.blogId)+'" data-targetblogid="'+soy.$$escapeHtml(a.targetBlogId)+'" title="Unfollow"><span class="icon notranslate">Z</span><span class="txt">Unfollow for '+soy.$$escapeHtml(a.blogName)+"</span></a>":'<a href="#" class="js_follow" data-followed="false" data-blogid="'+soy.$$escapeHtml(a.blogId)+'" data-targetblogid="'+soy.$$escapeHtml(a.targetBlogId)+'" title="Follow"><span class="icon notranslate">Y</span><span class="txt">Follow for '+soy.$$escapeHtml(a.blogName)+"</span></a>"),b?"":c.toString()},mantle.components.post.button.blockblog=function(a,b){var c=b||new soy.StringBuilder;return c.append("	",a.blocked?'<a href="#" class="js_block" data-blocked="true" data-blogid="'+soy.$$escapeHtml(a.blogId)+'" data-targetblogid="'+soy.$$escapeHtml(a.targetBlogId)+'" title="Unblock"><span class="icon notranslate">P</span><span class="txt">Unblock for '+soy.$$escapeHtml(a.blogName)+"</span></a>":'<a href="#" class="js_block" data-blocked="false" data-blogid="'+soy.$$escapeHtml(a.blogId)+'" data-targetblogid="'+soy.$$escapeHtml(a.targetBlogId)+'" title="Block"><span class="icon notranslate">b</span><span class="txt">Block for '+soy.$$escapeHtml(a.blogName)+"</span></a>"),b?"":c.toString()},mantle.components.post.button.undismissedmessage=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="js_undismissed-msg undismissed-msg popover-container active"><div class="popover popover-left nowrap"><div class="arrow"></div><div class="popover-content text-small pvs phm">Reply undismissed.</div></div></div>'),b?"":c.toString()},mantle.components.post.button.replybuttons=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div class="reply-buttons js_reply-buttons inline-block" data-forpost="',soy.$$escapeHtml(a.reply.id),'"><span class="js_message inline phs text-tiny proxima popover"></span><span class="js_undismissed-msg-place"></span><button class="button transparent js_dismiss js_external_dismiss has-tooltip tip-bottom pbn prn hide" data-tooltip title="Dismiss"><span class="icon downsized notranslate no-text">X</span></button><button class="button transparent js_undismiss js_external_undismiss has-tooltip tip-bottom pbn prn hide" data-tooltip title="Undismiss"><span class="icon downsized notranslate no-text force-alert-color">X</span></button><div class="inline plm has-tooltip tip-bottom" data-tooltip title="Recommend">',null!=a.reply.likes&&"0"!=a.reply.likes?'<span class="like-display txt text-micro text-upper mrs strong">'+soy.$$escapeHtml(a.reply.likes)+"</span>":"",'<span class="js_liked-msg-place"></span><span class="js_deleted-msg-place"></span><button class="button transparent no-text button-like js_like phn pbn"><span class="icon downsized notranslate js_like_icon">1</span></button></div><a href="/posts/',soy.$$escapeHtml(a.reply.id),'/reply" class="button transparent reply-to-post js_reply-to-post has-tooltip tip-bottom prn pbn" data-tooltip data-id="',soy.$$escapeHtml(a.reply.id),'" title="Discuss" rel="nofollow"><span class="icon downsized notranslate no-text">L</span></a>'),mantle.components.post.button.toolsmenu(a,d,c),d.append("</div>"),b?"":d.toString()},mantle.components.post.button.toolsmenu=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="button transparent dropdown down no-triangle pan pls reply-tools js_toolsmenu inline-block" data-repost="false" data-dismiss="false"><span class="icon icon-black notranslate">U</span><ul class="no-hover js_tools" style="left: -66px;top: 24px"><li class="js_kinja-share js_kinja-share-wrapper hide"><a href="#" data-id="',soy.$$escapeHtml(a.reply.id),'" class="js_reply-with-share" data-kinja-share="true"><span class="icon notranslate">L</span><span class="txt">Share to Kinja</span></a></li><li class="hide js_edit-post"><a href="/posts/',soy.$$escapeHtml(a.reply.id),'/edit" data-id="',soy.$$escapeHtml(a.reply.id),'" rel="nofollow"><span class="icon notranslate">e</span><span class="txt">Edit</span></a></li></ul></div>'),b?"":c.toString()},define("templates/mantle/components/post/button",function(){}),mantle.components.post.button.repostBlock=function(a,b){a=a||{};var c=b||new soy.StringBuilder;if(c.append("	",1==a.repostedToPersonal?'<li><a href="#" class="js_undorepost pvs" data-blogid="'+soy.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Undo repost to Personal blog</span></a></li>':""),a.blogsUndo)for(var d=a.blogsUndo,e=d.length,f=0;e>f;f++){var g=d[f];c.append('<li><a href="#" class="js_undorepost pvs" data-blogid="',soy.$$escapeHtml(g.id),'"><span class="txt">Undo repost to ',soy.$$escapeHtml(g.name),"</span></a></li>")}if(c.append('<li class="js_repostheader repostheader"><a href="#" class="pvs"><span class="icon notranslate mrs">E</span><span class="txt text-upper">Share to:</span></a></li>',!a.personalBlogId||a.kinjaShare||a.repostedToPersonal?"":'<li><a href="#" class="js_repost pvs" data-blogid="'+soy.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Personal blog</span></a></li>',a.kinjaShare?'<li><a href="#" class="js_kinja-share pvs"><span class="txt">Kinja</span></a></li>':""),a.blogsRepost)for(var h=a.blogsRepost,i=h.length,j=0;i>j;j++){var k=h[j];c.append('<li><a href="#" class="js_repost pvs" data-blogid="',soy.$$escapeHtml(k.id),'"><span class="txt">',soy.$$escapeHtml(k.name),"</span></a></li>")}return b?"":c.toString()},define("templates/mantle/components/post/button/repost-block",function(){}),define("view/items/PostTools",["config","lib/jquery","lib/underscore","lib/needly","model/post/Post","view/BaseView","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/ModalManager","view/forms/PromoteTargetSelector","view/forms/invite/InviteToPostModalView","module/groupchats/view/OpenReplyForms","gawkerlib/lightboxer","templates/mantle/components/post/button","templates/mantle/components/post/button/repost-block","templates/mantle/messages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=f.extend(c.extend({},o,{events:{"click .js_like":"likePost","click .js_dismiss":"dismissPost","click .js_undismiss":"undismissPost","click .js_edit-post":"editPost","click .js_delete-post":"deletePost","click .js_invite-to-post":"inviteToPost","click .js_reply-to-post":"replyToPostInterceptor","click .js_kinja-share":"kinjaShare","click .js_promote":"promoteModal","click .js_repost":"repostPost","click .js_undorepost":"undoRepost","click .js_hide-post":"hidePost","click .js_block":"blockBlog","click .js_share-post-item":"fillShareData","click .js_followforuser":"followUserForUser","click .js_unfollowforuser":"unfollowUserForUser","click .js_followforblog":"followUserForBlog","click .js_unfollowforblog":"unfollowUserForBlog"},replyFormOpenInProgress:!1,replyFormOpen:!1,initialize:function(a){g.on("authenticated",this.render,this),i.on("annotateReplyToPost",this.replyToPost,this),this.render(),this.model.on("change:liked",this.renderLikeButton,this),i.on("reply:openform",function(a){void 0!==a.id&&a.id===this.model.id&&this.replyToPost(a.e)},this),i.on("share:openkinjashare",function(a,b){void 0!==a&&a===this.model.id&&(this.kinjaShare(),b&&b.preventDefault())},this),i.on("share:externalshare",function(a,b){void 0!==a&&a===this.model.id&&this.fillShareData(b)},this),i.on("edit:post",function(a,b){void 0!==a&&a===this.model.id&&(this.editPost(b,"delegated"),b.preventDefault())},this),i.on("promote:post",function(a,b){void 0!==a&&a===this.model.id&&(this.promoteModal(b),b.preventDefault())},this),a&&a.openreframe&&this.kinjaShare(),g.on("change:updateFollow",this.updateFollowDropdown,this)},confirmHidePost:function(){return window.confirm(f.prototype.t(mantle.messages.confirmHidePost))},confirmBlockBlog:function(a,c,d){return window.confirm(b.trim(b(this.soyToHtml(mantle.messages.confirmBlockBlog,{action:a,username:c,sitename:d})).text()))},hidePost:function(a,c){if(a.preventDefault(),g.hasSuperuserTools()&&this.confirmHidePost()){var d=c||b(a.currentTarget).closest("article").data("id"),f="/apiproxy/post/"+d+"/hide?token="+g.get("token"),h=null,i="/";this.model.has("parentId")&&(h=new e({id:this.model.get("parentId")}),i=h.has("permalink")?h.get("permalink"):"/"+h.id),b.ajax({url:f,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){void 0!==a.meta&&a.meta.success===!0&&window.setTimeout(function(){window.location.href=i},1e3)}})}},likePost:function(){var a,c,d;return g.isLoggedIn()?(a="active",c=this.model.get("liked")?"unlike":"like",d=this.$el.find(".js_like_icon"),"like"===c?d.addClass(a):d.removeClass(a),this.model.setLike(c,{success:b.proxy(function(){"like"===c&&i.trigger("successbox:display",{message:this.soyToHtml(mantle.messages.postRecommended)})},this),error:function(a){throw new Error("PostTools.likePost(): "+a.reason)}}),!1):(g.once("authenticated",b.proxy(function(){this.likePost()},this)),i.trigger("loginRequired",{source:"likePost"}),!1)},deletePostSuccess:function(){i.trigger("successbox:display",{message:this.soyToHtml(mantle.messages.postDeleted)})},dismissPost:function(){if(!g.isLoggedIn())throw new Error("PostTools.dismissPost(): User not logged in!");return window.confirm(this.t(mantle.messages.confirmDismissPost))&&this.model.setAction("dismiss",this.model.get("defaultBlogId"),{success:b.proxy(function(){this.render(),this.trigger("dismiss:success")},this),error:function(a){throw new Error("PostTools.dismissPost(): "+a.reason)}}),!1},undismissPost:function(){if(!g.isLoggedIn())throw new Error("PostTools.undismissPost(): User not logged in!");return this.model.setAction("actionreset",this.model.get("defaultBlogId"),{success:b.proxy(function(){this.render(),this.trigger("undismiss:success")},this),error:function(a){throw new Error("PostTools.undismissPost(): "+a.reason)}}),!1},editPost:function(a,d){var f=this.getEditorMode(),h=b.Deferred(),i=b.Deferred(),j=b("body").data("post-form"),k=this.loadEditorPackage(f),l=b(a.target).closest("a").attr("href"),m=function(){document.location.href=l},n=b(".js_edit-post").addClass("disabled");return void 0!==j&&c.isFunction(j.confirmRemove)&&j.confirmRemove()&&j.remove(!0),"simple"===f?(d&&(window.location=window.location.origin+l),!0):(a.preventDefault(),g.onAuth.done(b.proxy(function(){this.model.fetch({preview:!0,cache:!1,success:h.resolve,error:h.reject}),this.model.has("parentId")?new e({id:this.model.get("parentId")}).fetch({success:i.resolve,error:i.reject}):i.resolve()},this)),b.when(k,h,i).fail(m).always(function(){n.removeClass("disabled")}).done(b.proxy(function(c,d,e){var g,h,i=function(a){this.trigger("edit:success",a)},j=b.noop,k=b.noop,l=b("body").scrollTop();switch(f){case"quickpost":g={model:this.model},h=new c(g),b("#editorplaceholder").append(h.$el.hide()),j=function(){b.scrollTo(0,{axis:"y",duration:500}),h.$el.fadeIn(500)},k=function(){b.scrollTo(l,{axis:"y",duration:500})};break;case"quickreply":g={model:this.model},void 0!==e&&(g.parent=e[0]),h=new c(g),h.on("success",function(){h.remove()},this);break;default:g={model:d[0],mode:"EDIT"},void 0!==e&&(g.parent=e[0]),h=new c(g)}h.on("success",i,this).on("rendered",j,this).on("remove",k,this),"quickreply"===f?this.$el.after(h.render().$el):h.render(null,a)},this)),void 0)},deletePost:function(){var a,b=this;return this.model.on("destroy",function(){i.trigger("successbox:display",{message:f.prototype.t(mantle.messages.postDeleted),timeout:5e3}),a=function(){window.location=b.cachebuster("/")},c.delay(a,j.isOn("wait-on-redirect")?2e3:0)},this),this.confirmDeletePost()&&this.model.destroy({wait:!0}),!1},inviteToPost:function(a){a.preventDefault();var c=new n({postId:b(a.target).closest(".js_post-dropdown").data("postid"),starterId:b(a.target).closest(".js_post-dropdown").data("starterid")});l.create(c.render().$el).open()},confirmDeletePost:function(){return window.confirm(f.prototype.t(mantle.messages.areYouSureToDelPost))},replyToPostInterceptor:function(a){return g.isLoggedIn()?this.replyToPost(a):(g.on("authenticated",c.bind(function(){g.isLoggedIn()&&this.$(".js_reply-to-post").trigger("click")},this)),i.trigger("loginRequired"),!1)},replyToPost:function(a){return j.device.can("EDIT_RICH_TEXT")||j.isOn("redactor")?(i.trigger("reply:openstarterform",{}),!1):(a.stopPropagation(),!0)},kinjaShare:function(a){var c,f,g=this,h=k.getKinjaMeta(),l=h.post?new e({id:h.post.id}):null;return a&&(c=b(a.currentTarget),c.parents(".js_tools").removeClass("show-dropdown"),c.parents(".js_toolsmenu").removeClass("active")),a&&a.preventDefault&&"function"==typeof a.preventDefault&&a.preventDefault(),l&&l.id&&l.get("sharedPostId")===this.model.get("id")?(this.kinjaSharePermalink(this.model),!1):(f=b.proxy(function(a){this.closeReplyForm(),this.services=new d.Container,this.services.registerMany({PostModel:{type:"class",dependency:e},eventDispatcher:{type:"singleton",dependency:i},feature:{type:"singleton",dependency:j},utils:{type:"singleton",dependency:k}}),b.when(this.openReplyForm(a,!1,"view/editor/Quickshare")).done(b.proxy(function(a){this.replyForm=a,a.render()},g))},this),this.model.has("original")?f(this.model):this.model.fetch({success:f,preview:"PUBLISHED"!==this.model.get("status")}),!1)},kinjaSharePermalink:function(a){window.location=a.get("permalink")+"?openreframe"},followUserForUser:function(a){return this.followReplyAction("follow","user",a),!1},unfollowUserForUser:function(a){return this.followReplyAction("unfollow","user",a),!1},followUserForBlog:function(a){return this.followReplyAction("follow","blog",a),!1},unfollowUserForBlog:function(a){return this.followReplyAction("unfollow","blog",a),!1},followReplyAction:function(a,c,d){var e=b(d.currentTarget),f=e.data("targetblogid");g.isLoggedIn()||i.trigger("loginRequired"),g.onLoggedIn.done(function(){var b="blog"===c?h.id:g.get("defaultBlogId");g.setBlogAction(a,b,f,{success:function(){g.trigger("change:updateFollow",f,a,c)},error:function(a){throw new Error("PostTools.followBlog(): "+a.reason)}})})},hasBlockRights:function(){return this.userIsAdmin()||this.userIsOwner()||this.userIsSuper()},blockBlog:function(a){function c(){var a=d.data("blocked");void 0===a&&(a=l.indexOf(j)>=0);var c=a?"unblock":"block";m.confirmBlockBlog(c,m.model.get("author").displayName,h.displayName)&&g.setBlogAction(c,e,f,{success:b.proxy(function(){d.data("blocked",!a),d.find("span").text(a?"Block for site":"Unblock for site"),m.model.remove(),m.render()},m),error:function(a){throw new Error("PostTools.blockBlog(): "+a.reason)}})}if(a.preventDefault(),this.hasBlockRights()){var d=b(a.currentTarget),e=d.data("blogid"),f=d.data("targetblogid");if(e!==f){var h=(g.get("defaultBlog").id,k.getKinjaMeta().blog),i=h.id,j=this.model.get("author").defaultBlogId,l=[],m=this;this.userIsSuper()?0===l.length&&b.when(b.ajax({url:"/apiproxy/blog/"+i,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){l=a.data.blockedBlogIds}})).then(function(){c()}):(l=g.get("defaultBlog").blockedBlogIds,c())}}},promoteModal:function(a){var b=this;a&&a.preventDefault&&"function"==typeof a.preventDefault&&a.preventDefault(),g.isLoggedIn()?(this.promoteTargetSelector=new m({model:this.model}),l.create(this.promoteTargetSelector.render().$el).bind("close",c.bind(this.removePromoteTargetSelector,this)).open()):(g.once("authenticated",function(){b.promoteModal()}),i.trigger("loginRequired",{source:"promotemodal"}))},removePromoteTargetSelector:function(){null!==this.promoteTargetSelector&&(this.promoteTargetSelector.off("remove",null,this),this.promoteTargetSelector=null)},displayRepostOptions:function(){if(this.$(".js_repost_progress, .js_repost, .js_undorepost, .js_repostdivider, .js_repostheader, .js_kinja-share").closest("li").remove(),!g.isLoggedIn())return!1;var a=function(){var a,b,d,e,f=[],h=[],i=[];c.each(this.model.get("actionState"),function(a,b){"repost"===a&&f.push(parseInt(b,10))}),b=g.get("defaultBlogId"),d=this.model.get("defaultBlogId"),g.get("membership").each(function(a){a.get("blogId")===b||"ENABLED"!==a.get("blog").status&&"SPAM"!==a.get("blog").status||(-1!==c.indexOf(f,a.get("blog").id)?i.push({name:a.get("blog").displayName,id:a.get("blog").id}):h.push({name:a.get("blog").displayName,id:a.get("blog").id}))},this),e={personalBlogId:b,repostedToPersonal:-1!==c.indexOf(f,b)?!0:!1,currentPostDefaultBlogId:d,kinjaShare:!1,blogsRepost:h,blogsUndo:i},j.isOn("replywithshare")&&(e.kinjaShare=!0),b!==d&&(e.personalBlogId=b),a=b===d&&g.get("membership").length<=1&&!j.isOn("replywithshare")?"":this.soyToHtml(tiger.components.post.button.repostblockwrapped,e),this.$(".js_post-dropdown").prepend(a)};this.model.has("actionState")?a.call(this):this.model.getPostInfo({success:b.proxy(a,this)})},repostPost:function(a){if(!g.isLoggedIn())throw new Error("PostTools.repostPost(): User not logged in!");a.preventDefault();var c=b(a.currentTarget).data("blogid"),d="repost",e=this,f=g.get("membership").find(function(a){return a.get("blogId")===parseInt(c,10)});this.model.setAction(d,c,{success:function(){var a=e.soyToHtml(mantle.messages.postReposted,{blogName:f.get("blog").displayName,blogUrl:"http://"+f.get("blog").canonicalHost});e.displayPostMessage(a,3e3)},error:function(a){throw new Error("PostTools.repostPost(): "+a.reason)}})},undoRepost:function(a){if(!g.isLoggedIn())throw new Error("PostTools.undoRepost(): User not logged in!");a.preventDefault();var c=b(a.currentTarget).data("blogid"),d="actionreset",e=this;this.model.setAction(d,c,{success:function(){e.displayPostMessage(e.t(mantle.messages.repostRemoved),3e3)},error:function(a){throw new Error("PostTools.undoRepost(): "+a.reason)}})},displayPostMessage:function(a,b){return i.trigger("successbox:display",{message:a,timeout:b}),!0},displayAdminOptions:function(){var a,d,e,f=this.$el.find(".js_tools"),i=this,j=!1,k=this.model.get("defaultBlogId")===this.model.get("authorBlogId"),l=h.id===g.get("defaultBlogId"),m=g.get("membership").getBlog(this.model.get("defaultBlogId")),n=!1;return f.find(".js_admindivider, .js_adminitem").remove(),this.trigger("adminmenu:remove",{}),g.isLoggedIn()?(e=function(a,c){j||(j=!0,f.find("li:visible").length>0&&f.append('<li class="js_admindivider divider"></li>'));var d="js_adminitem";void 0!==c&&(d=d+" "+c),f.append(b('<li class="'+d+'" />').append(a)),n=!0},a=function(){!i.userIsAuthor()&&!g.hasSuperuserTools()||void 0===m||k||e(i.soyToHtml(mantle.components.post.button.followblog,{followed:-1!==c.indexOf(m.followedBlogIds,i.model.get("authorBlogId")),blogId:i.model.get("defaultBlogId"),targetBlogId:i.model.get("authorBlogId"),blogName:m.displayName})),!(i.userIsOwner()||i.userIsAdmin()||g.hasSuperuserTools())||void 0===m||k||l||e(i.soyToHtml(mantle.components.post.button.blockblog,{blocked:-1!==c.indexOf(m.blockedBlogIds,i.model.get("authorBlogId")),blogId:i.model.get("defaultBlogId"),targetBlogId:i.model.get("authorBlogId"),blogName:m.displayName}))},d=function(){var a,b=f.closest(".js_toolsmenu").data("dismiss");i.canDismissPost()&&b!==!1&&(a=c.any(i.model.get("actionState"),function(a){return"dismiss"===a}),e(i.soyToHtml(mantle.components.post.button.dismiss,{dismissed:a})))},!this.model.get("isStarter")&&(this.userIsOwner()||this.userIsAdmin()||this.userIsAuthor()||g.hasSuperuserTools())&&void 0!==m&&(e(this.soyToHtml(mantle.messages.followForSite,{currentBlog:m.displayName,authorName:this.model.get("author").displayName}),"no-hover phm text-small font-normal text-left"),f.append('<li class="js_admindivider divider"></li>')),this.$el.find(".js_toolsmenu").data("usertools")!==!0&&(g.hasSuperuserTools()&&void 0===m?(m=this.model.get("blogs").filter(function(a){return a.id===i.model.get("defaultBlogId")})[0],b.ajax({url:"/apiproxy/blog/byhost/"+m.canonicalHost,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(b){void 0!==b.meta&&b.meta.success===!0&&(m.followedBlogIds=b.data.followedBlogIds,m.blockedBlogIds=b.data.blockedBlogIds,a())}})):a(),this.model.has("actionState")?d():this.model.getPostInfo({success:d})),g.hasSuperuserTools()&&e(this.soyToHtml(mantle.components.post.button.hidepost)),this.canPromote()&&e(this.soyToHtml(mantle.components.post.button.promote)),n):!1},displayExternalDismissOptions:function(){if(g.isLoggedIn()&&"permalink"===this.getPageType()&&this.canDismissPost()){var a,c=parseInt(k.getKinjaMeta().postId||0,10),d=parseInt(k.getKinjaMeta().starterId||0,10);c!==d&&c===this.model.id?(a=b.proxy(function(){var a="dismiss"===this.model.get("actionState")[h.id]?".js_external_undismiss":".js_external_dismiss";this.$el.find(a).removeClass("hide")},this),this.model.has("actionState")?a():this.model.getPostInfo({success:a})):this.$el.find(".js_external_dismiss").toggleClass("hide",!this.canDismissPost())}},canEditPost:function(){var a=15,b=function(b){var c=new Date(b+60*a*1e3),d=new Date;return c>d},c=g.id===this.model.get("authorId"),d=g.hasRole("OWNER",this.model.get("defaultBlogId")),e=g.hasRole("ADMIN",this.model.get("defaultBlogId")),f=this.model.has("parentId"),h=(c||d||e)&&!f,i=f&&c&&b(this.model.get("publishTimeMillis"));return g.hasSuperuserTools()||h||i},canDeletePost:function(){var a=g.id===this.model.get("authorId"),b=g.hasRole("OWNER",this.model.get("defaultBlogId")),c=g.hasRole("ADMIN",this.model.get("defaultBlogId")),d=this.model.has("parentId"),e=(a||b||c)&&!d;return g.hasSuperuserTools()||e},canInviteToPost:function(){var a=this.model.attributes.authorId===g.id;return j.isOn("invite")&&g.hasRemote("twitter")&&a},canPromote:function(){return g.hasPermission("SALES")||g.hasSuperuserTools()||g.hasGMGRole("ADMIN")},canDismissPost:function(){var a=g.hasRole("ADMIN",h.id)||g.hasRole("ADMIN",this.model.get("defaultBlogId")),b=g.id===this.model.get("authorId"),c=g.id===this.model.get("parentAuthorId"),d=this.model.has("parentId");return g.hasSuperuserTools()||d&&!b&&(a||c)},canSharePost:function(){return g.isLoggedIn()},userIsAuthor:function(){return g.hasRole("AUTHOR",this.model.get("defaultBlogId"))&&g.id!==this.model.get("authorId")},userIsOwner:function(){return g.hasRole("OWNER",this.model.get("defaultBlogId"))&&g.id!==this.model.get("authorId")},userIsAdmin:function(){return g.hasRole("ADMIN",this.model.get("defaultBlogId"))&&g.id!==this.model.get("authorId")},userIsSuper:function(){return g.hasSuperuserTools()},adminMenuVisible:function(){var a=this.$el.find(".js_toolsmenu");return g.isLoggedIn()&&(g.hasSuperuserTools()||g.hasPermission("SALES")||this.canDismissPost()&&a.data("dismiss")!==!1||this.userIsAuthor()||this.canEditPost()||this.canSharePost())},render:function(){var a=this.$el.find(".js_toolsmenu");return this.$el.find(".js_external_dismiss, .js_external_undismiss").addClass("hide"),g.onAuth.always(b.proxy(function(){var b=this.adminMenuVisible()||a.data("usertools")===!0;a.toggleClass("hide",!b),this.$el.find(".js_meta-score").toggleClass("hide",!g.hasSuperuserTools()),this.$el.find(".js_edit-post").toggleClass("hide",!this.canEditPost()),this.$el.find(".js_delete-post").toggleClass("hide",!this.canDeletePost()),this.$el.find(".js_invite-to-post").toggleClass("hide",!this.canInviteToPost()),this.displayExternalDismissOptions();var c="permalink"===this.getPageType()&&this.model.get("liveBlog")===!0&&this.model.get("isStarter")===!0;c&&this.$el.find(".js_reply-to-post").toggleClass("hide",!g.hasRole("AUTHOR",h.id)),g.hasSuperuserTools()&&this.$(".js_hide-post").removeClass("hide"),this.hasBlockRights()&&this.$(".js_block").removeClass("hide")},this)),g.on("authenticated",function(){var a=this.canPromote(),b=this.canEditPost(),c=this.canDeletePost(),d=this.canInviteToPost(),e=this.canDismissPost(),f=g.hasSuperuserTools(),h="permalink"===this.getPageType(),i=f||b||a||e;this.$(".js_edit-post").toggleClass("hide",!b),this.$(".js_delete-post").toggleClass("hide",!c),this.$(".js_invite-to-post").toggleClass("hide",!d),this.$(".js_promote").toggleClass("hide",!a),this.$(".meta-container").toggleClass("wo-dd",!h&&!i)},this),this.$(".post-dropdown-ct .f-dropdown").off("opened").on("opened",b.proxy(function(){g.onAuth.always(b.proxy(function(){(this.model.get("parentId")||this.model.get("sharedPostId"))&&this.displayRepostOptions()
},this))},this)),this.renderLikeButton(),j.isOn("replywithshare")&&b(".js_kinja-share-wrapper").removeClass("hide"),"permalink"===this.getPageType()&&p(this.$el),this},renderLikeButton:function(){this.$(".js_recommend-icon").toggleClass("active",this.model.get("liked")),this.$(".js_like_icon").toggleClass("active",this.model.get("liked"))},fillShareData:function(a){var d=function(a){return b("<div/>").html(a).text()},e=b(a.currentTarget),f=this.$el.find(".js_post-dropdown"),g=void 0!==f.data("imagetag")?f.data("imagetag")+f.data("description"):f.data("description"),h=e.attr("href").replace("POST_TITLE",encodeURIComponent(d(f.data("title")))).replace("POST_DESCRIPTION",g),i={twitter:"toolbar=0,status=0,width=480,height=360",facebook:"toolbar=0,status=0,width=480,height=360",tumblr:"toolbar=0,status=0,width=450,height=430"},j=c.intersection(e.attr("class").split(/\s+/),["twitter","facebook","tumblr"])[0];return window.open(h,"share"+j,i[j]),!1},getEditorMode:function(){var a="default";return a=this.model.get("parentId")?"quickreply":"quickpost"},loadEditorPackage:function(a){var c=b.Deferred();switch(a){case"simple":c.reject();break;case"quickreply":k.requireModule("module/NewEditor",function(){require(["view/editor/Quickreply"],c.resolve)});break;default:k.requireModule("module/NewEditor",function(){require(["view/editor/Quickpost"],c.resolve)})}return c.promise()},remove:function(){g.off(null,null,this),i.off(null,null,this),this.model.off(null,null,this),f.prototype.remove.call(this)},updateFollowDropdown:function(a,c,d){var e=b('.js_post-dropdown[data-blogid="'+a+'"]');"user"===d?e.find(".js_followblog, .js_followforuser").toggleClass("hide","follow"===c).end().find(".js_unfollowblog, .js_unfollowforuser").toggleClass("hide","unfollow"===c):e.find(".js_followforblog").toggleClass("hide","follow"===c).end().find(".js_unfollowforblog").toggleClass("hide","unfollow"===c)}}));return q}),tiger.components.post.inset.referencedWideLSMock=function(a,b,c){var d=b||new soy.StringBuilder,e=a.insets.length>1,f=a.insets.length>2;d.append('<aside class="referenced-wide referenced-wide-ls referenced-editor proxima',f?" referenced-carousel":"",'" contentEditable="false"><div class="row">'),f&&tiger.components.post.inset.referenceNavigation(null,d,c);for(var g=a.insets,h=g.length,i=0;h>i;i++){var j=g[i];d.append('<div class="referenced-item referenced-editor-item columns',e?" medium-6":"",i>1?" hide":"",'" data-uid="',soy.$$escapeHtml(j.uid),'"><a href="javascript:;" class="js_skip-inset close" aria-hidden="true">&times;</a>',j.thumbnails.length>0?'<div class="'+(e?"small-6":"small-3")+' columns pln referenced-item-image"><a href="'+soy.$$escapeHtml(j.url)+'"><span class="img-border"><img src="'+soy.$$escapeHtml(j.thumbnails[0])+'" /></span></a></div>':"",j.headline?'<h6 class="headline"><a href="'+soy.$$escapeHtml(j.url)+'">'+soy.$$filterNoAutoescape(j.headline)+"</a></h6>":"",j.description?'<p class="text">'+soy.$$filterNoAutoescape(soy.$$truncate(j.description,90,!0))+' <a href="'+soy.$$escapeHtml(j.url)+'">Read…</p>':"","</div>")}return d.append("</div></aside>"),b?"":d.toString()},tiger.components.post.inset.referenceNavigation=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="referenced-nav hide-for-small"><div class="nav-arrow prev js_previous_inset hide"><a href="#" class="icon inline notranslate" onclick="javascript:return false;">3</a></div><div class="nav-arrow next js_next_inset"><a href="#" class="icon inline notranslate" onclick="javascript:return false;">4</a></div></div>'),b?"":c.toString()},define("templates/tiger/components/post/inset/referenced-permalink",function(){}),define("view/items/InsetTools",["lib/underscore","lib/jquery","view/BaseView","templates/tiger/components/post/inset/referenced-permalink"],function(a,b,c){var d=c.extend({initialize:function(){this.render()},render:function(){var a=this,c=this.$(".js_inset-groups aside");c.each(function(c,d){var e=b(d),f=e.data("ids");a.hideEmptyThumbnails(e),a.$("#inset_placeholder_"+f).replaceWith(e)}),this.initEvents()},initEvents:function(){this.$(".js_next_inset").off("click.inset").on("click.inset",b.proxy(function(a){this.changeInset(a,"next")},this)),this.$(".js_previous_inset").off("click.inset").on("click.inset",b.proxy(function(a){this.changeInset(a,"prev")},this))},changeInset:function(a,c){var d,e,f,g,h,i,j=b(a.target).closest(".referenced-wide"),k=j.find(".referenced-item:not(.hide)");return d=function(a){a.fadeIn(200,function(){b(this).removeClass("hide")})},e=function(a){a.fadeOut(200,function(){b(this).addClass("hide")})},f=function(){h=k.last().nextAll(".referenced-item:lt(2)"),i=k.slice(0,h.length),j.find(".js_previous_inset").removeClass("hide"),k.nextAll(".referenced-item").length<=2&&j.find(".js_next_inset").addClass("hide")},g=function(){h=k.first().prevAll(".referenced-item:lt(2)"),i=k.slice(-1*h.length),j.find(".js_next_inset").removeClass("hide"),k.prevAll(".referenced-item").length<=2&&j.find(".js_previous_inset").addClass("hide")},"next"===c?f():g(),h.length>0&&i.length>0&&(d(h),e(i)),!1},hideEmptyThumbnails:function(a){var c=a.find(".referenced-item");c.each(function(a,c){var d=b(c).find("img"),e=d.clone(),f=d.closest(".six");f.addClass("hide"),e.load(function(){f.removeClass("hide"),e.remove()}),e.removeClass().appendTo("body")})},removeInsetGroup:function(b){a.each(b,function(a){var b=a.$parent,c=a.$insetGroup;b&&b.data("insets",[]),c&&c.remove()})},renderFromObject:function(c){var d,e,f,g=[];return d=function(b){return a.find(g,function(a){return a.$parent.is(b)})},e=function(a){g.push({$parent:a,insets:[]})},f=function(a){var b=d(a.$parent);b&&b.insets.push(a)},a.each(c,function(a){d(a.$parent)||e(a.$parent),f(a)}),a.each(g,function(c){var d;d=this.soyToHtml(tiger.components.post.inset.referencedWideLSMock,{insets:a.pluck(c.insets,"data")}),c.$parent.next(".referenced-wide").remove(),d=b(d).insertAfter(c.$parent),c.$parent.data("$inset",d),a.each(c.insets,function(a){a.$insetGroup=d})},this),g},removeEmptySibling:function(a,b){var c=a[b](),d=c.text();(!d||""===d||1===d.length&&/[^u\200B]/.test(d))&&c.remove()}});return d}),mantle.components.post.postTools=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div class="columns twelve mobile-four post-bottom">',"permalink"==(null==c.meta?null:c.meta.pageType)?'<a name="replies"></a>':"",'<div class="post-tools-wrapper" data-forpost="',soy.$$escapeHtml(a.post.id),'"><div class="js_message post-action-message inline mrm text-tiny proxima"></div><div class="post-tools inline">'),mantle.components.post.button.postTools(a,d,c),d.append('</div></div><div class="fb-like fb-like-bottom" data-href="',soy.$$escapeHtml(a.post.permalink),'" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false"></div></div>'),b?"":d.toString()},mantle.components.post.postToolsNg=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div class="post-tools-wrapper-ng" data-forpost="',soy.$$escapeHtml(a.post.id),'"><div class="js_message post-action-message inline mrm text-tiny proxima"></div><div class="post-tools inline lineheight-base">'),mantle.components.post.button.postToolsNG(a,d,c),d.append("</div></div>"),b?"":d.toString()},define("templates/mantle/components/post",function(){}),mantle.components.post.item=function(a,b,c){var d=b||new soy.StringBuilder,e=new soy.StringBuilder("DRAFT"==a.post.status?"status-draft":"SCHEDULED"==a.post.status?"status-scheduled":"status-published");if(e=e.toString(),a.post.isPromoted);var f=new soy.StringBuilder(soy.$$escapeHtml(a.post.isBillboardPost&&a.post.showByline&&""!=a.post.byline?" billboard":""),soy.$$escapeHtml("true"==a.compactView?" post-collapsed":""),soy.$$escapeHtml(a.meta&&"permalink"!=a.meta.pageType&&!a.post.aboveHeadline?" wide":""),soy.$$escapeHtml(a.sharingPost?" shared":""),soy.$$escapeHtml("permalink"!=a.meta.pageType?" postlist-dense":""),soy.$$escapeHtml(a.post.isPromoted?" js_promoted hide":""),soy.$$escapeHtml("true"==a.stream?" stream":""));return f=f.toString(),a.post.ads&&a.post.ads.ad16x9&&mantle.components.ad.ad16x9({slot:a.post.ads.ad16x9,post:a.post},d,c),d.append(0==a.index&&c.features.asset_970x90?'<div class="row"><div class="twelve columns"><div class="custom-asset asset-970"><img src="http://placehold.it/970x90" border="0" alt="" /></div></div></div>':"",0==a.index&&a.meta.blog&&"vilag"==a.meta.blog.name?'<div class="row hide-for-small"><div class="twelve columns"><div class="custom-asset asset-970"><img src="'+soy.$$escapeHtml(c.meta.assets.images)+'ads/vilagegyetem-970x90.png" border="0" alt="" /></div></div></div>':""),a.index&&0!=a.index||(mantle.section.header.iemessage(a,d,c),d.append("frontpage"!=c.meta.pageType&&"permalink"!=c.meta.pageType&&"tag"!=c.meta.pageType||"true"==a.stream?"":'<div id="editorplaceholder" class="editorplaceholder"></div>')),a.post.ads&&a.post.ads.ad320x50&&mantle.components.ad.ad320x50({slot:a.post.ads.ad320x50,post:a.post},d,c),d.append('<div class="post-wrapper js_post-wrapper ',soy.$$escapeHtml(f),'" ',a.post.isPromoted?"data-postIdWrapper='"+soy.$$escapeHtml(a.post.id)+"' data-promotionData=\""+soy.$$escapeHtml(a.post.promotionJson)+'" data-adZone="'+soy.$$escapeHtml(a.post.adZone)+'" data-headline="'+soy.$$escapeHtml(a.post.headline)+'" data-tagUrlNames="'+soy.$$escapeHtml(a.post.tagUrlNames)+'"':""," >"),mantle.components.post.article(soy.$$augmentMap(a,{postStatus:e}),d,c),d.append("</div>"),a.post.ads&&a.post.ads.ad1x1&&a.post.sponsored&&mantle.components.ad.ad1x1({slot:a.post.ads.ad1x1,post:a.post},d,c),b?"":d.toString()},mantle.components.post.article=function(a,b,c){var d=b||new soy.StringBuilder,e=new soy.StringBuilder("row post hentry js_post_item ",soy.$$escapeHtml(a.postStatus),"permalink"==c.meta.pageType&&a.post.isStarter&&a.post.replyCount&&a.post.replyCount>0&&"true"!=a.compactView?" commented":"",a.post.isPromoted?" js_promoted":"","permalink"==c.meta.pageType?" js_amazon_module":"",1==a.post.isRecommended?" marquee-post":"");e=e.toString();var f=a.post&&a.post.postAction&&"REPOST"==a.post.postAction.relation;return a.sharingPost&&mantle.components.post.type.sharedFrame(soy.$$augmentMap(a,{post:a.sharingPost,sharedPost:a.post,postStatus:a.postStatus}),d,c),d.append('<article class="',soy.$$escapeHtml(e),'" data-id="',soy.$$escapeHtml(a.post.id),'" id="post_',soy.$$escapeHtml(a.post.id),'"',a.post.jsModelJson?' data-model="'+soy.$$escapeUri(a.post.jsModelJson)+'"':"",">"),"permalink"==c.meta.pageType&&"true"!=a.stream?(mantle.components.post.type.permalink(a,d,c),mantle.components.post.postTools(a,d,c)):"true"==a.compactView?(mantle.components.post.type.compact(a,d,c),mantle.components.post.postToolsNg(a,d,c)):"private"==c.meta.pageType?mantle.components.post.type.standard(a,d,c):a.post.isRecommended||a.post.aboveHeadline?a.post.aboveHeadline&&!f?mantle.components.post.type.marqueePackage(a,d,c):mantle.components.post.type.standardPackage(soy.$$augmentMap(a,{allowBannerHeadlines:"true"}),d,c):mantle.components.post.type.standardPackage(soy.$$augmentMap(a,{allowBannerHeadlines:"true"}),d,c),d.append("</article>"),b?"":d.toString()},define("templates/mantle/components/post/list-item",function(){}),mantle.components.ad.ad16x9=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div id="foreplay" class="row reveal-modal js_foreplay foreplay proxima" style="visibility:hidden;"><div id="jwPlayerVideo"></div><a href="#" class="close js_foreplay-close">In 5 seconds, click here to continue reading...</a>'),mantle.components.ad.zone(soy.$$augmentMap(a,{width:16,height:9,slot:a.slot,screen:"desktop",zoneClass:"Zone_16x9"}),d,c),d.append("</div>"),b?"":d.toString()},define("templates/mantle/components/ad/ad16x9",function(){}),mantle.components.ad.ad320x50=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('<div class="row"><div class="column ad-top-mobile">'),mantle.components.ad.zone(soy.$$augmentMap(a,{width:320,height:50,slot:a.slot,screen:"mobile",isScrollTriggered:!0,zoneClass:"Zone_320x50"}),d,c),d.append("</div></div>"),b?"":d.toString()},define("templates/mantle/components/ad/ad320x50",function(){}),mantle.components.ad.ad970x250=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),mantle.components.ad.zone(soy.$$augmentMap(a,{width:970,height:250,slot:a.slot,screen:"desktop",zoneClass:"Zone_970x250",isScrollTriggered:!0}),d,c),b?"":d.toString()},define("templates/mantle/components/ad/ad970x250",function(){}),mantle.components.ad.ad1x1=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),mantle.components.ad.zone(soy.$$augmentMap(a,{width:1,height:1,slot:a.slot}),d,c),b?"":d.toString()},define("templates/mantle/components/ad/ad1x1",function(){}),mantle.components.ad.zonehelper=function(a,b){var c=b||new soy.StringBuilder;return c.append('<div class="ad-unit ad-',soy.$$escapeHtml(a.width),"x",soy.$$escapeHtml(a.height)," ",soy.$$escapeHtml(a.slot)," ",soy.$$escapeHtml(a.screen),'" data-cb-ad-id="ad_',soy.$$escapeHtml(a.width),"x",soy.$$escapeHtml(a.height),"_",soy.$$escapeHtml(a.slot),'"><div class="ad-container" style="display: none;" id="ad-container-',soy.$$escapeHtml(a.random),'" data-size="',soy.$$escapeHtml(a.width),"x",soy.$$escapeHtml(a.height),'" data-random="',soy.$$escapeHtml(a.random),'" data-slot="',soy.$$escapeHtml(a.slot),'" data-zone-class="',soy.$$escapeHtml(a.zoneClass),'" data-is-scroll-triggered="',soy.$$escapeHtml(a.isScrollTriggered),'" data-dfp-sz="',soy.$$escapeHtml(a.dfpSz),'"',a.post?' data-post-id="'+soy.$$escapeHtml(a.post.id)+'" data-post-headline="'+(a.post.headline?soy.$$escapeHtml(a.post.headline):"")+'"'+(a.post.adZone?' data-forced-ad-zone="'+soy.$$escapeHtml(a.post.adZone)+'"':"")+' data-tags="'+(a.post.tagUrlNames?soy.$$escapeHtml(a.post.tagUrlNames):"")+'"':"","></div></div>"),b?"":c.toString()},mantle.components.ad.zone=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),mantle.components.ad.zonehelper(soy.$$augmentMap(a,{random:Math.floor(89999999*Math.random())+1e7,slot:a.slot?a.slot:"default",screen:a.screen?a.screen:"",zoneClass:soy.$$escapeHtml(a.zoneClass?a.zoneClass:"Zone"),isScrollTriggered:soy.$$escapeHtml(a.isScrollTriggered?a.isScrollTriggered:!1),dfpSz:soy.$$escapeHtml(a.dfpSz?a.dfpSz:a.width+"x"+a.height)}),d,c),b?"":d.toString()},define("templates/mantle/components/ad/zone",function(){}),mantle.components.post.type.compact=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<div class="two columns condensed-left">'),mantle.components.post.meta.meta(a,d,c),d.append('</div><div class="eight columns">'),a.post.isPromoted){var e=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");e=e.toString(),d.append('<div class="row"><div class="twelve columns post-promoted-description proxima mbs"><span class="icon inline notranslate mrs">B</span><span class="js_promoted_displayName">',soy.$$filterNoAutoescape(e),"</span> promoted this post</div></div>")}if(d.append('<div class="row post-content compact-content">'),a.post.compactThumb){if(d.append('<div class="three mobile-one columns">'),"image"==a.post.compactThumb.type){var f=new soy.StringBuilder("k-small");f=f.toString(),d.append('<div class="img-border"><img src="',soy.$$escapeHtml(window.kinja.imageUrl(a.post.compactThumb.id,f,a.post.compactThumb.format)),'" width="',soy.$$escapeHtml(a.post.compactThumb.width),'" height="',soy.$$escapeHtml(a.post.compactThumb.height),'" onError="this.onerror=null;this.src=\'',soy.$$escapeJsString(a.post.compactThumb.hotlink),"';\"/></div>")}else d.append(soy.$$filterNoAutoescape(a.post.compactThumb.embed));d.append('</div><div class="nine mobile-three columns">')}return d.append(a.post.headline?'<h6 class="headline mvn"><a href="'+soy.$$escapeHtml(a.post.permalink)+'" '+(a.post.tags&&0!=a.showTags?'class="mrs"':"")+' data-id="">'+soy.$$filterNoAutoescape(a.post.headline)+"</a>"+(0!=a.showTags&&a.post.tags[0]?'<a class="mrs '+soy.$$escapeHtml(a.tagClasses?a.tagClasses:"tag text-upper text-small")+'" href="/tag/'+soy.$$escapeHtml(a.post.tags[0].urlName)+'">'+soy.$$escapeHtml(a.post.tags[0].desc)+"</a>":"")+"</h6>":'<p class="mbn"><a href="'+soy.$$escapeHtml(a.post.permalink)+'" '+(a.post.tags&&0!=a.showTags?'class="mrs"':"")+' data-id="">'+soy.$$filterNoAutoescape(a.post.compact)+"</a>"+(0!=a.showTags&&a.post.tags[0]?'<a class="mrs '+soy.$$escapeHtml(a.tagClasses?a.tagClasses:"tag text-upper text-small")+'" href="/tag/'+soy.$$escapeHtml(a.post.tags[0].urlName)+'">'+soy.$$escapeHtml(a.post.tags[0].desc)+"</a>":"")+"</p>",a.post.compactThumb?"</div>":"","</div></div>"),b?"":d.toString()},define("templates/mantle/components/post/type/compact",function(){}),mantle.components.post.type.standard=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append(a.post.leftOfHeadline&&a.post.leftOfHeadline.type&&0==a.post.isBillboardPost?'<div class="with-media">':"",'<div class="two columns hide-for-small meta-ng">'),a.post.tags&&a.post.tags[0]&&mantle.components.post.header.tag({tag:a.post.tags[0],tagClasses:"mbs tag text-upper text-small"},d,c),mantle.components.post.meta.meta(a,d,c),d.append("</div>"),(a.post.headline||a.post.tags[0])&&mantle.components.post.header.standard({headline:a.post.shortHeadline?a.post.shortHeadline:"",headlineClasses:"twelve columns show-for-small",post:a.post},d,c),d.append(a.post.leftOfHeadline&&a.post.leftOfHeadline.type&&0==a.post.isBillboardPost?'<div class="columns four main-media">'+("image"==a.post.leftOfHeadline.type?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+'><span class="img-border"><img src="'+soy.$$escapeHtml(a.post.leftOfHeadline.src)+'" onError="this.onerror=null;this.src=\''+soy.$$escapeJsString(a.post.leftOfHeadline.hotlink)+"';\"/></span></a>":soy.$$filterNoAutoescape(a.post.leftOfHeadline.embed))+"</div>":"",'<div class="',soy.$$escapeHtml(a.post.leftOfHeadline&&a.post.leftOfHeadline.type||a.post.isBillboardPost?"six":"ten"),' columns end"><div class="text-container"><div class="row">'),a.post.isPromoted){var e=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");e=e.toString(),d.append('<div class="twelve columns post-promoted-description proxima mbm"><span class="icon inline notranslate mrs">B</span><span class="js_promoted_displayName">',soy.$$filterNoAutoescape(e),"</span> promoted this post</div>")}return(a.post.shortHeadline||a.post.tags[0])&&mantle.components.post.header.standard({headline:a.post.shortHeadline?a.post.shortHeadline:"",headlineClasses:"twelve columns hide-for-small",post:a.post,headerLevel:6},d,c),d.append('<div class="twelve columns show-for-small">'),a.post.tags&&a.post.tags[0]&&mantle.components.post.header.tag({tag:a.post.tags[0],tagClasses:"mbs tag text-upper text-small"},d,c),mantle.components.post.meta.meta(a,d,c),d.append('</div></div><div class="row post-content">',a.excerptOnly?(a.post.annotation&&"TEXT"==a.post.annotation.annotationType?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+soy.$$filterNoAutoescape(a.post.annotation.annotationText)+"</blockquote>":"")+soy.$$filterNoAutoescape(a.post.shortExcerpt):(a.post.annotation&&"TEXT"==a.post.annotation.annotationType?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+soy.$$filterNoAutoescape(a.post.annotation.annotationText)+"</blockquote>":"")+soy.$$filterNoAutoescape(a.post.display),a.post.isStarter||!a.post.starter||a.post.shared?"":'<div class="post-source mobile-four clear-both em">'+(""!=a.post.starter.headline||""!=a.post.starter.plaintext?'<span class="proxima">From&nbsp;<a href="'+soy.$$escapeHtml(a.post.starter.permalink)+'" class="strong">'+(a.post.starter.headline?soy.$$filterNoAutoescape(a.post.starter.headline):soy.$$filterNoAutoescape(a.post.starter.plaintext))+"</a></span>":"")+"</div>","</div>"),(!a.post.isBlip||a.post.isBillboardPost)&&mantle.components.post.postToolsNg(a,d,c),d.append("</div></div>",a.post.leftOfHeadline&&a.post.leftOfHeadline.type&&0==a.post.isBillboardPost?"</div>":""),b?"":d.toString()},define("templates/mantle/components/post/type/standard",function(){}),mantle.components.post.type.standardPackage=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="twelve columns frontpage-item">'),c.meta.fullTags&&a.post.ads&&a.post.ads.ad970x90&&mantle.section.header.tagpage({tag:c.meta.fullTags},d,c),d.append('<div class="row">'),mantle.components.post.type.packageContent(a,d,c),d.append("</div></div>"),b?"":d.toString()},mantle.components.post.type.packageContent=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}e=e.toString();var j=a.post.meta&&a.post.meta.typ&&"LIKE"==a.post.meta.typ,k=a.post.meta&&a.post.meta.typ&&"POSTACTION"==a.post.meta.typ;return a.post.isStarter||!a.post.starter||a.post.shared||j?j?c.features.feedtemplates?mantle.components.post.type.packageRecommendedAlternative(a,d,c):mantle.components.post.type.compactPackageRecommended(a,d,c):(d.append('<div class="twelve columns package-wrapper ',a.post.isRecommended||a.post.isPromoted?"recommended-post":"",'">'),mantle.components.post.meta.topMeta(a,d,c),d.append('<div class="row">'),(a.post.shortHeadline||a.post.tags[0])&&(a.post.isRecommended?mantle.components.post.header.standard({headline:a.post.shortHeadline?a.post.shortHeadline:"",headlineClasses:"twelve columns mbm",post:a.post,headerLevel:1},d,c):mantle.components.post.header.standard({headline:a.post.shortHeadline?a.post.shortHeadline:"",headlineClasses:"twelve columns mbm",post:a.post,headerLevel:5},d,c)),mantle.components.post.type.blip(a,d,c),a.post.latestInsets.length&&(d.append('<span class="hide-for-small">'),mantle.components.post.inset.packageReferenced({insets:a.post.packageInsets},d,c),d.append("</span>")),d.append("</div></div>")):k?c.features.feedtemplates?mantle.components.post.type.compactPackageAlternative(a,d,c):(d.append('<div class="twelve columns">'),mantle.components.post.meta.sharedReplyMeta({post:a.post,canonicalHost:e},d,c),d.append("</div>"),mantle.components.post.type.blip(a,d,c)):c.features.feedtemplates?mantle.components.post.type.compactPackageAlternative(a,d,c):mantle.components.post.type.compactPackage(a,d,c),b?"":d.toString()},mantle.components.post.type.blip=function(a,b){var c=b||new soy.StringBuilder,d=new soy.StringBuilder(0==a.post.packageInsets.length?"twelve":1==a.post.packageInsets.length?"nine":2==a.post.packageInsets.length?"six":"");return d=d.toString(),c.append('<div class="',soy.$$escapeHtml(d),' columns item-content hover-highlight">',a.post.leftOfHeadline&&a.post.leftOfHeadline.type&&0==a.post.isBillboardPost?'<div class="main-media">'+("image"==a.post.leftOfHeadline.type?'<a href="'+soy.$$escapeHtml(a.post.permalink)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+'><span class="img-border"><img src="'+soy.$$escapeHtml(a.post.leftOfHeadline.src)+'" width="132" height="74" onError="this.onerror=null;this.src=\''+soy.$$escapeJsString(a.post.leftOfHeadline.hotlink)+"';\"/></span></a>":soy.$$filterNoAutoescape(a.post.leftOfHeadline.embed))+"</div>":"",a.post.display?a.excerptOnly?soy.$$filterNoAutoescape(a.post.shortExcerpt):(a.post.annotation&&"TEXT"==a.post.annotation.annotationType?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+soy.$$filterNoAutoescape(a.post.annotation.annotationText)+"</blockquote>":"")+soy.$$filterNoAutoescape(a.post.display):"","</div>"),b?"":c.toString()},define("templates/mantle/components/post/type/standard-package",function(){}),mantle.components.post.type.marqueePackage=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder(0==a.post.packageInsets.length||4==a.post.marqueePackageInsets.length?"twelve":1==a.post.packageInsets.length?"nine":2==a.post.packageInsets.length?"six":"");return e=e.toString(),d.append('<div class="twelve columns package-wrapper marquee-post frontpage-item ',a.post.isRecommended||a.post.isPromoted?"recommended-post":"",'">'),c.meta.fullTags&&a.post.ads&&a.post.ads.ad970x90&&mantle.section.header.tagpage({tag:c.meta.fullTags},d,c),mantle.components.post.meta.topMeta(a,d,c),a.post.isRecommended?mantle.components.post.header.standard({headline:a.post.shortHeadline?a.post.shortHeadline:"",headlineClasses:"mtn mbm",post:a.post,headerLevel:1},d,c):mantle.components.post.header.standard({headline:a.post.shortHeadline?a.post.shortHeadline:"",headlineClasses:"mtn mbm",post:a.post,headerLevel:5},d,c),d.append('<div class="row">',a.post.aboveHeadline?'<div class="twelve columns"><div class="hover-highlight marquee-wrapper"><a href="'+soy.$$escapeHtml(a.post.permalink)+'">'+("image"==a.post.aboveHeadline.type?'<span class="img-border"><img class="marquee" src="'+soy.$$escapeHtml(a.post.aboveHeadline.src)+'" width="'+soy.$$escapeHtml(a.post.aboveHeadline.width)+'" height="'+soy.$$escapeHtml(a.post.aboveHeadline.height)+'" onError="this.onerror=null;this.src=\''+soy.$$escapeJsString(a.post.aboveHeadline.hotlink)+'\';" alt="'+soy.$$escapeHtml(a.post.headline)+'" /></span>':soy.$$filterNoAutoescape(a.post.aboveHeadline.embed))+"</a></div></div>":"",'<div class="',soy.$$escapeHtml(e),' columns item-content hover-highlight">',soy.$$filterNoAutoescape(a.post.excerpt),"</div>"),a.post.latestInsets.length&&a.post.marqueePackageInsets.length<4&&(d.append('<span class="hide-for-small">'),mantle.components.post.inset.packageReferenced({insets:a.post.packageInsets},d,c),d.append("</span>")),4==a.post.marqueePackageInsets.length&&(d.append('<div class="twelve columns mtl hide-for-small"><div class="row">'),mantle.components.post.inset.packageReferenced({insets:a.post.marqueePackageInsets},d,c),d.append("</div></div>")),d.append("</div></div>"),b?"":d.toString()},define("templates/mantle/components/post/type/marquee-package",function(){}),mantle.components.post.type.compactPackage=function(a,b){var c=b||new soy.StringBuilder;c.append("	");for(var d=new soy.StringBuilder,e=a.post.blogs,f=e.length,g=0;f>g;g++){var h=e[g];d.append(h.id==a.post.author.defaultBlogId?soy.$$escapeHtml(h.canonicalHost):"")}return d=d.toString(),c.append('<div class="twelve columns"><div class="compact-package text-light"><a href="',soy.$$escapeHtml(a.post.permalink),'"><h5 class="shrink man">',""!=a.post.starter.headline||""!=a.post.starter.plaintext?a.post.starter.headline?soy.$$filterNoAutoescape(a.post.starter.headline):soy.$$filterNoAutoescape(a.post.starter.plaintext):"",'</h5></a><span class="icon downsized notranslate">L</span></div></div>'),b?"":c.toString()},mantle.components.post.type.compactPackageRecommended=function(a,b){var c=b||new soy.StringBuilder,d=a.post.parent?a.post.parent:a.post;return c.append('<div class="twelve columns"><div class="compact-package compact-package-recommended text-light"><a href="',soy.$$escapeHtml(a.post.permalink),'"><h5 class="shrink man">',d.headline&&""!=d.headline?soy.$$filterNoAutoescape(d.headline):d.first100Characters&&""!=d.first100Characters?soy.$$filterNoAutoescape(d.first100Characters):d.firstSentence&&""!=d.firstSentence?soy.$$filterNoAutoescape(d.firstSentence):"",'</h5></a><span class="icon downsized notranslate">1</span></div></div>'),b?"":c.toString()},mantle.components.post.type.packageRecommendedAlternative=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}e=e.toString();var j=new soy.StringBuilder,k=new soy.StringBuilder("k-small");k=k.toString(),j.append(a.post.starter.sharingMainImage?soy.$$escapeHtml(window.kinja.imageUrl(a.post.starter.sharingMainImage,k)):""),j=j.toString();var l=""!=a.post.parentId;return l?mantle.components.post.type.compactPackageItem({type:"recommended-reply",authorBlogLink:e,authorDisplayName:a.post.author.displayName,postPermalink:a.post.starter.permalink,replyPermalink:a.post.permalink,thumbnailSource:j,content:a.post.plaintext,postHeadline:a.post.starter.headline},d,c):mantle.components.post.type.compactPackageItem({type:"recommended-post",authorBlogLink:e,authorDisplayName:a.post.author.displayName,postPermalink:a.post.permalink,thumbnailSource:null==a.post?null:null==a.post.compactThumb?null:a.post.compactThumb.src,content:a.post.headline?a.post.headline:a.post.first100Characters},d,c),b?"":d.toString()},mantle.components.post.type.compactPackageAlternative=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=new soy.StringBuilder,f=new soy.StringBuilder("k-small");return f=f.toString(),e.append(a.parentPostImage?soy.$$escapeHtml(window.kinja.imageUrl(a.post.starter.sharingMainImage,f)):""),e=e.toString(),mantle.components.post.type.compactPackageItem({type:"reply",authorBlogLink:a.post.starter.author.defaultBlog.canonicalHost,authorDisplayName:a.post.starter.author.displayName,postPermalink:a.post.starter.permalink,replyPermalink:a.post.permalink,thumbnailSource:e,content:a.post.plaintext,postHeadline:a.post.starter.headline},d,c),b?"":d.toString()},mantle.components.post.type.compactPackageItem=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");var e=a.thumbnailSource&&""!=a.thumbnailSource,f=new soy.StringBuilder("reply"==a.type?"Replied to a Post by":"recommended-reply"==a.type?"Recommended a reply by":"recommended-post"==a.type?"Recommended a post by":"");return f=f.toString(),d.append('<div class="twelve columns package-wrapper reply-post ',soy.$$escapeHtml(e?"has-thumbnail":""),'"><div class="top-meta proxima"><div class="meta text-micro"><span class="meta-bg"><span class="meta-info recommended-by pln"><span class="text-upper">',c.meta.blogOwner?'<a href="http://'+soy.$$escapeHtml(c.meta.blog.canonicalHost)+'">'+soy.$$escapeHtml(c.meta.blogOwner.displayName)+"</a>":"",'</span><span class="trigger-italic phs">',soy.$$escapeHtml(f),'</span><span class="meta-info display-name strong"><a class="text-upper" href="http://',soy.$$escapeHtml(a.authorBlogLink),'">',soy.$$escapeHtml(a.authorDisplayName),'</a></span></span></span></div></div><div class="row"><div class="twelve columns item-content hover-highlight">'),"reply"==a.type||"recommended-reply"==a.type?mantle.components.post.type.compactPackageReply(a,d,c):"recommended-post"==a.type&&mantle.components.post.type.compactPackageRecommendedPost(a,d,c),d.append("</div></div></div>"),b?"":d.toString()},mantle.components.post.type.compactPackageReply=function(a,b){var c=b||new soy.StringBuilder;c.append("	");var d=a.thumbnailSource&&""!=a.thumbnailSource;return c.append(d?'<div class="six columns right prn mts"><div class="row"><div class="six columns"><a href="'+soy.$$escapeHtml(a.postPermalink)+'" rel="nofollow"><span class="thumb"><span class="img-border"><img src="'+soy.$$escapeHtml(a.thumbnailSource)+'" /></span></span></a></div><div class="six columns pln"><h6 class="headline thumb-headline mvn">'+soy.$$filterNoAutoescape(a.postHeadline)+"</h6></div></div></div>":'<div class="three columns right prn mts"><h6 class="headline thumb-headline mvn">'+soy.$$filterNoAutoescape(a.postHeadline)+"</h6></div>",'<blockquote class="compact-quote"><a href="',soy.$$escapeHtml(a.replyPermalink),'">',soy.$$truncate(soy.$$escapeHtml(a.content),300,!0),"</a></blockquote>"),b?"":c.toString()},mantle.components.post.type.compactPackageRecommendedPost=function(a,b){var c=b||new soy.StringBuilder;c.append("	");var d=a.thumbnailSource&&""!=a.thumbnailSource;
return c.append(d?'<div class="main-media"><a href="'+soy.$$escapeHtml(a.postPermalink)+'" rel="nofollow"><span class="thumb"><span class="img-border"><img src="'+soy.$$escapeHtml(a.thumbnailSource)+'" /></span></span></a></div>':"",'<h1 class="headline h5 mtn"><a href="',soy.$$escapeHtml(a.postPermalink),'" rel="nofollow">',soy.$$filterNoAutoescape(a.content),"</a></h1>"),b?"":c.toString()},define("templates/mantle/components/post/type/compact-package",function(){}),mantle.components.post.type.permalink=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<div class="twelve mobile-four columns end content-column js_ad300-companion"><div class="post-container">'),c.meta.fullTags&&a.post.ads&&a.post.ads.ad970x90&&mantle.section.header.tagpage({tag:c.meta.fullTags},d,c),a.sharingPost?(d.append('<div class="row">'),mantle.components.contentLogo(a,d,c),d.append('</div><div class="avatar-shared-by-container"></div>'),mantle.components.post.meta.topMetaAvatar({post:a.post,forSharedPost:!0},d,c),(a.post.headline||a.post.tags[0])&&mantle.components.post.header.standard({headline:a.post.headline?a.post.headline:"",headlineClasses:"mts mbl",post:a.post,headerLevel:3},d,c)):(d.append('<div class="avatar-shared-by-container"></div>'),mantle.components.post.meta.topMetaAvatar({post:a.post,forSharedPost:a.sharingPost?"true":""},d,c),d.append('<div class="row js_kinja-share-wrapper hide"><div class="twelve columns post-tools-above"><a href="#" class="js_kinja-share replywithshare inline-block"><span class="icon notranslate">K</span></a></div></div>'),(a.post.headline||a.post.tags[0])&&mantle.components.post.header.standard({headline:a.post.headline?a.post.headline:"",headlineClasses:"mtn mbl",post:a.post},d,c)),d.append(a.post.display?'<div class="row post-content">'+(a.post.annotation&&"TEXT"==a.post.annotation.annotationType?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+soy.$$filterNoAutoescape(a.post.annotation.annotationText)+"</blockquote>":"")+(!a.excerptOnly||!a.post.isStarter&&a.post.starter?soy.$$filterNoAutoescape(a.post.display):soy.$$filterNoAutoescape(a.post.excerpt))+"</div>":"","</div></div>"),b?"":d.toString()},define("templates/mantle/components/post/type/permalink",function(){}),mantle.components.post.meta.meta=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}if(e=e.toString(),null==a.isSharedPost||a.isSharedPost||"permalink"!=a.meta.pageType)a.post.isBlip&&"permalink"!=a.meta.pageType&&"private"!=a.meta.pageType||(d.append('<div class="author-meta js_authormeta" data-authorid="',soy.$$escapeHtml(a.post.author.id),'" data-blogid="',soy.$$escapeHtml(a.post.author.defaultBlogId),'">'),"permalink"==a.meta.pageType&&mantle.components.post.meta.avatarContainer({post:a.post,canonicalHost:e},d,c),d.append('<div class="meta meta-text',"permalink"!=a.meta.pageType?" follow-inline":"",'"><span class="meta-defaults">'),mantle.components.post.meta.byline({post:a.post,canonicalHost:e},d,c),d.append("</span>"),(!a.post.postAction||a.post.postAction&&"REPOST"!=a.post.postAction.relation)&&""==a.post.byline&&"permalink"==a.meta.pageType&&(d.append('<span class="follow-links">'),mantle.components.post.button.follow({pageType:a.meta.pageType},d,c),d.append("</span>")),d.append(a.post.sponsored||a.post.isBillboardPost?'<div class="mts clear-both"><span class="mvs tag text-upper text-small">Sponsored</span></div>':"",'<span class="meta-separator hide-for-billboard">'),0!=a.showDate&&mantle.components.post.meta.publishTime(a,d,c),"DRAFT"!=a.post.status&&mantle.components.post.meta.stats(a,d,c),d.append('</span><span class="meta-private"><a class="meta-info text-light hide js_edit-post clear-both" href="/posts/',soy.$$escapeHtml(a.post.id),'/edit" rel="nofollow">Edit</a></span>'),a.post.score&&mantle.components.post.meta.postScore(a,d,c),d.append('<div class="clear-both"></div></div>',a.post.isStarter&&"permalink"==a.meta.pageType?'<div class="fb-like mts" data-href="'+soy.$$escapeHtml(a.post.permalink)+'" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false"></div>':"","</div>"));else{d.append('<div class="media author-meta-small"><div class="img mrm mts"><div class="avatar-container js_avatar-container">');var j=new soy.StringBuilder("avt-medium");j=j.toString(),d.append(a.post.showByline&&""==a.post.byline?'<a href="http://'+soy.$$escapeHtml(e)+'"'+(a.post.isPromoted?' rel="nofollow"':"")+'><span class="img-border"><img src="'+soy.$$escapeHtml(a.post.author.avatar.id?window.kinja.imageUrl(a.post.author.avatar.id,j):c.meta.assets.images+"icons/avatar-big.png")+'" class="avatar" height="40" width="40"/></span></a>':(null==a.post.salesAvatarMap?null:a.post.salesAvatarMap.id)?'<span class="img-border"><img src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.post.salesAvatarMap.id,j))+'" class="avatar" height="40" width="40"/></span>':'<span class="img-border"><img src="'+soy.$$escapeHtml(c.meta.assets.images)+'icons/avatar-big.png" class="avatar" height="40" width="40"/></span>','</div></div><div class="bd meta-text mts"><span class="meta-info display-name"><a href="http://',soy.$$escapeHtml(e),'"',a.post.isPromoted?' rel="nofollow"':"",' class="text-upper">',soy.$$escapeHtml(a.post.author.displayName?a.post.author.displayName:""),'</a></span><span class="publish-time js_publish_time" data-publishtime="',soy.$$escapeHtml(a.post.publishTimeMillis),'"><a class="text-light hover-switch" href="',soy.$$escapeHtml(a.post.permalink),'"',a.post.isPromoted?' rel="nofollow"':"",">"),mantle.components.post.meta.formattedTime({time:a.post.publishTime},d,c),d.append("</a></span></div></div>")}return b?"":d.toString()},define("templates/mantle/components/post/meta",function(){}),mantle.components.post.meta.topMeta=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<div class="top-meta proxima',"permalink"==c.meta.pageType?" meta-content":"",'"><div class="meta text-micro">'),a.post.tags&&a.post.tags[0]&&(mantle.components.post.header.tag({tag:a.post.tags[0],tagClasses:"text-upper strong meta-bg mrs"},d,c),d.append(a.post.postAction&&a.post.postAction.author&&a.post.postAction.author.displayName||"hu-HU"==c.meta.blog.locale?"":'<span class="meta-bg post-by">By</span>')),d.append('<span class="meta-bg',"hu-HU"==c.meta.blog.locale?" pln":"",'">'),mantle.components.post.meta.metaMinimal(a,d,c),d.append("</span>"),a.post.sponsored||a.post.isBillboardPost||a.post.isPromoted){if(d.append('<span class="meta-bg mls">',a.post.sponsored||a.post.isBillboardPost?'<span class="text-upper">Sponsored</span>':""),a.post.isPromoted){var e=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");e=e.toString(),d.append('<span class="icon icon-promoted text-light notranslate mhs">B</span>Promoted by <span class="js_promoted_displayName text-upper">',soy.$$filterNoAutoescape(e),"</span>")}d.append("</span>")}return"permalink"==c.meta.pageType&&0!=a.showDate&&(d.append('<span class="meta-bg mls publishtime-container">'),mantle.components.post.meta.publishTime(a,d,c),d.append("</span>")),d.append("</div>"),mantle.components.post.postToolsNg(a,d,c),d.append("</div>"),b?"":d.toString()},mantle.components.post.meta.metaMinimal=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}return e=e.toString(),mantle.components.post.meta.byline({post:a.post,canonicalHost:e},d,c),b?"":d.toString()},define("templates/mantle/components/post/meta/meta-top",function(){}),mantle.components.post.meta.topMetaAvatar=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}if(e=e.toString(),d.append('<div class="top-meta meta-avatar proxima',"permalink"==c.meta.pageType?" meta-content":"",a.forSharedPost?" shared-chevron":"",'"><div class="meta"><div class="media"><div class="img">'),mantle.components.post.meta.avatarContainer({post:a.post,canonicalHost:e},d,c),d.append('</div><div class="bd text-micro">',a.forSharedPost?'<span class="meta-bg">Original post by</span>':""),mantle.components.post.meta.metaMinimalTwo({post:a.post,mode:soy.$$escapeHtml(a.mode?a.mode:"post"),forSharedPost:a.forSharedPost},d,c),(a.post.sponsored||a.post.isBillboardPost||a.post.isPromoted)&&(d.append(a.post.sponsored||a.post.isBillboardPost?'<span class="text-upper meta-bg mhs">Sponsored</span>':""),a.post.isPromoted)){var j=new soy.StringBuilder(a.post.promotion&&a.post.promotion.byline&&""!=a.post.promotion.byline?soy.$$escapeHtml(a.post.promotion.byline):a.post.promotion&&a.post.promotion.authorDisplayName?soy.$$escapeHtml(a.post.promotion.authorDisplayName):"");j=j.toString(),d.append('<span class="icon icon-promoted text-light notranslate mhs">B</span>Promoted by <span class="js_promoted_displayName text-upper">',soy.$$filterNoAutoescape(j),"</span>")}return a.post.tags&&a.post.tags[0]&&!a.forSharedPost&&(d.append('<div class="inline-block taglist-container">'),mantle.components.post.header.tag({tag:a.post.tags[0],tagClasses:"text-upper text-micro meta-bg mls mrs meta-tag"},d,c),a.post.tags.length>1&&mantle.components.post.header.tagList({tags:a.post.tags},d,c),d.append("</div>")),0==a.showDate||a.forSharedPost||(d.append('<span class="meta-bg text-micro pln prm',a.forSharedPost?" mls":"",'">'),mantle.components.post.meta.publishTime(a,d,c),d.append("</span>")),d.append("</div></div></div>"),mantle.components.post.postToolsNg({post:a.post,mode:soy.$$escapeHtml(a.mode?a.mode:"post"),forSharedPost:a.forSharedPost},d,c),d.append("</div>"),b?"":d.toString()},mantle.components.post.meta.metaMinimalTwo=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=new soy.StringBuilder,f=a.post.blogs,g=f.length,h=0;g>h;h++){var i=f[h];e.append(i.id==a.post.author.defaultBlogId?soy.$$escapeHtml(i.canonicalHost):"")}return e=e.toString(),mantle.components.post.meta.topByline({post:a.post,mode:a.mode,canonicalHost:e,forSharedPost:a.forSharedPost},d,c),b?"":d.toString()},define("templates/mantle/components/post/meta/meta-top-avatar",function(){}),mantle.components.post.inset.packageReferenced=function(a,b){var c=b||new soy.StringBuilder;if(a.insets.length)for(var d=a.insets,e=d.length,f=0;e>f;f++){var g=d[f];if(c.append('<div class="three columns end package-inset">'),g.image.id){c.append('<a href="',soy.$$escapeHtml(g.url),'" onClick="window._gaq.push([\'_trackEvent\', \'Front page click\', \'Front page click - inset\']);"><span class="thumb"><span class="img-border">');var h=new soy.StringBuilder("k-small");h=h.toString(),c.append('<img src="',soy.$$escapeHtml(window.kinja.imageUrl(g.image.id,h)),'" onError="this.onerror=null;this.src=\'',soy.$$escapeJsString(g.image.hotlink),'\';" width="132" height="74" /></span></span></a>')}c.append('<a class="inset-headline proxima strong" href="',soy.$$escapeHtml(g.url),"\" onClick=\"window._gaq.push(['_trackEvent', 'Front page click', 'Front page click - inset']);\">",soy.$$filterNoAutoescape(g.headline?g.headline:g.auxiliaryHeadline),"</a></div>")}return b?"":c.toString()},define("templates/mantle/components/post/inset/referenced-package",function(){}),tiger.components.post.button.repostblock=function(a,b){a=a||{};var c=b||new soy.StringBuilder;if(c.append("	",1==a.repostedToPersonal?'<li><a href="#" class="js_undorepost pvs" data-blogid="'+soy.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Undo repost to Personal blog</span></a></li>':""),a.blogsUndo)for(var d=a.blogsUndo,e=d.length,f=0;e>f;f++){var g=d[f];c.append('<li><a href="#" class="js_undorepost pvs" data-blogid="',soy.$$escapeHtml(g.id),'"><span class="txt">Undo repost to ',soy.$$escapeHtml(g.name),"</span></a></li>")}if(c.append('<li class="js_repostheader repostheader ptm"><span class="icon notranslate mrs">E</span><span class="txt text-upper">Share to:</span></li>',!a.personalBlogId||a.kinjaShare||a.repostedToPersonal?"":'<li><a href="#" class="js_repost pvs" data-blogid="'+soy.$$escapeHtml(a.personalBlogId)+'"><span class="txt">Personal blog</span></a></li>',a.kinjaShare?'<li><a href="#" class="js_kinja-share pvs"><span class="txt">Kinja</span></a></li>':""),a.blogsRepost)for(var h=a.blogsRepost,i=h.length,j=0;i>j;j++){var k=h[j];c.append('<li><a href="#" class="js_repost pvs" data-blogid="',soy.$$escapeHtml(k.id),'"><span class="txt">',soy.$$escapeHtml(k.name),"</span></a></li>")}return b?"":c.toString()},tiger.components.post.button.repostblockwrapped=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<li class="repostblock js_repostblock"><ul>'),tiger.components.post.button.repostblock(a,d,c),d.append("</ul></li>"),b?"":d.toString()},define("templates/tiger/components/post/button",function(){}),mantle.components.post.header.__deltemplate_s3969_4f7c8884=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<li class="has-border pan"><a class="text-upper text-small font-normal" href="',soy.$$escapeHtml(a.host?"http://"+a.host:""),"/tag/",soy.$$escapeHtml(a.item.urlName),'" data-urlname="',soy.$$escapeHtml(a.item.urlName),'">',soy.$$escapeHtml(a.item.desc),"</a></li>"),b?"":c.toString()},soy.$$registerDelegateFn(soy.$$getDelTemplateId("dropdowniterable"),"tags",0,mantle.components.post.header.__deltemplate_s3969_4f7c8884),mantle.components.post.header.__deltemplate_s3979_f9b3b570=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<li class="has-border pan"><a class="text-small font-normal" href="',a.item.url?soy.$$escapeHtml(a.item.url):"",'"><span class="author strong shorten">',soy.$$escapeHtml(a.item.sharedBy),'</span><span class="text-light"> shared on ',soy.$$escapeHtml(a.item.sharedOn),"</span>",a.item.headline?': <span class="strong">'+soy.$$filterNoAutoescape(a.item.headline)+"</span>":"","</a></li>"),b?"":c.toString()},soy.$$registerDelegateFn(soy.$$getDelTemplateId("dropdowniterable"),"shareNotification",0,mantle.components.post.header.__deltemplate_s3979_f9b3b570),define("templates/mantle/components/post/header",function(){}),define("view/PostView",["lib/jquery","lib/underscore","view/BaseView","view/items/PostTools","view/items/InsetTools","singleton/CurrentBlog","singleton/Utils","singleton/EventDispatcher","singleton/Feature","singleton/CurrentUser","gawkerlib/jquery.foundation.dropdownhover","templates/mantle/components/post","templates/mantle/components/post/list-item","templates/mantle/components/ad/ad16x9","templates/mantle/components/ad/ad320x50","templates/mantle/components/ad/ad970x250","templates/mantle/components/ad/ad1x1","templates/mantle/components/ad/zone","templates/mantle/components/post/type/compact","templates/mantle/components/post/type/standard","templates/mantle/components/post/type/standard-package","templates/mantle/components/post/type/marquee-package","templates/mantle/components/post/type/compact-package","templates/mantle/components/post/type/permalink","templates/mantle/components/post/meta","templates/mantle/components/post/meta/meta-top","templates/mantle/components/post/meta/meta-top-avatar","templates/mantle/components/post/meta/meta-components","templates/mantle/components/post/inset/referenced-package","templates/mantle/components/post/button","templates/tiger/components/post/button","templates/mantle/components/post/header","templates/mantle/messages"],function(a,b,c,d,e,f,g,h,i,j,k){var l=a(window),m=c.extend({postTool:null,extraSidebarStickyAfter:1169,extraSidebarStuckClass:"stuck",extraSidebarOffsetTop:18,alternateTagTimeout:void 0,gawkerHosts:["jalopnik.com","es.gizmodo.com","cink.hu","io9.com","deadspin.com","kotaku.com","gizmodo.com","gawker.com","lifehacker.com","jezebel.com"],events:{"mouseenter .js_tag_primary":"showAlternateTags","mouseenter .headline":"clearAlternateTagTimeout","mouseleave .headline":"hideAlternateTags","click .js_annotation-expand":"expandAnnotation","click .item-content":"navigateToArticle","mouseenter .hover-highlight":"addHeaderHighlight","mouseleave .hover-highlight":"removeHeaderHighlight","click .js_videoThumbPlay":"loadHiddenVideo","click .js_event_expand":"expandEvent","click .lazy-gif.thawable":"thawImage"},initialize:function(){this.$stickyTriggerCt=a(".js_post-dropdown-ct-sticky"),this.$stickyLimitElement=a(".js_post-wrapper"),a(".js_post-dropdown").on("opened",a.proxy(this.onOpenPostmenu,this)),this.$stickyTriggerCt.length&&(this.$postMenuToggler=this.$stickyTriggerCt.find(".js_post-menu-toggler"),window.setTimeout(a.proxy(this.initExtraSidebarSticky,this),1))},start:function(){return null!==this.postTool&&(this.postTool.remove(),this.postTool=null),this.postTool=new d({model:this.model,el:this.$el,openreframe:"?openreframe"===window.location.search}),this.postTool.on({"reply:success":this.delegatedReplyHandler,"dismiss:success":this.delegatedDismissHandler,"undismiss:success":this.delegatedUndismissHandler,"edit:success":this.delegatedEditHandler},this),this.fixMarkup(),this},onOpenPostmenu:function(b){var c;return b.preventDefault(),b.target.getAttribute("id")!=="dropdown-"+this.model.id?!0:(c=this.model&&parseInt(g.getKinjaMeta().postId,10)===this.model.get("sharedPostId"),c&&this.initReframeDropdownUtil(a(b.target)),void 0)},initReframeDropdownUtil:function(b){if(!j.isLoggedIn()){var c=function(){k.open(b,a("[data-dropdown="+b.attr("id")+"]"))};return j.once("authenticated",c),h.trigger("loginRequired",{source:"kinjaShare"}),k.close(b),!1}var d=function(a,c){return function(){var d=Array.prototype.slice.call(arguments);return a.apply(c,d.concat(b))}};this.model.getShareOptionsForUser(j).pipe(a.proxy(this.parseShareOptionsForUser,this)).done(d(this.createReframeMarkup,this))},parseShareOptionsForUser:function(a){return{personalBlogId:a.personalBlogId,repostedToPersonal:a.repostedToPersonal,currentPostDefaultBlogId:a.currentPostDefaultBlogId,blogsRepost:a.blogsRepost,blogsUndo:a.blogsUndo,kinjaShare:!1}},createReframeMarkup:function(b,c){var e="",f=c.find(".js_promote");f.hide(),c.find(".js_kinja-share-block").hide(),c.find(".js_repostblock").remove(),e=b.personalBlogId===b.currentPostDefaultBlogId&&j.get("membership").length<=1&&!i.isOn("replywithshare")?"":this.soyToHtml(tiger.components.post.button.repostblockwrapped,b),f.after(e),g.dropdownSentinel(),c.find(".js_undorepost").on("click",a.proxy(d.undoRepost,d)),c.find(".js_repost").on("click",a.proxy(d.repostPost,d)),c.find(".js_kinja-share").on("click",a.proxy(d.kinjaShare,d))},fixMarkup:function(){if("permalink"!==this.getPageType())return!1;var c=this;b.each(this.$el.find(".referenced ~ .content-ad"),function(b){var c=a(b);c.appendTo(c.prev())}),this.$el.find("blockquote .inset_placeholder").each(function(){a(this).closest("blockquote").before(this)}),this.insetTools=new e({el:this.$el}),this.$el.find(".js_reel").each(function(){c.createReel(this)}),this.$el.find(".js_slider").each(function(){var b=a(this),d=b.attr("data-uri1"),e=b.attr("data-uri2"),f=b.attr("data-percent");c.renderSlider(b,d,e,f)})},loadHiddenVideo:function(b){return a(b.currentTarget).hide(),this.$el.find(".js_hiddenbythumbnail").removeClass("hide"),!1},renderSlider:function(b,c,d,e){function f(a,b){var c=b-a;return 6>c&&(c=6),c>630&&(c=630),c}function h(a,b,c,d){d&&(b.stop().animate({width:a},0),c.stop().animate({right:628-a},0))}var i,j=640*e*.01,k=g.imageUrl(c,"k-bigpic"),l=g.imageUrl(d,"k-bigpic"),m=a('<div id="sliderBottom" style="background-image: url('+l+');"></div>'),n=a('<div id="sliderTop" style="background-image: url('+k+');"></div>'),o=a('<div id="sliderArrows"></div>'),p=!1,q=b.offset().left;b.html('<div id="slider"></div>').append(m,n,o),i=b.find("#slider"),n.stop().animate({width:j},1e3),o.stop().animate({right:628-j},1e3),i.bind("mousedown touchstart",function(a){p=!0;var b=f(q,a.pageX);return h(b,n,o,p),i.bind("mousemove touchmove",function(a){var b=f(q,a.pageX);h(b,n,o,p)}),!1}).bind("mouseup touchend",function(){p=!1,i.stop()}).mouseleave(function(){p=!1,i.stop()})},remove:function(){null!==this.postTool&&(this.postTool.remove(),this.postTool=null)},showAlternateTags:function(){""!==this.$el.find(".js_tag_alternates").html()&&this.$el.find(".js_tag_alternates").fadeIn(100)},hideAlternateTags:function(){var a=this;this.alternateTagTimeout=window.setTimeout(function(){a.$el.find(".js_tag_alternates").fadeOut(100)},2e3)},clearAlternateTagTimeout:function(){window.clearTimeout(this.alternateTagTimeout)},render:function(a){a=a||{};var b,c;return b={post:this.model.returnElement(),excerptOnly:a.excerptOnly||!1,showDate:a.showDate||!0,compactView:a.compactView||"false",meta:{blog:f}},c=this.soyToHtml(mantle.components.post.item,b),this.setElement(c),this},delegatedReplyHandler:function(a){void 0!==a.model&&h.trigger("reply:insert",a)},delegatedDismissHandler:function(){var b=700;this.$el.parents(".post-wrapper").fadeOut({duration:b,queue:!1}).slideUp({duration:b,queue:!1,complete:function(){a(this).remove()}})},delegatedEditHandler:function(){return!1},createReel:function(b){var c,d,e=a(b),f=636,g=Math.round(f/(16/9)),h=[],i={},j=e.data("url"),k=e.data("cols"),l=e.data("rows"),m=a('<img class="greel" src="'+j+'A00.jpg" alt="" width="'+f+'" height="'+g+'" />');for(e.append(m),c=0;l>c;c++)for(d=0;k>d;d++)h.push(String.fromCharCode(c+65)+(10>d?"0":"")+d+".jpg");i={frames:k,path:j,images:h,cw:!0,revolution:{x:300,y:100},inversed:!0,suffix:"",wheelable:!1},1!==l&&(i.rows=l),require(["lib/jquery.reel"],function(){m.one("load",function(){a(this).reel(i)})})},expandAnnotation:function(){return this.$el.find(".js_annotation-short").remove(),this.$el.find(".js_annotation-long").removeClass("hide"),!1},truncatePostText:function(a,b){var c,d,e=b?"":"&hellip;",f=a||320;c=this.$el.find(".read-more").detach(),d=this.$el.find("p.first-text"),d.text().length>f&&d.html(g.cutHtml(d.html(),f,e)),d.append(c)},truncateWidePostText:function(a,b){this.$el.parent().hasClass("wide")&&this.truncatePostText(a,b)},navigateToArticle:function(b){if(!a(b.target).parents(".thumb-inset").length&&!(a(b.target).closest(".js_post-menu-toggler").length>0||b.target.href)){var c=this.model.getUrl();if(b.metaKey)return window.open(c,"_blank"),!1;window.location=c}},addHeaderHighlight:function(){this.$(".hover-highlight").addClass("hovered")},removeHeaderHighlight:function(){this.$(".hover-highlight").removeClass("hovered")},initExtraSidebarSticky:function(){var c=function(){return l.width()>=this.extraSidebarStickyAfter},d=function(){this._measureSticky(),this.stickExtraSidebar(),l.on("scroll.extra.sidebar",a.proxy(this.stickExtraSidebar,this))},e=function(){c.call(this)?d.call(this):(this._resetSticky(),l.off("scroll.extra.sidebar",a.proxy(this.stickExtraSidebar,this)))},f=b.debounce(a.proxy(e,this),300);c.call(this)&&d.call(this),l.on("resize orientationchange",f)},stickExtraSidebar:function(a){a=a||{};var b,c,d=this.$stickyTriggerCt.data("initalOffset"),e=window.pageYOffset>=d.top-this.extraSidebarOffsetTop,f=this.$stickyTriggerCt.hasClass(this.extraSidebarStuckClass),g=!1;!this.$stickyLimitElement||this.stickyMax&&"resize"!==a.type||(b=this.$stickyLimitElement.height(),c=this.$stickyLimitElement.offset().top,this.stickyMax=b+c-60),g=this.stickyMax<=window.pageYOffset,!e||g||f?e&&!g||!f||this._resetSticky():(this.$stickyTriggerCt.width(this.$postMenuToggler.outerWidth()).css({top:this.extraSidebarOffsetTop,left:Math.round(d.left)}).addClass(this.extraSidebarStuckClass),k.resize())},_resetSticky:function(){this.$stickyTriggerCt.css({left:"",top:"",width:""}).removeClass(this.extraSidebarStuckClass),k.resize()},_measureSticky:function(){this.$stickyTriggerCt.data("initalOffset")&&this._resetSticky(),this.$stickyTriggerCt.data("initalOffset",this.$postMenuToggler.offset())},expandEvent:function(a){this.$el.find(".js_event_collapsed").addClass("hide"),this.$el.find(".js_event_expanded").removeClass("hide"),a.preventDefault()},thawImage:function(b){b.preventDefault(),h.trigger("thawImage",{$el:a(b.target)})}});return m}),mantle.components.replies.reply=function(a,b,c){var d=b||new soy.StringBuilder;d.append('	<article class="js_reply reply js_goto_post',0==a.reply.approved?" unapproved":"",'" id="',soy.$$escapeHtml(a.annotationInPopup?"annotation_":""),"reply_",soy.$$escapeHtml(a.reply.id),'" data-id="',soy.$$escapeHtml(a.reply.id),'" ',a.reply.jsModelJson?'data-model="'+soy.$$escapeUri(a.reply.jsModelJson)+'"':"",">",a.reply.annotation&&"IMAGE"==a.reply.annotation.annotationType?'<div class="reply-annotation" style=" background-image: url(\''+soy.$$escapeHtml(a.reply.annotation.imageUrl)+"'); background-image: url('"+soy.$$escapeHtml(a.reply.annotation.imageUrl)+"'), url("+soy.$$escapeHtml(window.kinja.imageUrl(a.reply.annotation.imageChompId,"k-xlarge"))+"); background-position: -"+soy.$$escapeHtml(a.reply.annotation.xPx)+"px -"+soy.$$escapeHtml(a.reply.annotation.yPx)+'px;" data-annotation-image-url="'+soy.$$escapeHtml(a.reply.annotation.imageUrl)+'" data-annotation-image-x="'+soy.$$escapeHtml(a.reply.annotation.x)+'" data-annotation-image-y="'+soy.$$escapeHtml(a.reply.annotation.y)+'"></div>':"","<header>",a.reply.aboveHeadline?'<div class="thumb">'+("image"==a.reply.aboveHeadline.type?'<img class="marquee" src="'+soy.$$escapeHtml(a.reply.aboveHeadline.src)+'" width="'+soy.$$escapeHtml(a.reply.aboveHeadline.width)+'" height="'+soy.$$escapeHtml(a.reply.aboveHeadline.height)+'"/>':soy.$$filterNoAutoescape(a.reply.aboveHeadline.embed))+"</div>":"",'<div class="media"><span class="img">');var e=new soy.StringBuilder("avt-small");e=e.toString(),d.append(a.reply.showByline&&""!=a.reply.byline?(null==a.reply.salesAvatarMap?null:a.reply.salesAvatarMap.id)?'<img class="avatar-mini" src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.reply.salesAvatarMap.id,e))+'" />':'<img class="avatar-mini" src="'+soy.$$escapeHtml(c.meta.assets.images)+'icons/avatar-big.png" />':'<img src="'+soy.$$escapeHtml(a.reply.author.avatar.id?window.kinja.imageUrl(a.reply.author.avatar.id,e):c.meta.assets.images+"icons/avatar-big.png")+'" class="avatar-mini" />','</span><div class="bd"><span class="reply-authors">');for(var f=new soy.StringBuilder,g=a.reply.blogs,h=g.length,i=0;h>i;i++){var j=g[i];f.append(j.id==a.reply.author.defaultBlogId?a.reply.showByline&&""!=a.reply.byline?'<span class="reply-author" >'+soy.$$filterNoAutoescape(a.reply.byline)+"</span>":'<a class="reply-author" href="http://'+soy.$$escapeHtml(j.canonicalHost)+'" target="_self">'+soy.$$escapeHtml(a.reply.author.displayName)+"</a>":"")}return f=f.toString(),d.append(f?soy.$$filterNoAutoescape(f):'<span class="reply-author">'+(a.reply.showByline&&""!=a.reply.byline?soy.$$escapeHtml(a.reply.byline):soy.$$escapeHtml(a.reply.author.displayName))+"</span>",null!=a.reply.parentAuthorId&&a.reply.replyMeta&&a.reply.replyMeta.parentAuthor?a.reply.replyMeta&&a.reply.replyMeta.showParentByline&&""!=a.reply.replyMeta.parentByline?'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+soy.$$filterNoAutoescape(a.reply.replyMeta.parentByline)+"</span>":'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+soy.$$escapeHtml(a.reply.replyMeta.parentAuthor.displayName)+"</span>":"","</span>"),mantle.components.post.button.replybuttons(a,d,c),d.append("</div></div></header>",a.reply.score?'<span class="mscr proxima rscr">'+(a.reply.isStarter&&a.reply.score.baseScoreExplanation?"BASE: "+soy.$$escapeHtml(a.reply.score.baseScoreExplanation):!a.reply.isStarter&&a.reply.score.explanation?soy.$$escapeHtml(a.reply.score.explanation):"")+"</span>":"",a.reply.replyMeta&&a.reply.replyMeta.approvedExplanation?'<span class="mscr proxima rscr">'+soy.$$escapeHtml(a.reply.replyMeta.approvedExplanation)+"</span>":"",'<div class="reply-content whitelisted-links">',a.reply.annotation&&"TEXT"==a.reply.annotation.annotationType?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+(a.reply.annotation.annotationShortText?'<div class="js_annotation-long hide">'+soy.$$filterNoAutoescape(a.reply.annotation.annotationText)+'</div><div class="js_annotation-short">'+soy.$$filterNoAutoescape(a.reply.annotation.annotationShortText)+' <a href="'+soy.$$escapeHtml(a.reply.permalink)+'" class="js_annotation-expand proxima text-small">Show all</a></div>':soy.$$filterNoAutoescape(a.reply.annotation.annotationText))+"</blockquote>":"",soy.$$filterNoAutoescape(a.reply.display),a.reply.annotationReadMore?'<a href="'+soy.$$escapeHtml(a.reply.permalink)+'" class="js_viewDiscussion js_endoftext" data-id="'+soy.$$escapeHtml(a.reply.id)+'"> Read…</a>':""),mantle.components.replies.replyPermalink({permalink:a.reply.permalink,publishTime:a.reply.publishTime},d,c),d.append("</div></article>"),b?"":d.toString()},mantle.components.replies.replyPermalink=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<a class="reply-permalink proxima js_endoftext" href="',soy.$$escapeHtml(a.permalink),'" target="_self">'),mantle.utils.relativeTime({time:a.publishTime},d,c),d.append("</a>"),b?"":d.toString()},define("templates/mantle/components/replies",function(){}),mantle.utils.relativeTime=function(a,b,c){a=a||{};var d=b||new soy.StringBuilder;return d.append("	"),a.time&&mantle.messages.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma},d,c),b?"":d.toString()},define("templates/mantle/utils/relative-time",function(){}),define("view/ReplyView",["lib/jquery","lib/underscore","view/PostView","templates/mantle/components/replies","templates/mantle/utils/relative-time","templates/mantle/messages"],function(a,b,c){var d=c.extend({fixMarkup:function(){},delegatedReplyHandler:function(c){var e,f=this.soyToHtml(mantle.components.replies.reply,{reply:c.model.replaceImagesWithOriginal().returnElement()});this.$el.after(f),e=new d({model:c.model,el:a("#reply_"+c.model.id)}),e.start(),b.each(e.$el.find(".js_endoftext"),function(b){var c=a(b),d=c.parents(".reply-content").children(":not(.js_endoftext)").last();d.append(c.detach().removeClass("hide"))}),this.trigger("reply:rendered")},delegatedDismissHandler:function(){var b=this.$el.parents(".js_replyblock").data("startid")===this.model.id,c=700,d=function(a,b){a.fadeOut({duration:c,queue:!1}).animate({width:0,height:0},{duration:c,queue:!1,complete:b||function(){}})};b?d(this.$el.parents(".js_replybranch"),function(){a(this).remove()}):d(this.$el,function(){a(this).remove()})},delegatedUndismissHandler:function(){var b=this.$el.find(".js_undismissed-msg-place");b.append(this.soyToHtml(mantle.components.post.button.undismissedmessage,{})),window.setTimeout(a.proxy(function(){b.empty()},this),5e3)},delegatedEditHandler:function(a){this.$el.find(".reply-content").html(a.model.get("display")),this.$el.find(".reply-content").children().last().append(this.soyToHtml(mantle.components.replies.replyPermalink,{permalink:a.model.get("permalink"),publishTime:a.model.get("publishTime")}))}});return d}),tiger.components.liveblog.branch=function(a,b,c){var d=b||new soy.StringBuilder;if(d.append('	<div class="six columns masonry-brick replybranch js_replybranch" data-id="',soy.$$escapeHtml(a.branch.reply.id),'"><header class="proxima js_expand-branch-header">',"authorParticipated"==a.branch.branchType&&1==a.branch.reply.approved?'<span class="icon icon-star notranslate mrs">1</span>Author is participating':1==a.branch.reply.replyCount?soy.$$escapeHtml(a.branch.reply.replyCount)+" participant":a.branch.reply.replyCount>1?soy.$$escapeHtml(a.branch.reply.replyCount)+" participants":"&nbsp;",'<a href="#" class="js_expand-branch branch-control"><span class="icon transparent notranslate">@</span></a><a href="#" class="js_collapse-branch branch-control hide"><span class="icon transparent notranslate">X</span></a></header><section class="replies js_replyblock" data-startid="',soy.$$escapeHtml(a.branch.reply.id),'">'),a.ancestors){d.append('<div class="js_ancestor-list">');
for(var e=a.ancestors,f=e.length,g=0;f>g;g++){var h=e[g];tiger.components.liveblog.reply({reply:h},d,c)}d.append("</div>")}tiger.components.liveblog.reply({reply:a.branch.reply},d,c),d.append('<div class="js_branchreplies">');for(var i=a.branch.children,j=i.length,k=0;j>k;k++){var l=i[k];2>k&&tiger.components.liveblog.reply({reply:l},d,c)}if(d.append('</div><div class="js_additional-replies" style="display: none;"></div></section><footer class="js_collapsed">'),a.branch.reply.replyCount>a.branch.children.length-1&&a.branch.children[2]){var m=a.branch.children[2];d.append('<div class="floated-container img-20"><div class="avatar"><div class="avatar-stack"><img src="',soy.$$escapeHtml(c.meta.assets.images),'icons/avatar-big.png" class="avatar-mini" /><span></span><span></span></div></div><div class="media plm"><a href="#" class="js_expand-branch proxima text-small"><span class="name inline-block">',m.showByline&&""!=m.byline?soy.$$escapeHtml(m.byline):soy.$$escapeHtml(m.author.displayName),'</span><span class="inline-fix">',a.branch.reply.replyCount-3==1?"&nbsp; and one other...":"",a.branch.reply.replyCount-3>1?"&nbsp; and "+soy.$$escapeHtml(a.branch.reply.replyCount-4)+" others...":"","</span></a></div></div>")}return d.append('</footer><footer class="js_expanded footer-expanded text-right hide clear-both"><a href="#" class="js_collapse-branch proxima text-small"><span class="icon notranslate mrs">X</span>Collapse conversation</a></footer><footer class="js_loading-footer center hide"><img src="',soy.$$escapeHtml(c.meta.assets.images),'ajax-loader.gif" /></footer></div>'),b?"":d.toString()},tiger.components.liveblog.reply=function(a,b,c){var d=b||new soy.StringBuilder;d.append('	<article class="js_reply reply js_goto_post clear-both',0==a.reply.approved?" unapproved":"",'" id="',soy.$$escapeHtml(a.annotationInPopup?"annotation_":""),"reply_",soy.$$escapeHtml(a.reply.id),'" data-id="',soy.$$escapeHtml(a.reply.id),'" ',a.reply.jsModelJson?'data-model="'+soy.$$escapeUri(a.reply.jsModelJson)+'"':"",">",a.reply.annotation&&"IMAGE"==a.reply.annotation.annotationType?'<div class="reply-annotation" style=" background-image: url(\''+soy.$$escapeHtml(a.reply.annotation.imageUrl)+"'); background-position: -"+soy.$$escapeHtml(a.reply.annotation.xPx)+"px -"+soy.$$escapeHtml(a.reply.annotation.yPx)+'px;" data-annotation-image-url="'+soy.$$escapeHtml(a.reply.annotation.imageUrl)+'" data-annotation-image-x="'+soy.$$escapeHtml(a.reply.annotation.x)+'" data-annotation-image-y="'+soy.$$escapeHtml(a.reply.annotation.y)+'"></div>':"","<header>",a.reply.aboveHeadline?'<div class="thumb">'+("image"==a.reply.aboveHeadline.type?'<img class="marquee" src="'+soy.$$escapeHtml(a.reply.aboveHeadline.src)+'" width="'+soy.$$escapeHtml(a.reply.aboveHeadline.width)+'" height="'+soy.$$escapeHtml(a.reply.aboveHeadline.height)+'"/>':soy.$$filterNoAutoescape(a.reply.aboveHeadline.embed))+"</div>":"",'<div class="floated-container img-20"><span class="avatar">');var e=new soy.StringBuilder("avt-small");e=e.toString(),d.append(a.reply.showByline&&""!=a.reply.byline?(null==a.reply.salesAvatarMap?null:a.reply.salesAvatarMap.id)?'<img class="avatar-mini" src="'+soy.$$escapeHtml(window.kinja.imageUrl(a.reply.salesAvatarMap.id,e))+'" />':'<img class="avatar-mini" src="'+soy.$$escapeHtml(c.meta.assets.images)+'icons/avatar-big.png" />':'<img src="'+soy.$$escapeHtml(a.reply.author.avatar.id?window.kinja.imageUrl(a.reply.author.avatar.id,e):c.meta.assets.images+"icons/avatar-big.png")+'" class="avatar-mini" />','</span><div class="txt"><span class="reply-authors inline-block proxima">');for(var f=new soy.StringBuilder,g=a.reply.blogs,h=g.length,i=0;h>i;i++){var j=g[i];f.append(j.id==a.reply.author.defaultBlogId?a.reply.showByline&&""!=a.reply.byline?'<span class="reply-author" >'+soy.$$filterNoAutoescape(a.reply.byline)+"</span>":'<a class="reply-author" href="http://'+soy.$$escapeHtml(j.canonicalHost)+'" target="_self">'+soy.$$escapeHtml(a.reply.author.displayName)+"</a>":"")}return f=f.toString(),d.append(f?soy.$$filterNoAutoescape(f):'<span class="reply-author">'+(a.reply.showByline&&""!=a.reply.byline?soy.$$escapeHtml(a.reply.byline):soy.$$escapeHtml(a.reply.author.displayName))+"</span>",null!=a.reply.parentAuthorId&&a.reply.replyMeta&&a.reply.replyMeta.parentAuthor?'<span class="reply-author replyto-author"><span class="icon text-light notranslate">U</span>'+((null==a.reply.replyMeta?null:a.reply.replyMeta.showParentByline)&&""!=(null==a.reply.replyMeta?null:a.reply.replyMeta.parentByline)?soy.$$filterNoAutoescape(a.reply.replyMeta.parentByline):soy.$$escapeHtml(a.reply.replyMeta.parentAuthor.displayName))+"</span>":"","</span>"),tiger.components.post.button.expandedReplyButtons(a,d,c),d.append("</div></div></header>",a.reply.score?'<span class="mscr proxima rscr">'+(a.reply.isStarter&&a.reply.score.baseScoreExplanation?"BASE: "+soy.$$escapeHtml(a.reply.score.baseScoreExplanation):!a.reply.isStarter&&a.reply.score.explanation?soy.$$escapeHtml(a.reply.score.explanation):"")+"</span>":"",a.reply.replyMeta&&a.reply.replyMeta.approvedExplanation?'<span class="mscr proxima rscr">'+soy.$$escapeHtml(a.reply.replyMeta.approvedExplanation)+"</span>":"",'<div class="reply-content whitelisted-links">',a.reply.annotation&&"TEXT"==a.reply.annotation.annotationType?'<blockquote class="reply-text-annotation" style=""><span class="icon notranslate mrs">u</span>'+(a.reply.annotation.annotationShortText?'<div class="js_annotation-long hide">'+soy.$$filterNoAutoescape(a.reply.annotation.annotationText)+'</div><div class="js_annotation-short">'+soy.$$filterNoAutoescape(a.reply.annotation.annotationShortText)+' <a href="'+soy.$$escapeHtml(a.reply.permalink)+'" class="js_annotation-expand proxima text-small">Show all</a></div>':soy.$$filterNoAutoescape(a.reply.annotation.annotationText))+"</blockquote>":"",soy.$$filterNoAutoescape(a.reply.display),a.reply.annotationReadMore?'<a href="'+soy.$$escapeHtml(a.reply.permalink)+'" class="js_viewDiscussion js_endoftext" data-id="'+soy.$$escapeHtml(a.reply.id)+'"> Read…</a>':""),tiger.components.liveblog.expandedReplyPermalink({permalink:a.reply.permalink,publishTime:a.reply.publishTime},d,c),d.append("</div></article>"),b?"":d.toString()},tiger.components.liveblog.expandedReplyPermalink=function(a,b,c){var d=b||new soy.StringBuilder;return d.append('	<a class="reply-permalink proxima js_endoftext" href="',soy.$$escapeHtml(a.permalink),'" target="_self">'),mantle.utils.relativeTime({time:a.publishTime},d,c),d.append("</a>"),b?"":d.toString()},define("templates/tiger/components/liveblog",function(){}),tiger.components.post.button.expandedReplyButtons=function(a,b){var c=b||new soy.StringBuilder;return c.append('<div class="reply-buttons js_reply-buttons inline-block right" data-forpost="',soy.$$escapeHtml(a.reply.id),'"><span class="js_message inline phs text-tiny proxima popover"></span><span class="js_undismissed-msg-place"></span><button class="button transparent js_dismiss js_external_dismiss has-tooltip tip-bottom pbn prn hide" data-tooltip title="Dismiss"><span class="icon downsized notranslate no-text">X</span></button><button class="button transparent js_undismiss js_external_undismiss has-tooltip tip-bottom pbn prn hide" data-tooltip title="Undismiss"><span class="icon downsized notranslate no-text force-alert-color">X</span></button><div class="inline plm has-tooltip tip-bottom" data-tooltip title="Recommend">',null!=a.reply.likes&&"0"!=a.reply.likes?'<span class="like-display txt text-micro text-upper mrs strong">'+soy.$$escapeHtml(a.reply.likes)+"</span>":"",'<span class="js_liked-msg-place"></span><span class="js_deleted-msg-place"></span><button class="button transparent no-text button-like js_like phn pbn ptn"><span class="icon downsized notranslate js_like_icon">1</span></button></div><a href="/posts/',soy.$$escapeHtml(a.reply.id),'/reply" class="button transparent reply-to-post js_reply-to-post has-tooltip tip-bottom prn pbn ptn plm" data-tooltip data-id="',soy.$$escapeHtml(a.reply.id),'" title="Discuss" rel="nofollow"><span class="icon downsized notranslate no-text">L</span></a></div>'),b?"":c.toString()},define("templates/tiger/components/post/button/expanded-reply-buttons",function(){}),define("view/ExpandedBranchView",["lib/jquery","lib/underscore","view/BaseView","view/ReplyView","singleton/PostHelper","singleton/Feature","templates/mantle/utils/relative-time","templates/tiger/components/liveblog","templates/tiger/components/post/button/expanded-reply-buttons","templates/mantle/messages"],function(a,b,c,d,e){var f=c.extend({replyViews:null,events:{"click .js_collapse-branch":"collapseBranch"},initialize:function(){this.replyViews=[]},render:function(){var a,c,f={branch:this.model.returnElement()},g=tiger.components.liveblog.branch,h=this.soyToHtml(g,f),i=this;return this.$el.html(h),a=this.$el.find(".js_replybranch"),a.removeClass("six masonry-brick").addClass("js_expanded expanded twelve"),this._fixTimestampPosition(a),this.$el.find(".js_expand-branch").addClass("hide").end().find(".js_collapse-branch").removeClass("hide"),this.$el.find(".js_collapsed").addClass("hide"),this.$el.find("footer.js_expanded").removeClass("hide"),this.$el.find(".js_expand-branch-header").removeClass("js_expand-branch-header").addClass("js_collapse-branch-header"),window.setTimeout(function(){c=e.parseFromDom(i.$el),b.each(c,function(a){var b=new d({model:a.model,el:a.node});b.start(),i.replyViews.push(b)}),e.likeStatusFor(c,{})},10),this.$el.slideDown(100),this.bindCloseHandlers(),this},collapseBranch:function(){return this.$el.slideUp(100).promise().done(a.proxy(function(){this.remove()},this)),!1},remove:function(){b.isArray(this.replyViews)&&b.invoke(this.replyViews,"remove"),this.unbindCloseHandlers(),c.prototype.remove.call(this)},bindCloseHandlers:function(){a(window).on("keyup.closebranch",a.proxy(function(a){return void 0!==a.keyCode&&27===a.keyCode||void 0!==a.which&&27===a.which?(this.collapseBranch(),!1):!0},this)),a(".js_liveblog").on("click.closebranch",a.proxy(function(b){return 0===a(b.target).closest(this.$el).length?(this.collapseBranch(),!1):!0},this))},unbindCloseHandlers:function(){a(window).off("keyup.closebranch"),a(".js_liveblog").off("click.closebranch")},_fixTimestampPosition:function(c){b.each(c.find(".js_endoftext"),function(b){var c=a(b),d=c.parents(".reply-content").children(":not(.js_endoftext)").last();d.append(c.detach().removeClass("hide"))})}});return f}),define("collection/BaseCollection",["lib/backbone"],function(a){var b=a.Collection.extend({constructor:function(b,c){c=c||{},c.url&&(this.url=c.url),a.Collection.prototype.constructor.apply(this,arguments)}});return b}),define("collection/Post",["lib/jquery","lib/underscore","collection/BaseCollection","model/post/Post","singleton/Feature","singleton/CurrentUser"],function(a,b,c,d,e,f){var g=c.extend({model:d,options:{},pagination:{},listMeta:{},initialize:function(a,d){c.prototype.initialize.call(this,a,d),this.options=b.extend({},this.options,d||{})},fetch:function(b){b=b||{};var d=a.Deferred(),g=a.Deferred();return e.isOn("superuser")?f.onAuth.done(function(){b.data=b.data||{},b.data.token=f.get("token"),d.resolve()}):d.resolve(),d.done(a.proxy(function(){c.prototype.fetch.call(this,b).done(g.resolve)},this)),g},sync:function(c,d,e){var f,g;switch(c){case"read":f="GET",g=b.result(this,"url");break;case"update":case"create":case"delete":throw new Error("PostCollection.sync(): unsupported method in sync")}return a.ajax(b.extend({type:f,dataType:"json",url:g},e))},parse:function(a){return void 0===a||void 0===a.data||void 0===a.data.items||a.meta.success===!1?[]:(this.pagination=a.data.pagination||{},void 0!==a.data.directReplyCount&&(this.listMeta.directReplyCount=a.data.directReplyCount),void 0!==a.contributors&&(this.listMeta.contributors=a.contributors),void 0!==a.data.meta&&(this.listMeta=b.extend({},this.listMeta,a.data.meta)),a.data.items)}});return g}),define("model/post/Branch",["model/Action","model/post/Post","collection/Post"],function(a,b,c){var d=a.extend({defaults:{reply:new b,children:new c,branch:new c,branchType:"normal"},parse:function(a){var d;return a.isStarterAuthorBranch===!0&&(d="authorParticipated"),{id:a.reply.id,reply:new b(a.reply).prepareAnnotations(),children:new c(a.children.items),branch:new c(a.branch.items),branchType:d}},returnElement:function(){return{reply:this.get("reply").returnElement(),children:this.get("children").invoke("returnElement"),branch:this.get("branch").invoke("returnElement"),branchType:this.get("branchType")}}});return d}),tiger.components.liveblog.post=function(a,b,c){var d=b||new soy.StringBuilder;d.append('	<article id="liveblogpost-',soy.$$escapeHtml(a.post.id),'" class="reply liveblog js_liveblog-item" data-timestamp="',soy.$$escapeHtml(a.post.publishTimeMillis),'" data-id="',soy.$$escapeHtml(a.post.id),'"><header><div class="floated-container img-20 mbm"><span class="avatar mrs">');var e=new soy.StringBuilder("avt-large");return e=e.toString(),d.append('<img src="',soy.$$escapeHtml(a.post.author.avatar&&a.post.author.avatar.id?window.kinja.imageUrl(a.post.author.avatar.id,e):c.meta.assets.images+"icons/avatar-big.png"),'" /></span><div class="txt"><span class="reply-authors text-light"><span class="reply-author proxima text-light strong">',soy.$$escapeHtml(a.post.author.displayName),'</span></span></div></div></header><div class="reply-content whitelisted-links pbn">',soy.$$filterNoAutoescape(a.post.display),'<a class="reply-permalink proxima mls js_endoftext" href="',soy.$$escapeHtml(a.post.permalink),'" target="_self">',soy.$$escapeHtml(a.post.publishTime.hmma),'</a></div><footer class="reply-buttons clear-both text-right border-bottom"><button class="button transparent js_expand-branch has-tooltip tip-bottom pan" data-tooltip title="Discuss"><span class="icon downsized notranslate no-text">L</span></button></footer></article>'),b?"":d.toString()},define("templates/tiger/components/liveblog/post",function(){}),tiger.components.liveblog.postList=function(a,b,c){var d=b||new soy.StringBuilder;d.append("	");for(var e=a.posts,f=e.length,g=0;f>g;g++){var h=e[g];tiger.components.liveblog.post({post:h},d,c)}return b?"":d.toString()},define("templates/tiger/components/liveblog/post-list",function(){}),mantle.components.ad.ad300x600=function(a,b,c){var d=b||new soy.StringBuilder;return d.append("	"),mantle.components.ad.zone(soy.$$augmentMap(a,{width:300,height:600,slot:a.slot,screen:"desktop",isScrollTriggered:!0,zoneClass:"Zone_300x",dfpSz:"300x250,300x600"}),d,c),b?"":d.toString()},define("templates/mantle/components/ad/ad300x600",function(){}),define("app/LiveblogApplet",["lib/jquery","lib/underscore","lib/needly","view/BaseView","view/ExpandedBranchView","model/post/Branch","model/post/Post","collection/Post","singleton/EventDispatcher","singleton/Utils","singleton/hyperion/ZoneHelper","singleton/Feature","module/groupchats/view/OpenReplyForms","lib/jquery.scrollTo","lib/waypoints","templates/tiger/components/liveblog/post","templates/tiger/components/liveblog/post-list","templates/mantle/components/ad/zone","templates/mantle/components/ad/ad300x600"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=d.extend(b.extend({},m,{pollInterval:10,pollTries:0,maxPollTries:1080,pollTimeout:null,remainingTimerInterval:null,remainingTimer:0,maximumPostsDisplayed:30,totalPostCount:null,has300Ad:!1,appRevision:null,events:{"click .js_expand-branch, .reply-content:not(.js_expanded .reply-content, .js_open-branch .reply-content)":"loadPermalink","click .js_pager":"loadMore"},initialize:function(){this.render(),this.fetchPosts(),this.getPostCount(),this.$elements={replyFormContainer:a("#editorplaceholder")},this.services=new c.Container,this.services.registerMany({PostModel:{type:"class",dependency:g},eventDispatcher:{type:"singleton",dependency:i},feature:{type:"singleton",dependency:l},utils:{type:"singleton",dependency:j}}),this.handleStarterInsert(),i.on("reply:insert",this.insertReply,this)},render:function(){return this.$el.find(".js_top-message").html("Loading posts"),this},fetchPosts:function(){var b=new h([],{url:"/api/post/"+this.model.id+"/replies/live"});b.fetch({data:{maxReturned:this.maximumPostsDisplayed},success:a.proxy(this.handleUpdate,this),error:a.proxy(this._pollErrorHandler,this)})},fetchThread:function(b){var c=new h([],{url:"/api/post/"+b+"/replies/flat",model:f}),d={reset:!0,success:a.proxy(this.displayThread,this)};c.fetch(d)},updatePosts:function(){var b=new h([],{url:"/api/post/"+this.model.id+"/replies/live"});b.fetch({data:{maxReturned:5,newerThan:this.getFirstDisplayedTimestamp()},success:a.proxy(this.handleUpdate,this),error:a.proxy(this._pollErrorHandler,this)})},loadPermalink:function(b){var c=a(b.currentTarget);this.fetchThread(c.parents(".js_liveblog-item").data("id"))},loadMore:function(){this.hidePager();var b=new h([],{url:"/api/post/"+this.model.id+"/replies/live"});return b.fetch({data:{maxReturned:this.maximumPostsDisplayed,olderThan:this.getLastDisplayedTimestamp()},success:a.proxy(this.handlePaging,this),error:a.proxy(this._pollErrorHandler,this)}),!1},insertReply:function(){window.setTimeout(a.proxy(this.updatePosts,this),500)},handleUpdate:function(b,c){if(b.length>0){var d,f=tiger.components.liveblog.postList,g=this.soyToHtml(f,{posts:b.invoke("returnElement")});this.$el.find(".js_postlist-shadow").html(g),d=this.$el.find(".js_postlist-shadow").children().hide().detach(),this.$el.find(".js_postlist").prepend(d),e.prototype._fixTimestampPosition.call(this,d),0===this.pollTries?d.fadeIn(50):(this.totalPostCount=this.totalPostCount+b.length,this.updatePostCount(),d.slideDown(300,a.proxy(function(){},this))),0===this.pollTries&&void 0!==c.data&&void 0!==c.data.pagination&&null!==c.data.pagination.next&&this.showPager()}0===this.pollTries?this.appRevision=c.data.appRevision:void 0!==c.data.appRevision&&this.appRevision!==c.data.appRevision&&window.location.reload(),this.pollTries=this.pollTries+1,void 0!==c.data.pollIntervalMillis&&(this.pollInterval=c.data.pollIntervalMillis/1e3),this.pollTries<this.maxPollTries?this.startNextPoll():this.displayPollMaxTries(),this.add300Ad()},handlePaging:function(b,c){var d,e=tiger.components.liveblog.postList,f=this.soyToHtml(e,{posts:b.invoke("returnElement")});this.$el.find(".js_postlist-shadow").html(f),d=this.$el.find(".js_postlist-shadow").children().hide().detach(),this.$el.find(".js_postlist").append(d),d.slideDown(100,a.proxy(function(){void 0!==c.data&&void 0!==c.data.pagination&&null!==c.data.pagination.next&&this.showPager()},this))},displayThread:function(b){var c=a('<div class="js_open-branch open-branch" />'),d=new e({el:c,model:b.first()}),f=this.$el.find("#liveblogpost-"+b.first().get("reply").id);f.length>0?f.before(c):this.$el.find(".js_liveblog-permalink").append(c),a.scrollTo(c,50,{offset:-75}),d.render()},_pollErrorHandler:function(){this.pollInterval=2*this.pollInterval,this.pollInterval<120?this.startNextPoll():this.displayPollError()},startNextPoll:function(){this.stopPolling(),this.pollTimeout=window.setTimeout(a.proxy(this.updatePosts,this),1e3*this.pollInterval),this.remainingTimer=this.pollInterval,this.remainingTimerInterval=window.setInterval(a.proxy(this.displayNextPollTime,this),1e3)},stopPolling:function(){window.clearTimeout(this.pollTimeout),window.clearInterval(this.remainingTimerInterval)},getFirstDisplayedTimestamp:function(){return parseInt(this.$el.find(".js_postlist .js_liveblog-item:first").data("timestamp"),10)||0},getLastDisplayedTimestamp:function(){return parseInt(this.$el.find(".js_postlist .js_liveblog-item:last").data("timestamp"),10)||0},displayPollEnded:function(){},displayPollError:function(){},displayPollMaxTries:function(){this.stopPolling(),this.$el.find(".js_top-message").html("Automatic polling disabled, 3 hour timeout reached")},displayNextPollTime:function(){this.remainingTimer=this.remainingTimer-1,this.$el.find(".js_top-message").html("Next poll in "+this.remainingTimer+" seconds"),this.remainingTimer<=0&&window.clearInterval(this.remainingTimerInterval)},showPager:function(){var b=this.$el.find(".js_pager");b.removeClass("hide").waypoint("destroy"),b.waypoint(a.proxy(function(){b.waypoint("destroy"),this.loadMore()},this),{offset:"100%"})},hidePager:function(){this.$el.find(".js_pager").addClass("hide").waypoint("destroy")},getPostCount:function(){var b=new h([],{url:"/api/post/"+this.model.id+"/replies",model:f}),c={maxReturned:0,maxChildren:0,approvedChildrenOnly:!0,approvedStartersOnly:!0,startIndex:0},d=this,e=function(a){a.listMeta.directReplyCount.approved>0&&(d.totalPostCount=a.listMeta.directReplyCount.approved,d.updatePostCount())};b.fetch({data:c,success:a.proxy(e,this)})},updatePostCount:function(){var b=this.$el.find(".js_discussion-numbers"),c=this.$el.find(".js_post-updates");b.hasClass("hide")?(c.text(this.totalPostCount),b.removeClass("hide")):c.fadeOut(150,a.proxy(function(){c.text(this.totalPostCount).fadeIn(200)},this))},add300Ad:function(c){var d=a.parseParams(),e=180;void 0!==d.adupdate&&b.isNaN(parseInt(d.adupdate,10))===!1&&(e=parseInt(d.adupdate,10)),(c===!0||this.has300Ad===!1)&&(c===!0&&(k.generateOrd(!0),this.$el.find(".js_300-container .content-ad").remove()),this.has300Ad=!0,this.render300Ad(),window.setTimeout(a.proxy(function(){this.add300Ad(!0)},this),1e3*e))},render300Ad:function(){this.$el.find(".js_300-container").append(this.soyToHtml(mantle.components.ad.ad300x600,{slot:"default",post:{id:j.kinjaMeta.post.id,headline:j.kinjaMeta.post.headline,tagUrlNames:b.map(j.kinjaMeta.post.tags,function(a){return a.urlName}).join(","),adZone:j.kinjaMeta.post.adZone}})),i.trigger("zones:added",{})}}));return n}),define("app/mixins/HighlightBox",["lib/jquery","singleton/EventDispatcher"],function(a,b){var c={insertHighlightBox:function(c,d,e,f){var g=c===!1?d:a(c.target),h=c===!1?Math.round(g.width()*e/100):Math.round(c.pageX-g.offset().left),i=c===!1?Math.round(g.height()*f/100):Math.round(c.pageY-g.offset().top),j=g.width()-50,k=50,l=g.height()-50,m=50,n=Math.round((h>j?j-50:k>h?0:h-50)+g.offset().left),o=Math.round((i>l?l-50:m>i?0:i-50)+g.offset().top),p='<div class="annotationHighlightBox" style="top:'+o+"px; left:"+n+'px;"></div>';return c===!1?b.on("imageAnnotationsClose",function(){a(".annotationHighlightBox").remove()},this):b.on("removeReplyForm",function(){a(".annotationHighlightBox").remove()},this),a(".annotationHighlightBox").remove(),a("body").prepend(p),{top:o,left:n}}};return c}),define("app/mixins/AnnotatableParent",[],function(){var a={getAnnotatableParent:function(a){var b=a.parent();return b.hasClass("js_post_item")||b.length<1?a:b.attr("data-textannotation-id")&&b.attr("data-textannotation-id").length>0?b:this.getAnnotatableParent(b)}};return a}),tiger.components.annotation.textFootnote=function(a,b){var c=b||new soy.StringBuilder;return c.append('<span class="js_text-annotation-footnote text-annotation-footnote proxima" data-annotation-id="',soy.$$escapeHtml(a.annotationId),'"><a href="',soy.$$escapeHtml(a.permalink),'" class="js_text-annotation-footnote-link">',soy.$$escapeHtml(a.number),'</a><span class="arrow"></span></span>'),b?"":c.toString()},tiger.components.annotation.imageFootnote=function(a,b){var c=b||new soy.StringBuilder;return c.append('<span class="js_image-annotation-footnote text-annotation-footnote proxima" data-annotation-id="',soy.$$escapeHtml(a.annotationId),'" data-annotation-x="',soy.$$escapeHtml(a.annotationX),'" data-annotation-y="',soy.$$escapeHtml(a.annotationY),'"><a href="',soy.$$escapeHtml(a.permalink),'" class="js_image-annotation-footnote-link">',soy.$$escapeHtml(a.number),'</a><span class="arrow"></span></span>'),b?"":c.toString()},tiger.components.annotation.annotationInset=function(a,b){var c=b||new soy.StringBuilder,d=new soy.StringBuilder("image"==a.inset.annotationType?"image-annotation":"text-annotation");d=d.toString();var e=new soy.StringBuilder("annotation-inset-under","image"==a.inset.annotationType?" image-annotation-inset-under":"");e=e.toString(),c.append('<div class="',soy.$$escapeHtml(e)," js_",soy.$$escapeHtml(d),"-",soy.$$escapeHtml(a.annotationId)," js_",soy.$$escapeHtml(d),'-inset hide" data-annotation-id="',soy.$$escapeHtml(a.annotationId),'"><div class="right js_hide-',soy.$$escapeHtml(d)," cursor-pointer hide-",soy.$$escapeHtml(d),'" id="annotation_',soy.$$escapeHtml(a.annotationId),'"><span class="icon notranslate">8</span></div><div class="annotation-content">',soy.$$filterNoAutoescape(a.inset.excerptWithAssets),'<footer class="row proxima"><div class="small-9 columns"><span class="floated-container img-30"><span class="avatar">');var f=new soy.StringBuilder("avt-large");f=f.toString(),c.append('<span class="img-border mbn mrm"><img src="',soy.$$escapeHtml(window.kinja.imageUrl(a.inset.author.avatar.id,f,a.inset.author.avatar.format)),'" class="avatar" alt="" /></span></span><span class="txt blogname proxima text-upper text-strong text-light txt-30">');for(var g=new soy.StringBuilder,h=a.inset.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g.append(k.id==a.inset.author.defaultBlogId?'<a class="text-light" href="http://'+soy.$$escapeHtml(k.canonicalHost)+'" target="_self">'+soy.$$escapeHtml(a.inset.author.displayName)+"</a>":"")}return g=g.toString(),c.append(g?soy.$$filterNoAutoescape(g):soy.$$escapeHtml(a.inset.author.displayName),'</span></span></div><div class="small-3 columns text-right txt-30"><a class="text-light text-small" href="',soy.$$escapeHtml(a.inset.permalink),'">Expand</a></div></footer></div></div>'),b?"":c.toString()},define("templates/tiger/components/annotation",function(){}),define("app/AnnotationApplet",["lib/jquery","lib/underscore","lib/needly","view/BaseView","model/post/Post","view/items/PostTools","singleton/EventDispatcher","singleton/Utils","singleton/Feature","app/mixins/HighlightBox","app/mixins/AnnotatableParent","module/groupchats/view/OpenReplyForms","templates/tiger/components/annotation"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a(window),n=768,o=250,p=d.extend(b.extend({},j,k,l,{_activeImageAnnotation:a(),_imageAnnotationTimer:!1,_annotatableImage:a(),_annotatableImages:a(),_annotatableImageToolbar:!1,annotationsMaxDisplay:50,annotationsFootnotesMax:5,annotationsStarted:!1,textAnnotatableElements:["blockquote","pre","p","h1","h2","h3","h4","h5","h6"],annotateTextFormInstance:null,_annotationsResponse:!1,events:{"click .js_annotatable-image":"annotateImageHandler","click .js_annotation":"openAnnotation","click .js_viewDiscussion":"viewDiscussion","click .js_text-annotate":"annotateTextHandler","click .js_text-annotation-footnote":"expandTextFootnote","click .js_image-annotation-footnote":"expandImageFootnote","click .js_show-all-footnotes":"showAllFootnotes","click .js_hide-image-annotation":"hideImageAnnotations","click .js_hide-text-annotation":"hideTextAnnotations"},initialize:a.noop,startApp:function(){var b=new e({id:this.model.get("starterId")});this.allowReplies=b.get("allowReplies"),m.width()<=n||this.model.get("liveBlog")||(this._annotatableImages=a("article:not(reframe-post) [data-chomp-id]"),this._annotatableImages.length&&(this.getImageAnnotations(!1),this.model.on("imageAnnotationCreated",function(){this.getImageAnnotations(!0)},this)),this.textAnnotationIsEnabled()&&!this.allowReplies?this.getTextAnnotations(!1,!0):this.textAnnotationIsEnabled()&&this.getTextAnnotations())},textAnnotationIsEnabled:function(){return i.isOn("textannotation")&&a(".reframe-post").length<1},getImageAnnotations:function(a){a=!!a,n<=m.width()&&this.retrieveAnnotations("image",a)},retrieveAnnotations:function(b,c){var d=this,e=c?"?cache="+(new Date).getTime():"";c||!d._annotationsResponse?a.ajax({url:"/api/starter/"+d.model.attributes.starterId+"/annotations"+e,type:"GET",dataType:"json",success:function(a){void 0!==a.meta&&a.meta.success===!0?(d._annotationsResponse=a.data,"image"===b&&d.renderImageAnnotations(a.data,c),"text"===b&&d.renderTextAnnotations(a.data)):this.error()},error:function(){d.trigger("error",d.model)}}):"image"===b?d.renderImageAnnotations(d._annotationsResponse,c):"text"===b&&d.renderTextAnnotations(d._annotationsResponse)},renderImageAnnotations:function(c,d){var e,f,g,i=this,j=c.items,k=0,l=this._annotatableImages,m=[],n=[];if(l.length){for(this.annotationsStarted=!0,f=0,l;f<l.length;f+=1)m.push(a(l[f]).attr("data-chomp-id"));a(".image-annotation-footnote-wrapper").remove(),b.each(b.unique(m),function(b){var c=a("[data-chomp-id="+b+"]").first();i.allowReplies&&c.addClass("js_annotatable-image cursor-crosshair"),c.parent().after('<span class="image-annotation-footnote-wrapper" data-footnote-chomp-id="'+b+'"></span>')}),d=!!d,b.each(j,function(a){var c,d=i.isDisplayedImageAnnotation(a);a.chompId=a.imageChompId,d&&b.contains(m,a.chompId)&&(k+=1,a.count=k,a.imageIndex=b.indexOf(m,a.chompId),a.reply.display.length>o&&(a.reply.display=a.reply.excerptWithAssets,a.reply.annotationReadMore=!0),c={annotation:a,num:k,meta:{relativeTimestamp:i.getRelativeTime(a.reply.lastUpdateTimeMillis),author:{avatar:h.imageUrl(a.reply.author.avatar.id,"avt-small",a.reply.author.avatar.format),displayName:a.reply.author.displayName}}},n.push({imageIndex:a.imageIndex,chompId:a.chompId,timestamp:a.reply.publishTimeMillis,renderedTemplate:i.renderImageAnnotationTemplate(c),footnoteData:{permalink:a.reply.permalink,annotationId:a.id,annotationX:a.x,annotationY:a.y}}))}),n=b.sortBy(n,function(a){return[a.imageIndex,a.timestamp].join("")}),b.each(n,function(b,c){b.footnoteData.number=c+1,e=a("[data-footnote-chomp-id="+b.chompId+"]"),e.append(b.renderedTemplate),e.append(i.soyToHtml(tiger.components.annotation.imageFootnote,b.footnoteData))}),d&&n.length>0&&(g=b.max(n,function(a){return a.timestamp}),a(".js_image-annotation-inset").addClass("hide"),a(".js_image-annotation-footnote").removeClass("selected maincolor-bg"),a('.js_image-annotation-footnote[data-annotation-id="'+g.footnoteData.annotationId+'"]').addClass("selected maincolor-bg"),a(".js_image-annotation-"+g.footnoteData.annotationId).removeClass("hide")),this.reorderFootnotes(),this.pageFootnotes()}},renderImageAnnotationTemplate:function(a){var c,d;return d=a.annotation,c=this.soyToHtml(tiger.components.annotation.annotationInset,{annotationId:d.id,inset:b.extend({annotationType:"image"},d.reply)})},expandImageFootnote:function(b){b.stopPropagation(),b.preventDefault();var c=this,d=a(b.currentTarget),e=d.parent().attr("data-footnote-chomp-id"),f=d.attr("data-annotation-id"),g=a(".js_image-annotation-"+f),h=a(".js_image-annotation-inset"),i=a(".js_image-annotation-footnote"),j=a('[data-chomp-id="'+e+'"]');this.insertHighlightBox(!1,j,d.attr("data-annotation-x"),d.attr("data-annotation-y")),h.addClass("hide"),d.hasClass("selected")?i.removeClass("selected maincolor-bg"):(i.removeClass("selected maincolor-bg"),d.addClass("selected maincolor-bg"),g.removeClass("hide")),a(window).on("keyup.hideImageAnnotations",function(a){(void 0!==a.keyCode&&27===a.keyCode||void 0!==a.which&&27===a.which)&&c.hideImageAnnotations()}),a(window).on("click.hideImageAnnotations",function(b){0===a(b.target).parents(".image-annotation-footnote-wrapper").length&&c.hideImageAnnotations()})},annotateImageHandler:function(b){if(this._activeImageAnnotation.length)this._activeImageAnnotation.removeClass("image-annotation-open"),this._activeImageAnnotation=a();else if(this.annotationsStarted&&new e({id:this.model.get("starterId")}).get("allowReplies")!==!1){var d=this,f=a(b.currentTarget),j=f.offset(),k=f.width(),l=f.height(),m=f.attr("width"),n=f.attr("height"),o=f.attr("data-asset-url"),p=f.attr("data-chomp-id"),q=b.pageX-j.left,r=b.pageY-j.top,s=Math.round(q/k*100),t=Math.round(r/l*100),u=function(a){a.$el.find(".reply-annotation").remove(),a.$el.find("input.js_annotationType").val("IMAGE"),a.$el.find("input.js_imageUrl").val(o),a.$el.find("input.js_imageChompId").val(p),a.$el.find("input.js_imageWidth").val(m?m:k),a.$el.find("input.js_imageHeight").val(n?n:l),a.$el.find("input.js_x").val(s),a.$el.find("input.js_y").val(t)
},v=function(f){d.closeReplyForm(),d.services=new c.Container,d.services.registerMany({PostModel:{type:"class",dependency:e},eventDispatcher:{type:"singleton",dependency:g},feature:{type:"singleton",dependency:i},utils:{type:"singleton",dependency:h}}),a.when(d.openReplyForm(f,!1,"view/editor/Quickannotate")).done(a.proxy(function(c){c.render(b),u(c),c.on("success",function(b){return d.model.trigger("imageAnnotationCreated",b),a(".annotationHighlightBox").remove(),!1})},d))};v(this.model)}else a(".image-annotation").removeClass("image-annotation-open"),this._activeImageAnnotation=a()},getAnnotatableTextEls:function(){var b=a(".post-content.js_text-annotatable").children(this.textAnnotatableElements.join(",")),c=a(".post-content.js_text-annotatable ul").children("li"),d=b.add(c).not(".has-media");return d.length?d:a()},getTextAnnotations:function(c,d){var e=a(".post-content"),f=this;return this.model&&this.model.get("isStarter")===!0&&this.model.on("textAnnotationCreated",function(){this.getTextAnnotations(!0)},this),e.hasClass("js_text-annotatable")&&c!==!0?!1:(e.addClass("js_text-annotatable"),e.find(".text-annotation-button").remove(),b.each(f.getAnnotatableTextEls(),function(b){var c=a(b);d?c.children().last().is("p")?c.children().last().append('<span class="text-annotation-footnote-wrapper"></span>'):c.append('<span class="text-annotation-footnote-wrapper"></span>'):(c.children().last().is("p")?c.children().last().append('<span class="text-annotation-footnote-wrapper"><span class="annotateButton js_text-annotate text-annotation-button icon notranslate">P</span></span>'):c.append('<span class="text-annotation-footnote-wrapper"><span class="annotateButton js_text-annotate text-annotation-button icon notranslate">P</span></span>'),c.on({"mouseenter.annotatetextdisplay":function(){c.find(".text-annotation-button").addClass("text-annotation-button-shown")},"mouseleave.annotatetextdisplay":function(){c.find(".text-annotation-button").removeClass("text-annotation-button-shown")}}))}),g.on("removeAnnotationTextForm",this.destroy,this),this.retrieveAnnotations("text",!0),void 0)},renderTextAnnotations:function(c){var d,e,f,g,h=c.items,i=a(".post-content"),j=0,k=this;k.textFootnoteArray=[],i.find(".js_text-annotation-footnote").remove(),i.find(".js_text-annotation-inset").remove(),b.each(h,function(a){k.isDisplayedImageAnnotation(a)&&(j+=1)}),b.each(h,function(a){k.isDisplayedTextAnnotation(a)&&(d=i.find('[data-textannotation-id="'+a.annotationTextHash+'"]').eq(0),d.length&&(e={inset:a.reply,annotationId:a.id},f={permalink:a.reply.permalink,annotationId:a.id},g=d.index(),k.textFootnoteArray.push({index:g,footnotenode:d.children(".text-annotation-footnote-wrapper").eq(0),footnotedata:f,annotationnode:d,annotationData:e})))}),k.textFootnoteArray=b.sortBy(k.textFootnoteArray,function(a){return a.index}),a.each(k.textFootnoteArray,function(a,b){var c=tiger.components.annotation.textFootnote,d=tiger.components.annotation.annotationInset;b.footnotedata.number=a+j+1,b.footnotenode.prepend(k.soyToHtml(c,b.footnotedata)),b.annotationnode.after(k.soyToHtml(d,b.annotationData))}),this.reorderFootnotes(),this.pageFootnotes()},expandTextFootnote:function(b){b.stopPropagation(),b.preventDefault();var c=a(b.currentTarget),d=c.attr("data-annotation-id"),e=a(".js_text-annotation-"+d),f=a(".js_text-annotation-inset"),g=a(".js_text-annotation-footnote");f.addClass("hide"),c.hasClass("selected")?g.removeClass("selected maincolor-bg"):(g.removeClass("selected maincolor-bg"),c.addClass("selected maincolor-bg"),e.removeClass("hide"))},annotateTextHandler:function(b){var d,f,j,k,l=this,m=b,n=a(b.currentTarget),o=a(".post-content"),p=function(b){k=a("<div></div>").append(j.removeAttr("style").removeAttr("data-textannotation-id").removeClass("js_text-annotate text-annotation-highlight text-annotation-clicked")).html(),b.$el.find(".reply-annotation").remove(),b.$el.find("input").filter(".js_annotationType").val("TEXT").end().filter(".js_annotationType").val("TEXT").end().filter(".js_annotationTextHash").val(f).end().filter(".js_annotationText").val(k).end(),o.find(".text-annotation-clicked").removeClass("text-annotation-clicked").end().find(".text-annotation-button").removeClass("text-annotation-button-clicked"),d.addClass("text-annotation-clicked").find(".text-annotation-button").addClass("text-annotation-button-clicked")},q=function(b,d){l.closeReplyForm(),l.services=new c.Container,l.services.registerMany({PostModel:{type:"class",dependency:e},eventDispatcher:{type:"singleton",dependency:g},feature:{type:"singleton",dependency:i},utils:{type:"singleton",dependency:h}}),a.when(l.openReplyForm(b,!1,"view/editor/Quickannotate")).done(a.proxy(function(a){a.isTextAnnotation=!0,a.render(d),p(a),l.annotateTextFormInstance=a,a.on("success",function(a){return l.model.trigger("textAnnotationCreated",a),!1}),a.on("remove",l.destroy,l)},l))};return d=void 0===n.attr("data-textannotation-id")?this.getAnnotatableParent(n):n,d.parent().is("blockquote")&&(d=d.parent()),f=d.data("textannotation-id"),j=d.clone().find(".text-annotation-footnote-wrapper").remove().end(),null===this.annotateTextFormInstance?this.model.has("original")?q(this.model,b):(l=this,this.model.fetch({success:function(){q(l.model,m)}})):(this.annotateTextFormInstance.positionForm(b),p(this.annotateTextFormInstance)),!1},pageFootnotes:function(){var c,d=a(".text-annotation-footnote-wrapper, .image-annotation-footnote-wrapper"),e=this;b.each(d,function(b){c=a(b).children(".js_text-annotation-footnote, .js_image-annotation-footnote"),c.length>e.annotationsFootnotesMax+1&&(a.each(c,function(b,c){b>=e.annotationsFootnotesMax&&a(c).addClass("hide")}),c.last().after('<span class="js_show-all-footnotes" style="cursor: pointer; color: #666;"> ...<span class="text-annotation-footnote proxima"><a href="#">'+c.last().text()+"</a></span></span>"))})},showAllFootnotes:function(b){a(b.currentTarget).addClass("hide").parent().children(".js_text-annotation-footnote, .js_image-annotation-footnote").removeClass("hide"),b.stopPropagation(),b.preventDefault()},hideAnnotations:function(){this._annotatableImage.parent().find(".image-annotation").addClass("hide")},hideActiveAnnotation:function(){this._activeImageAnnotation.removeClass("image-annotation-open")},removeAnnotations:function(){this._annotatableImage.parent().find(".image-annotation").remove()},hideTextAnnotations:function(){a(".js_text-annotation-inset").addClass("hide"),a(".js_text-annotation-footnote").removeClass("selected maincolor-bg")},hideImageAnnotations:function(){a(".js_image-annotation-inset").addClass("hide"),a(".js_image-annotation-footnote").removeClass("selected maincolor-bg"),g.trigger("imageAnnotationsClose"),a(window).off("keyup.hideImageAnnotations"),a(window).off("click.hideImageAnnotations")},openAnnotation:function(c,d){var h=d&&d.annotation&&d.annotation.length?a(d.annotation):a("#wrap_"+c.currentTarget.id);return a(".image-annotation").removeClass("image-annotation-open"),h.addClass("image-annotation-open"),a(".image-annotation-box").off("mouseleave"),new f({model:new e({id:h.find(".js_reply").data("id")}),el:h.find(".js_reply")}).on({"reply:success":function(a){g.trigger("reply:goto",a)}}),b.each(h.find(".js_endoftext"),function(b){var c=a(b),d=c.parents(".reply-content").children(":not(.js_endoftext)").last();d.append(c.detach().removeClass("hide"))}),this._activeImageAnnotation=h,!1},viewDiscussion:function(b){var c=a(b.currentTarget).data("id");return a(".js_replybranch[data-id="+c+"]").remove(),g.trigger("reply:goto",{model:{id:a(b.currentTarget).data("id")}}),!1},showThisAnnotation:function(a){var b=this.$el.find('[data-annotationnum="'+a+'"]');this.openAnnotation(!1,{annotation:b})},isDisplayedImageAnnotation:function(a){return"IMAGE"===a.annotationType&&a.reply&&a.reply.approved},isDisplayedTextAnnotation:function(a){return"TEXT"===a.annotationType&&a.annotationTextHash&&a.reply&&a.reply.approved&&a.annotationTextHash.length>0},reorderFootnotes:function(){var b=a(".js_image-annotation-footnote-link, .js_text-annotation-footnote-link");a.each(b,function(b,c){a(c).text(b+1)})},destroy:function(){this.annotateTextFormInstance=null,this.getAnnotatableTextEls().off(".annotatetextdisplaywithform").find(".text-annotation-button").removeClass("text-annotation-button-shown text-annotation-button-clicked").end().removeClass("text-annotation-clicked")}}));return p}),define("view/HoverCard",["lib/jquery","view/BaseView","singleton/CurrentUser","singleton/EventDispatcher"],function(a,b,c,d){var e=b.extend({events:{"click .js_followblog":"followBlog","click .js_unfollowblog":"unFollowBlog"},initialize:function(){c.on("change:updateFollow",this.updateFollowButton,this)},openPopover:function(b){var c=a(b.target);a(".hovercard-trigger").removeClass("hover"),c.closest(".hovercard-trigger").addClass("hover"),c.closest(".js_meta-avatar").find(".js_at-user").removeClass("hide")},closePopover:function(){a(".hovercard-trigger").removeClass("hover"),a(".js_at-user").addClass("hide")},followBlog:function(a){return this.followAction("follow",a),!1},unFollowBlog:function(a){return this.followAction("unfollow",a),!1},followAction:function(b,e){var f=a(e.currentTarget),g=f.data("targetblogid");c.isLoggedIn()||d.trigger("loginRequired"),c.onLoggedIn.done(function(){c.setBlogAction(b,c.get("defaultBlogId"),g,{success:function(){c.trigger("change:updateFollow",g,b,"user")},error:function(a){throw new Error("PostTools.followBlog(): "+a.reason)}})})},updateFollowButton:function(b,c,d){if("user"===d){var e=a('.js_author[data-blogid="'+b+'"]').toggleClass("followed","follow"===c);e.find(".js_followforuser").toggleClass("hide","follow"===c).end().find(".js_unfollowforuser").toggleClass("hide","unfollow"===c)}}});return e}),define("app/mixins/PostViewLoader",["lib/jquery","lib/underscore","view/PostView","view/ReplyView","view/HoverCard","singleton/PostHelper"],function(a,b,c,d,e,f){var g={initPostTools:function(){var b;this.on("update.postlist.post",this.addPosts,this),this.on("update.postlist.reply",this.addReplies,this),this.addPosts({el:a("body")}),b=new e({el:a("body")})},addPosts:function(a){this._startPostViews(a,c)},addReplies:function(c){this._startPostViews(c,d),b.isFunction(a.fn.foundation)&&a(document).foundation()},_startPostViews:function(c,d){var e,g;c=c||{},g=c.el||a("body"),e=f.parseFromDom(g),b.each(e,function(a){var b=new d({model:a.model,el:a.node});b.start(),c.callback&&c.callback.call(this,b)},this),e.length>0&&f.likeStatusFor(e,{})}};return g}),mantle.components.post.button.promoteButton=function(a,b){var c=b||new soy.StringBuilder,d=a.assetId?a.assetId:"";return c.append('<a href="#" class="recommend js_recommend ',soy.$$escapeHtml(a.type),"-recommend js_",soy.$$escapeHtml(a.type),"-recommend ",a.isActive?" active ":"",'" data-asset-source="',soy.$$escapeHtml(a.assetSource),'" data-asset-id="',soy.$$escapeHtml(d),'" title="Recommend"><span class="icon icon-white oversized notranslate">1</span></a>'),b?"":c.toString()},define("templates/mantle/components/post/button/promote-button",function(){}),define("app/mixins/PostAssetPromoter",["lib/jquery","lib/underscore","singleton/CurrentUser","singleton/EventDispatcher","view/BaseView","model/post/Post","templates/mantle/components/post/button/promote-button","templates/mantle/messages"],function(a,b,c,d,e,f){var g=e.extend({initialize:function(a){this.model=a.model,this.assets=this.filterAssets(this.model),this.renderUI()},filterAssets:function(a){var c=b.compact(b.map(a.get("images"),this.filterAndCreateImageObject,this)),d=b.compact(b.map(a.get("videos"),this.createVideoObject,this));return c.concat(d)},filterAndCreateImageObject:function(a){var c,d;return a.width>=636?(c=null!==a.id?a.id:"",d=c?this.findByChompId(c):this.$('[src="'+(null!==a.src?a.src:"")+'"]'),b.extend(a,{$el:d,type:"image"})):void 0},createVideoObject:function(a){var c=a.src.split("//")[1],d=this.findByChompId(c);return b.extend(a,{$el:d,type:"video"})},recommendAsset:function(c,d){return a.when(this.callRecommendationService("recommendAsset",c,d)).then(b.bind(this.updateAssetsData,this)).then(b.bind(this.renderUI,this))},unrecommendAsset:function(c,d){return a.when(this.callRecommendationService("unrecommendAsset",c,d)).then(b.bind(this.updateAssetsData,this)).then(b.bind(this.renderUI,this))},callRecommendationService:function(b,d,e){var f=e?e:null;return a.ajax({type:"POST",contentType:"text/json",url:"/api/post/"+this.model.get("id")+"/"+b+"?token="+c.get("token"),data:JSON.stringify({assetUri:d,assetId:f})})},updateAssetsData:function(a){var b=new f(a.data);this.assets=this.filterAssets(b)},renderUI:function(){this.$(".js_post_item").find(".js_recommend").remove(),this.renderPromoteButtons(),this.bindPromoteEvents()},renderPromoteButtons:function(){b.each(this.assets,function(a){this.renderPromoteButton(a)},this)},renderPromoteButton:function(b){var c,d=mantle.components.post.button.promoteButton,e={isActive:b.recommended,type:b.type,assetSource:b.src||b.uri,assetId:void 0!==b.id?b.id:""},f=this.soyToHtml(d,e);switch(b.type){case"image":c=b.$el.closest(".img-border"),0===c.length&&(c=b.$el.closest(".columns"),a(f).addClass("marquee-recommend-btn"));break;case"video":c=b.$el.closest(".flex-video")}c.append(f)},displayRecommendMessage:function(){d.trigger("successbox:display",{message:mantle.messages.assetRecommended})},displayUnrecommendMessage:function(){d.trigger("successbox:display",{message:mantle.messages.assetUnrecommended})},bindPromoteEvents:function(){this.$(".js_post-wrapper").off("click",".js_recommend"),this.$(".js_post-wrapper").on("click",".js_recommend",b.bind(this.recommendClickHandler,this))},recommendClickHandler:function(b){var c=a(b.currentTarget);return this.handleRecommendation(c.data("asset-source"),c.data("asset-id")),!1},handleRecommendation:function(c,d){var e=b.find(this.assets,function(a){return a.recommended===!0}),f=null,g=null,h=null;e&&(f=e.src||e.uri,g=e.id),f?(h=a.when(this.unrecommendAsset(f,g)),f===c?h.then(this.displayUnrecommendMessage):b.delay(a.proxy(function(){h.then(this.recommendAsset(c,d)),h.then(this.displayRecommendMessage)},this),600)):(h=a.when(this.recommendAsset(c,d)),h.then(this.displayRecommendMessage))},findByChompId:function(a){var b;return a.indexOf("#")>-1&&(a=a.split("#")[0]),b=this.$('[data-chomp-id="'+a+'"]'),0===b.length&&(b=this.$('[data-recommend-chomp-id="'+a+'"]')),b}});return{startAssetPromoter:function(a){if(a){var b,c=a.has("images")&&a.get("images").length>0,d=a.has("videos")&&a.get("videos").length>0;(c||d)&&(b=new g({model:a,el:this.el}))}}}}),define("model/post/FlatBranch",["model/Action","collection/Post"],function(a,b){var c=a.extend({defaults:{replies:new b},parse:function(a){return{replies:new b(a)}},returnElement:function(){return this.get("replies").invoke("returnElement")}});return c}),define("collection/FlatBranch",["model/post/FlatBranch","collection/Post"],function(a,b){var c=b.extend({model:a,parse:function(a){if(void 0===a||void 0===a.data||void 0===a.data.items||a.meta.success===!1)return[];var c,d,e,f=b.prototype.parse.apply(this,arguments),g=["atUser","contributors","query","queryType"];void 0!==a.data.byScoreItems&&(d={meta:{success:!0},data:a.data.byScoreItems},a.data.byScoreItems.contributorsPerAuthor.length>0&&(d.contributors=a.data.byScoreItems.contributorsPerAuthor),e=this.listMeta.byScoreItems||new b,e.add(e.parse(d)),this.listMeta.byScoreItems=e);for(c in g)void 0!==a.data[g[c]]&&(this.listMeta[g[c]]=a.data[g[c]]);return f}});return c}),tiger.components.agegate.form=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="age-gate-container"><div class="row"><div class="four columns centered"><form class="js_age-gate-form" action="#"><div class="proxima text-upper text-center mbx">Please confirm your birth date:</div><div class="row mvm"><div class="eleven columns centered"><div class="row"><div class="three mobile-one columns"><input type="text" size="2" maxlength="2" name="month" value="mm" class="js_month" /></div><div class="three mobile-one columns"><input type="text" size="2" maxlength="2" name="day" value="dd" class="js_day" /></div><div class="three mobile-one columns"><input type="text" size="4" maxlength="4" name="year" value="yyyy" class="js_year" /></div><div class="three mobile-one columns"><input class="button" type="submit" value="Submit" /></div></div><div class="row mtm js_date-invalid hide"><div class="twelve columns text-center proxima"><small class="error inline">Please enter a valid date</small></div></div></div></div></form></div></div></div>'),b?"":c.toString()},tiger.components.agegate.rejected=function(a,b){var c=b||new soy.StringBuilder;return c.append('	<div class="age-gate-container"><div class="row"><div class="four columns centered text-center proxima strong"><h2>This content is restricted.</h2></div></div></div>'),b?"":c.toString()},define("templates/tiger/components/agegate",function(){}),define("view/items/AgeGate",["lib/jquery","lib/underscore","view/BaseView","singleton/Utils","templates/tiger/components/agegate"],function(a,b,c,d){var e=c.extend({postList:["479817984","1210675194"],year:null,month:null,day:null,events:{"submit .js_age-gate-form":"handleClick"},initialize:function(){var c,e,f=a.cookie("visitor_birthdate");"permalink"===this.getPageType()&&(c=d.getKinjaMeta().postId,b.indexOf(this.postList,c)>=0&&(null===f?this.render():(e=f.split("_"),this.validateAge(e[0],e[1],e[2])===!0?this.remove():this.rejected())))},render:function(){a("body").prepend(this.soyToHtml(tiger.components.agegate.form,{})),this.$el=a("body .age-gate-container"),this.$el.find(".js_month").focus()},rejected:function(){a("body .age-gate-container").remove(),a("body").prepend(this.soyToHtml(tiger.components.agegate.rejected,{}))},handleClick:function(){return this.validateForm()===!0?this.validateAge(this.year,this.month,this.day)===!0?this.remove():this.rejected():this.$el.find(".js_month").focus(),!1},validateForm:function(){var a=this,c=function(c,d,e){return a[c]=parseInt(a.$(".js_"+c).val(),10),b.isNaN(a[c])===!1&&a[c]>=d&&a[c]<=e},d=c("year",1900,2014)&&c("month",1,12)&&c("day",1,31);return this.$el.find(".js_date-invalid").toggleClass("hide",d),d},validateAge:function(b,c,d){return a.cookie("visitor_birthdate",b+"_"+c+"_"+d),moment(b+"-"+c+"-"+d).add("years",18)<moment()}});return e}),define("view/items/InviteTool",["singleton/EventDispatcher","singleton/CurrentUser","view/BaseView"],function(a,b,c){var d=c.extend({wasLoggedIn:b.isLoggedIn(),initialize:function(){b.on("authenticated",this.render,this)},render:function(){var c=b.isLoggedIn(),d=this.wasLoggedIn&&!c;return this.wasLoggedIn=c,b.isBurner()?this:d?this:(c?b.hasRemote("twitter")||a.trigger("twitterConnectRecommended"):a.trigger("loginRequired",{source:"inviteLink"}),this)}});return d}),define("view/ImageLoader",["lib/jquery","lib/underscore","singleton/Feature","view/BaseView","lib/waypoints","lib/jquery.browser.mobile"],function(a,b,c,d){var e=a(document),f=a(window),g={initialLookaheadFactor:.8,lookaheadFactor:2.6,containerClass:"lazy-image"},h="loaded",i=d.extend({viewportHeight:0,scrollTop:0,initialize:function(c){this.options=b.defaults(c||{},g),b.bindAll(this,"loadIfVisible","handleScroll"),this.registerImages(),this.trigger("initialized"),this.addScrollEvents(),a(window).resize(b.debounce(b.bind(this.setAbsoluteHeight,this),300))},registerImages:function(){var b=this.options.containerClass,c=this.$allWrappers=this.$el.find("."+b);this.$allImages=c.find("img"),this.$watchedImages=a(this.$allImages),this.$watchedWrappers=a(this.$allWrappers),this.setAbsoluteHeight(),this.$allImages.each(function(c,d){var e=a(d);e.data("wrapper",e.closest("."+b))})},addScrollEvents:function(){var c=b.bind(function(){this.viewportHeight=a.waypoints("viewportHeight")},this);c(),f.resize(b.debounce(c,1e3)),f.scroll(b.throttle(b.partial(this.handleScroll,this.options.lookaheadFactor),500)),this.handleScroll(this.options.initialLookaheadFactor)},setAbsoluteHeight:function(){this.$allImages.each(function(b,c){var d=a(c),e=a(c).data("aspectRatio")||a(c).attr("width")/a(c).attr("height");a(c).data("aspectRatio")||a(c).data("aspectRatio",e),d.height(Math.round(d.prop("width")/e))})},loadImage:function(b){var c=a(b);c.data(h)||this.waitForPlaceholder(c)},updateInterchange:b.throttle(function(){a(document).foundation("interchange","reflow")},100),_loadImage:function(a){var c,d=a.data("src"),e=a.data("lazyInterchange");this.trigger("imageLoading",{$el:a}),c=b.bind(function(){a.off("load",c).addClass("lazy-loaded"),this.trigger("imageLoaded",{$el:a}),this.$watchedImages=this.$watchedImages.not(a),this.$watchedWrappers=this.$watchedWrappers.not(a.data("wrapper"))},this),a.load(c).data(h,!0),d?a.attr("src",d):e?(a.attr("data-interchange",e),this.updateInterchange()):a.load()},waitForPlaceholder:function(a){var d,e="await-placeholder",f=a.data("wrapper");c.isOn("imageloadmask")&&f.hasClass("asset-loading")?a.data(e)||(a.data(e,!0),d=b.bind(function(){a.off("load",d),this._loadImage(a)},this),a.load(d)):this._loadImage(a)},loadIfVisible:function(b,c){var d=a(b);d.data(h)||d.is(":hidden")||!this.inViewPort(d,c)||this.loadImage(d)},inViewPort:function(b,c){var d=this.scrollTop,e=c||this.options.lookaheadFactor,f=this.viewportHeight,g=f*e,h=d+f+g,i=d-g,j=Math.round(a(b).offset().top),k=Math.round(j+a(b).outerHeight()),l=k>i,m=h>j;return l&&m},handleScroll:function(a){this.scrollTop=window.pageYOffset||e.scrollTop(),b.each(this.$watchedImages,function(b){this.loadIfVisible(b,a)},this)}});return i}),define("view/GifImageLoader",["lib/jquery","lib/underscore","singleton/EventDispatcher","singleton/Feature","view/ImageLoader","lib/jquery.browser.mobile"],function(a,b,c,d,e){var f,g={mobileGifs:!0,gifClass:"lazy-gif",thawableClass:"thawable",thawingClass:"thawing",thawedClass:"thawed"};return f=e.extend({initialize:function(c){var d=b.extend(this.options,b.defaults(c||{},g));this.addEvents(),e.prototype.initialize.apply(this,arguments),a.browser.mobile&&d.mobileGifs&&this.markImagesThawable()},addEvents:function(){var b=this.options.gifClass,d=function(a){return a.data("wrapper").hasClass(b)};a.browser.mobile||(this.on("imageLoading",function(b){var c=b.$el,e=new Image,f=c.data("anim-src");d(c)&&a(e).attr("src",f)},this),this.on("imageLoaded",function(a){var b=a.$el;d(b)&&this.thawImage(b)},this)),c.on("thawImage",function(a){var b=a.$el;"IMG"!==b.prop("tagName")&&(b=b.find("img")),this.thawImage(b)},this)},markImagesThawable:function(){this.$allWrappers.addClass(this.options.thawableClass)},thawImage:function(a){var b=a.data("animSrc")||a.data("assetUrl"),c=a.data("animInterchange");this.setExplicitHeight(a),this.startLoadIndicator(a),b&&a.attr("src",b),c&&a.data("interchange",c)},startLoadIndicator:function(b){var c=a(b),d=c.data("wrapper"),e=this.options,f=function(){d.removeClass(e.thawingClass).addClass(e.thawedClass)};d.removeClass(e.thawableClass).addClass(e.thawingClass),c.load(f).error(f)},setExplicitHeight:function(b){var c,d=a(b);(d[0].naturalWidth||d[0].complete)&&(c=function(){d.css("height","").off("load",c)},d.height(d.height()).load(c))}})}),define("module/PostApp",["lib/jquery","lib/underscore","lib/momentjs/moment","lib/needly","singleton/Utils","singleton/CurrentUser","singleton/CurrentBlog","singleton/Feature","singleton/ModuleFactory","singleton/EventDispatcher","singleton/KillSwitch","module/BaseApp","module/AmazonInsetsModule","app/LiveblogApplet","app/AnnotationApplet","app/mixins/PostViewLoader","app/mixins/PostAssetPromoter","model/post/Post","model/post/Branch","collection/Post","collection/FlatBranch","view/items/AgeGate","view/items/UserBar","view/items/InviteTool","view/GifImageLoader","lib/jquery.cookie"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=l.extend(b.extend({},p,q,{ageGate:null,inviteTool:null,starterPost:null,initApp:function(){l.prototype.initApp.call(this),this.initPostTools(),this.imageLoader=new y({el:document});var a=parseInt(e.getKinjaMeta().starterId,10),c=b.isNaN(a)||a===this.options.id?this.options.id:a;this.starterPost=new r({id:c})},start:function(){this.starterPost.has("liveBlog")&&this.starterPost.get("liveBlog")===!0?this.startLiveblog():this.startReplyApplet(),this.startAnnotations(),this.startAmazonStats(),this.startAmazonInsets(),this.startAmazonTextLinks(),this.trackPostPage(),this.insertMoatAdScript(),this.loadYoutubeAds(),this.ageGate=new v,this.startInvite(),f.onLoggedIn.done(b.bind(this.initAssetRecommendation,this))},startReplyApplet:function(){var c=a(".js_replies"),k=this.options.query||this.starterPost.get("authorBlogName"),l=!!this.options.allView,m=this.getCommentPermalinkId(),n="GroupchatsModule",o={el:c,model:this.starterPost},p=new d.Container,q=function(a){var c,d=b.defaults({},a);switch(a.model){case"branch":c=s;break;default:c=r}return d.model=c,new t([],d)};p.registerMany({PostModel:{type:"class",dependency:r},PostCollection:{type:"factory",dependency:q},FlatBranchCollection:{type:"class",dependency:u},feature:{type:"singleton",dependency:h},eventDispatcher:{type:"singleton",dependency:j},currentUser:{type:"singleton",dependency:f},currentBlog:{type:"singleton",dependency:g},utils:{type:"singleton",dependency:e}}),i(n,p).done(function(a){a.setOptions(o),m?a.trigger("loadPermalink",{id:m}):l?a.trigger("loadStarters",{}):(window.markUserTime("Groupchats - Start"),a.trigger("loadPersonalizedReplies",{query:k}))}).fail(a.noop),this.trackDiscussionEngagement(this.starterPost.get("permalink"),"groupchats")},startLiveblog:function(){var b=this.getCommentPermalinkId(),c=new n({model:this.starterPost,el:a(".js_liveblog")});b&&c.fetchThread(this.options.id)},getCommentPermalinkId:function(){var a=null,c=parseInt(window.location.hash.substring(1),10);return this.options.id!==this.starterPost.id?a=this.options.id:b.isNaN(c)||(a=c),a},startAnnotations:function(){var b=new o({model:this.starterPost,el:a("body")});b.startApp()},startAmazonStats:function(){var b=this;f.onLoggedIn.done(a.proxy(function(){f.hasPermission("SALES")&&"on"===e.getParameterByName("amazonstats")&&require(["view/amazon/AmazonStatsReport"],function(c){var d=a(".post-wrapper article.post"),e=new c({postId:b.starterPost.id});d.prepend(e.$el)})},this))},startAmazonInsets:function(){var b=this.$el.find(".branch-wrapper article");return b.hasClass("js_amazon_module")?(m.forPost(b),m.forReplies(a(".js_replies")),void 0):!1},startAmazonTextLinks:function(){if(""===document.referrer)return!1;var c=b.filter(a(".post-content a"),function(b){return!!a(b).data("amazontag")}),d=document.referrer.match(/:\/\/([^/]+)\//);null!==d&&(d=d[1],b.each(c,function(b){var c=a(b).attr("href").replace("&ascsubtag=","&ascsubtag=[referrer|"+d);a(b).attr("href",c)}))},startInvite:function(){return-1===document.location.search.indexOf("invitelink")?!1:(f.on("authenticated",function(){null===this.inviteTool&&(this.inviteTool=new x,this.$el.find(".js_replycol").prepend(this.inviteTool.render().$el))},this),void 0)},loadYoutubeAds:function(){if(0===a(".youtubead").length)return!1;var b=function(){var b=a(this).data("width"),c=a(this).data("height"),d=a(this).data("id"),e="948d7212c89311e2892e0019b9f1584b",f="http://www.youtube.com/watch?v="+d,g="http://cdn.visiblemeasures.com/swf/as3/2013-B-75456d/bin/YouTubeEmbeddedPlayer.swf",h="http://cdn.visiblemeasures.com/ad_units/in_banner_video/expressInstall.swf",i={autohide:1,autoplay:0,fs:1,loop:1,vmcKey:e,video:d,chromeless:"1",link:encodeURIComponent(f)},j={allowscriptaccess:"always",allowfullscreen:"true"},k={};swfobject.embedSWF(g,"youtubead-"+d,b,c,"9.0.0",h,i,j,k)};require(["http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"],function(){a(".youtubead").each(function(){b.call(this)})})},initUserTools:function(){var b,c,d=this.options.id;e.getKinjaMeta().post&&e.getKinjaMeta().post.id!==this.options.id&&(d=e.getKinjaMeta().post.id),c=new r({id:d}),b=new w({el:a(".js_topbar"),model:c})},insertMoatAdScript:function(){if(!h.isOn("moatads_promoted")||!e.getKinjaMeta().post.sponsored)return!1;var b=['<script type="text/javascript">',"(function(){",'var a=document,b=a.createElement("script"),a=a.getElementsByTagName("script")[0];','b.type="text/javascript";b.async=!0;','b.src="http://js.moatads.com/gawkersppage4859385728/moatcontent.js";',"a.parentNode.insertBefore(b,a)","})();","</script>"];a("body").append(b.join(""))},initAssetRecommendation:function(){var a=new r(e.getKinjaMeta().post),b=f.hasRole("ADMIN",a.get("defaultBlogId")),c=f.hasSuperuserTools();(b||c)&&this.startAssetPromoter(a)},trackDiscussionEngagement:function(a,b){if(!h.isOn("timespentincomments"))return!1;var c="Discussion engagement";"groupchats"===b?window._gaq.push(["_trackEvent",c,"Full width discussion layout - page load",a]):window._gaq.push(["_trackEvent",c,"Default discussion layout - page load",a])},trackPostPage:function(){var a=c(this.starterPost.get("publishTimeMillis")).format("YYYY/MM/DD");window._gaq.push(["_setCustomVar",1,"Post Publish Date",a,3]),void 0!==e.kinjaMeta.post.tags[0]&&window._gaq.push(["_setCustomVar",1,"Post Primary Tag",e.kinjaMeta.post.tags[0].name,3]),window._gaq.push(["_trackEvent"])}}));return z});